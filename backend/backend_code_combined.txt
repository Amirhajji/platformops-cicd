############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\main.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\main.py
==================================================
# app/main.py
from fastapi import FastAPI
from app.api.routers import signals
from app.api import alerts, components, timeseries , propagation , auth , users
from app.api import analytics
from app.api import system, patterns, simulator
from app.api import anomalies
from fastapi.middleware.cors import CORSMiddleware
from app.api import incidents










app = FastAPI(title="PlatformOPS Observability API")
app.add_middleware(
    CORSMiddleware,
    allow_origins=["http://localhost:5173","http://127.0.0.1:5173" ,"http://localhost:3000",],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)



app.include_router(timeseries.router)
app.include_router(signals.router)
app.include_router(propagation.router)
app.include_router(auth.router)
app.include_router(users.router)
app.include_router(analytics.router)
app.include_router(alerts.router)
app.include_router(system.router)
app.include_router(patterns.router)
app.include_router(simulator.router)
app.include_router(anomalies.router)
app.include_router(incidents.router)
app.include_router(components.router)











############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\api\alerts.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\api\alerts.py
==================================================
# app/api/alerts.py
from fastapi import APIRouter, Depends
from sqlalchemy.orm import Session

from app.db.models.incidents import IncidentAlert
from app.db.session import get_db
from app.db.models.alerts import AlertRule, AlertEvent
from app.db.models.signals import Signal

from app.services.alerts_insight_service import alert_summary, alerts_by_component
from app.services.alert_service import evaluate_alerts



router = APIRouter(prefix="/api/alerts", tags=["Alerts"])


# ------------------------------------------------------------------
# DEBUG
# ------------------------------------------------------------------

@router.get("/ping")
def ping():
    return {"ok": True}


# ------------------------------------------------------------------
# RULES
# ------------------------------------------------------------------

@router.get("/rules")
def list_rules(db: Session = Depends(get_db)):
    return db.query(AlertRule).all()


@router.post("/rules/generate-all")
def generate_all_rules(db: Session = Depends(get_db)):
    from app.services.alert_rule_generator import generate_rules_for_all_metrics
    created = generate_rules_for_all_metrics(db)
    return {
        "created_rules": created,
        "strategy": "metric-family-based",
    }


# ------------------------------------------------------------------
# EVALUATION
# ------------------------------------------------------------------

@router.post("/evaluate")
def evaluate(
    lookback_ticks: int = 200,
    simulation_mode: bool = False,
    db: Session = Depends(get_db),
):
    return evaluate_alerts(
        db=db,
        lookback_ticks=lookback_ticks,
        simulation_mode=simulation_mode,
    )



@router.post("/reset-and-evaluate")
def reset_and_evaluate(
    lookback_ticks: int = 200,
    db: Session = Depends(get_db),
):
    db.query(IncidentAlert).delete()
    db.query(AlertEvent).delete()
    db.commit()

    return evaluate_alerts(
        db=db,
        lookback_ticks=lookback_ticks,
        simulation_mode=False,
    )



# ------------------------------------------------------------------
# EVENTS & INSIGHTS
# ------------------------------------------------------------------

@router.get("/events")
def list_events(
    signal_code: str | None = None,
    status: str | None = None,
    limit: int = 100,
    db: Session = Depends(get_db),
):
    q = db.query(AlertEvent)
    if signal_code:
        q = q.filter(AlertEvent.signal_code == signal_code)
    if status:
        q = q.filter(AlertEvent.status == status)

    return q.order_by(AlertEvent.id.desc()).limit(limit).all()


@router.get("/summary")
def alerts_summary(db: Session = Depends(get_db)):
    return alert_summary(db)


@router.get("/by-component/{component_code}")
def alerts_for_component(component_code: str, db: Session = Depends(get_db)):
    return alerts_by_component(db, component_code)




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\api\analytics.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\api\analytics.py
==================================================
from fastapi import APIRouter, Depends
from sqlalchemy.orm import Session

from app.db.session import get_db
from app.schemas.analytics import ComponentHealth

from app.services.analytics_service import (
    compute_volatility,
    detect_degradation,
    component_health,
    global_health,

    # NEW
    system_stats,
    alerts_stats,
    component_rankings,
    signal_coverage,
    active_hotspots,
)

from app.services.analytics_service import component_time_analysis
from app.services.analytics_service import (
    forecast_signal,
    forecast_component,
)

from app.services.analytics_service import component_regimes
from app.services.analytics_service import signal_influence
from app.services.analytics_service import signal_envelope 
from app.services.analytics_service import component_stress_curve
from app.services.analytics_service import signal_change_impact













router = APIRouter(prefix="/api/analytics", tags=["Analytics"])


# -------------------------
# Existing endpoints (kept) 
# -------------------------
@router.get("/volatility")
def volatility(
    signal_code: str,
    window: int = 10,
    db: Session = Depends(get_db),
):
    return {
        "signal_code": signal_code,
        "window": window,
        "volatility": compute_volatility(db, signal_code, window),
    }


@router.get("/component-health/{component_code}", response_model=ComponentHealth)
def component_health_api(component_code: str, db: Session = Depends(get_db)):
    return {
        "component_code": component_code,
        "health_score": component_health(db, component_code),
    }


@router.get("/global-health")
def global_health_api(db: Session = Depends(get_db)):
    return global_health(db)


@router.get("/top-risk")
def top_risk(role: str, limit: int = 5, db: Session = Depends(get_db)):
    signals = detect_degradation(db, role)
    signals.sort(key=lambda x: abs(x["slope"]), reverse=True)
    return signals[:limit]


@router.get("/degradation")
def degradation(role: str, db: Session = Depends(get_db)):
    return detect_degradation(db, role)


# =========================================================
# NEW: rich global analytics endpoints
# =========================================================

@router.get("/system-stats")
def system_stats_api(db: Session = Depends(get_db)):
    return system_stats(db)


@router.get("/alerts-stats")
def alerts_stats_api(
    from_tick: int | None = None,
    to_tick: int | None = None,
    limit: int = 10,
    db: Session = Depends(get_db),
):
    return alerts_stats(db, from_tick=from_tick, to_tick=to_tick, limit=limit)


@router.get("/component-rankings")
def component_rankings_api(
    limit: int = 10,
    db: Session = Depends(get_db),
):
    return component_rankings(db, limit=limit)


@router.get("/signal-coverage")
def signal_coverage_api(
    window_ticks: int = 200,
    limit: int = 20,
    db: Session = Depends(get_db),
):
    return signal_coverage(db, window_ticks=window_ticks, limit=limit)


@router.get("/active-hotspots")
def active_hotspots_api(
    limit: int = 15,
    db: Session = Depends(get_db),
):
    return active_hotspots(db, limit=limit)


@router.get("/component-time-analysis/{component_code}")
def component_time_analysis_api(
    component_code: str,
    max_ticks: int = 500,
    db: Session = Depends(get_db),
):
    return component_time_analysis(db, component_code, max_ticks)
  




@router.get("/forecast/signal")
def forecast_signal_api(
    signal_code: str,
    horizon_ticks: int = 30,
    db: Session = Depends(get_db),
):
    return forecast_signal(
        db,
        signal_code=signal_code,
        horizon_ticks=horizon_ticks,
    )


@router.get("/forecast/component/{component_code}")
def forecast_component_api(
    component_code: str,
    horizon_ticks: int = 30,
    db: Session = Depends(get_db),
):
    return forecast_component(
        db,
        component_code=component_code,
        horizon_ticks=horizon_ticks,
    )



@router.get("/component-regimes/{component_code}")
def component_regimes_api(
    component_code: str,
    window: int = 1440,
    bucket_size: int = 60,
    db: Session = Depends(get_db),
):
    return component_regimes(
        db=db,
        component_code=component_code,
        window=window,
        bucket_size=bucket_size,
    )


@router.get("/signal-envelope")
def signal_envelope_api(
    signal_code: str,
    window: int = 300,
    bucket: int = 10,
    db: Session = Depends(get_db),
):
    return signal_envelope(db, signal_code, window, bucket)


@router.get("/component-stress/{component_code}")
def component_stress_api(
    component_code: str,
    window: int = 600,
    bucket: int = 20,
    db: Session = Depends(get_db),
):
    return component_stress_curve(db, component_code, window, bucket)


@router.get("/signal-change-impact")
def signal_change_impact_api(
    signal_code: str,
    pivot_tick: int,
    window: int = 200,
    db: Session = Depends(get_db),
):
    return signal_change_impact(db, signal_code, pivot_tick, window)




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\api\anomalies.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\api\anomalies.py
==================================================
# app/api/anomalies.py
from fastapi import APIRouter, Depends, HTTPException
from sqlalchemy.orm import Session

from app.db.session import get_db
from app.services.anomaly_analysis_service import anomaly_full_analysis
from app.services.anomaly_injection_service import inject_anomaly
from app.services.anomaly_rollback_service import rollback_anomalies
from app.services.anomaly_insight_service import active_anomalies
from app.services.anomaly_impact_service import anomaly_impact_summary


router = APIRouter(prefix="/api/anomalies", tags=["Anomalies"])


@router.post("/inject")
def inject(
    pipeline: str,
    anomaly_type: str,
    from_tick: int,
    to_tick: int,
    strength: float = 1.0,
    db: Session = Depends(get_db),#
):
    try:
        affected = inject_anomaly(
            db=db,
            pipeline=pipeline,
            anomaly_type=anomaly_type,
            from_tick=from_tick,
            to_tick=to_tick,
            strength=strength,
        )
    except Exception as e:
        raise HTTPException(status_code=400, detail=str(e))

    return {
        "anomaly_type": anomaly_type,
        "pipeline": pipeline,
        "affected_points": affected,
    }


@router.post("/rollback")
def rollback(db: Session = Depends(get_db)):
    restored = rollback_anomalies(db)
    return {"restored_points": restored}


@router.get("/active")
def active(db: Session = Depends(get_db)):
    return active_anomalies(db)


@router.get("/impact")
def impact(db: Session = Depends(get_db)):
    return anomaly_impact_summary(db)

#@router.get("/analysis1")
#def analysis(db: Session = Depends(get_db)):
#    return analyze_anomaly(db)

@router.get("/analysis")
def analysis(db: Session = Depends(get_db)):
    return anomaly_full_analysis(db)





############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\api\auth.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\api\auth.py
==================================================
# app/api/auth.py
from http.client import HTTPException
from fastapi import APIRouter, Depends
from sqlalchemy.orm import Session
from app.db.models.users import User
from app.schemas.auth import SignupRequest, LoginRequest, TokenResponse, UserInfo
from app.services.auth_service import signup, login
from app.db.session import get_db
from app.dependencies.auth import get_current_user
from jose import JWTError
from app.core.security import decode_email_verification_token

router = APIRouter(prefix="/api/auth", tags=["auth"])


@router.post("/signup")
def signup_api(req: SignupRequest, db: Session = Depends(get_db)):
    user = signup(db, req.username, req.password)
    return {"id": str(user.id), "username": user.username}


@router.post("/login", response_model=TokenResponse)
def login_api(req: LoginRequest, db: Session = Depends(get_db)):
    token = login(db, req.username, req.password)
    return {"access_token": token}


@router.get("/me", response_model=UserInfo)
def me(user=Depends(get_current_user)):
    return {
        "id": str(user.id),
        "username": user.username,
        "roles": user.roles_from_token,
        "is_active": user.is_active,
    }





@router.get("/verify-email")
def verify_email(token: str, db: Session = Depends(get_db)):
    try:
        payload = decode_email_verification_token(token)
    except JWTError:
        raise HTTPException(status_code=400, detail="Invalid or expired token")

    user_id = payload.get("sub")
    user = db.query(User).filter(User.id == user_id).first()

    if not user:
        raise HTTPException(status_code=404, detail="User not found")

    if user.is_active:
        return {"message": "Account already verified"}

    user.is_active = True
    db.commit()

    return {"message": "Account verified successfully"}




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\api\components.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\api\components.py
==================================================
from fastapi import APIRouter, Depends
from sqlalchemy.orm import Session

from app.db.session import get_db
from app.services.components_service import (
    get_related_signals,
    get_health_breakdown,
    get_family_snapshot,
    get_anomaly_contribution,
    get_forecast_summary,
)

router = APIRouter(prefix="/api/components", tags=["Components"])


@router.get("/{component_code}/related-signals")
def related_signals(
    component_code: str,
    limit: int = 8,
    min_correlation: float = 0.7,
    db: Session = Depends(get_db),
):
    return get_related_signals(db, component_code, limit, min_correlation)


@router.get("/{component_code}/health-breakdown")
def health_breakdown(
    component_code: str,
    db: Session = Depends(get_db),
):
    return get_health_breakdown(db, component_code)


@router.get("/{component_code}/family-snapshot")
def family_snapshot(
    component_code: str,
    family: str,
    window: int = 60,
    db: Session = Depends(get_db),
):
    return get_family_snapshot(db, component_code, family, window)


@router.get("/{component_code}/anomaly-contribution")
def anomaly_contribution(
    component_code: str,
    db: Session = Depends(get_db),
):
    return get_anomaly_contribution(db, component_code)


@router.get("/{component_code}/forecast-summary")
def forecast_summary(
    component_code: str,
    horizon_ticks: int = 60,
    db: Session = Depends(get_db),
):
    return get_forecast_summary(db, component_code, horizon_ticks)



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\api\deps.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\api\deps.py
==================================================
# app/api/deps.py
from app.db.session import SessionLocal

def get_db():
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\api\incidents.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\api\incidents.py
==================================================
# app/api/incidents.py
from fastapi import APIRouter, Depends
from sqlalchemy.orm import Session

from app.db.session import get_db
from app.db.models.incidents import Incident
from app.services.incident_service import evaluate_incidents


router = APIRouter(prefix="/api/incidents", tags=["Incidents"])


@router.post("/evaluate")
def evaluate(db: Session = Depends(get_db)):
    return evaluate_incidents(db)


@router.get("/")
def list_incidents(db: Session = Depends(get_db)):
    return db.query(Incident).order_by(Incident.id.desc()).all()


@router.get("/{incident_id}")
def get_incident(incident_id: int, db: Session = Depends(get_db)):
    return (
        db.query(Incident)
        .filter(Incident.id == incident_id)
        .one_or_none()
    )




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\api\patterns.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\api\patterns.py
==================================================
# app/api/patterns.py
from fastapi import APIRouter, Depends
from sqlalchemy.orm import Session
from app.db.session import get_db
from app.services.patterns_service import detect_spikes, detect_recovery

router = APIRouter(prefix="/api/analytics/patterns", tags=["Patterns"])


@router.get("/spikes")
def spikes(db: Session = Depends(get_db)):
    return detect_spikes(db)


@router.get("/recovery")
def recovery(db: Session = Depends(get_db)):
    return detect_recovery(db)




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\api\propagation.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\api\propagation.py
==================================================
# app/api/propagation.py
from fastapi import APIRouter, Depends, HTTPException
from sqlalchemy.orm import Session
from app.db.session import get_db
from app.services.propagation_service import compute_propagation

router = APIRouter(prefix="/api/propagation", tags=["propagation"])


@router.get("")
def propagation(
    source_signal: str,
    target_signal: str,
    window: int = 30,
    db: Session = Depends(get_db),
):
    try:
        return compute_propagation(
            db=db,
            source_signal=source_signal,
            target_signal=target_signal,
            window=window,
        )
    except ValueError as e:
        raise HTTPException(status_code=400, detail=str(e))




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\api\simulator.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\api\simulator.py
==================================================
# app/api/simulator.py
from fastapi import APIRouter, Depends
from sqlalchemy.orm import Session
from sqlalchemy import text
from app.db.session import get_db

router = APIRouter(prefix="/api/simulator", tags=["Simulator"])


@router.get("/state")
def simulator_state(tick: int, db: Session = Depends(get_db)):
    sql = """
    SELECT component_code, payload
    FROM timeseries_points
    WHERE tick = :tick
    """

    rows = db.execute(text(sql), {"tick": tick}).fetchall()

    state = {}

    for r in rows:
        if r.component_code not in state:
            state[r.component_code] = {}
        state[r.component_code].update(r.payload)

    return {
        "tick": tick,
        "state": state
    }




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\api\system.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\api\system.py
==================================================
# app/api/system.py
from fastapi import APIRouter, Depends
from sqlalchemy.orm import Session
from sqlalchemy import func
from app.db.session import get_db
from app.db.models.signals import Signal
from app.db.models.alerts import AlertEvent
from app.services.analytics_service import component_health
from app.services.email_service import send_email


router = APIRouter(prefix="/api/system", tags=["System"])


@router.get("/overview")
def system_overview(db: Session = Depends(get_db)):
    components = (
        db.query(Signal.component_code)
        .distinct()
        .all()
    )

    result = []

    for (component_code,) in components:
        health = component_health(db, component_code)

        active_alerts = (
            db.query(AlertEvent)
            .filter(AlertEvent.component_code == component_code)
            .count()
        )

        result.append({
            "component_code": component_code,
            "health_score": health,
            "active_alerts": active_alerts,
            "status": (
                "CRITICAL" if health < 40 else
                "DEGRADED" if health < 70 else
                "OK"
            )
        })

    return result


@router.get("/components")
def list_components(db: Session = Depends(get_db)):
    components = (
        db.query(
            Signal.component_code,
            func.count(Signal.signal_code).label("signals")
        )
        .group_by(Signal.component_code)
        .all()
    )

    return [
        {
            "component_code": c,
            "signal_count": count
        }
        for c, count in components
    ]


@router.get("/components/{component_code}")
def component_details(component_code: str, db: Session = Depends(get_db)):
    signals = (
        db.query(Signal)
        .filter(Signal.component_code == component_code)
        .all()
    )

    return {
        "component_code": component_code,
        "signals": [
            {
                "signal_code": s.signal_code,
                "type": s.signal_type,
                "unit": s.unit,
                "polarity": s.polarity,
                "description": s.description
            }
            for s in signals
        ],
        "health_score": component_health(db, component_code)
    }





@router.post("/test-email")
def test_email():
    send_email(
        to_email="test@local.test",
        subject="SMTP Test",
        text="Plain text email works",
        html="<h1>HTML email works</h1>",
    )
    return {"sent": True}


@router.get("/{component_code}/related-signals")
def get_related_signals(
    component_code: str,
    limit: int = 8,
    min_correlation: float = 0.7,
    db: Session = Depends(get_db)
):
    # Use existing propagation evidence table or compute on-the-fly
    related = (
        db.query(PropagationEvidence)
        .filter(
            or_(
                PropagationEvidence.source_signal.in_(
                    db.query(Signal.signal_code).filter(Signal.component_code == component_code)
                ),
                PropagationEvidence.target_signal.in_(
                    db.query(Signal.signal_code).filter(Signal.component_code == component_code)
                )
            ),
            PropagationEvidence.correlation >= min_correlation
        )
        .order_by(desc(PropagationEvidence.correlation))
        .limit(limit)
        .all()
    )

    return {
        "component_code": component_code,
        "related": [
            {
                "signal_code": r.target_signal if r.source_signal in primary else r.source_signal,
                "component_code": "...",  # resolve from signals table
                "lag_ticks": r.lag_ticks,
                "correlation": r.correlation,
                "confidence": r.confidence_score,
                "direction": "upstream" if r.target_signal in primary else "downstream"
            }
            for r in related
        ]
    }



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\api\timeseries.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\api\timeseries.py
==================================================
# app/api/timeseries.py
from fastapi import APIRouter, Depends, HTTPException, Query
from sqlalchemy.orm import Session

from app.db.session import get_db
from app.services.timeseries_service import get_timeseries
from app.services import timeseries_service

router = APIRouter(prefix="/api/timeseries", tags=["timeseries"])


@router.get("")
def read_timeseries(
    signal_code: str,
    from_tick: int | None = None,
    to_tick: int | None = None,
    db: Session = Depends(get_db),
):
    try:
        return get_timeseries(
            db=db,
            signal_code=signal_code,
            from_tick=from_tick,
            to_tick=to_tick,
        )
    except ValueError as e:
        raise HTTPException(status_code=404, detail=str(e))


@router.get("/multi")
def multi_timeseries(
    signals: str = Query(...),
    db: Session = Depends(get_db)
):
    return {
        "signals": timeseries_service.multi_signal(
            db, signals.split(",")
        )
    }
#

@router.get("/aggregate")
def aggregate(
    signal_code: str,
    window: int = 10,
    agg: str = "avg",
    db: Session = Depends(get_db)
):
    return timeseries_service.aggregate_signal(
        db, signal_code, window, agg #
    )



@router.get("/derivative")
def derivative(
    signal_code: str,
    db: Session = Depends(get_db)
):
    return timeseries_service.derivative_signal(db, signal_code)


@router.get("/normalized")
def normalized(
    signal_code: str,
    db: Session = Depends(get_db)
):
    return timeseries_service.normalize_signal(db, signal_code)




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\api\users.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\api\users.py
==================================================
# app/api/users.py
from fastapi import APIRouter, Depends
from sqlalchemy.orm import Session
from app.db.session import get_db
from app.dependencies.auth import require_admin
from app.schemas.user import AssignRolesRequest
from app.services.user_service import assign_roles
from app.db.models.users import User

router = APIRouter(prefix="/api/users", tags=["users"])


@router.get("/")
def list_users(db: Session = Depends(get_db), admin=Depends(require_admin)):
    return [
        {
            "id": str(u.id),
            "username": u.username,
            "roles": [r.id for r in u.roles],
            "is_active": u.is_active,
        }
        for u in db.query(User).all()
    ]


@router.post("/{user_id}/roles")
def set_roles(
    user_id: str,
    req: AssignRolesRequest,
    db: Session = Depends(get_db),
    admin=Depends(require_admin),
):
    user = assign_roles(db, user_id, req.roles)
    return {"id": str(user.id), "roles": [r.id for r in user.roles]}




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\api\routers\signals.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\api\routers\signals.py
==================================================
# app/api/routers/signals.py
from fastapi import APIRouter, Depends, Query
from sqlalchemy.orm import Session
from app.api.deps import get_db
from app.schemas.signal import SignalOut
from app.services.signal_service import list_signals

router = APIRouter(prefix="/api/signals", tags=["signals"])

@router.get("", response_model=list[SignalOut])
def get_signals(
    role: str = Query(..., regex="^(ops|architect|exec)$"),
    db: Session = Depends(get_db)
):
    return list_signals(db, role)




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\api\routers\__pycache__\signals.cpython-311.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\api\routers\__pycache__\signals.cpython-311.pyc
==================================================
§
    ]£Ciá  ã                   óê   — d dl mZmZmZ d dlmZ d dlmZ d dlm	Z	 d dl
mZ  eddg¬¦  «        Ze                     d	ee	         ¬
¦  «         edd¬¦  «         ee¦  «        fdedefd„¦   «         ZdS )é    )Ú	APIRouterÚDependsÚQuery)ÚSession)Úget_db)Ú	SignalOut©Úlist_signalsz/api/signalsÚsignals)ÚprefixÚtagsÚ )Úresponse_model.z^(ops|architect|exec)$)ÚregexÚroleÚdbc                 ó"   — t          || ¦  «        S )Nr	   )r   r   s     úLC:\Users\h50048240\3D Objects\PlatformOPS\backend\app\api\routers\signals.pyÚget_signalsr   
   s   € õ
 ˜˜DÑ!Ô!Ð!ó    N)Úfastapir   r   r   Úsqlalchemy.ormr   Úapp.api.depsr   Úapp.schemas.signalr   Úapp.services.signal_servicer
   ÚrouterÚgetÚlistÚstrr   © r   r   ú<module>r!      sñ   ðØ -Ð -Ð -Ð -Ð -Ð -Ð -Ð -Ð -Ð -Ø "Ð "Ð "Ð "Ð "Ð "à Ð Ð Ð Ð Ð Ø (Ð (Ð (Ð (Ð (Ð (Ø 4Ð 4Ð 4Ð 4Ð 4Ð 4à	ˆ˜.°	¨{Ð	;Ñ	;Ô	;€à‡‚ˆB˜t Iœ€Ñ/Ô/àcÐ!9Ð:Ñ:Ô:Ø'˜&‘/”/ð"ð "Ø
ð"àð"ð "ð "ñ 0Ô/ð"ð "ð "r   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\api\routers\__pycache__\signals.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\api\routers\__pycache__\signals.cpython-314.pyc
==================================================
+
    ŠxTiý  ã                   óÊ   € ^ RI HtHtHt ^ RIHt ^ RIHt ^ RIH	t	 ^ RI
Ht ]! RR.R7      t]P                  R	]]	,          R
7      ]! RRR7      ]! ]4      3R R ll4       tR# )é    )Ú	APIRouterÚDependsÚQuery)ÚSession)Úget_db)Ú	SignalOut©Úlist_signalsz/api/signalsÚsignals)ÚprefixÚtagsÚ )Úresponse_model.z^(ops|architect|exec)$)Úregexc                ó0   € V ^8„  d   QhR\         R\        /# )é   ÚroleÚdb)Ústrr   )Úformats   "ÚLC:\Users\h50048240\3D Objects\platformOPS\backend\app\api\routers\signals.pyÚ__annotate__r      s   € ÷ "ñ "Ü
ð"äñ"ó    c                 ó   € \        W4      # )Nr	   )r   r   s   &&r   Úget_signalsr   
   s   € ô
 ˜Ó!Ð!r   N)Úfastapir   r   r   Úsqlalchemy.ormr   Úapp.api.depsr   Úapp.schemas.signalr   Úapp.services.signal_servicer
   ÚrouterÚgetÚlistr   © r   r   Ú<module>r%      sZ   ðç -Ñ -Ý "Ý Ý (Ý 4á	˜.°	¨{Ô	;€à‡ˆB˜t I€Ó/ácÐ!9Ô:Ù˜&“/ö"ó 0ò"r   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\api\routers\__pycache__\timeseries.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\api\routers\__pycache__\timeseries.cpython-314.pyc
==================================================
+
    ¶¦Ci…  ã                   ó    € ^ RI HtHtHt ^ RIHt ^ RIHt ^ RIH	t	 ]! RR.R7      t
]
P                  R4      ^ R	^]! ]4      3R
 R ll4       tR	# )é    )Ú	APIRouterÚDependsÚQuery)ÚSession)Úget_db©Úfetch_timeseriesz/api/timeseriesÚ
timeseries)ÚprefixÚtagsÚ Nc                ón   € V ^8„  d   QhR\         R\         R\        R\        R,          R\        R\        /# )é   ÚroleÚsignal_codeÚ	from_tickÚto_tickNÚ
downsampleÚdb)ÚstrÚintr   )Úformats   "ÚOC:\Users\h50048240\3D Objects\PlatformOPS\backend\app\api\routers\timeseries.pyÚ__annotate__r   	   sH   € ÷ ñ Ü
ðäðô ðô 4Zð	ô
 ðô 	ñó    c           	      ó$   € \        VV VVVVR 7      # ))r   r   r   r   r   r   r   )r   r   r   r   r   r   s   &&&&&&r   Úget_timeseriesr      s#   € ô ØØØØØØôð r   )Úfastapir   r   r   Úsqlalchemy.ormr   Úapp.db.sessionr   Úapp.services.timeseries_servicer	   ÚrouterÚgetr   © r   r   Ú<module>r%      sO   ðß -Ñ -Ý "Ý !Ý <á	Ð+°<°.Ô	A€à‡ˆBƒð ØØÙ˜&“/öó òr   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\api\__pycache__\alerts.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\api\__pycache__\alerts.cpython-314.pyc
==================================================
+
    å£ai£  ã                   ó¬  € ^ RI HtHt ^ RIHt ^ RIHt ^ RIHt ^ RI	H
t
Ht ^ RIHt ^ RIHtHt ^ RIHt ]! R	R
.R7      t]P)                  R4      R 4       t]P)                  R4      ]! ]4      3R R ll4       t]P/                  R4      ]! ]4      3R R ll4       t]P/                  R4      ^ÈR]! ]4      3R R ll4       t]P/                  R4      ^È]! ]4      3R R ll4       t]P)                  R4      RR^d]! ]4      3R R ll4       t]P)                  R4      ]! ]4      3R  R! ll4       t]P)                  R"4      ]! ]4      3R# R$ ll4       tR# )%é    )Ú	APIRouterÚDepends©ÚSession)ÚIncidentAlert)Úget_db)Ú	AlertRuleÚ
AlertEvent)ÚSignal)Úalert_summaryÚalerts_by_component©Úevaluate_alertsz/api/alertsÚAlerts)ÚprefixÚtagsz/pingc                  ó
   € R R/# )ÚokT© r   ó    ÚCC:\Users\h50048240\3D Objects\PlatformOPS\backend\app\api\alerts.pyÚpingr      s   € à$ˆ<Ðr   z/rulesc                ó$   € V ^8„  d   QhR\         /# ©é   Údbr   )Úformats   "r   Ú__annotate__r       s   € ÷ %ñ %”7ñ %r   c                 óH   € V P                  \        4      P                  4       # ©N)Úqueryr	   Úall©r   s   &r   Ú
list_rulesr$      s   € à8‰8”IÓ×"Ñ"Ó$Ð$r   z/rules/generate-allc                ó$   € V ^8„  d   QhR\         /# r   r   )r   s   "r   r   r   %   s   € ÷ ñ œ7ñ r   c                 ó*   € ^ RI Hp V! V 4      pRVRR/# )r   )Úgenerate_rules_for_all_metricsÚcreated_rulesÚstrategyzmetric-family-based)Ú!app.services.alert_rule_generatorr'   )r   r'   Úcreateds   &  r   Úgenerate_all_rulesr,   $   s$   € åPÙ,¨RÓ0€Gà˜ØÐ)ðð r   z	/evaluateFc                ó<   € V ^8„  d   QhR\         R\        R\        /# )r   Úlookback_ticksÚsimulation_moder   )ÚintÚboolr   )r   s   "r   r   r   3   s&   € ÷ 	ñ 	Üð	äð	ô 	ñ	r   c                 ó   € \        VV VR 7      # )©r   r.   r/   r   )r.   r/   r   s   &&&r   Úevaluater4   2   s   € ô ØØ%Ø'ôð r   z/reset-and-evaluatec                ó0   € V ^8„  d   QhR\         R\        /# )r   r.   r   )r0   r   )r   s   "r   r   r   A   s   € ÷ ñ Üðäñr   c                 óÊ   € VP                  \        4      P                  4        VP                  \        4      P                  4        VP	                  4        \        VV R R7      # )Fr3   )r!   r   Údeleter
   Úcommitr   )r.   r   s   &&r   Úreset_and_evaluater9   @   sM   € ð
 ‡HHŒ]Ó×"Ñ"Ô$Ø‡HHŒZÓ×ÑÔ!Ø‡II„KäØØ%Øôð r   z/eventsNc                ód   € V ^8„  d   QhR\         R,          R\         R,          R\        R\        /# )r   Úsignal_codeNÚstatusÚlimitr   )Ústrr0   r   )r   s   "r   r   r   V   s8   € ÷ ?ñ ?Üt•ð?ä$Jð?ô ð?ô 	ñ	?r   c                 óh  € VP                  \        4      pV '       d#   VP                  \        P                  V 8H  4      pV'       d#   VP                  \        P                  V8H  4      pVP                  \        P                  P                  4       4      P                  V4      P                  4       # r    )
r!   r
   Úfilterr;   r<   Úorder_byÚidÚdescr=   r"   )r;   r<   r=   r   Úqs   &&&& r   Úlist_eventsrE   U   sz   € ð 	‰”Ó€AßØH‰H”Z×+Ñ+¨{Ñ:Ó;ˆßØH‰H”Z×&Ñ&¨&Ñ0Ó1ˆà:‰:”j—m‘m×(Ñ(Ó*Ó+×1Ñ1°%Ó8×<Ñ<Ó>Ð>r   z/summaryc                ó$   € V ^8„  d   QhR\         /# r   r   )r   s   "r   r   r   f   s   € ÷ ñ ”wñ r   c                 ó   € \        V 4      # r    )r   r#   s   &r   Úalerts_summaryrH   e   s   € ä˜ÓÐr   z/by-component/{component_code}c                ó0   € V ^8„  d   QhR\         R\        /# )r   Úcomponent_coder   )r>   r   )r   s   "r   r   r   k   s   € ÷ 3ñ 3¬ð 3´'ñ 3r   c                 ó   € \        W4      # r    )r   )rJ   r   s   &&r   Úalerts_for_componentrL   j   s   € ä˜rÓ2Ð2r   )Úfastapir   r   Úsqlalchemy.ormr   Úapp.db.models.incidentsr   Úapp.db.sessionr   Úapp.db.models.alertsr	   r
   Úapp.db.models.signalsr   Ú#app.services.alerts_insight_servicer   r   Úapp.services.alert_servicer   ÚrouterÚgetr   r$   Úpostr,   r4   r9   rE   rH   rL   r   r   r   Ú<module>rX      s[  ðç &Ý "å 1Ý !ß 6Ý (ç RÝ 6ñ 
˜-¨x¨jÔ	9€ð ‡ˆGÓñó ðð ‡ˆHÓÙ$ V›_ö %ó ð%ð ‡Ð"Ó#Ù%,¨V£_ö ó $ðð ‡ˆ[ÓàØ!Ù˜&“/ö	ó ð	ð ‡Ð"Ó#àÙ˜&“/öó $ðð( ‡ˆIÓà"ØØÙ˜&“/ö	?ó ð?ð ‡ˆJÓÙ!(¨£ö ó ðð ‡Ð,Ó-Ù<CÀF»Oö 3ó .ò3r   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\api\__pycache__\analytics.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\api\__pycache__\analytics.cpython-314.pyc
==================================================
+
    þã\i‚  ã                   ó¤  € ^ RI HtHt ^ RIHt ^ RIHt ^ RIHt ^ RI	H
t
HtHtHtHtHtHtHtHt ^ RI	Ht ^ RI	HtHt ^ RI	Ht ^ R	I	Ht ^ R
I	Ht ^ RI	Ht ^ RI	Ht ]! RR.R7      t]P9                  R4      ^
]! ]4      3R R ll4       t]P9                  R]R7      ]! ]4      3R R ll4       t]P9                  R4      ]! ]4      3R R ll4       t]P9                  R4      ^]! ]4      3R R ll4       t ]P9                  R4      ]! ]4      3R R ll4       t!]P9                  R 4      ]! ]4      3R! R" ll4       t"]P9                  R#4      R$R$^
]! ]4      3R% R& ll4       t#]P9                  R'4      ^
]! ]4      3R( R) ll4       t$]P9                  R*4      ^È^]! ]4      3R+ R, ll4       t%]P9                  R-4      ^]! ]4      3R. R/ ll4       t&]P9                  R04      R1]! ]4      3R2 R3 ll4       t']P9                  R44      ^]! ]4      3R5 R6 ll4       t(]P9                  R74      ^]! ]4      3R8 R9 ll4       t)]P9                  R:4      R;^<]! ]4      3R< R= ll4       t*]P9                  R>4      R?^
]! ]4      3R@ RA ll4       t+]P9                  RB4      RC^]! ]4      3RD RE ll4       t,]P9                  RF4      ^È]! ]4      3RG RH ll4       t-R$# )Ié    )Ú	APIRouterÚDepends©ÚSession)Úget_db)ÚComponentHealth)	Úcompute_volatilityÚdetect_degradationÚcomponent_healthÚglobal_healthÚsystem_statsÚalerts_statsÚcomponent_rankingsÚsignal_coverageÚactive_hotspots©Úcomponent_time_analysis)Úforecast_signalÚforecast_component©Úcomponent_regimes)Úsignal_influence©Úsignal_envelope©Úcomponent_stress_curve©Úsignal_change_impactz/api/analyticsÚ	Analytics)ÚprefixÚtagsz/volatilityc                ó<   € V ^8„  d   QhR\         R\        R\        /# )é   Úsignal_codeÚwindowÚdb©ÚstrÚintr   )Úformats   "ÚFC:\Users\h50048240\3D Objects\PlatformOPS\backend\app\api\analytics.pyÚ__annotate__r,   4   s&   € ÷ 	ñ 	Üð	äð	ô 	ñ	ó    c           
      ó&   € R V RVR\        W V4      /# )r$   r%   Ú
volatility)r	   )r$   r%   r&   s   &&&r+   r/   r/   3   s%   € ð 	{Ø&ØÔ(¨¸&ÓAðð r-   z"/component-health/{component_code})Úresponse_modelc                ó0   € V ^8„  d   QhR\         R\        /# )r#   Úcomponent_coder&   ©r(   r   )r*   s   "r+   r,   r,   A   s   € ÷ ñ ¬ð ´'ñ r-   c                 ó    € R V R\        W4      /# )r2   Úhealth_score)r   )r2   r&   s   &&r+   Úcomponent_health_apir6   @   s   € ð 	˜.ØÔ(¨Ó<ðð r-   z/global-healthc                ó$   € V ^8„  d   QhR\         /# ©r#   r&   r   )r*   s   "r+   r,   r,   I   s   € ÷ ñ œ'ñ r-   c                 ó   € \        V 4      # ©N)r   ©r&   s   &r+   Úglobal_health_apir<   H   s   € ä˜ÓÐr-   z	/top-riskc                ó<   € V ^8„  d   QhR\         R\        R\        /# )r#   ÚroleÚlimitr&   r'   )r*   s   "r+   r,   r,   N   s!   € ÷ ñ ”3ð œsð ¬Gñ r-   c                 óJ   € \        W 4      pVP                  R  RR7       VRV # )c                 ó&   € \        V R ,          4      # )Úslope)Úabs)Úxs   &r+   Ú<lambda>Útop_risk.<locals>.<lambda>P   s   € œs 1 W¥:œr-   T)ÚkeyÚreverseN)r
   Úsort)r>   r?   r&   Úsignalss   &&& r+   Útop_riskrK   M   s)   € ä  Ó*€GØ‡LLÑ.¸€LÔ=Ø6Eˆ?Ðr-   z/degradationc                ó0   € V ^8„  d   QhR\         R\        /# )r#   r>   r&   r3   )r*   s   "r+   r,   r,   U   s   € ÷ (ñ (”cð (œwñ (r-   c                 ó   € \        W4      # r:   )r
   )r>   r&   s   &&r+   ÚdegradationrN   T   s   € ä˜bÓ'Ð'r-   z/system-statsc                ó$   € V ^8„  d   QhR\         /# r8   r   )r*   s   "r+   r,   r,   ^   s   € ÷ ñ œñ r-   c                 ó   € \        V 4      # r:   )r   r;   s   &r+   Úsystem_stats_apirQ   ]   s   € ä˜ÓÐr-   z/alerts-statsNc                ód   € V ^8„  d   QhR\         R,          R\         R,          R\         R\        /# )r#   Ú	from_tickNÚto_tickr?   r&   ©r)   r   )r*   s   "r+   r,   r,   c   s>   € ÷ Oñ OÜTzðOä4ZðOô ðOô 	ñ	Or-   c                 ó   € \        W0WR 7      # ))rS   rT   r?   )r   )rS   rT   r?   r&   s   &&&&r+   Úalerts_stats_apirW   b   s   € ô ˜¸ÔNÐNr-   z/component-rankingsc                ó0   € V ^8„  d   QhR\         R\        /# ©r#   r?   r&   rU   )r*   s   "r+   r,   r,   m   s   € ÷ /ñ /Üð/äñ/r-   c                 ó   € \        WR 7      # ©)r?   )r   ©r?   r&   s   &&r+   Úcomponent_rankings_apir]   l   s   € ô
 ˜bÔ.Ð.r-   z/signal-coveragec                ó<   € V ^8„  d   QhR\         R\         R\        /# )r#   Úwindow_ticksr?   r&   rU   )r*   s   "r+   r,   r,   u   s+   € ÷ Gñ GÜðGäðGô 	ñGr-   c                 ó   € \        W VR 7      # ))r_   r?   )r   )r_   r?   r&   s   &&&r+   Úsignal_coverage_apira   t   s   € ô ˜2ÀÔFÐFr-   z/active-hotspotsc                ó0   € V ^8„  d   QhR\         R\        /# rY   rU   )r*   s   "r+   r,   r,   ~   s   € ÷ ,ñ ,Üð,äñ,r-   c                 ó   € \        WR 7      # r[   )r   r\   s   &&r+   Úactive_hotspots_apird   }   s   € ô
 ˜2Ô+Ð+r-   z)/component-time-analysis/{component_code}iô  c                ó<   € V ^8„  d   QhR\         R\        R\        /# )r#   r2   Ú	max_ticksr&   r'   )r*   s   "r+   r,   r,   †   s+   € ÷ Bñ BÜðBäðBô 	ñBr-   c                 ó   € \        W V4      # r:   r   )r2   rf   r&   s   &&&r+   Úcomponent_time_analysis_apirh   …   s   € ô # 2°yÓAÐAr-   z/forecast/signalc                ó<   € V ^8„  d   QhR\         R\        R\        /# )r#   r$   Úhorizon_ticksr&   r'   )r*   s   "r+   r,   r,   ’   s&   € ÷ 	ñ 	Üð	äð	ô 	ñ	r-   c                 ó   € \        VV VR 7      # ))r$   rj   )r   )r$   rj   r&   s   &&&r+   Úforecast_signal_apirl   ‘   s   € ô Ø
ØØ#ôð r-   z$/forecast/component/{component_code}c                ó<   € V ^8„  d   QhR\         R\        R\        /# )r#   r2   rj   r&   r'   )r*   s   "r+   r,   r,   Ÿ   s&   € ÷ 	ñ 	Üð	äð	ô 	ñ	r-   c                 ó   € \        VV VR 7      # ))r2   rj   )r   )r2   rj   r&   s   &&&r+   Úforecast_component_apiro   ž   s   € ô Ø
Ø%Ø#ôð r-   z#/component-regimes/{component_code}i   c                óH   € V ^8„  d   QhR\         R\        R\        R\        /# )r#   r2   r%   Úbucket_sizer&   r'   )r*   s   "r+   r,   r,   ­   s0   € ÷ ñ Üðäðô ðô 	ñ	r-   c                 ó    € \        VV VVR 7      # ))r&   r2   r%   rq   r   )r2   r%   rq   r&   s   &&&&r+   Úcomponent_regimes_apirs   ¬   s   € ô ØØ%ØØô	ð r-   z/signal-envelopei,  c                óH   € V ^8„  d   QhR\         R\        R\        R\        /# )r#   r$   r%   Úbucketr&   r'   )r*   s   "r+   r,   r,   ¼   s0   € ÷ <ñ <Üð<äð<ô ð<ô 	ñ	<r-   c                 ó   € \        W0W4      # r:   r   )r$   r%   ru   r&   s   &&&&r+   Úsignal_envelope_apirw   »   s   € ô ˜2¨FÓ;Ð;r-   z"/component-stress/{component_code}iX  c                óH   € V ^8„  d   QhR\         R\        R\        R\        /# )r#   r2   r%   ru   r&   r'   )r*   s   "r+   r,   r,   Æ   s6   € ÷ Fñ FÜðFäðFô ðFô 	ñ	Fr-   c                 ó   € \        W0W4      # r:   r   )r2   r%   ru   r&   s   &&&&r+   Úcomponent_stress_apirz   Å   s   € ô " "°fÓEÐEr-   z/signal-change-impactc                óH   € V ^8„  d   QhR\         R\        R\        R\        /# )r#   r$   Ú
pivot_tickr%   r&   r'   )r*   s   "r+   r,   r,   Ð   s6   € ÷ Eñ EÜðEäðEô ðEô 	ñ	Er-   c                 ó   € \        W0W4      # r:   r   )r$   r|   r%   r&   s   &&&&r+   Úsignal_change_impact_apir~   Ï   s   € ô   °ÓDÐDr-   ).Úfastapir   r   Úsqlalchemy.ormr   Úapp.db.sessionr   Úapp.schemas.analyticsr   Úapp.services.analytics_servicer	   r
   r   r   r   r   r   r   r   r   r   r   r   r   r   r   r   ÚrouterÚgetr/   r6   r<   rK   rN   rQ   rW   r]   ra   rd   rh   rl   ro   rs   rw   rz   r~   © r-   r+   Ú<module>r‡      s  ðß &Ý "å !Ý 1÷÷ õ õ C÷õ
 =Ý ;Ý :Ý AÝ ?ñ 
Ð*°+°Ô	?€ð ‡ˆMÓð Ù˜&“/ö	ó ð	ð ‡Ð0À€ÓQÙ<CÀF»Oö ó Rðð ‡ÐÓÙ$+¨F£Oö ó ðð ‡ˆKÓØ%&±g¸f³oö ó ðð ‡ˆNÓÙ)0°«ö (ó ð(ð ‡ˆOÓÙ#*¨6£?ö ó ðð ‡ˆOÓà ØØÙ˜&“/ö	Oó ðOð ‡Ð!Ó"àÙ˜&“/ö/ó #ð/ð ‡ÐÓàØÙ˜&“/öGó  ðGð ‡ÐÓàÙ˜&“/ö,ó  ð,ð ‡Ð7Ó8ð Ù˜&“/öBó 9ðBð ‡ÐÓð Ù˜&“/ö	ó  ð	ð ‡Ð2Ó3ð Ù˜&“/ö	ó 4ð	ð ‡Ð1Ó2ð ØÙ˜&“/ö	ó 3ðð ‡ÐÓð ØÙ˜&“/ö	<ó  ð<ð ‡Ð0Ó1ð ØÙ˜&“/ö	Fó 2ðFð ‡Ð#Ó$ð Ù˜&“/ö	Eó %òEr-   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\api\__pycache__\anomalies.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\api\__pycache__\anomalies.cpython-314.pyc
==================================================
+
    ~ÃYi$  ã                   óä  € ^ RI HtHtHt ^ RIHt ^ RIHt ^ RIH	t	 ^ RI
Ht ^ RIHt ^ RIHt ^ RIHt ]! R	R
.R7      t]P'                  R4      R]! ]4      3R R ll4       t]P'                  R4      ]! ]4      3R R ll4       t]P-                  R4      ]! ]4      3R R ll4       t]P-                  R4      ]! ]4      3R R ll4       t]P-                  R4      ]! ]4      3R R ll4       tR# )é    )Ú	APIRouterÚDependsÚHTTPException©ÚSession)Úget_db©Úanomaly_full_analysis)Úinject_anomaly©Úrollback_anomalies©Úactive_anomalies©Úanomaly_impact_summaryz/api/anomaliesÚ	Anomalies)ÚprefixÚtagsz/injectg      ð?c                ó`   € V ^8„  d   QhR\         R\         R\        R\        R\        R\        /# )é   ÚpipelineÚanomaly_typeÚ	from_tickÚto_tickÚstrengthÚdb)ÚstrÚintÚfloatr   )Úformats   "ÚFC:\Users\h50048240\3D Objects\PlatformOPS\backend\app\api\anomalies.pyÚ__annotate__r"      sD   € ÷ ñ Üðäðô ðô ð	ô
 ðô 	ñó    c           	      óˆ   €  \        VV VVVVR 7      pRTRT RT/#   \         d   p\        R\        T4      R7      hRp?ii ; i))r   r   r   r   r   r   i  )Ústatus_codeÚdetailNr   r   Úaffected_points)r   Ú	Exceptionr   r   )r   r   r   r   r   r   ÚaffectedÚes   &&&&&&  r!   Úinjectr+      sa   € ð
<Ü!ØØØ%ØØØô
ˆð 	˜ØHØ˜8ðð øô ô <Ü¨´C¸³FÔ;Ð;ûð<ús   ‚ ›A¦<¼Az	/rollbackc                ó$   € V ^8„  d   QhR\         /# ©r   r   r   )r    s   "r!   r"   r"   -   s   € ÷ )ñ )”ñ )r#   c                 ó    € \        V 4      pR V/# )Úrestored_pointsr   )r   Úrestoreds   & r!   Úrollbackr1   ,   s   € ä! "Ó%€HØ˜xÐ(Ð(r#   z/activec                ó$   € V ^8„  d   QhR\         /# r-   r   )r    s   "r!   r"   r"   3   s   € ÷  ñ  Œwñ  r#   c                 ó   € \        V 4      # ©Nr   ©r   s   &r!   Úactiver6   2   s   € ä˜BÓÐr#   z/impactc                ó$   € V ^8„  d   QhR\         /# r-   r   )r    s   "r!   r"   r"   8   s   € ÷ &ñ &Œwñ &r#   c                 ó   € \        V 4      # r4   r   r5   s   &r!   Úimpactr9   7   s   € ä! "Ó%Ð%r#   z	/analysisc                ó$   € V ^8„  d   QhR\         /# r-   r   )r    s   "r!   r"   r"   @   s   € ÷ %ñ %”ñ %r#   c                 ó   € \        V 4      # r4   r	   r5   s   &r!   Úanalysisr<   ?   s   € ä  Ó$Ð$r#   N)Úfastapir   r   r   Úsqlalchemy.ormr   Úapp.db.sessionr   Ú%app.services.anomaly_analysis_servicer
   Ú&app.services.anomaly_injection_servicer   Ú%app.services.anomaly_rollback_servicer   Ú$app.services.anomaly_insight_servicer   Ú#app.services.anomaly_impact_servicer   ÚrouterÚpostr+   r1   Úgetr6   r9   r<   © r#   r!   Ú<module>rI      sê   ðç 5Ñ 5Ý "å !Ý GÝ AÝ DÝ AÝ Fñ 
Ð*°+°Ô	?€ð ‡ˆYÓð Ù˜&“/öó ðð6 ‡ˆ[ÓÙ" 6›?ö )ó ð)ð
 ‡ˆIÓÙ  ›ö  ó ð ð ‡ˆIÓÙ  ›ö &ó ð&ð ‡ˆKÓÙ" 6›?ö %ó ò%r#   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\api\__pycache__\auth.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\api\__pycache__\auth.cpython-314.pyc
==================================================
+
    J=\iI  ã                   óÂ  € ^ RI Ht ^ RIHtHt ^ RIHt ^ RIHt ^ RI	H
t
HtHtHt ^ RIHtHt ^ RIHt ^ RIHt ^ R	IHt ^ R
IHt ]! RR.R7      t]P5                  R4      ]! ]4      3R R ll4       t]P5                  R]R7      ]! ]4      3R R ll4       t]P;                  R]R7      ]! ]4      3R l4       t]P;                  R4      ]! ]4      3R R ll4       tR# )é    )ÚHTTPException)Ú	APIRouterÚDepends)ÚSession)ÚUser)ÚSignupRequestÚLoginRequestÚTokenResponseÚUserInfo)ÚsignupÚlogin)Úget_db)Úget_current_user)ÚJWTError)Údecode_email_verification_tokenz	/api/authÚauth)ÚprefixÚtagsz/signupc                ó0   € V ^8„  d   QhR\         R\        /# ©é   ÚreqÚdb)r   r   )Úformats   "ÚAC:\Users\h50048240\3D Objects\PlatformOPS\backend\app\api\auth.pyÚ__annotate__r      s   € ÷ ;ñ ;”Mð ;¤wñ ;ó    c                 óˆ   € \        WP                  V P                  4      pR \        VP                  4      RVP                  /# )ÚidÚusername)r   r    ÚpasswordÚstrr   )r   r   Úusers   && r   Ú
signup_apir$      s1   € ä"—l‘l C§L¡LÓ1€DØ”#d—g‘g“, 
¨D¯M©MÐ:Ð:r   z/login)Úresponse_modelc                ó0   € V ^8„  d   QhR\         R\        /# r   )r	   r   )r   s   "r   r   r      s   € ÷ #ñ #”<ð #¤Wñ #r   c                 óJ   € \        WP                  V P                  4      pR V/# )Úaccess_token)r   r    r!   )r   r   Útokens   && r   Ú	login_apir*      s!   € ä"—l‘l C§L¡LÓ1€EØ˜EÐ"Ð"r   z/mec                 óx   € R \        V P                  4      RV P                  RV P                  RV P                  /# )r   r    ÚrolesÚ	is_active)r"   r   r    Úroles_from_tokenr-   )r#   s   &r   Úmer/      s8   € ð 	Œc$—'‘'‹lØD—M‘MØ×&Ñ&ØT—^‘^ð	ð r   z/verify-emailc                ó0   € V ^8„  d   QhR\         R\        /# )r   r)   r   )r"   r   )r   s   "r   r   r   *   s   € ÷ 8ñ 8œð 8¤ñ 8r   c                 ó†  €  \        V 4      pTP                  R4      pTP	                  \
        4      P                  \
        P                  T8H  4      P                  4       pT'       g   \        RRR7      hTP                  '       d   RR/# RTn	        TP                  4        RR	/#   \         d    \        R RR7      hi ; i)
i  zInvalid or expired token)Ústatus_codeÚdetailÚsubi”  zUser not foundÚmessagezAccount already verifiedTzAccount verified successfully)r   r   r   ÚgetÚqueryr   Úfilterr   Úfirstr-   Úcommit)r)   r   ÚpayloadÚuser_idr#   s   &&   r   Úverify_emailr=   )   s¯   € ðPÜ1°%Ó8ˆð k‰k˜%Ó €GØ8‰8”D‹>× Ñ ¤§¡¨GÑ!3Ó4×:Ñ:Ó<€DçÜ¨Ð4DÔEÐEà‡~‡~€~ØÐ5Ð6Ð6à€D„NØ‡II„KàÐ6Ð7Ð7øô ô PÜ¨Ð4NÔOÐOðPús   ‚B' Â'C N) Úhttp.clientr   Úfastapir   r   Úsqlalchemy.ormr   Úapp.db.models.usersr   Úapp.schemas.authr   r	   r
   r   Úapp.services.auth_servicer   r   Úapp.db.sessionr   Úapp.dependencies.authr   Újoser   Úapp.core.securityr   ÚrouterÚpostr$   r*   r6   r/   r=   © r   r   Ú<module>rK      sÎ   ðå %ß &Ý "Ý $ß QÓ Qß 3Ý !Ý 2Ý Ý =á	˜+¨V¨HÔ	5€ð ‡ˆYÓÙ18¸³ö ;ó ð;ð
 ‡ˆX m€Ó4Ù/6°v«ö #ó 5ð#ð
 ‡ˆE (€Ó+ÙÐ$Ó%ó ó ,ðð ‡ˆOÓÙ+2°6«?ö 8ó ò8r   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\api\__pycache__\components.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\api\__pycache__\components.cpython-314.pyc
==================================================
+
    I£ei  ã                   óÆ  € ^ RI HtHt ^ RIHt ^ RIHt ^ RIHtH	t	H
t
HtHt ]! RR.R7      t]P                  R4      ^R	]! ]4      3R
 R ll4       t]P                  R4      ]! ]4      3R R ll4       t]P                  R4      ^<]! ]4      3R R ll4       t]P                  R4      ]! ]4      3R R ll4       t]P                  R4      ^<]! ]4      3R R ll4       tR# )é    )Ú	APIRouterÚDepends)ÚSession)Úget_db)Úget_related_signalsÚget_health_breakdownÚget_family_snapshotÚget_anomaly_contributionÚget_forecast_summaryz/api/componentsÚ
Components)ÚprefixÚtagsz!/{component_code}/related-signalsgffffffæ?c                óH   € V ^8„  d   QhR\         R\        R\        R\        /# )é   Úcomponent_codeÚlimitÚmin_correlationÚdb)ÚstrÚintÚfloatr   )Úformats   "ÚGC:\Users\h50048240\3D Objects\PlatformOPS\backend\app\api\components.pyÚ__annotate__r      s6   € ÷ Kñ KÜðKäðKô ðKô 	ñ	Kó    c                 ó   € \        W0W4      # ©N)r   )r   r   r   r   s   &&&&r   Úrelated_signalsr      s   € ô ˜r°5ÓJÐJr   z"/{component_code}/health-breakdownc                ó0   € V ^8„  d   QhR\         R\        /# ©r   r   r   ©r   r   )r   s   "r   r   r      s   € ÷ 4ñ 4Üð4äñ4r   c                 ó   € \        W4      # r   )r   ©r   r   s   &&r   Úhealth_breakdownr$      s   € ô
   Ó3Ð3r   z!/{component_code}/family-snapshotc                óH   € V ^8„  d   QhR\         R\         R\        R\        /# )r   r   ÚfamilyÚwindowr   ©r   r   r   )r   s   "r   r   r   #   s6   € ÷ Cñ CÜðCäðCô ðCô 	ñ	Cr   c                 ó   € \        W0W4      # r   )r	   )r   r&   r'   r   s   &&&&r   Úfamily_snapshotr*   "   s   € ô ˜r°6ÓBÐBr   z&/{component_code}/anomaly-contributionc                ó0   € V ^8„  d   QhR\         R\        /# r    r!   )r   s   "r   r   r   -   s   € ÷ 8ñ 8Üð8äñ8r   c                 ó   € \        W4      # r   )r
   r#   s   &&r   Úanomaly_contributionr-   ,   s   € ô
 $ BÓ7Ð7r   z"/{component_code}/forecast-summaryc                ó<   € V ^8„  d   QhR\         R\        R\        /# )r   r   Úhorizon_ticksr   r(   )r   s   "r   r   r   5   s+   € ÷ Cñ CÜðCäðCô 	ñCr   c                 ó   € \        W V4      # r   )r   )r   r/   r   s   &&&r   Úforecast_summaryr1   4   s   € ô   °MÓBÐBr   N)Úfastapir   r   Úsqlalchemy.ormr   Úapp.db.sessionr   Úapp.services.components_servicer   r   r	   r
   r   ÚrouterÚgetr   r$   r*   r-   r1   © r   r   Ú<module>r9      sþ   ðß &Ý "å !÷õ ñ 
Ð+°<°.Ô	A€ð ‡Ð/Ó0ð Ø Ù˜&“/ö	Kó 1ðKð ‡Ð0Ó1ñ ˜&“/ö4ó 2ð4ð ‡Ð/Ó0ð Ù˜&“/ö	Có 1ðCð ‡Ð4Ó5ñ ˜&“/ö8ó 6ð8ð ‡Ð0Ó1ð Ù˜&“/öCó 2òCr   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\api\__pycache__\deps.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\api\__pycache__\deps.cpython-314.pyc
==================================================
+
    {*Ji¤   ã                   ó   € ^ RI Ht R tR# )é    )ÚSessionLocalc               #   óv   "  € \        4       p  V x € V P                  4        R #   T P                  4        i ; i5i)N)r   Úclose)Údbs    ÚAC:\Users\h50048240\3D Objects\platformOPS\backend\app\api\deps.pyÚget_dbr      s(   é € Ü	‹€BðØŠà
‰Ž
øˆ‰
üs   ‚9Ž$ ’9¤6¶9N)Úapp.db.sessionr   r   © ó    r   Ú<module>r      s   ðå 'ôr   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\api\__pycache__\incidents.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\api\__pycache__\incidents.cpython-314.pyc
==================================================
+
    Ò›ai  ã                   ó.  € ^ RI HtHt ^ RIHt ^ RIHt ^ RIHt ^ RI	H
t
 ]! RR.R7      t]P                  R	4      ]! ]4      3R
 R ll4       t]P                  R4      ]! ]4      3R R ll4       t]P                  R4      ]! ]4      3R R ll4       tR# )é    )Ú	APIRouterÚDepends©ÚSession)Úget_db)ÚIncident©Úevaluate_incidentsz/api/incidentsÚ	Incidents)ÚprefixÚtagsz	/evaluatec                ó$   € V ^8„  d   QhR\         /# ©é   Údbr   )Úformats   "ÚFC:\Users\h50048240\3D Objects\PlatformOPS\backend\app\api\incidents.pyÚ__annotate__r      s   € ÷ "ñ "”ñ "ó    c                 ó   € \        V 4      # ©Nr	   ©r   s   &r   Úevaluater      s   € ä˜bÓ!Ð!r   Ú/c                ó$   € V ^8„  d   QhR\         /# r   r   )r   s   "r   r   r      s   € ÷ Añ A”wñ Ar   c                 óž   € V P                  \        4      P                  \        P                  P	                  4       4      P                  4       # r   )Úqueryr   Úorder_byÚidÚdescÚallr   s   &r   Úlist_incidentsr"      s2   € à8‰8”HÓ×&Ñ&¤x§{¡{×'7Ñ'7Ó'9Ó:×>Ñ>Ó@Ð@r   z/{incident_id}c                ó0   € V ^8„  d   QhR\         R\        /# )r   Úincident_idr   )Úintr   )r   s   "r   r   r      s   € ÷ ñ œcð ¤wñ r   c                 óˆ   € VP                  \        4      P                  \        P                  V 8H  4      P	                  4       # r   )r   r   Úfilterr   Úone_or_none)r$   r   s   &&r   Úget_incidentr)      s/   € ð 	‰”Óß	‰”—‘˜{Ñ*Ó	+ß	‰‹ðr   N)Úfastapir   r   Úsqlalchemy.ormr   Úapp.db.sessionr   Úapp.db.models.incidentsr   Úapp.services.incident_servicer
   ÚrouterÚpostr   Úgetr"   r)   © r   r   Ú<module>r3      s“   ðç &Ý "å !Ý ,Ý <ñ 
Ð*°+°Ô	?€ð ‡ˆ[ÓÙ" 6›?ö "ó ð"ð ‡ˆCƒÙ!(¨£ö Aó ðAð ‡ÐÓÙ18¸³ö ó òr   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\api\__pycache__\patterns.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\api\__pycache__\patterns.cpython-314.pyc
==================================================
+
    {*Jií  ã                   óà   € ^ RI HtHt ^ RIHt ^ RIHt ^ RIHtH	t	 ]! RR.R7      t
]
P                  R4      ]! ]4      3R	 R
 ll4       t]
P                  R4      ]! ]4      3R R ll4       tR# )é    )Ú	APIRouterÚDepends©ÚSession)Úget_db)Údetect_spikesÚdetect_recoveryz/api/analytics/patternsÚPatterns)ÚprefixÚtagsz/spikesc                ó$   € V ^8„  d   QhR\         /# ©é   Údbr   )Úformats   "ÚEC:\Users\h50048240\3D Objects\platformOPS\backend\app\api\patterns.pyÚ__annotate__r      s   € ÷ ñ Œwñ ó    c                 ó   € \        V 4      # ©N)r   ©r   s   &r   Úspikesr   
   s   € ä˜ÓÐr   z	/recoveryc                ó$   € V ^8„  d   QhR\         /# r   r   )r   s   "r   r   r      s   € ÷ ñ ”ñ r   c                 ó   € \        V 4      # r   )r	   r   s   &r   Úrecoveryr      s   € ä˜2ÓÐr   N)Úfastapir   r   Úsqlalchemy.ormr   Úapp.db.sessionr   Úapp.services.patterns_servicer   r	   ÚrouterÚgetr   r   © r   r   Ú<module>r#      sh   ðç &Ý "Ý !ß Há	Ð3¸:¸,Ô	G€ð ‡ˆIÓÙ  ›ö ó ðð ‡ˆKÓÙ" 6›?ö ó òr   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\api\__pycache__\propagation.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\api\__pycache__\propagation.cpython-314.pyc
==================================================
+
    {*JiÑ  ã                   óœ   € ^ RI HtHtHt ^ RIHt ^ RIHt ^ RIH	t	 ]! RR.R7      t
]
P                  R4      ^]! ]4      3R	 R
 ll4       tR# )é    )Ú	APIRouterÚDependsÚHTTPException)ÚSession)Úget_db)Úcompute_propagationz/api/propagationÚpropagation)ÚprefixÚtagsÚ c                óH   € V ^8„  d   QhR\         R\         R\        R\        /# )é   Úsource_signalÚtarget_signalÚwindowÚdb)ÚstrÚintr   )Úformats   "ÚHC:\Users\h50048240\3D Objects\platformOPS\backend\app\api\propagation.pyÚ__annotate__r      s0   € ÷ <ñ <Üð<äð<ô ð<ô 	ñ	<ó    c                 ót   €  \        VV VVR 7      #   \         d   p\        R\        T4      R7      hRp?ii ; i))r   r   r   r   i  )Ústatus_codeÚdetailN)r   Ú
ValueErrorr   r   )r   r   r   r   Úes   &&&& r   r	   r	   
   sC   € ð<Ü"ØØ'Ø'Øô	
ð 	
øô ô <Ü¨´C¸³FÔ;Ð;ûð<ús   ‚ ‘7œ2²7N)Úfastapir   r   r   Úsqlalchemy.ormr   Úapp.db.sessionr   Ú app.services.propagation_servicer   ÚrouterÚgetr	   © r   r   Ú<module>r%      sK   ðç 5Ñ 5Ý "Ý !Ý @á	Ð,°M°?Ô	C€ð ‡ˆBƒð Ù˜&“/ö	<ó ò<r   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\api\__pycache__\simulator.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\api\__pycache__\simulator.cpython-314.pyc
==================================================
+
    	¾Iiç  ã                   ó–   € ^ RI HtHt ^ RIHt ^ RIHt ^ RIHt ]! RR.R7      t	]	P                  R4      ]! ]4      3R	 R
 ll4       tR# )é    )Ú	APIRouterÚDepends)ÚSession)Útext)Úget_dbz/api/simulatorÚ	Simulator)ÚprefixÚtagsz/statec                ó0   € V ^8„  d   QhR\         R\        /# )é   ÚtickÚdb)Úintr   )Úformats   "ÚFC:\Users\h50048240\3D Objects\platformOPS\backend\app\api\simulator.pyÚ__annotate__r      s   € ÷ ñ œ#ð ¤7ñ ó    c                 ó  € R pVP                  \        V4      RV /4      P                  4       p/ pV FM  pVP                  V9  d   / WEP                  &   WEP                  ,          P	                  VP
                  4       KO  	  RV RV/# )zZ
    SELECT component_code, payload
    FROM timeseries_points
    WHERE tick = :tick
    r   Ústate)Úexecuter   ÚfetchallÚcomponent_codeÚupdateÚpayload)r   r   ÚsqlÚrowsr   Úrs   &&    r   Úsimulator_stater   
   sˆ   € ð€Cð :‰:”d˜3“i &¨$ Ó0×9Ñ9Ó;€Dà€EãˆØ×Ñ 5Ô(Ø&(ˆE×"Ñ"Ñ#Ø×ÑÕ×&Ñ& q§y¡yÖ1ñ ð 	Øðð r   N)Úfastapir   r   Úsqlalchemy.ormr   Ú
sqlalchemyr   Úapp.db.sessionr   ÚrouterÚgetr   © r   r   Ú<module>r&      sD   ðç &Ý "Ý Ý !á	Ð*°+°Ô	?€ð ‡ˆHÓÙ-4°V«_ö ó òr   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\api\__pycache__\system.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\api\__pycache__\system.cpython-314.pyc
==================================================
+
    I£eiõ  ã                   óÊ  € ^ RI HtHt ^ RIHt ^ RIHt ^ RIHt ^ RI	H
t
 ^ RIHt ^ RIHt ^ RIHt ]! R	R
.R7      t]P%                  R4      ]! ]4      3R R ll4       t]P%                  R4      ]! ]4      3R R ll4       t]P%                  R4      ]! ]4      3R R ll4       t]P-                  R4      R 4       t]P%                  R4      ^R]! ]4      3R R ll4       tR# )é    )Ú	APIRouterÚDepends©ÚSession)Úfunc)Úget_db)ÚSignal)Ú
AlertEvent)Úcomponent_health©Ú
send_emailz/api/systemÚSystem)ÚprefixÚtagsz	/overviewc                ó$   € V ^8„  d   QhR\         /# ©é   Údbr   )Úformats   "ÚCC:\Users\h50048240\3D Objects\PlatformOPS\backend\app\api\system.pyÚ__annotate__r      s   € ÷ ñ œñ ó    c                 óˆ  € V P                  \        P                  4      P                  4       P	                  4       p. pV F~  w  p\        W4      pV P                  \        4      P                  \        P                  V8H  4      P                  4       pTP                  R TRTRTRV^(8  d   RM
V^F8  d   RMR/4       K€  	  V# )Úcomponent_codeÚhealth_scoreÚactive_alertsÚstatusÚCRITICALÚDEGRADEDÚOK)
Úqueryr	   r   ÚdistinctÚallr   r
   ÚfilterÚcountÚappend)r   Ú
componentsÚresultr   Úhealthr   s   &     r   Úsystem_overviewr*      s·   € ð 	‰”×&Ñ&Ó'ß	‰‹ß	‰‹ð ð €Fã'ÑˆÜ! "Ó5ˆð H‰H”ZÓ ß‰V”J×-Ñ-°Ñ?Ó@ß‰U‹Wð 	ð 	‰Ø˜nØ˜FØ˜]ØØ$ rœk‘
Ø$ rœk‘
Øð	
ö 		ñ (ð( €Mr   z/componentsc                ó$   € V ^8„  d   QhR\         /# r   r   )r   s   "r   r   r   1   s   € ÷ ñ œñ r   c                 ó:  € V P                  \        P                  \        P                  ! \        P
                  4      P                  R 4      4      P                  \        P                  4      P                  4       pV UUu. uF  w  r#RVRV/NK  	  upp# u uppi )Úsignalsr   Úsignal_count)	r!   r	   r   r   r%   Úsignal_codeÚlabelÚgroup_byr#   )r   r'   Úcr%   s   &   r   Úlist_componentsr3   0   s   € ð 	‰Ü×!Ñ!ÜJŠJ”v×)Ñ)Ó*×0Ñ0°Ó;ó	
÷ 
‰”&×'Ñ'Ó	(ß	‰‹ð ñ #ôñ
 #‰HˆAð ˜aØ˜Eó	
ñ #òð ùó s   ÂBz/components/{component_code}c                ó0   € V ^8„  d   QhR\         R\        /# )r   r   r   )Ústrr   )r   s   "r   r   r   E   s   € ÷ ñ ¤cð ¬wñ r   c                 óL  € VP                  \        4      P                  \        P                  V 8H  4      P	                  4       pR T RV Uu. uFA  pRVP
                  RVP                  RVP                  RVP                  RVP                  /NKC  	  upR\        W4      /# u upi )r   r-   r/   ÚtypeÚunitÚpolarityÚdescriptionr   )r!   r	   r$   r   r#   r/   Úsignal_typer8   r9   r:   r   )r   r   r-   Úss   &&  r   Úcomponent_detailsr=   D   s§   € ð 	‰”Óß	‰”×%Ñ%¨Ñ7Ó	8ß	‰‹ð ð 	˜.Øñ ó	
ñ ð ˜qŸ}™}Ø˜Ÿ™Ø˜Ÿ™Ø˜AŸJ™JØ˜qŸ}™}óñ ñ	
ð 	Ô(¨Ó<ðð ùò	
s   ÁAB!
z/test-emailc                  ó(   € \        R RRRR7       RR/# )ztest@local.testz	SMTP TestzPlain text email worksz<h1>HTML email works</h1>)Úto_emailÚsubjectÚtextÚhtmlÚsentTr   © r   r   Ú
test_emailrE   _   s"   € äØ"ØØ%Ø(õ	ð Dˆ>Ðr   z!/{component_code}/related-signalsgffffffæ?c                óH   € V ^8„  d   QhR\         R\        R\        R\        /# )r   r   ÚlimitÚmin_correlationr   )r5   ÚintÚfloatr   )r   s   "r   r   r   k   s0   € ÷ &ñ &Üð&äð&ô ð&ô 	ñ	&r   c                 ó~  € VP                  \        4      P                  \        \        P                  P                  VP                  \        P                  4      P                  \        P                  V 8H  4      4      \        P                  P                  VP                  \        P                  4      P                  \        P                  V 8H  4      4      4      \        P                  V8¬  4      P                  \        \        P                  4      4      P                  V4      P                  4       pR T RV Uu. uFq  pRVP                  \        9   d   VP                  MVP                  R RRVP                   RVP                  RVP"                  RVP                  \        9   d   RMR	/NKs  	  up/# u upi )
r   Úrelatedr/   z...Ú	lag_ticksÚcorrelationÚ
confidenceÚ	directionÚupstreamÚ
downstream)r!   ÚPropagationEvidencer$   Úor_Úsource_signalÚin_r	   r/   r   Útarget_signalrN   Úorder_byÚdescrG   r#   ÚprimaryrM   Úconfidence_score)r   rG   rH   r   rL   Úrs   &&&&  r   Úget_related_signalsr]   j   si  € ð 	‰Ô$Ó%ß	‰ÜÜ#×1Ñ1×5Ñ5Ø—H‘HœV×/Ñ/Ó0×7Ñ7¼×8MÑ8MÐQ_Ñ8_Ó`óô $×1Ñ1×5Ñ5Ø—H‘HœV×/Ñ/Ó0×7Ñ7¼×8MÑ8MÐQ_Ñ8_Ó`óó	ô  ×+Ñ+¨Ñ>ó


÷ 
‰”$Ô*×6Ñ6Ó7Ó	8ß	‰ˆu‹ß	‰‹ð ð& 	˜.Øñ ó

ñ ð °!·/±/ÄWÔ2L˜qŸšÐRS×RaÑRaØ  %Ø˜QŸ[™[Ø˜qŸ}™}Ø˜a×0Ñ0Ø¨1¯?©?¼gÔ+E™ZÈ<óñ ñ

ðð ùò

s   Ä?A7F:
N)Úfastapir   r   Úsqlalchemy.ormr   Ú
sqlalchemyr   Úapp.db.sessionr   Úapp.db.models.signalsr	   Úapp.db.models.alertsr
   Úapp.services.analytics_servicer   Úapp.services.email_servicer   ÚrouterÚgetr*   r3   r=   ÚpostrE   r]   rD   r   r   Ú<module>ri      så   ðç &Ý "Ý Ý !Ý (Ý +Ý ;Ý 1ñ 
˜-¨x¨jÔ	9€ð ‡ˆKÓÙ")¨&£/ö ó ðð@ ‡ˆMÓÙ")¨&£/ö ó ðð& ‡Ð*Ó+Ù9@À»ö ó ,ðð4 ‡ˆ]Óñó ðð ‡Ð/Ó0ð Ø Ù˜&“/ö	&ó 1ò&r   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\api\__pycache__\timeseries.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\api\__pycache__\timeseries.cpython-314.pyc
==================================================
+
    ç‹eiV  ã                   óØ  € ^ RI HtHtHtHt ^ RIHt ^ RIHt ^ RI	H
t
 ^ RIHt ]! RR.R7      t]P                  R	4      R
R
]! ]4      3R R ll4       t]P                  R4      ]! R4      ]! ]4      3R R ll4       t]P                  R4      ^
R]! ]4      3R R ll4       t]P                  R4      ]! ]4      3R R ll4       t]P                  R4      ]! ]4      3R R ll4       tR
# )é    )Ú	APIRouterÚDependsÚHTTPExceptionÚQuery)ÚSession)Úget_db)Úget_timeseries)Útimeseries_servicez/api/timeseriesÚ
timeseries)ÚprefixÚtagsÚ Nc                ód   € V ^8„  d   QhR\         R\        R,          R\        R,          R\        /# )é   Úsignal_codeÚ	from_tickNÚto_tickÚdb©ÚstrÚintr   )Úformats   "ÚGC:\Users\h50048240\3D Objects\PlatformOPS\backend\app\api\timeseries.pyÚ__annotate__r      s8   € ÷ <ñ <Üð<äTzð<ô 4Zð<ô 	ñ	<ó    c                 ót   €  \        VV VVR 7      #   \         d   p\        R\        T4      R7      hRp?ii ; i))r   r   r   r   i”  )Ústatus_codeÚdetailN)r	   Ú
ValueErrorr   r   )r   r   r   r   Úes   &&&& r   Úread_timeseriesr!      sC   € ð<ÜØØ#ØØô	
ð 	
øô ô <Ü¨´C¸³FÔ;Ð;ûð<ús   ‚ ‘7œ2²7z/multi.c                ó0   € V ^8„  d   QhR\         R\        /# )r   Úsignalsr   ©r   r   )r   s   "r   r   r      s   € ÷ ñ Üðäñr   c                 óP   € R \         P                  ! WP                  R4      4      /# )r#   Ú,)r
   Úmulti_signalÚsplit)r#   r   s   &&r   Úmulti_timeseriesr)      s+   € ð 	Ô%×2Ò2Ø—‘˜cÓ"ó
ðð r   z
/aggregateÚavgc                óH   € V ^8„  d   QhR\         R\        R\         R\        /# )r   r   ÚwindowÚaggr   r   )r   s   "r   r   r   +   s0   € ÷ ñ Üðäðô 
ðô 	ñ	r   c                 ó0   € \         P                  ! W0W4      # ©N)r
   Úaggregate_signal)r   r,   r-   r   s   &&&&r   Ú	aggregater1   *   s   € ô ×.Ò.Ø
˜óð r   z/derivativec                ó0   € V ^8„  d   QhR\         R\        /# ©r   r   r   r$   )r   s   "r   r   r   8   s    € ÷ Añ AÜðAäñAr   c                 ó.   € \         P                  ! W4      # r/   )r
   Úderivative_signal©r   r   s   &&r   Ú
derivativer7   7   s   € ô
 ×/Ò/°Ó@Ð@r   z/normalizedc                ó0   € V ^8„  d   QhR\         R\        /# r3   r$   )r   s   "r   r   r   @   s    € ÷ @ñ @Üð@äñ@r   c                 ó.   € \         P                  ! W4      # r/   )r
   Únormalize_signalr6   s   &&r   Ú
normalizedr;   ?   s   € ô
 ×.Ò.¨rÓ?Ð?r   )Úfastapir   r   r   r   Úsqlalchemy.ormr   Úapp.db.sessionr   Úapp.services.timeseries_servicer	   Úapp.servicesr
   ÚrouterÚgetr!   r)   r1   r7   r;   © r   r   Ú<module>rD      sø   ðç <Ó <Ý "å !Ý :Ý +á	Ð+°<°.Ô	A€ð ‡ˆBƒð !ØÙ˜&“/ö	<ó ð<ð" ‡ˆHÓá˜“:Ù˜&“/öó ðð ‡ˆLÓð ØÙ˜&“/ö	ó ðð ‡ˆMÓñ ˜&“/öAó ðAð ‡ˆMÓñ ˜&“/ö@ó ò@r   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\api\__pycache__\users.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\api\__pycache__\users.cpython-314.pyc
==================================================
+
    JlGiò  ã                   ó  € ^ RI HtHt ^ RIHt ^ RIHt ^ RIHt ^ RI	H
t
 ^ RIHt ^ RIHt ]! RR	.R
7      t]P!                  R4      ]! ]4      ]! ]4      3R R ll4       t]P%                  R4      ]! ]4      ]! ]4      3R R ll4       tR# )é    )Ú	APIRouterÚDepends©ÚSession)Úget_db)Úrequire_admin)ÚAssignRolesRequest)Úassign_roles)ÚUserz
/api/usersÚusers)ÚprefixÚtagsÚ/c                ó$   € V ^8„  d   QhR\         /# )é   Údbr   )Úformats   "ÚBC:\Users\h50048240\3D Objects\PlatformOPS\backend\app\api\users.pyÚ__annotate__r      s   € ÷ 	ñ 	”7ñ 	ó    c                 ó&  € V P                  \        4      P                  4        UUu. uFW  pR \        VP                  4      RVP
                  RVP                   Uu. uF  q3P                  NK  	  upRVP                  /NKY  	  upp# u upi u uppi )ÚidÚusernameÚrolesÚ	is_active)Úqueryr   ÚallÚstrr   r   r   r   )r   ÚadminÚuÚrs   &&  r   Ú
list_usersr"      s~   € ð —‘œ$“×#Ñ#Ô%ôñ &ˆAð ”#a—d‘d“)Ø˜Ÿ
™
Ø A§G¢GÓ,¡G˜q—d”d¡GÑ,Ø˜Ÿ™ó		
ñ &òð ùò -ùó	s   §5BÁBÁ0BÂBz/{user_id}/rolesc                ó<   € V ^8„  d   QhR\         R\        R\        /# )r   Úuser_idÚreqr   )r   r	   r   )r   s   "r   r   r      s+   € ÷ Eñ EÜðEä	ðEô 	ñEr   c                 ó°   € \        W VP                  4      pR \        VP                  4      RVP                   Uu. uF  qUP                  NK  	  up/# u upi )r   r   )r
   r   r   r   )r$   r%   r   r   Úuserr!   s   &&&&  r   Ú	set_rolesr(      sC   € ô ˜ S§Y¡YÓ/€DØ”#d—g‘g“, ¸¿
º
Ó)C¹
°1¯$¬$¹
Ñ)CÐDÐDùÒ)Cs   »A
N)Úfastapir   r   Úsqlalchemy.ormr   Úapp.db.sessionr   Úapp.dependencies.authr   Úapp.schemas.userr	   Úapp.services.user_servicer
   Úapp.db.models.usersr   ÚrouterÚgetr"   Úpostr(   © r   r   Ú<module>r4      sƒ   ðç &Ý "Ý !Ý /Ý /Ý 2Ý $á	˜,¨g¨YÔ	7€ð ‡ˆCƒÙ$ V›_±G¸MÓ4Jö 	ó ð	ð ‡ÐÓ ñ ˜&“/Ù
-Ó
 ö	Eó !òEr   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\core\config copy.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\core\config copy.py
==================================================
from datetime import timedelta
from pydantic import BaseSettings, SettingsConfigDict



class Settings(BaseSettings):
    # --------------------
    # App
    # --------------------
    APP_NAME: str = "PlatformOPS Backend"
    DEBUG: bool = True

    # --------------------
    # Database
    # --------------------
    DB_HOST: str = "localhost"
    DB_PORT: int = 5432
    DB_NAME: str = "platformops"
    DB_USER: str = "platformops"
    DB_PASSWORD: str = "platformops"

    # --------------------
    # Security / Auth
    # --------------------
    SECRET_KEY: str = "CHANGE_ME_SUPER_SECRET"
    ALGORITHM: str = "HS256"
    ACCESS_TOKEN_EXPIRE_MINUTES: int = 60 * 24  # 24 hours

    # --------------------
    # Pydantic settings config
    # --------------------
    model_config = SettingsConfigDict(
        env_file=".env",
        env_file_encoding="utf-8",
        case_sensitive=True,
    )

    @property
    def database_url(self) -> str:
        return (
            f"postgresql+psycopg://{self.DB_USER}:"
            f"{self.DB_PASSWORD}@{self.DB_HOST}:"
            f"{self.DB_PORT}/{self.DB_NAME}"
        )


settings = Settings()




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\core\config.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\core\config.py
==================================================
# app/core/config.py
from datetime import timedelta
from pydantic_settings import BaseSettings, SettingsConfigDict



class Settings(BaseSettings):
    # --------------------
    # App
    # --------------------
    APP_NAME: str = "PlatformOPS Backend"
    DEBUG: bool = True
    APP_PUBLIC_BASE_URL: str = "http://127.0.0.1:8000"


    # --------------------
    # Database
    # --------------------
    DB_HOST: str = "localhost"
    DB_PORT: int = 5432
    DB_NAME: str = "platformops"
    DB_USER: str = "platformops"
    DB_PASSWORD: str = "platformops"

    # --------------------
    # Security / Auth
    # --------------------
    SECRET_KEY: str = "CHANGE_ME_SUPER_SECRET"
    ALGORITHM: str = "HS256"
    ACCESS_TOKEN_EXPIRE_MINUTES: int = 60 * 24  # 24 hours
    # --------------------
    # SMTP (NEW)
    # --------------------
    SMTP_HOST: str = "localhost"
    SMTP_PORT: int = 1025
    SMTP_USERNAME: str | None = None
    SMTP_PASSWORD: str | None = None
    SMTP_FROM_EMAIL: str = "platformops@local.test"

    # --------------------
    # Pydantic settings config
    # --------------------
    model_config = SettingsConfigDict(
        env_file=".env",
        env_file_encoding="utf-8",
        case_sensitive=True,
    )

    @property
    def database_url(self) -> str:
        return (
            f"postgresql+psycopg://{self.DB_USER}:"
            f"{self.DB_PASSWORD}@{self.DB_HOST}:"
            f"{self.DB_PORT}/{self.DB_NAME}"
        )


settings = Settings()






############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\core\security.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\core\security.py
==================================================
# app/core/security.py
from datetime import datetime, timedelta
from jose import jwt, JWTError
from passlib.context import CryptContext
from app.core.config import settings  # âœ… FIX

pwd_context = CryptContext(schemes=["bcrypt"], deprecated="auto")


def hash_password(password: str) -> str:
    return pwd_context.hash(password)


def verify_password(password: str, hashed: str) -> bool:
    return pwd_context.verify(password, hashed)


def create_access_token(data: dict) -> str:
    to_encode = data.copy()
    expire = datetime.utcnow() + timedelta(
        minutes=settings.ACCESS_TOKEN_EXPIRE_MINUTES
    )
    to_encode.update({"exp": expire})
    return jwt.encode(
        to_encode,
        settings.SECRET_KEY,
        algorithm=settings.ALGORITHM,
    )


def decode_token(token: str) -> dict:
    return jwt.decode(
        token,
        settings.SECRET_KEY,
        algorithms=[settings.ALGORITHM],
    )


def create_email_verification_token(data: dict, expires_minutes: int = 30) -> str:
    to_encode = data.copy()
    expire = datetime.utcnow() + timedelta(minutes=expires_minutes)
    to_encode.update({"exp": expire, "scope": "email_verification"})
    return jwt.encode(
        to_encode,
        settings.SECRET_KEY,
        algorithm=settings.ALGORITHM,
    )


def decode_email_verification_token(token: str) -> dict:
    payload = jwt.decode(
        token,
        settings.SECRET_KEY,
        algorithms=[settings.ALGORITHM],
    )
    if payload.get("scope") != "email_verification":
        raise JWTError("Invalid token scope")
    return payload




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\core\__pycache__\config.cpython-311.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\core\__pycache__\config.cpython-311.pyc
==================================================
§
    ½‘Ci:  ã                   óB   — d dl mZ  G d„ de¦  «        Z e¦   «         ZdS )é    )ÚBaseSettingsc                   óŽ   — e Zd ZU dZeed<   dZeed<   dZeed<   dZ	e
ed<   d	Zeed
<   d	Zeed<   d	Zeed<   edefd„¦   «         ZdS )ÚSettingszPlatformOPS BackendÚAPP_NAMETÚDEBUGÚ	localhostÚDB_HOSTi8  ÚDB_PORTÚplatformopsÚDB_NAMEÚDB_USERÚDB_PASSWORDÚreturnc           
      óV   — d| j         › d| j        › d| j        › d| j        › d| j        › 
S )Nzpostgresql+psycopg://ú:ú@ú/)r   r   r	   r
   r   )Úselfs    úDC:\Users\h50048240\3D Objects\PlatformOPS\backend\app\core\config.pyÚdatabase_urlzSettings.database_url   sW   € ð- D¤Lð -ð -ØÔð-ð -Ø"&¤,ð-ð -àŒ|ð-ð -à"œlð-ð -ð	
ó    N)Ú__name__Ú
__module__Ú__qualname__r   ÚstrÚ__annotations__r   Úboolr	   r
   Úintr   r   r   Úpropertyr   © r   r   r   r      s«   € € € € € € Ø)€HˆcÐ)Ð)Ñ)Ø€Eˆ4ÐÐÑà€GˆSÐÐÑØ€GˆSÐÐÑØ €GˆSÐ Ð Ñ Ø €GˆSÐ Ð Ñ Ø$€KÐ$Ð$Ñ$àð
˜cð 
ð 
ð 
ñ „Xð
ð 
ð 
r   r   N)Úpydantic_settingsr   r   Úsettingsr    r   r   ú<module>r#      sR   ðØ *Ð *Ð *Ð *Ð *Ð *ð
ð 
ð 
ð 
ð 
ˆ|ñ 
ô 
ð 
ð& ˆ8‰:Œ:€€€r   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\core\__pycache__\config.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\core\__pycache__\config.cpython-314.pyc
==================================================
+
    \¹\i  ã                   óF   € ^ RI Ht ^ RIHtHt  ! R R]4      t]! 4       tR# )é    )Ú	timedelta)ÚBaseSettingsÚSettingsConfigDictc                   óž   a € ] tR t^t o RtRtRtRtRtRt	Rt
RtRtRtRtRtR	tR
tR
tRt]! RRRR7      t]V 3R lR l4       tV 3R ltRtV tR
# )ÚSettingszPlatformOPS BackendTzhttp://127.0.0.1:8000Ú	localhosti8  ÚplatformopsÚCHANGE_ME_SUPER_SECRETÚHS256i  Nzplatformops@local.testz.envzutf-8)Úenv_fileÚenv_file_encodingÚcase_sensitivec                ó    <€ V ^8„  d   QhRS[ /# )é   Úreturn)Ústr)ÚformatÚ__classdict__s   "€ÚDC:\Users\h50048240\3D Objects\PlatformOPS\backend\app\core\config.pyÚ__annotate__ÚSettings.__annotate__2   s   ø€ ÷ 
ñ 
™cñ 
ó    c           
     óˆ   € R V P                    RV P                   RV P                   RV P                   RV P                   2
# )zpostgresql+psycopg://Ú:Ú@Ú/)ÚDB_USERÚDB_PASSWORDÚDB_HOSTÚDB_PORTÚDB_NAME)Úselfs   &r   Údatabase_urlÚSettings.database_url1   sF   € ð $ D§L¡L >°Ø×ÑÐ   $§,¡, ¨qØ|‰|ˆn˜A˜dŸl™l˜^ð-ð	
r   c                óö   <€ V ^8„  d   Qh/ S[ ;R&   S[;R&   S[ ;R&   S[ ;R&   S[;R&   S[ ;R&   S[ ;R&   S[ ;R&   S[ ;R	&   S[ ;R
&   S[;R&   S[ ;R&   S[;R&   S[ R,          ;R&   S[ R,          ;R&   S[ ;R&   # )r   ÚAPP_NAMEÚDEBUGÚAPP_PUBLIC_BASE_URLr   r    r!   r   r   Ú
SECRET_KEYÚ	ALGORITHMÚACCESS_TOKEN_EXPIRE_MINUTESÚ	SMTP_HOSTÚ	SMTP_PORTNÚSMTP_USERNAMEÚSMTP_PASSWORDÚSMTP_FROM_EMAIL)r   ÚboolÚint)r   r   s   "€r   r   r      sÝ   ø‡ ‚ ñ Ñ)ñ	 ñ
 Ññ ñ Ñ6ñ ñ Ññ ñ Ññ ñ Ñ ñ ñ Ñ ñ ñ  Ñ$ñ! ñ* Ñ.ñ+ ñ, Ññ- ñ. "%Ñ.ñ/ ñ6 Ñ ñ7 ñ8 Ññ9 ñ: ˜•:Ñ$ñ; ñ< ˜•:Ñ$ñ= ñ> Ñ3ò? r   © i   )Ú__name__Ú
__module__Ú__qualname__Ú__firstlineno__r&   r'   r(   r   r    r!   r   r   r)   r*   r+   r,   r-   r.   r/   r0   r   Úmodel_configÚpropertyr#   Ú__annotate_func__Ú__static_attributes__Ú__classdictcell__)r   s   @r   r   r      s   ø‡ € ð *€HØ€EØ6Ðð €GØ€GØ €GØ €GØ$€Kð
 /€JØ€IØ'.Ðð !€IØ€IØ $€MØ $€MØ3€Oñ
 &ØØ!Øô€Lð ÷
ó ð
÷W ƒ r   r   N)Údatetimer   Úpydantic_settingsr   r   r   Úsettingsr3   r   r   Ú<module>r@      s!   ðå ß >ô0
ˆ|ô 0
ñf ‹:‚r   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\core\__pycache__\security.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\core\__pycache__\security.cpython-314.pyc
==================================================
+
    F<\ih  ã                   ó    € ^ RI H t Ht ^ RIHtHt ^ RIHt ^ RIHt ]! R.RR7      t	R R	 lt
R
 R ltR R ltR R ltRR R lltR R ltR# )é    )ÚdatetimeÚ	timedelta)ÚjwtÚJWTError)ÚCryptContext)ÚsettingsÚbcryptÚauto)ÚschemesÚ
deprecatedc                ó0   € V ^8„  d   QhR\         R\         /# )é   ÚpasswordÚreturn)Ústr)Úformats   "ÚFC:\Users\h50048240\3D Objects\PlatformOPS\backend\app\core\security.pyÚ__annotate__r   
   s   € ÷ &ñ &œCð &¤Cñ &ó    c                 ó,   € \         P                  V 4      # ©N)Úpwd_contextÚhash)r   s   &r   Úhash_passwordr   
   s   € Ü×Ñ˜HÓ%Ð%r   c                ó<   € V ^8„  d   QhR\         R\         R\        /# )r   r   Úhashedr   )r   Úbool)r   s   "r   r   r      s!   € ÷ 0ñ 0œcð 0¬3ð 0´4ñ 0r   c                 ó,   € \         P                  W4      # r   )r   Úverify)r   r   s   &&r   Úverify_passwordr       s   € Ü×Ñ˜hÓ/Ð/r   c                ó0   € V ^8„  d   QhR\         R\        /# )r   Údatar   )Údictr   )r   s   "r   r   r      s   € ÷ 
ñ 
œdð 
¤sñ 
r   c                 ó  € V P                  4       p\        P                  ! 4       \        \        P
                  R 7      ,           pVP                  RV/4       \        P                  ! V\        P                  \        P                  R7      # )©ÚminutesÚexp©Ú	algorithm)Úcopyr   Úutcnowr   r   ÚACCESS_TOKEN_EXPIRE_MINUTESÚupdater   ÚencodeÚ
SECRET_KEYÚ	ALGORITHM)r"   Ú	to_encodeÚexpires   &  r   Úcreate_access_tokenr3      sh   € Ø—	‘	“€IÜ_Š_Ó¤Ü×4Ñ4ô"õ €Fð ×Ñe˜V_Ô%Ü:Š:ØÜ×ÑÜ×$Ñ$ôð r   c                ó0   € V ^8„  d   QhR\         R\        /# ©r   Útokenr   ©r   r#   )r   s   "r   r   r      s   € ÷ ñ œð ¤ñ r   c                 ón   € \         P                  ! V \        P                  \        P                  .R 7      # )©Ú
algorithms)r   Údecoder   r/   r0   )r6   s   &r   Údecode_tokenr<      s+   € Ü:Š:ØÜ×ÑÜ×&Ñ&Ð'ôð r   c                ó<   € V ^8„  d   QhR\         R\        R\        /# )r   r"   Úexpires_minutesr   )r#   Úintr   )r   s   "r   r   r   '   s!   € ÷ ñ ¬$ð Äð Ìcñ r   c                 ó  € V P                  4       p\        P                  ! 4       \        VR 7      ,           pVP	                  RVRR/4       \
        P                  ! V\        P                  \        P                  R7      # )r%   r'   ÚscopeÚemail_verificationr(   )
r*   r   r+   r   r-   r   r.   r   r/   r0   )r"   r>   r1   r2   s   &&  r   Úcreate_email_verification_tokenrC   '   sa   € Ø—	‘	“€IÜ_Š_Ó¤°?Ô!CÕC€FØ×Ñe˜V WÐ.BÐCÔDÜ:Š:ØÜ×ÑÜ×$Ñ$ôð r   c                ó0   € V ^8„  d   QhR\         R\        /# r5   r7   )r   s   "r   r   r   2   s   € ÷ ñ ¬3ð ´4ñ r   c                 ó´   € \         P                  ! V \        P                  \        P                  .R 7      pVP                  R4      R8w  d   \        R4      hV# )r9   rA   rB   zInvalid token scope)r   r;   r   r/   r0   Úgetr   )r6   Úpayloads   & r   Údecode_email_verification_tokenrH   2   sM   € ÜjŠjØÜ×ÑÜ×&Ñ&Ð'ô€Gð
 ‡{{7ÓÐ3Ô3ÜÐ,Ó-Ð-Ø€Nr   N)é   )r   r   Újoser   r   Úpasslib.contextr   Úapp.core.configr   r   r   r    r3   r<   rC   rH   © r   r   Ú<module>rN      s=   ðç (ß Ý (Ý $á H :¸&ÔA€õ&õ0õ
õ÷÷r   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\db\base.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\db\base.py
==================================================
# app/db/base.py
from sqlalchemy.orm import DeclarativeBase

class Base(DeclarativeBase):
    pass




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\db\session.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\db\session.py
==================================================
# app/db/session.py
from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker, Session

from app.core.config import settings


engine = create_engine(
    settings.database_url,
    pool_pre_ping=True,
    future=True,
)

SessionLocal = sessionmaker(
    bind=engine,
    autocommit=False,
    autoflush=False,
    future=True,
)


def get_db():
    db: Session = SessionLocal()
    try:
        yield db
    finally:
        db.close()




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\db\models\alerts.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\db\models\alerts.py
==================================================
# app/db/models/alerts.py
from sqlalchemy import Column, Integer, Text, Float, Boolean, ForeignKey
from app.db.base import Base

class AlertRule(Base):
    __tablename__ = "alert_rules"

    id = Column(Integer, primary_key=True)
    signal_code = Column(Text, nullable=False)
    operator = Column(Text, nullable=False)
    threshold = Column(Float, nullable=False)
    min_duration_ticks = Column(Integer, nullable=False)
    severity = Column(Text, nullable=False)
    enabled = Column(Boolean, default=True)


class AlertEvent(Base):
    __tablename__ = "alert_events"

    id = Column(Integer, primary_key=True)
    rule_id = Column(Integer, ForeignKey("alert_rules.id"))
    component_code = Column(Text)
    signal_code = Column(Text)
    tick_start = Column(Integer)
    tick_end = Column(Integer)
    peak_value = Column(Float)
    severity = Column(Text)

    # lifecycle
    status = Column(Text, default="OPEN")   # OPEN | CLOSED

    # ðŸ”¥ NEW
    origin = Column(Text, default="REAL")   # REAL | SIMULATED




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\db\models\anomalies.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\db\models\anomalies.py
==================================================
# app/db/models/anomalies.py
from sqlalchemy import Column, Integer, Text, TIMESTAMP
from sqlalchemy.dialects.postgresql import JSONB
from sqlalchemy.sql import func

from app.db.base import Base


class InjectedAnomaly(Base):
    __tablename__ = "injected_anomalies"

    id = Column(Integer, primary_key=True)
    signal_code = Column(Text, nullable=False)
    component_code = Column(Text, nullable=False)
    tick = Column(Integer, nullable=False)

    # store the original scalar value as jsonb (number, string, etc.)
    original_value = Column(JSONB, nullable=False)

    anomaly_type = Column(Text, nullable=False)
    injected_at = Column(TIMESTAMP, server_default=func.now(), nullable=False)




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\db\models\incidents.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\db\models\incidents.py
==================================================
# app/db/models/incidents.py
from sqlalchemy import Column, Integer, Text, ForeignKey
from app.db.base import Base


class Incident(Base):
    __tablename__ = "incidents"

    id = Column(Integer, primary_key=True)

    component_code = Column(Text, nullable=False)

    start_tick = Column(Integer, nullable=False)
    end_tick = Column(Integer)

    severity = Column(Text, nullable=False)
    status = Column(Text, default="OPEN")   # OPEN | RESOLVED
    origin = Column(Text, default="REAL")   # REAL | SIMULATED (we will only create REAL)

    summary = Column(Text, nullable=False)


class IncidentAlert(Base):
    __tablename__ = "incident_alerts"

    incident_id = Column(
        Integer,
        ForeignKey("incidents.id"),
        primary_key=True,
    )
    alert_event_id = Column(
        Integer,
        ForeignKey("alert_events.id"),
        primary_key=True,
    )




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\db\models\propagation.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\db\models\propagation.py
==================================================
# app/db/models/propagation.py
from sqlalchemy import Column, Integer, Text, Float
from app.db.base import Base

class SignalDependency(Base):
    __tablename__ = "signal_dependencies"

    source_signal = Column(Text, primary_key=True)
    target_signal = Column(Text, primary_key=True)
    relationship = Column(Text)  # FORMULA | PROPAGATION


class PropagationEvidence(Base):
    __tablename__ = "propagation_evidence"

    id = Column(Integer, primary_key=True)
    source_signal = Column(Text, nullable=False)
    target_signal = Column(Text, nullable=False)
    lag_ticks = Column(Integer)
    correlation = Column(Float)
    confidence_score = Column(Float)




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\db\models\signals.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\db\models\signals.py
==================================================
# app/db/models/signals.py
from sqlalchemy import Column, Text, ARRAY
from app.db.base import Base

class Signal(Base):
    __tablename__ = "signals"

    signal_code = Column(Text, primary_key=True)
    component_code = Column(Text, nullable=False)
    column_name = Column(Text, nullable=False)
    signal_type = Column(Text, nullable=False)
    unit = Column(Text)
    polarity = Column(Text)
    description = Column(Text)
    visible_to_roles = Column(ARRAY(Text))
    family = Column(Text)




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\db\models\timeseries.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\db\models\timeseries.py
==================================================
# app/db/models/timeseries.py
from sqlalchemy import Column, BigInteger, Integer, Text
from sqlalchemy.dialects.postgresql import JSONB
from app.db.base import Base

class TimeSeriesPoint(Base):
    __tablename__ = "timeseries_points"

    id = Column(BigInteger, primary_key=True)
    component_code = Column(Text, nullable=False, index=True)
    tick = Column(Integer, nullable=False, index=True)
    timestamp = Column(BigInteger, nullable=False)
    payload = Column(JSONB, nullable=False)




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\db\models\users.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\db\models\users.py
==================================================
# app/db/models/users.py
from sqlalchemy import Column, Text, Boolean, ForeignKey
from sqlalchemy.dialects.postgresql import UUID
from sqlalchemy.orm import relationship
import uuid
from app.db.base import Base

class User(Base):
    __tablename__ = "users"

    id = Column(UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)
    username = Column(Text, unique=True, nullable=False)
    password_hash = Column(Text, nullable=False)
    is_active = Column(Boolean, default=True)

    roles = relationship("Role", secondary="user_roles", back_populates="users")


class Role(Base):
    __tablename__ = "roles"

    id = Column(Text, primary_key=True)  # EXEC / OPS / ARCH
    users = relationship("User", secondary="user_roles", back_populates="roles")


class UserRole(Base):
    __tablename__ = "user_roles"

    user_id = Column(UUID(as_uuid=True), ForeignKey("users.id"), primary_key=True)
    role_id = Column(Text, ForeignKey("roles.id"), primary_key=True)




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\db\models\__init__.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\db\models\__init__.py
==================================================
from .timeseries import TimeSeriesPoint
from .signals import Signal
from .users import User, Role, UserRole
from .alerts import AlertRule, AlertEvent
from .incidents import Incident, IncidentAlert
from .propagation import SignalDependency, PropagationEvidence




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\db\models\__pycache__\alerts.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\db\models\__pycache__\alerts.cpython-314.pyc
==================================================
+
    _Xi  ã                   ó^   € ^ RI HtHtHtHtHtHt ^ RIHt  ! R R]4      t	 ! R R]4      t
R# )é    )ÚColumnÚIntegerÚTextÚFloatÚBooleanÚ
ForeignKey)ÚBasec                   ó¦   € ] tR t^tRt]! ]RR7      t]! ]RR7      t	]! ]RR7      t
]! ]RR7      t]! ]RR7      t]! ]RR7      t]! ]RR7      tRtR# )	Ú	AlertRuleÚalert_rulesT©Úprimary_keyF)Únullable©Údefault© N)Ú__name__Ú
__module__Ú__qualname__Ú__firstlineno__Ú__tablename__r   r   Úidr   Úsignal_codeÚoperatorr   Ú	thresholdÚmin_duration_ticksÚseverityr   ÚenabledÚ__static_attributes__r   ó    ÚIC:\Users\h50048240\3D Objects\PlatformOPS\backend\app\db\models\alerts.pyr   r      s\   † Ø!€Má	 TÔ	*€BÙ˜¨Ô.€KÙd UÔ+€HÙu uÔ-€IÙ °%Ô8ÐÙd UÔ+€HÙW dÔ+„Gr    r   c                   óÔ   € ] tR t^tRt]! ]RR7      t]! ]]! R4      4      t	]! ]
4      t]! ]
4      t]! ]4      t]! ]4      t]! ]4      t]! ]
4      t]! ]
RR7      t]! ]
RR7      tRtR	# )
Ú
AlertEventÚalert_eventsTr   zalert_rules.idÚOPENr   ÚREALr   N)r   r   r   r   r   r   r   r   r   Úrule_idr   Úcomponent_coder   Ú
tick_startÚtick_endr   Ú
peak_valuer   ÚstatusÚoriginr   r   r    r!   r#   r#      sw   † Ø"€Má	 TÔ	*€BÙW™jÐ)9Ó:Ó;€GÙ˜D“\€NÙ˜“,€KÙ˜“€JÙg‹€HÙ˜“€JÙd‹|€Hñ D &Ô)€Fñ D &Ô)„Fr    r#   N)Ú
sqlalchemyr   r   r   r   r   r   Úapp.db.baser	   r   r#   r   r    r!   Ú<module>r0      s&   ðç H× HÝ ô	,ô 	,ô*ö *r    



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\db\models\__pycache__\anomalies.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\db\models\__pycache__\anomalies.cpython-314.pyc
==================================================
+
    {*JiÓ  ã                   óX   € ^ RI HtHtHtHt ^ RIHt ^ RIHt ^ RI	H
t
  ! R R]
4      tR# )é    )ÚColumnÚIntegerÚTextÚ	TIMESTAMP)ÚJSONB)Úfunc)ÚBasec                   óÆ   € ] tR t^	tRt]! ]RR7      t]! ]RR7      t	]! ]RR7      t
]! ]RR7      t]! ]RR7      t]! ]RR7      t]! ]]P"                  ! 4       RR7      tRtR# )	ÚInjectedAnomalyÚinjected_anomaliesT)Úprimary_keyF)Únullable)Úserver_defaultr   © N)Ú__name__Ú
__module__Ú__qualname__Ú__firstlineno__Ú__tablename__r   r   Úidr   Úsignal_codeÚcomponent_codeÚtickr   Úoriginal_valueÚanomaly_typer   r   ÚnowÚinjected_atÚ__static_attributes__r   ó    ÚLC:\Users\h50048240\3D Objects\platformOPS\backend\app\db\models\anomalies.pyr   r   	   se   † Ø(€Má	 TÔ	*€BÙ˜¨Ô.€KÙ˜D¨5Ô1€NÙ' EÔ*€Dñ ˜E¨EÔ2€Ná˜$¨Ô/€LÙ˜°4·8²8³:ÈÔN„Kr   r   N)Ú
sqlalchemyr   r   r   r   Úsqlalchemy.dialects.postgresqlr   Úsqlalchemy.sqlr   Úapp.db.baser	   r   r   r   r    Ú<module>r%      s"   ðç 7Ó 7Ý 0Ý å ôOdö Or   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\db\models\__pycache__\incidents.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\db\models\__pycache__\incidents.cpython-314.pyc
==================================================
+
    Ò›ai—  ã                   óV   € ^ RI HtHtHtHt ^ RIHt  ! R R]4      t ! R R]4      tR# )é    )ÚColumnÚIntegerÚTextÚ
ForeignKey)ÚBasec                   ó¶   € ] tR t^tRt]! ]RR7      t]! ]RR7      t	]! ]RR7      t
]! ]4      t]! ]RR7      t]! ]RR7      t]! ]RR7      t]! ]RR7      tR	tR
# )ÚIncidentÚ	incidentsT©Úprimary_keyF)ÚnullableÚOPEN)ÚdefaultÚREAL© N)Ú__name__Ú
__module__Ú__qualname__Ú__firstlineno__Ú__tablename__r   r   Úidr   Úcomponent_codeÚ
start_tickÚend_tickÚseverityÚstatusÚoriginÚsummaryÚ__static_attributes__r   ó    ÚLC:\Users\h50048240\3D Objects\PlatformOPS\backend\app\db\models\incidents.pyr	   r	      sd   † Ø€Má	 TÔ	*€Bá˜D¨5Ô1€Ná˜¨%Ô0€JÙg‹€Hád UÔ+€HÙD &Ô)€FÙD &Ô)€FáT EÔ*„Gr    r	   c                   ó^   € ] tR t^tRt]! ]]! R4      RR7      t]! ]]! R4      RR7      t	Rt
R# )ÚIncidentAlertÚincident_alertszincidents.idTr   zalert_events.idr   N)r   r   r   r   r   r   r   r   Úincident_idÚalert_event_idr   r   r    r!   r#   r#      s:   † Ø%€MáØÙ>Ó"Øô€Kñ
 ØÙÐ$Ó%Øô„Nr    r#   N)	Ú
sqlalchemyr   r   r   r   Úapp.db.baser   r	   r#   r   r    r!   Ú<module>r)      s&   ðç 8Ó 8Ý ô+ˆtô +ô"Dö r    



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\db\models\__pycache__\propagation.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\db\models\__pycache__\propagation.cpython-314.pyc
==================================================
+
    {*Ji¯  ã                   óV   € ^ RI HtHtHtHt ^ RIHt  ! R R]4      t ! R R]4      tR# )é    )ÚColumnÚIntegerÚTextÚFloat)ÚBasec                   óR   € ] tR t^tRt]! ]RR7      t]! ]RR7      t]! ]4      t	Rt
R# )ÚSignalDependencyÚsignal_dependenciesT©Úprimary_key© N)Ú__name__Ú
__module__Ú__qualname__Ú__firstlineno__Ú__tablename__r   r   Úsource_signalÚtarget_signalÚrelationshipÚ__static_attributes__r   ó    ÚNC:\Users\h50048240\3D Objects\platformOPS\backend\app\db\models\propagation.pyr	   r	      s(   † Ø)€Má˜4¨TÔ2€MÙ˜4¨TÔ2€MÙ˜$“<„Lr   r	   c                   ó†   € ] tR t^tRt]! ]RR7      t]! ]RR7      t	]! ]RR7      t
]! ]4      t]! ]4      t]! ]4      tRtR# )ÚPropagationEvidenceÚpropagation_evidenceTr   F)Únullabler   N)r   r   r   r   r   r   r   Úidr   r   r   Ú	lag_ticksr   ÚcorrelationÚconfidence_scorer   r   r   r   r   r      sG   † Ø*€Má	 TÔ	*€BÙ˜4¨%Ô0€MÙ˜4¨%Ô0€MÙw“€IÙ˜“-€KÙ˜e“}Ôr   r   N)	Ú
sqlalchemyr   r   r   r   Úapp.db.baser   r	   r   r   r   r   Ú<module>r#      s&   ðç 3Ó 3Ý ô tô  ô%˜$ö %r   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\db\models\__pycache__\signals.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\db\models\__pycache__\signals.cpython-314.pyc
==================================================
+
    ‰¬Hi   ã                   ó<   € ^ RI HtHtHt ^ RIHt  ! R R]4      tR# )é    )ÚColumnÚTextÚARRAY)ÚBasec                   óÆ   € ] tR t^tRt]! ]RR7      t]! ]RR7      t]! ]RR7      t	]! ]RR7      t
]! ]4      t]! ]4      t]! ]4      t]! ]! ]4      4      t]! ]4      tRtR# )ÚSignalÚsignalsT)Úprimary_keyF)Únullable© N)Ú__name__Ú
__module__Ú__qualname__Ú__firstlineno__Ú__tablename__r   r   Úsignal_codeÚcomponent_codeÚcolumn_nameÚsignal_typeÚunitÚpolarityÚdescriptionr   Úvisible_to_rolesÚfamilyÚ__static_attributes__r   ó    ÚJC:\Users\h50048240\3D Objects\PlatformOPS\backend\app\db\models\signals.pyr   r      sj   † Ø€Má˜¨4Ô0€KÙ˜D¨5Ô1€NÙ˜¨Ô.€KÙ˜¨Ô.€KÙ$‹<€DÙd‹|€HÙ˜“,€KÙ™e D›kÓ*ÐÙD‹\„Fr   r   N)Ú
sqlalchemyr   r   r   Úapp.db.baser   r   r   r   r   Ú<module>r       s   ðç *Ñ *Ý ôˆTö r   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\db\models\__pycache__\timeseries.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\db\models\__pycache__\timeseries.cpython-314.pyc
==================================================
+
    YqGiû  ã                   óL   € ^ RI HtHtHtHt ^ RIHt ^ RIHt  ! R R]4      t	R# )é    )ÚColumnÚ
BigIntegerÚIntegerÚText)ÚJSONB)ÚBasec                   ó‚   € ] tR t^tRt]! ]RR7      t]! ]RRR7      t	]! ]
RRR7      t]! ]RR7      t]! ]RR7      tRtR# )	ÚTimeSeriesPointÚtimeseries_pointsT)Úprimary_keyF)ÚnullableÚindex)r   © N)Ú__name__Ú
__module__Ú__qualname__Ú__firstlineno__Ú__tablename__r   r   Úidr   Úcomponent_coder   ÚtickÚ	timestampr   ÚpayloadÚ__static_attributes__r   ó    ÚMC:\Users\h50048240\3D Objects\PlatformOPS\backend\app\db\models\timeseries.pyr
   r
      sG   † Ø'€Má	
¨Ô	-€BÙ˜D¨5¸Ô=€NÙ' E°Ô6€DÙz¨EÔ2€IÙU UÔ+„Gr   r
   N)
Ú
sqlalchemyr   r   r   r   Úsqlalchemy.dialects.postgresqlr   Úapp.db.baser   r
   r   r   r   Ú<module>r       s   ðç 8Ó 8Ý 0Ý ô,dö ,r   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\db\models\__pycache__\users.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\db\models\__pycache__\users.cpython-314.pyc
==================================================
+
    ïEiæ  ã                   óŒ   € ^ RI HtHtHtHt ^ RIHt ^ RIHt ^ RI	t	^ RI
Ht  ! R R]4      t ! R R	]4      t ! R
 R]4      tR# )é    )ÚColumnÚTextÚBooleanÚ
ForeignKey)ÚUUID)ÚrelationshipN)ÚBasec                   ó¦   € ] tR t^tRt]! ]! RR7      R]P                  R7      t	]! ]
RRR7      t]! ]
RR7      t]! ]RR7      t]! R	R
RR7      tRtR# )ÚUserÚusersT©Úas_uuid)Úprimary_keyÚdefaultF)ÚuniqueÚnullable)r   )r   ÚRoleÚ
user_roles©Ú	secondaryÚback_populates© N)Ú__name__Ú
__module__Ú__qualname__Ú__firstlineno__Ú__tablename__r   r   ÚuuidÚuuid4Úidr   ÚusernameÚpassword_hashr   Ú	is_activer   ÚrolesÚ__static_attributes__r   ó    ÚHC:\Users\h50048240\3D Objects\PlatformOPS\backend\app\db\models\users.pyr   r      sR   † Ø€Má	‘˜TÔ"°¸d¿j¹jÔ	I€BÙd 4°%Ô8€HÙ˜4¨%Ô0€MÙw¨Ô-€Iá˜¨<ÈÔP„Er&   r   c                   óD   € ] tR t^tRt]! ]RR7      t]! RRRR7      t	Rt
R# )	r   r$   T©r   r   r   r   r   N)r   r   r   r   r   r   r   r    r   r   r%   r   r&   r'   r   r      s!   † Ø€Má	 $Ô	'€BÙ˜¨<ÈÔP„Er&   r   c                   ól   € ] tR t^tRt]! ]! RR7      ]! R4      RR7      t]! ]	]! R4      RR7      t
RtR# )	ÚUserRoler   Tr   zusers.idr)   zroles.idr   N)r   r   r   r   r   r   r   r   Úuser_idr   Úrole_idr%   r   r&   r'   r+   r+      s2   † Ø €Má‘T $Ô'©°JÓ)?ÈTÔR€GÙT™: jÓ1¸tÔD„Gr&   r+   )Ú
sqlalchemyr   r   r   r   Úsqlalchemy.dialects.postgresqlr   Úsqlalchemy.ormr   r   Úapp.db.baser	   r   r   r+   r   r&   r'   Ú<module>r2      sA   ðç 8Ó 8Ý /Ý 'Û Ý ôQˆ4ô QôQˆ4ô QôEˆtö Er&   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\db\models\__pycache__\__init__.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\db\models\__pycache__\__init__.cpython-314.pyc
==================================================
+
    K–Ci
  ã                   ób   € ^RI Ht ^RIHt ^RIHtHtHt ^RIH	t	H
t
 ^RIHtHt ^RIHtHt R# )é   )ÚTimeSeriesPoint)ÚSignal)ÚUserÚRoleÚUserRole)Ú	AlertRuleÚ
AlertEvent)ÚIncidentÚIncidentAlert)ÚSignalDependencyÚPropagationEvidenceN)Ú
timeseriesr   Úsignalsr   Úusersr   r   r   Úalertsr   r	   Ú	incidentsr
   r   Úpropagationr   r   © ó    ÚKC:\Users\h50048240\3D Objects\PlatformOPS\backend\app\db\models\__init__.pyÚ<module>r      s   ðÝ 'Ý ß 'Ñ 'ß )ß .ß >Ñ >r   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\db\__pycache__\base.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\db\__pycache__\base.cpython-314.pyc
==================================================
+
    {*Jih   ã                   ó(   € ^ RI Ht  ! R R]4      tR# )é    )ÚDeclarativeBasec                   ó   € ] tR t^tRtR# )ÚBase© N)Ú__name__Ú
__module__Ú__qualname__Ú__firstlineno__Ú__static_attributes__r   ó    Ú@C:\Users\h50048240\3D Objects\platformOPS\backend\app\db\base.pyr   r      s   † Ûr   r   N)Úsqlalchemy.ormr   r   r   r   r   Ú<module>r      s   ðå *ô	ˆ?ö 	r   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\db\__pycache__\session.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\db\__pycache__\session.cpython-314.pyc
==================================================
+
    JlGiã  ã                   óv   € ^ RI Ht ^ RIHtHt ^ RIHt ]! ]P                  RRR7      t]! ]RRRR7      t	R t
R	# )
é    )Úcreate_engine)ÚsessionmakerÚSession)ÚsettingsT)Úpool_pre_pingÚfutureF)ÚbindÚ
autocommitÚ	autoflushr   c               #   óv   "  € \        4       p  V x € V P                  4        R #   T P                  4        i ; i5i)N)ÚSessionLocalÚclose)Údbs    ÚCC:\Users\h50048240\3D Objects\PlatformOPS\backend\app\db\session.pyÚget_dbr      s(   é € Ü“.€BðØŠà
‰Ž
øˆ‰
üs   ‚9Ž$ ’9¤6¶9N)Ú
sqlalchemyr   Úsqlalchemy.ormr   r   Úapp.core.configr   Údatabase_urlÚenginer   r   © ó    r   Ú<module>r      sF   ðå $ß 0å $ñ 
Ø×ÑØØô
€ñ Ø	ØØØô	€ôr   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\dependencies\auth.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\dependencies\auth.py
==================================================
# app/dependencies/auth.py
from fastapi import Depends, HTTPException, status
from fastapi.security import OAuth2PasswordBearer
from sqlalchemy.orm import Session
from jose import JWTError
from app.core.security import decode_token
from app.db.session import get_db
from app.db.models.users import User

oauth2_scheme = OAuth2PasswordBearer(tokenUrl="/api/auth/login")


def get_current_user(
    token: str = Depends(oauth2_scheme),
    db: Session = Depends(get_db),
):
    try:
        payload = decode_token(token)
        user_id = payload.get("sub")
        if not user_id:
            raise HTTPException(status_code=401, detail="Invalid token")

        user = db.query(User).filter(User.id == user_id).first()
        if not user or not user.is_active:
            raise HTTPException(status_code=401, detail="Inactive user")

        user.roles_from_token = payload.get("roles", [])
        user.is_admin = payload.get("is_admin", False)
        return user

    except JWTError:
        raise HTTPException(status_code=401, detail="Invalid token")


def require_admin(user=Depends(get_current_user)):
    if not user.is_admin:
        raise HTTPException(status_code=403, detail="Admin only")
    return user




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\dependencies\__pycache__\auth.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\dependencies\__pycache__\auth.cpython-314.pyc
==================================================
+
    JlGiê  ã                   ó¸   € ^ RI HtHtHt ^ RIHt ^ RIHt ^ RIH	t	 ^ RI
Ht ^ RIHt ^ RIHt ]! RR	7      t]! ]4      ]! ]4      3R
 R llt]! ]4      3R ltR# )é    )ÚDependsÚHTTPExceptionÚstatus)ÚOAuth2PasswordBearer)ÚSession)ÚJWTError)Údecode_token)Úget_db)ÚUserz/api/auth/login)ÚtokenUrlc                ó0   € V ^8„  d   QhR\         R\        /# )é   ÚtokenÚdb)Ústrr   )Úformats   "ÚJC:\Users\h50048240\3D Objects\PlatformOPS\backend\app\dependencies\auth.pyÚ__annotate__r      s    € ÷ Eñ EÜðEäñEó    c                 óÒ  €  \        V 4      pVP                  R 4      pV'       g   \        RRR7      hVP                  \        4      P                  \        P                  V8H  4      P                  4       pV'       d   VP                  '       g   \        RRR7      hVP                  R. 4      Vn	        VP                  RR4      Vn
        V#   \         d    \        RRR7      hi ; i)Úsubi‘  zInvalid token©Ústatus_codeÚdetailzInactive userÚrolesÚis_adminF)r	   Úgetr   Úqueryr   ÚfilterÚidÚfirstÚ	is_activeÚroles_from_tokenr   r   )r   r   ÚpayloadÚuser_idÚusers   &&   r   Úget_current_userr'      sº   € ðEÜ˜uÓ%ˆØ—+‘+˜eÓ$ˆßÜ¨C¸ÔHÐHàx‰xœ‹~×$Ñ$¤T§W¡W°Ñ%7Ó8×>Ñ>Ó@ˆß˜4Ÿ>Ÿ>˜>Ü¨C¸ÔHÐHà '§¡¨G°RÓ 8ˆÔØŸ™ J°Ó6ˆŒØˆøäô EÜ¨°OÔDÐDðEús   ‚A;C Á>C Â<C ÃC&c                 óD   € V P                   '       g   \        R RR7      hV # )i“  z
Admin onlyr   )r   r   )r&   s   &r   Úrequire_adminr)   #   s   € Ø==ˆ=Ü¨°LÔAÐAØ€Kr   N)Úfastapir   r   r   Úfastapi.securityr   Úsqlalchemy.ormr   Újoser   Úapp.core.securityr	   Úapp.db.sessionr
   Úapp.db.models.usersr   Úoauth2_schemer'   r)   © r   r   Ú<module>r3      sO   ðç 2Ñ 2Ý 1Ý "Ý Ý *Ý !Ý $á$Ð.?Ô@€ñ ˜Ó'Ù˜&“/÷Eñ, Ð/Ó0ö r   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\ingestion\csv_loader.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\ingestion\csv_loader.py
==================================================
# app/ingestion/csv_loader.py
from pathlib import Path
import pandas as pd
import math
from sqlalchemy.orm import Session
from app.db.models.timeseries import TimeSeriesPoint



def _sanitize_payload(payload: dict) -> dict:
    """
    Convert NaN / inf values to None so JSONB is valid.
    """
    clean = {}
    for k, v in payload.items():
        if isinstance(v, float):
            if math.isnan(v) or math.isinf(v):
                clean[k] = None
            else:
                clean[k] = v
        else:
            clean[k] = v
    return clean


def load_csv_to_db(
    db: Session,
    csv_path: Path,
    component_code: str,
):
    df = pd.read_csv(csv_path)

    required_cols = {"tick", "timestamp"}
    if not required_cols.issubset(df.columns):
        raise ValueError(f"{csv_path.name} missing required columns")

    records = []

    for _, row in df.iterrows():
        raw_payload = row.drop(labels=["tick", "timestamp"]).to_dict()
        payload = _sanitize_payload(raw_payload)

        records.append(
            TimeSeriesPoint(
                component_code=component_code,
                tick=int(row["tick"]),
                timestamp=int(row["timestamp"]),
                payload=payload,
            )
        )

    db.bulk_save_objects(records)
    db.commit()

    return len(records)




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\ingestion\ingest_cli.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\ingestion\ingest_cli.py
==================================================
# app/ingestion/ingest_cli.py
from pathlib import Path
from sqlalchemy.orm import Session
from app.db.session import SessionLocal
from app.ingestion.csv_loader import load_csv_to_db

CSV_ROOT = Path(
    r"C:\Users\h50048240\3D Objects\PlatformOPS\simulator\output\csv"
)

COMPONENT_FILES = {
    "C1": "c1.csv",
    "C2": "c2.csv",
    "C3": "c3.csv",
    "C4": "c4.csv",
    "C5": "c5.csv",
    "C6": "c6.csv",
    "C7": "c7.csv",
    "C8": "c8.csv",
    "C9": "c9.csv",
    "GLOBAL": "global.csv",
}


def run_ingestion():
    db: Session = SessionLocal()

    try:
        for component, filename in COMPONENT_FILES.items():
            csv_path = CSV_ROOT / filename
            if not csv_path.exists():
                raise FileNotFoundError(csv_path)

            count = load_csv_to_db(db, csv_path, component)
            print(f"[OK] {component}: {count} rows ingested")

    finally:
        db.close()


if __name__ == "__main__":
    run_ingestion()




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\ingestion\signal_catalog_loader.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\ingestion\signal_catalog_loader.py
==================================================



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\ingestion\__pycache__\csv_loader.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\ingestion\__pycache__\csv_loader.cpython-314.pyc
==================================================
+
    {*Jih  ã                   óR   € ^ RI Ht ^ RIt^ RIt^ RIHt ^ RIHt R R lt	R R lt
R# )	é    )ÚPathN)ÚSession)ÚTimeSeriesPointc                ó0   € V ^8„  d   QhR\         R\         /# )é   ÚpayloadÚreturn)Údict)Úformats   "ÚMC:\Users\h50048240\3D Objects\platformOPS\backend\app\ingestion\csv_loader.pyÚ__annotate__r   	   s   € ÷ ñ œtð ¬ñ ó    c                óø   € / pV P                  4        Fc  w  r#\        V\        4      '       dE   \        P                  ! V4      '       g   \        P
                  ! V4      '       d   RW&   KY  W1V&   K_  W1V&   Ke  	  V# )z5
Convert NaN / inf values to None so JSONB is valid.
N)ÚitemsÚ
isinstanceÚfloatÚmathÚisnanÚisinf)r   ÚcleanÚkÚvs   &   r   Ú_sanitize_payloadr   	   s]   € ð €EØ—‘–‰ˆÜaœ×ÒÜzŠz˜!}Š}¤§
¢
¨1§¢Ø“àa“à!‹Hñ  ð €Lr   c                ó<   € V ^8„  d   QhR\         R\        R\        /# )r   ÚdbÚcsv_pathÚcomponent_code)r   r   Ústr)r   s   "r   r   r      s&   € ÷ ñ Üðäðô ñr   c                 ó  € \         P                  ! V4      pR R0pVP                  VP                  4      '       g   \	        VP
                   R24      h. pVP                  4        Fp  w  rgVP                  R R.R7      P                  4       p\        V4      p	VP                  \        V\        VR ,          4      \        VR,          4      V	R7      4       Kr  	  V P                  V4       V P                  4        \        V4      # )ÚtickÚ	timestampz missing required columns)Úlabels)r   r    r!   r   )ÚpdÚread_csvÚissubsetÚcolumnsÚ
ValueErrorÚnameÚiterrowsÚdropÚto_dictr   Úappendr   ÚintÚbulk_save_objectsÚcommitÚlen)
r   r   r   ÚdfÚrequired_colsÚrecordsÚ_ÚrowÚraw_payloadr   s
   &&&       r   Úload_csv_to_dbr7      sÝ   € ô
 
ŠXÓ	€Bà˜[Ð)€MØ×!Ñ! "§*¡*×-Ò-Ü˜HŸM™M˜?Ð*CÐDÓEÐEà€Gà—+‘+–-‰ˆØ—h‘h v¨{Ð&;hÓ<×DÑDÓFˆÜ# KÓ0ˆà‰ÜØ-Ü˜˜VÓ%Ü˜c +Õ.Ó/Øô	ö	
ñ	  ð ×Ñ˜Ô!Ø‡II„Käˆw‹<Ðr   )Úpathlibr   Úpandasr#   r   Úsqlalchemy.ormr   Úapp.db.models.timeseriesr   r   r7   © r   r   Ú<module>r=      s   ðå Û Û Ý "Ý 4õ÷ r   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\ingestion\__pycache__\ingest_cli.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\ingestion\__pycache__\ingest_cli.cpython-314.pyc
==================================================
+
    ÐëViï  ã                   ó˜   € ^ RI Ht ^ RIHt ^ RIHt ^ RIHt ]! R4      tRRRR	R
RRRRRRRRRRRRRRR/
t	R t
]R8X  d
   ]
! 4        R# R# )é    )ÚPath)ÚSession)ÚSessionLocal)Úload_csv_to_dbz>C:\Users\h50048240\3D Objects\PlatformOPS\simulator\output\csvÚC1zc1.csvÚC2zc2.csvÚC3zc3.csvÚC4zc4.csvÚC5zc5.csvÚC6zc6.csvÚC7zc7.csvÚC8zc8.csvÚC9zc9.csvÚGLOBALz
global.csvc                  ó8  € \        4       p  \        P                  4        FQ  w  r\        V,          pVP	                  4       '       g   \        V4      h\        WV4      p\        R V RV R24       KS  	  V P                  4        R#   T P                  4        i ; i)z[OK] z: z rows ingestedN)	r   ÚCOMPONENT_FILESÚitemsÚCSV_ROOTÚexistsÚFileNotFoundErrorr   ÚprintÚclose)ÚdbÚ	componentÚfilenameÚcsv_pathÚcounts        ÚMC:\Users\h50048240\3D Objects\platformOPS\backend\app\ingestion\ingest_cli.pyÚrun_ingestionr      s~   € Ü“.€Bð
Ü#2×#8Ñ#8Ö#:ÑˆIÜ (Õ*ˆHØ—?‘?×$Ò$Ü'¨Ó1Ð1ä" 2°Ó;ˆEÜE˜)˜ B u g¨^Ð<Ö=ñ $;ð 	‰Ž
øˆ‰
ús   ŒA)B ÂBÚ__main__N)Úpathlibr   Úsqlalchemy.ormr   Úapp.db.sessionr   Úapp.ingestion.csv_loaderr   r   r   r   Ú__name__© ó    r   Ú<module>r(      sr   ðå Ý "Ý 'Ý 3áØEó€ð
 	ˆ(Øˆ(Øˆ(Øˆ(Øˆ(Øˆ(Øˆ(Øˆ(Øˆ(Øˆlð€òð  ˆzÔÙ†Oñ r'   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\observability\baseline.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\observability\baseline.py
==================================================
# app/observability/baseline.py
import statistics
from sqlalchemy import text

DEFAULT_BASELINE_WINDOW = 200


def metric_baseline(db, component: str, column: str, window: int = DEFAULT_BASELINE_WINDOW):
    sql = text("""
        SELECT (payload ->> :column)::double precision AS v
        FROM timeseries_points
        WHERE component_code = :component
          AND payload ? :column
        ORDER BY tick DESC
        LIMIT :window
    """)

    rows = db.execute(
        sql,
        {
            "component": component,
            "column": column,
            "window": window,   # ðŸ”’ ALWAYS BOUND
        },
    ).fetchall()

    values = [r.v for r in rows if r.v is not None]

    if len(values) < 5:
        return None

    mean = statistics.mean(values)
    p95 = statistics.quantiles(values, n=20)[18]
    max_v = max(values)

    return {
        "mean": mean,
        "p95": p95,
        "max": max_v,
    }




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\observability\family_thresholds.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\observability\family_thresholds.py
==================================================
# app/observability/family_thresholds.py

def thresholds_for_family(family: str):
    """
    Returns (operator, warning_threshold, critical_threshold)
    """

    # F1 â€” Utilization (bounded)
    if family == "utilization":
        return "gt", 75, 90

    # F2 â€” Throughput / rate (low is bad)
    if family == "throughput":
        return "lt", 0.6, 0.4   # % of baseline (handled later)

    # F3 â€” Queue / backlog
    if family == "backlog":
        return "gt", 2.0, 4.0   # Ïƒ multipliers

    # F4 â€” Latency
    if family == "latency":
        return "gt", 3.0, 6.0   # Ïƒ multipliers

    # F5 â€” Error rate
    if family == "error_rate":
        return "gt", 0.01, 0.05

    # F6 â€” Count / cardinality
    if family == "count":
        return "gt", 1.3, 1.6   # Ã— baseline

    # F7 â€” Control / events (your rule â¤ï¸)
    if family == "events":
        return "gte", 1, 3

    # safety net
    return "gt", 999999, 999999




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\observability\metric_families.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\observability\metric_families.py
==================================================
# app/observability/metric_families.py

FAMILY_F1 = "utilization"
FAMILY_F2 = "throughput"
FAMILY_F3 = "backlog"
FAMILY_F4 = "latency"
FAMILY_F5 = "error_rate"
FAMILY_F6 = "count"
FAMILY_F7 = "events"

# substring-based classification (robust + scalable)
FAMILY_RULES = {
    FAMILY_F4: [
        "latency", "delay", "jitter", "rtt", "response", "wait", "duration"
    ],
    FAMILY_F3: [
        "queue", "backlog", "lag", "depth", "pending"
    ],
    FAMILY_F1: [
        "utilization", "ratio", "percent", "pressure"
    ],
    FAMILY_F5: [
        "error", "failure", "timeout", "drop", "reject"
    ],
    FAMILY_F2: [
        "rate", "throughput", "per_sec", "qps"
    ],
    FAMILY_F6: [
        "count", "total", "size", "cardinality", "bytes", "mb"
    ],
    FAMILY_F7: [
        "event", "restart", "election", "deadlock", "oom", "failover"
    ],
}

def detect_family(metric_name: str) -> str:
    name = metric_name.lower()

    for family, keywords in FAMILY_RULES.items():
        if any(k in name for k in keywords):
            return family

    # fallback (safe)
    return FAMILY_F6




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\observability\__pycache__\baseline.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\observability\__pycache__\baseline.cpython-314.pyc
==================================================
+
    EqXi©  ã                   ó0   € ^ RI t ^ RIHt ^Èt]3R R lltR# )é    N)Útextc                ó<   € V ^8„  d   QhR\         R\         R\        /# )é   Ú	componentÚcolumnÚwindow)ÚstrÚint)Úformats   "ÚOC:\Users\h50048240\3D Objects\PlatformOPS\backend\app\observability\baseline.pyÚ__annotate__r      s!   € ÷  ñ  ¤3ð  ´ð  ¼Sñ  ó    c           	      óv  € \        R 4      pV P                  VRVRVRV/4      P                  4       pV Uu. uF  qfP                  f   K  VP                  NK   	  pp\	        V4      ^8  d   R# \
        P                  ! V4      p\
        P                  ! V^R7      ^,          p	\        V4      p
RVRV	RV
/# u upi )	zÛ
        SELECT (payload ->> :column)::double precision AS v
        FROM timeseries_points
        WHERE component_code = :component
          AND payload ? :column
        ORDER BY tick DESC
        LIMIT :window
    r   r   r   N)ÚnÚmeanÚp95Úmax)	r   ÚexecuteÚfetchallÚvÚlenÚ
statisticsr   Ú	quantilesr   )Údbr   r   r   ÚsqlÚrowsÚrÚvaluesr   r   Úmax_vs   &&&&       r   Úmetric_baseliner       sÀ   € Ü
ð ó 	€Cð :‰:Øà˜ØfØfð	
ó÷ hƒjð 	ñ  Ó3™4a§3¡3ŒcˆacŒc™4€FÐ3ä
ˆ6ƒ{Q„Ùä?Š?˜6Ó"€DÜ
×
Ò
˜v¨Ô
,¨RÕ
0€CÜ‹K€Eð 	ØˆsØˆuðð ùò 4s   ¶B6Á
B6)r   Ú
sqlalchemyr   ÚDEFAULT_BASELINE_WINDOWr    © r   r   Ú<module>r$      s"   ðÛ Ý àÐ ð D[÷  ñ  r   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\observability\__pycache__\family_thresholds.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\observability\__pycache__\family_thresholds.cpython-314.pyc
==================================================
+
    _XiÛ  ã                   ó   € R  R lt R# )c                ó$   € V ^8„  d   QhR\         /# )é   Úfamily)Ústr)Úformats   "ÚXC:\Users\h50048240\3D Objects\PlatformOPS\backend\app\observability\family_thresholds.pyÚ__annotate__r      s   € ÷ " ñ " ¤#ñ " ó    c                ó„   € V R8X  d   R# V R8X  d   R	# V R8X  d   R
# V R8X  d   R# V R8X  d   R# V R8X  d   R# V R8X  d   R# R# )z;
Returns (operator, warning_threshold, critical_threshold)
ÚutilizationÚ
throughputÚbacklogÚlatencyÚ
error_rateÚcountÚevents)ÚgtéK   éZ   )Últg333333ã?gš™™™™™Ù?)r   g       @g      @)r   g      @g      @)r   g{®Gáz„?gš™™™™™©?)r   gÍÌÌÌÌÌô?gš™™™™™ù?)Úgteé   é   )r   é?B r   © )r   s   &r   Úthresholds_for_familyr      sz   € ð ÔØÐð ÔØÐð ÔØÐð ÔØÐð ÔØÐð ÔØÐð ÔØÐð  Ðr	   N)r   r   r	   r   Ú<module>r      s
   ð÷" r	   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\observability\__pycache__\metric_families.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\observability\__pycache__\metric_families.cpython-314.pyc
==================================================
+
    _Xi|  ã                   ój   € R t RtRtRtRtRtRt]. R
O]. RO] . RO]. RO]. RO]. RO]. RO/tR R ltR	# )ÚutilizationÚ
throughputÚbacklogÚlatencyÚ
error_rateÚcountÚeventsc                ó0   € V ^8„  d   QhR\         R\         /# )é   Úmetric_nameÚreturn)Ústr)Úformats   "ÚVC:\Users\h50048240\3D Objects\PlatformOPS\backend\app\observability\metric_families.pyÚ__annotate__r   $   s   € ÷ ñ œsð ¤sñ ó    c                 óò   a€ V P                  4       o\        P                  4        FI  w  r\        ;QJ d    V3R  lV 4       F  '       g   K   RM	  RM! V3R  lV 4       4      '       g   KG  Vu # 	  \        # )c              3   ó,   <"  € T F	  qS9   x € K  	  R # 5i)N© )Ú.0ÚkÚnames   & €r   Ú	<genexpr>Ú detect_family.<locals>.<genexpr>(   s   øé € Ð+¡(˜QDŽy£(ùs   ƒTF)ÚlowerÚFAMILY_RULESÚitemsÚanyÚ	FAMILY_F6)r   ÚfamilyÚkeywordsr   s   &  @r   Údetect_familyr!   $   sU   ø€ Ø×ÑÓ€Dä(×.Ñ.Ö0Ñˆß‹3Ô+¡(Ó+33Š3Ô+¡(Ó+×+Ô+ØŠMñ 1ô
 Ðr   N)r   ÚdelayÚjitterÚrttÚresponseÚwaitÚduration)Úqueuer   ÚlagÚdepthÚpending)r   ÚratioÚpercentÚpressure)ÚerrorÚfailureÚtimeoutÚdropÚreject)Úrater   Úper_secÚqps)r   ÚtotalÚsizeÚcardinalityÚbytesÚmb)ÚeventÚrestartÚelectionÚdeadlockÚoomÚfailover)	Ú	FAMILY_F1Ú	FAMILY_F2Ú	FAMILY_F3Ú	FAMILY_F4Ú	FAMILY_F5r   Ú	FAMILY_F7r   r!   r   r   r   Ú<module>rH      s|   ðð €	Ø€	Ø€	Ø€	Ø€	Ø€	Ø€	ð ò ð ò ð ò ð ò ð ò ð ò ð ò ð'€÷0r   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\schemas\alerts.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\schemas\alerts.py
==================================================
# app/schemas/alerts.py
from pydantic import BaseModel, Field
from typing import Optional, List, Literal


Operator = Literal["gt", "gte", "lt", "lte", "eq", "ne"]
Severity = Literal["info", "warning", "critical"]


class AlertRuleCreate(BaseModel):
    signal_code: str = Field(..., min_length=3)
    operator: Operator
    threshold: float
    min_duration_ticks: int = Field(..., ge=1, le=1000000)
    severity: Severity = "warning"
    enabled: bool = True


class AlertRuleUpdate(BaseModel):
    operator: Optional[Operator] = None
    threshold: Optional[float] = None
    min_duration_ticks: Optional[int] = Field(default=None, ge=1, le=1000000)
    severity: Optional[Severity] = None
    enabled: Optional[bool] = None


class AlertRuleOut(BaseModel):
    id: int
    signal_code: str
    operator: str
    threshold: float
    min_duration_ticks: int
    severity: str
    enabled: bool

    class Config:
        from_attributes = True


class AlertEventOut(BaseModel):
    id: int
    rule_id: int
    component_code: Optional[str] = None
    signal_code: Optional[str] = None
    tick_start: Optional[int] = None
    tick_end: Optional[int] = None
    peak_value: Optional[float] = None
    severity: Optional[str] = None

    class Config:
        from_attributes = True


class BulkCreateRules(BaseModel):
    rules: List[AlertRuleCreate]


class EvaluateRequest(BaseModel):
    # If not provided, we evaluate last `last_ticks` ticks
    from_tick: Optional[int] = None
    to_tick: Optional[int] = None
    last_ticks: int = Field(default=300, ge=2, le=20000)

    # If true, we delete old events in that tick window first (rebuild clean)
    rebuild_window: bool = True


class EvaluateResponse(BaseModel):
    evaluated_rules: int
    created_events: int




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\schemas\analytics.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\schemas\analytics.py
==================================================
from pydantic import BaseModel, Field
from typing import Dict, List, Optional


# -------------------------
# Existing
# -------------------------
class VolatilityResponse(BaseModel):
    signal_code: str
    window: int
    volatility: float


class DegradingSignal(BaseModel):
    signal_code: str
    slope: float
    polarity: str


class ComponentHealth(BaseModel):
    component_code: str
    health_score: float


# -------------------------
# New: System stats
# -------------------------
class TickRange(BaseModel):
    min_tick: int | None = None
    max_tick: int | None = None


class SystemIngestionStats(BaseModel):
    total_rows: int
    components: int
    tick_range: TickRange
    latest_tick_by_component: Dict[str, int] = Field(default_factory=dict)


class SignalInventoryStats(BaseModel):
    total_signals: int
    by_type: Dict[str, int] = Field(default_factory=dict)      # xi/yi/zi
    by_family: Dict[str, int] = Field(default_factory=dict)    # AUTO_Cx or your families
    by_role_visibility: Dict[str, int] = Field(default_factory=dict)  # how many signals visible to each role


class RuleCoverageStats(BaseModel):
    total_rules: int
    signals_with_rule: int
    rule_coverage_ratio: float


class EventStats(BaseModel):
    total_events: int
    by_severity: Dict[str, int] = Field(default_factory=dict)
    by_status: Dict[str, int] = Field(default_factory=dict)


class SystemStatsResponse(BaseModel):
    ingestion: SystemIngestionStats
    signals: SignalInventoryStats
    rules: RuleCoverageStats
    events: EventStats


# -------------------------
# New: Alerts stats
# -------------------------
class TopItem(BaseModel):
    key: str
    count: int


class LongestOpenAlert(BaseModel):
    alert_event_id: int
    component_code: Optional[str] = None
    signal_code: Optional[str] = None
    severity: Optional[str] = None
    tick_start: Optional[int] = None
    tick_end: Optional[int] = None
    duration_ticks: Optional[int] = None


class AlertsStatsResponse(BaseModel):
    window: Dict[str, int | None]  # from_tick/to_tick
    totals: Dict[str, int]
    by_severity: Dict[str, int]
    by_status: Dict[str, int]
    top_components: List[TopItem]
    top_signals: List[TopItem]
    longest_open: List[LongestOpenAlert]


# -------------------------
# New: Component rankings
# -------------------------
class ComponentRanking(BaseModel):
    component_code: str
    health_score: float
    open_alerts: int
    critical_open_alerts: int
    warning_open_alerts: int
    risk_score: float  # composite score used for ranking


class ComponentRankingsResponse(BaseModel):
    ranked: List[ComponentRanking]


# -------------------------
# New: Signal coverage
# -------------------------
class SignalCoverageItem(BaseModel):
    signal_code: str
    component_code: str
    column_name: str
    window_ticks: int
    total_component_points_in_window: int
    points_with_metric_present: int
    coverage_ratio: float


class SignalCoverageResponse(BaseModel):
    window_ticks: int
    worst: List[SignalCoverageItem]


# -------------------------
# New: Active hotspots
# -------------------------
class HotspotItem(BaseModel):
    signal_code: str
    component_code: Optional[str] = None
    open_events: int
    critical_open: int
    warning_open: int
    max_duration_ticks: int
    last_tick_seen: int


class HotspotsResponse(BaseModel):
    hotspots: List[HotspotItem]




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\schemas\auth.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\schemas\auth.py
==================================================
# app/schemas/auth.py
from pydantic import BaseModel
from typing import List


class SignupRequest(BaseModel):
    username: str
    password: str


class LoginRequest(BaseModel):
    username: str
    password: str


class TokenResponse(BaseModel):
    access_token: str
    token_type: str = "bearer"


class UserInfo(BaseModel):
    id: str
    username: str
    roles: List[str]
    is_active: bool = False




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\schemas\catalog.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\schemas\catalog.py
==================================================



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\schemas\incidents.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\schemas\incidents.py
==================================================



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\schemas\propagation.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\schemas\propagation.py
==================================================



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\schemas\signal.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\schemas\signal.py
==================================================
# app/schemas/signal.py
from pydantic import BaseModel

class SignalOut(BaseModel):
    signal_code: str
    component_code: str
    signal_type: str
    unit: str | None
    polarity: str | None
    family: str | None
    description: str | None

    class Config:
        from_attributes = True




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\schemas\timeseries.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\schemas\timeseries.py
==================================================
# app/schemas/timeseries.py
from pydantic import BaseModel
from typing import List, Dict

class Point(BaseModel):
    tick: int
    timestamp: int
    value: float

class SingleSeries(BaseModel):
    signal_code: str
    points: List[Point]

class MultiSeries(BaseModel):
    signals: Dict[str, List[Point]]




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\schemas\user.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\schemas\user.py
==================================================
# app/schemas/user.py
from pydantic import BaseModel
from typing import List


class AssignRolesRequest(BaseModel):
    roles: List[str]




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\schemas\__pycache__\alerts.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\schemas\__pycache__\alerts.cpython-314.pyc
==================================================
+
    çzGi3  ã                   óè   € ^ RI HtHt ^ RIHtHtHt ]R,          t]R,          t ! R R]4      t	 ! R R]4      t
 ! R R]4      t ! R	 R
]4      t ! R R]4      t ! R R]4      t ! R R]4      tR# )é    )Ú	BaseModelÚField)ÚOptionalÚListÚLiteralc                   ó^   a € ] tR t^
t o ]! R^R7      t]! R^RR7      tRtRtV 3R lt	Rt
V tR	# )
ÚAlertRuleCreate.)Ú
min_lengthé@B )ÚgeÚleÚwarningTc                ób   <€ V ^8„  d   Qh/ S[ ;R&   S[;R&   S[;R&   S[;R&   S[;R&   S[;R&   # )é   Úsignal_codeÚoperatorÚ	thresholdÚmin_duration_ticksÚseverityÚenabled)ÚstrÚOperatorÚfloatÚintÚSeverityÚbool)ÚformatÚ__classdict__s   "€ÚGC:\Users\h50048240\3D Objects\PlatformOPS\backend\app\schemas\alerts.pyÚ__annotate__ÚAlertRuleCreate.__annotate__
   sO   ø‡ ‚ ÙÑ/ñ áÑñ ñ Ññ ñ Ñ:ñ	 ñ
 Ñ"ñ ñ Ñò ó    © N)Ú__name__Ú
__module__Ú__qualname__Ú__firstlineno__r   r   r   r   r   Ú__annotate_func__Ú__static_attributes__Ú__classdictcell__©r   s   @r   r	   r	   
   s3   ø‡ € Ù˜S¨QÔ/€Kñ $ C¨A°'Ô:ÐØ"€HØ€G÷ ƒ r"   r	   c                   óR   a € ] tR t^t o RtRt]! R^RR7      tRtRt	V 3R lt
RtV tR# )ÚAlertRuleUpdateNr   ©Údefaultr   r   c                ó¦   <€ V ^8„  d   Qh/ S[ S[,          ;R&   S[ S[,          ;R&   S[ S[,          ;R&   S[ S[,          ;R&   S[ S[,          ;R&   # )r   r   r   r   r   r   )r   r   r   r   r   r   )r   r   s   "€r   r    ÚAlertRuleUpdate.__annotate__   sX   ø‡ ‚ Ù‘xÕ Ñ'ñ á™Ñ%ñ ñ !¡ÑMñ ñ ‘xÕ Ñ'ñ	 ñ
 ‘d^Ñ"ò r"   r#   )r$   r%   r&   r'   r   r   r   r   r   r   r(   r)   r*   r+   s   @r   r-   r-      s/   ø‡ € Ø#'€HØ!%€IÙ(-°d¸qÀWÔ(MÐØ#'€HØ"€G÷ ƒ r"   r-   c                   ó@   a € ] tR t^t o  ! R R4      tV 3R ltRtV tR# )ÚAlertRuleOutc                   ó   € ] tR t^$tRtRtR# )ÚAlertRuleOut.ConfigTr#   N©r$   r%   r&   r'   Úfrom_attributesr)   r#   r"   r   ÚConfigr5   $   ó   † ØŒr"   r8   c                ón   <€ V ^8„  d   Qh/ S[ ;R&   S[;R&   S[;R&   S[;R&   S[ ;R&   S[;R&   S[;R&   # )r   Úidr   r   r   r   r   r   )r   r   r   r   )r   r   s   "€r   r    ÚAlertRuleOut.__annotate__   sX   ø‡ ‚ ÙGñ áÑñ ñ Mñ ñ Ññ	 ñ
 Ññ ñ Mñ ñ Mò r"   r#   N)r$   r%   r&   r'   r8   r(   r)   r*   r+   s   @r   r3   r3      s   ø‡ € ÷ñ ÷ ƒ r"   r3   c                   óX   a € ] tR t^(t o RtRtRtRtRtRt	 ! R R4      t
V 3R ltRtV tR# )ÚAlertEventOutNc                   ó   € ] tR t^2tRtRtR# )ÚAlertEventOut.ConfigTr#   Nr6   r#   r"   r   r8   r@   2   r9   r"   r8   c                óÚ   <€ V ^8„  d   Qh/ S[ ;R&   S[ ;R&   S[S[,          ;R&   S[S[,          ;R&   S[S[ ,          ;R&   S[S[ ,          ;R&   S[S[,          ;R&   S[S[,          ;R&   # )	r   r;   Úrule_idÚcomponent_coder   Ú
tick_startÚtick_endÚ
peak_valuer   )r   r   r   r   )r   r   s   "€r   r    ÚAlertEventOut.__annotate__(   s   ø‡ ‚ ÙGñ áLñ ñ ™S•MÑ(ñ ñ ™#•Ñ%ñ	 ñ
 ™•Ñ$ñ ñ ‘smÑ"ñ ñ ™•Ñ&ñ ñ ‘smÑ"ò r"   r#   )r$   r%   r&   r'   rC   r   rD   rE   rF   r   r8   r(   r)   r*   r+   s   @r   r>   r>   (   s6   ø‡ € ð %)€NØ!%€KØ $€JØ"€HØ"&€JØ"€H÷ñ ÷ ƒ r"   r>   c                   ó,   a € ] tR t^6t o V 3R ltRtV tR# )ÚBulkCreateRulesc                ó6   <€ V ^8„  d   Qh/ S[ S[,          ;R&   # )r   Úrules)r   r	   )r   r   s   "€r   r    ÚBulkCreateRules.__annotate__6   s   ø‡ ‚ Ù‘Õ Ñ ò r"   r#   N©r$   r%   r&   r'   r(   r)   r*   r+   s   @r   rI   rI   6   ó   ø‡ ‡ „ r"   rI   c                   óN   a € ] tR t^:t o RtRt]! R^RR7      tRtV 3R lt	Rt
V tR# )ÚEvaluateRequestNi,  i N  r.   Tc                ój   <€ V ^8„  d   Qh/ S[ S[,          ;R&   S[ S[,          ;R&   S[;R&   S[;R&   # )r   Ú	from_tickÚto_tickÚ
last_ticksÚrebuild_window)r   r   r   )r   r   s   "€r   r    ÚEvaluateRequest.__annotate__:   s?   ø‡ ‚ á™}Ñ#ñ ñ ‘c]Ñ!ñ ñ Ñ8ñ	 ñ Ñò r"   r#   )r$   r%   r&   r'   rR   rS   r   rT   rU   r(   r)   r*   r+   s   @r   rP   rP   :   s+   ø‡ € à#€IØ!€GÙ C¨A°%Ô8€Jð  €N÷ ƒ r"   rP   c                   ó,   a € ] tR t^Dt o V 3R ltRtV tR# )ÚEvaluateResponsec                ó2   <€ V ^8„  d   Qh/ S[ ;R&   S[ ;R&   # )r   Úevaluated_rulesÚcreated_events)r   )r   r   s   "€r   r    ÚEvaluateResponse.__annotate__D   s   ø‡ ‚ ÙÑñ áÑò r"   r#   NrM   r+   s   @r   rX   rX   D   rN   r"   rX   N)ÚgtÚgteÚltÚlteÚeqÚne)Úinfor   Úcritical)Úpydanticr   r   Útypingr   r   r   r   r   r	   r-   r3   r>   rI   rP   rX   r#   r"   r   Ú<module>rg      sz   ðç %ß *Ñ *ð Ð7Õ8€ØÐ0Õ1€ôiô ô#iô #ô
9ô 
ôIô ô!iô !ô iô  ôyö r"   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\schemas\__pycache__\analytics.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\schemas\__pycache__\analytics.cpython-314.pyc
==================================================
+
    Ò
Wiô  ã                   ó¶  € ^ RI HtHt ^ RIHtHtHt  ! R R]4      t ! R R]4      t ! R R]4      t	 ! R	 R
]4      t
 ! R R]4      t ! R R]4      t ! R R]4      t ! R R]4      t ! R R]4      t ! R R]4      t ! R R]4      t ! R R]4      t ! R R]4      t ! R R]4      t ! R R ]4      t ! R! R"]4      t ! R# R$]4      t ! R% R&]4      tR'# )(é    )Ú	BaseModelÚField)ÚDictÚListÚOptionalc                   ó,   a € ] tR t^t o V 3R ltRtV tR# )ÚVolatilityResponsec                ó>   <€ V ^8„  d   Qh/ S[ ;R&   S[;R&   S[;R&   # )é   Úsignal_codeÚwindowÚ
volatility©ÚstrÚintÚfloat)ÚformatÚ__classdict__s   "€ÚJC:\Users\h50048240\3D Objects\PlatformOPS\backend\app\schemas\analytics.pyÚ__annotate__ÚVolatilityResponse.__annotate__   s'   ø‡ ‚ ÙÑñ áKñ ñ Ñò ó    © N©Ú__name__Ú
__module__Ú__qualname__Ú__firstlineno__Ú__annotate_func__Ú__static_attributes__Ú__classdictcell__©r   s   @r   r	   r	      ó   ø‡ ‡ „ r   r	   c                   ó,   a € ] tR t^t o V 3R ltRtV tR# )ÚDegradingSignalc                ó>   <€ V ^8„  d   Qh/ S[ ;R&   S[;R&   S[ ;R&   # )r   r   ÚslopeÚpolarity©r   r   )r   r   s   "€r   r   ÚDegradingSignal.__annotate__   s&   ø‡ ‚ ÙÑñ áLñ ñ Mò r   r   Nr   r"   s   @r   r%   r%      r#   r   r%   c                   ó,   a € ] tR t^t o V 3R ltRtV tR# )ÚComponentHealthc                ó2   <€ V ^8„  d   Qh/ S[ ;R&   S[;R&   # )r   Úcomponent_codeÚhealth_scorer)   )r   r   s   "€r   r   ÚComponentHealth.__annotate__   s   ø‡ ‚ ÙÑñ áÑò r   r   Nr   r"   s   @r   r,   r,      r#   r   r,   c                   ó4   a € ] tR t^t o RtRtV 3R ltRtV tR# )Ú	TickRangeNc                óN   <€ V ^8„  d   Qh/ S[ R,          ;R&   S[ R,          ;R&   # )r   NÚmin_tickÚmax_tick)r   )r   r   s   "€r   r   ÚTickRange.__annotate__   s#   ø‡ ‚ ÙDjÑñ áDjÑò r   r   )	r   r   r   r   r4   r5   r   r    r!   r"   s   @r   r2   r2      s   ø‡ € Ø€HØ€H÷ ƒ r   r2   c                   ó>   a € ] tR t^!t o ]! ]R7      tV 3R ltRtV t	R# )ÚSystemIngestionStats©Údefault_factoryc                ó`   <€ V ^8„  d   Qh/ S[ ;R&   S[ ;R&   S[;R&   S[S[S[ 3,          ;R&   # )r   Ú
total_rowsÚ
componentsÚ
tick_rangeÚlatest_tick_by_component)r   r2   r   r   )r   r   s   "€r   r   Ú!SystemIngestionStats.__annotate__!   s;   ø‡ ‚ ÙOñ áOñ ñ Ññ ñ #¡3© 8nÑJò	 r   r   N)
r   r   r   r   r   Údictr?   r   r    r!   r"   s   @r   r8   r8   !   s   ø‡ € ñ 05ÀTÔ/JÐ÷	 ƒ r   r8   c                   ób   a € ] tR t^(t o ]! ]R7      t]! ]R7      t]! ]R7      tV 3R lt	Rt
V tR# )ÚSignalInventoryStatsr9   c                óŒ   <€ V ^8„  d   Qh/ S[ ;R&   S[S[S[ 3,          ;R&   S[S[S[ 3,          ;R&   S[S[S[ 3,          ;R&   # )r   Útotal_signalsÚby_typeÚ	by_familyÚby_role_visibility©r   r   r   )r   r   s   "€r   r   Ú!SignalInventoryStats.__annotate__(   sM   ø‡ ‚ ÙÑñ á‘#‘s(^Ñ9ñ ñ ‘C™H~Ñ;ñ ñ ™S¡#˜XÑDò	 r   r   N)r   r   r   r   r   rA   rF   rG   rH   r   r    r!   r"   s   @r   rC   rC   (   s+   ø‡ € á#°DÔ9€GÙ %°dÔ ;€IÙ).¸tÔ)DÐ÷	 ƒ r   rC   c                   ó,   a € ] tR t^/t o V 3R ltRtV tR# )ÚRuleCoverageStatsc                ó>   <€ V ^8„  d   Qh/ S[ ;R&   S[ ;R&   S[;R&   # )r   Útotal_rulesÚsignals_with_ruleÚrule_coverage_ratio)r   r   )r   r   s   "€r   r   ÚRuleCoverageStats.__annotate__/   s(   ø‡ ‚ ÙÑñ áÑñ ñ Ñò r   r   Nr   r"   s   @r   rL   rL   /   r#   r   rL   c                   óP   a € ] tR t^5t o ]! ]R7      t]! ]R7      tV 3R ltRt	V t
R# )Ú
EventStatsr9   c                ój   <€ V ^8„  d   Qh/ S[ ;R&   S[S[S[ 3,          ;R&   S[S[S[ 3,          ;R&   # )r   Útotal_eventsÚby_severityÚ	by_statusrI   )r   r   s   "€r   r   ÚEventStats.__annotate__5   s8   ø‡ ‚ ÙÑñ á‘c™3h•Ñ=ñ ñ ‘C™H~Ñ;ò r   r   N)r   r   r   r   r   rA   rV   rW   r   r    r!   r"   s   @r   rS   rS   5   s    ø‡ € á"'¸Ô"=€KÙ %°dÔ ;€I÷ ƒ r   rS   c                   ó,   a € ] tR t^;t o V 3R ltRtV tR# )ÚSystemStatsResponsec                óJ   <€ V ^8„  d   Qh/ S[ ;R&   S[;R&   S[;R&   S[;R&   # )r   Ú	ingestionÚsignalsÚrulesÚevents)r8   rC   rL   rS   )r   r   s   "€r   r   Ú SystemStatsResponse.__annotate__;   s5   ø‡ ‚ Ù#Ñ#ñ á!Ñ!ñ ñ Ññ ñ Ñò	 r   r   Nr   r"   s   @r   rZ   rZ   ;   r#   r   rZ   c                   ó,   a € ] tR t^Et o V 3R ltRtV tR# )ÚTopItemc                ó2   <€ V ^8„  d   Qh/ S[ ;R&   S[;R&   # )r   ÚkeyÚcount)r   r   )r   r   s   "€r   r   ÚTopItem.__annotate__E   s   ø‡ ‚ Ù	Hñ áJò r   r   Nr   r"   s   @r   rb   rb   E   r#   r   rb   c                   óD   a € ] tR t^Jt o RtRtRtRtRtRt	V 3R lt
RtV tR# )ÚLongestOpenAlertNc                óÎ   <€ V ^8„  d   Qh/ S[ ;R&   S[S[,          ;R&   S[S[,          ;R&   S[S[,          ;R&   S[S[ ,          ;R&   S[S[ ,          ;R&   S[S[ ,          ;R&   # )r   Úalert_event_idr.   r   ÚseverityÚ
tick_startÚtick_endÚduration_ticks)r   r   r   )r   r   s   "€r   r   ÚLongestOpenAlert.__annotate__J   st   ø‡ ‚ ÙÑñ á™S•MÑ(ñ ñ ™#•Ñ%ñ ñ ‘smÑ"ñ	 ñ
 ™•Ñ$ñ ñ ‘smÑ"ñ ñ ™S•MÑ(ò r   r   )r   r   r   r   r.   r   rk   rl   rm   rn   r   r    r!   r"   s   @r   rh   rh   J   s*   ø‡ € à$(€NØ!%€KØ"€HØ $€JØ"€HØ$(€N÷ ƒ r   rh   c                   ó,   a € ] tR t^Tt o V 3R ltRtV tR# )ÚAlertsStatsResponsec                ó  <€ V ^8„  d   Qh/ S[ S[S[R,          3,          ;R&   S[ S[S[3,          ;R&   S[ S[S[3,          ;R&   S[ S[S[3,          ;R&   S[S[,          ;R&   S[S[,          ;R&   S[S[,          ;R&   # )	r   Nr   ÚtotalsrV   rW   Útop_componentsÚtop_signalsÚlongest_open)r   r   r   r   rb   rh   )r   r   s   "€r   r   Ú AlertsStatsResponse.__annotate__T   s   ø‡ ‚ Ù‘‘c˜D•jÕ!Ñ!ñ á‘‘cNÑñ ñ ‘c™3h•Ññ ñ ‘C™H~Ññ	 ñ
 ™•MÑ!ñ ñ ‘g•Ññ ñ Ñ'Õ(Ñ(ò r   r   Nr   r"   s   @r   rq   rq   T   r#   r   rq   c                   ó,   a € ] tR t^at o V 3R ltRtV tR# )ÚComponentRankingc                ób   <€ V ^8„  d   Qh/ S[ ;R&   S[;R&   S[;R&   S[;R&   S[;R&   S[;R&   # )r   r.   r/   Úopen_alertsÚcritical_open_alertsÚwarning_open_alertsÚ
risk_score)r   r   r   )r   r   s   "€r   r   ÚComponentRanking.__annotate__a   sO   ø‡ ‚ ÙÑñ áÑñ ñ Ññ ñ Ññ	 ñ
 Ññ ñ Ñò r   r   Nr   r"   s   @r   ry   ry   a   r#   r   ry   c                   ó,   a € ] tR t^jt o V 3R ltRtV tR# )ÚComponentRankingsResponsec                ó6   <€ V ^8„  d   Qh/ S[ S[,          ;R&   # )r   Úranked)r   ry   )r   r   s   "€r   r   Ú&ComponentRankingsResponse.__annotate__j   s   ø‡ ‚ ÙÑ!Õ"Ñ"ò r   r   Nr   r"   s   @r   r   r   j   r#   r   r   c                   ó,   a € ] tR t^qt o V 3R ltRtV tR# )ÚSignalCoverageItemc                ón   <€ V ^8„  d   Qh/ S[ ;R&   S[ ;R&   S[ ;R&   S[;R&   S[;R&   S[;R&   S[;R&   # )r   r   r.   Úcolumn_nameÚwindow_ticksÚ total_component_points_in_windowÚpoints_with_metric_presentÚcoverage_ratior   )r   r   s   "€r   r   ÚSignalCoverageItem.__annotate__q   s\   ø‡ ‚ ÙÑñ áÑñ ñ Ññ ñ Ññ	 ñ
 '*Ñ)ñ ñ !$Ñ#ñ ñ Ñò r   r   Nr   r"   s   @r   r†   r†   q   r#   r   r†   c                   ó,   a € ] tR t^{t o V 3R ltRtV tR# )ÚSignalCoverageResponsec                óB   <€ V ^8„  d   Qh/ S[ ;R&   S[S[,          ;R&   # )r   r‰   Úworst)r   r   r†   )r   r   s   "€r   r   Ú#SignalCoverageResponse.__annotate__{   s!   ø‡ ‚ ÙÑñ áÑ"Õ#Ñ#ò r   r   Nr   r"   s   @r   r   r   {   r#   r   r   c                   ó0   a € ] tR t^ƒt o RtV 3R ltRtV tR# )ÚHotspotItemNc                ó~   <€ V ^8„  d   Qh/ S[ ;R&   S[S[ ,          ;R&   S[;R&   S[;R&   S[;R&   S[;R&   S[;R&   # )r   r   r.   Úopen_eventsÚcritical_openÚwarning_openÚmax_duration_ticksÚlast_tick_seen)r   r   r   )r   r   s   "€r   r   ÚHotspotItem.__annotate__ƒ   s`   ø‡ ‚ ÙÑñ á™S•MÑ(ñ ñ Ññ ñ Ññ	 ñ
 Ññ ñ Ññ ñ Ñò r   r   )r   r   r   r   r.   r   r    r!   r"   s   @r   r”   r”   ƒ   s   ø‡ € à$(€N÷ ƒ r   r”   c                   ó,   a € ] tR t^t o V 3R ltRtV tR# )ÚHotspotsResponsec                ó6   <€ V ^8„  d   Qh/ S[ S[,          ;R&   # )r   Úhotspots)r   r”   )r   r   s   "€r   r   ÚHotspotsResponse.__annotate__   s   ø‡ ‚ Ù‘;ÕÑò r   r   Nr   r"   s   @r   r   r      r#   r   r   N)Úpydanticr   r   Útypingr   r   r   r	   r%   r,   r2   r8   rC   rL   rS   rZ   rb   rh   rq   ry   r   r†   r   r”   r   r   r   r   Ú<module>r£      sê   ðß %ß 'Ñ 'ô˜ô ôiô ôiô ô 	ô  ô
K˜9ô KôE˜9ô Eô˜	ô ô<ô <ô˜)ô ôˆiô ô
)yô )ô)˜)ô )ôyô ô# 	ô #ô˜ô ô$˜Yô $ô)ô ô yö  r   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\schemas\__pycache__\auth.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\schemas\__pycache__\auth.cpython-314.pyc
==================================================
+
    ŒA\i´  ã                   óv   € ^ RI Ht ^ RIHt  ! R R]4      t ! R R]4      t ! R R]4      t ! R	 R
]4      tR# )é    )Ú	BaseModel)ÚListc                   ó,   a € ] tR t^t o V 3R ltRtV tR# )ÚSignupRequestc                ó2   <€ V ^8„  d   Qh/ S[ ;R&   S[ ;R&   # ©é   ÚusernameÚpassword©Ústr)ÚformatÚ__classdict__s   "€ÚEC:\Users\h50048240\3D Objects\PlatformOPS\backend\app\schemas\auth.pyÚ__annotate__ÚSignupRequest.__annotate__   ó   ø‡ ‚ ÙMñ áMò ó    © N©Ú__name__Ú
__module__Ú__qualname__Ú__firstlineno__Ú__annotate_func__Ú__static_attributes__Ú__classdictcell__©r   s   @r   r   r      ó   ø‡ ‡ „ r   r   c                   ó,   a € ] tR t^t o V 3R ltRtV tR# )ÚLoginRequestc                ó2   <€ V ^8„  d   Qh/ S[ ;R&   S[ ;R&   # r   r   )r   r   s   "€r   r   ÚLoginRequest.__annotate__   r   r   r   Nr   r   s   @r   r!   r!      r   r   r!   c                   ó0   a € ] tR t^t o RtV 3R ltRtV tR# )ÚTokenResponseÚbearerc                ó2   <€ V ^8„  d   Qh/ S[ ;R&   S[ ;R&   # )r	   Úaccess_tokenÚ
token_typer   )r   r   s   "€r   r   ÚTokenResponse.__annotate__   s   ø‡ ‚ ÙÑñ áÑò r   r   N)r   r   r   r   r)   r   r   r   r   s   @r   r%   r%      s   ø‡ € à€J÷ ƒ r   r%   c                   ó0   a € ] tR t^t o RtV 3R ltRtV tR# )ÚUserInfoFc                óZ   <€ V ^8„  d   Qh/ S[ ;R&   S[ ;R&   S[S[ ,          ;R&   S[;R&   # )r	   Úidr
   ÚrolesÚ	is_active)r   r   Úbool)r   r   s   "€r   r   ÚUserInfo.__annotate__   s7   ø‡ ‚ ÙGñ áMñ ñ ‘9Ññ ñ Ñò	 r   r   N)r   r   r   r   r0   r   r   r   r   s   @r   r,   r,      s   ø‡ € ð €I÷	 ƒ r   r,   N)Úpydanticr   Útypingr   r   r!   r%   r,   r   r   r   Ú<module>r5      s;   ðå Ý ôIô ô
9ô ô
Iô ô
ˆyö r   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\schemas\__pycache__\signal.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\schemas\__pycache__\signal.cpython-314.pyc
==================================================
+
    {*Ji7  ã                   ó(   € ^ RI Ht  ! R R]4      tR# )é    )Ú	BaseModelc                   ó@   a € ] tR t^t o  ! R R4      tV 3R ltRtV tR# )Ú	SignalOutc                   ó   € ] tR t^tRtRtR# )ÚSignalOut.ConfigT© N)Ú__name__Ú
__module__Ú__qualname__Ú__firstlineno__Úfrom_attributesÚ__static_attributes__r   ó    ÚGC:\Users\h50048240\3D Objects\platformOPS\backend\app\schemas\signal.pyÚConfigr      s   † ØŒr   r   c                ó¦   <€ V ^8„  d   Qh/ S[ ;R&   S[ ;R&   S[ ;R&   S[ R,          ;R&   S[ R,          ;R&   S[ R,          ;R&   S[ R,          ;R&   # )	é   Úsignal_codeÚcomponent_codeÚsignal_typeNÚunitÚpolarityÚfamilyÚdescription)Ústr)ÚformatÚ__classdict__s   "€r   Ú__annotate__ÚSignalOut.__annotate__   sl   ø‡ ‚ ÙÑñ áÑñ ñ Ññ ñ *Ññ	 ñ
 DjÑñ ñ $JÑñ ñ t•Ñò r   r   N)r	   r
   r   r   r   Ú__annotate_func__r   Ú__classdictcell__)r   s   @r   r   r      s   ø‡ € ÷ñ ÷ ƒ r   r   N)Úpydanticr   r   r   r   r   Ú<module>r#      s   ðå ô
	ö 
r   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\schemas\__pycache__\user.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\schemas\__pycache__\user.cpython-314.pyc
==================================================
+
    JlGi   ã                   ó4   € ^ RI Ht ^ RIHt  ! R R]4      tR# )é    )Ú	BaseModel)ÚListc                   ó,   a € ] tR t^t o V 3R ltRtV tR# )ÚAssignRolesRequestc                ó6   <€ V ^8„  d   Qh/ S[ S[,          ;R&   # )é   Úroles)r   Ústr)ÚformatÚ__classdict__s   "€ÚEC:\Users\h50048240\3D Objects\PlatformOPS\backend\app\schemas\user.pyÚ__annotate__ÚAssignRolesRequest.__annotate__   s   ø‡ ‚ Ù‘9Ñò ó    © N)Ú__name__Ú
__module__Ú__qualname__Ú__firstlineno__Ú__annotate_func__Ú__static_attributes__Ú__classdictcell__)r   s   @r   r   r      s   ø‡ ‡ „ r   r   N)Úpydanticr   Útypingr   r   r   r   r   Ú<module>r      s   ðå Ý ô˜ö r   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\scripts\generate_signals.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\scripts\generate_signals.py
==================================================
# app/scripts/generate_signals.py
from app.db.session import SessionLocal
from app.services.signal_generation_service import generate_signals

def main():
    db = SessionLocal()
    try:
        created = generate_signals(db)
        print(f"[OK] {created} signals generated")
    finally:
        db.close()

if __name__ == "__main__":
    main()




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\scripts\__pycache__\generate_signals.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\scripts\__pycache__\generate_signals.cpython-314.pyc
==================================================
+
    á&Jik  ã                   óD   € ^ RI Ht ^ RIHt R t]R8X  d
   ]! 4        R# R# )é    )ÚSessionLocal)Úgenerate_signalsc                  óš   € \        4       p  \        V 4      p\        R V R24       V P                  4        R#   T P                  4        i ; i)z[OK] z signals generatedN)r   r   ÚprintÚclose)ÚdbÚcreateds     ÚQC:\Users\h50048240\3D Objects\platformOPS\backend\app\scripts\generate_signals.pyÚmainr      s=   € Ü	‹€BðÜ" 2Ó&ˆÜgYÐ0Ð1Ô2à
‰Ž
øˆ‰
ús	   Œ8 ¸A
Ú__main__N)Úapp.db.sessionr   Ú&app.services.signal_generation_servicer   r   Ú__name__© ó    r
   Ú<module>r      s$   ðå 'Ý Còð ˆzÔÙ†Fñ r   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\services\alerts_insight_service.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\alerts_insight_service.py
==================================================
# app/services/alerts_insight_service.py
from sqlalchemy.orm import Session
from sqlalchemy import func
from app.db.models.alerts import AlertEvent


def alert_summary(db: Session):
    rows = (
        db.query(
            AlertEvent.severity,
            func.count(AlertEvent.id)
        )
        .group_by(AlertEvent.severity)
        .all()
    )

    return {severity: count for severity, count in rows}


def alerts_by_component(db: Session, component_code: str):
    return (
        db.query(AlertEvent)
        .filter(AlertEvent.component_code == component_code)
        .order_by(AlertEvent.id.desc())
        .all()
    )




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\services\alert_autogen_service.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\alert_autogen_service.py
==================================================
# app/services/alert_autogen_service.py
import statistics
from sqlalchemy.orm import Session
from sqlalchemy import text
from app.db.models.signals import Signal
from app.db.models.alerts import AlertRule


def _baseline(db: Session, signal: Signal, window: int = 50):
    sql = """
        SELECT
            (payload ->> :column)::double precision AS value
        FROM timeseries_points
        WHERE component_code = :component
          AND payload ? :column
        ORDER BY tick DESC
        LIMIT :window
    """

    rows = db.execute(
        text(sql),
        {
            "column": signal.column_name,
            "component": signal.component_code,
            "window": window,
        },
    ).fetchall()

    values = [r.value for r in rows if r.value is not None]

    if len(values) < 5:
        return None, None

    return statistics.mean(values), statistics.stdev(values)


def autogenerate_alert_rules(db: Session):
    created = 0

    signals = db.query(Signal).all()

    for s in signals:
        # Avoid duplicates
        exists = (
            db.query(AlertRule)
            .filter(AlertRule.signal_code == s.signal_code)
            .first()
        )
        if exists:
            continue

        mean, std = _baseline(db, s)

        # ---------- xi ----------
        if s.signal_type == "xi" and mean is not None:
            threshold = mean + 2 * std if s.polarity == "higher_is_worse" else mean - 2 * std
            rule = AlertRule(
                signal_code=s.signal_code,
                operator=">" if s.polarity == "higher_is_worse" else "<",
                threshold=threshold,
                min_duration_ticks=2,
                severity="MEDIUM",
            )

        # ---------- yi ----------
        elif s.signal_type == "yi":
            rule = AlertRule(
                signal_code=s.signal_code,
                operator="<",
                threshold=70.0,
                min_duration_ticks=3,
                severity="HIGH",
            )

        # ---------- zi ----------
        elif s.signal_type == "zi":
            rule = AlertRule(
                signal_code=s.signal_code,
                operator=">",
                threshold=0.7,
                min_duration_ticks=5,
                severity="CRITICAL",
            )

        else:
            continue

        db.add(rule)
        created += 1

    db.commit()
    return created




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\services\alert_notification_serice.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\alert_notification_serice.py
==================================================
from typing import List
from sqlalchemy.orm import Session

from app.db.models.alerts import AlertEvent
from app.core.config import settings
from app.services.email_service import send_email


def notify_admin_for_real_alerts(
    db: Session,
    alerts: List[AlertEvent],
):
    """
    Send ONE summary email for newly created REAL alerts.
    """

    if not alerts:
        return

    # Group alerts by severity
    grouped: dict[str, list[AlertEvent]] = {}
    for alert in alerts:
        grouped.setdefault(alert.severity, []).append(alert)

    # Build email text
    lines: list[str] = []
    lines.append("ðŸš¨ PlatformOPS â€“ REAL Alerts Detected")
    lines.append("")
    lines.append(f"Total new alerts: {len(alerts)}")
    lines.append("")

    for severity, items in grouped.items():
        lines.append(f"Severity: {severity.upper()} ({len(items)})")
        for a in items:
            lines.append(
                f"- Component: {a.component_code} | "
                f"Signal: {a.signal_code} | "
                f"Ticks: {a.tick_start} â†’ {a.tick_end} | "
                f"Peak: {a.peak_value}"
            )
        lines.append("")

    body = "\n".join(lines)

    send_email(
        to_email=settings.SMTP_FROM_EMAIL,  # admin inbox (MailHog)
        subject="ðŸš¨ PlatformOPS â€“ Alert Summary",
        text=body,
    )




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\services\alert_rule_generator.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\alert_rule_generator.py
==================================================
# app/services/alert_rule_generator.py
from sqlalchemy.orm import Session

from app.db.models.alerts import AlertRule
from app.db.models.signals import Signal
from app.observability.baseline import metric_baseline
from app.observability.metric_families import detect_family


def generate_rules_for_all_metrics(db: Session) -> int:
    """
    Deterministic, family-based alert rule generation.
    NO std, NO dynamic math instability.
    """

    existing = {r.signal_code for r in db.query(AlertRule.signal_code).all()}
    created = 0

    signals = db.query(Signal).all()

    for s in signals:
        if s.signal_code in existing:
            continue

        family = detect_family(s.column_name)
        baseline = metric_baseline(db, s.component_code, s.column_name)

        rules = []

        # ---------------- Utilization / Saturation ----------------
        if family == "utilization":
            rules = [
                ("gt", 0.75, "warning"),
                ("gt", 0.90, "critical"),
            ]

        # ---------------- Throughput / Rates ----------------
        elif family == "throughput" and baseline:
            rules = [
                ("gt", baseline["mean"] * 1.5, "warning"),
                ("gt", baseline["mean"] * 2.5, "critical"),
            ]

        # ---------------- Backlog / Lag / Queues ----------------
        elif family == "backlog" and baseline:
            rules = [
                ("gt", baseline["p95"], "warning"),
                ("gt", baseline["max"], "critical"),
            ]

        # ---------------- Latency ----------------
        elif family == "latency" and baseline:
            rules = [
                ("gt", baseline["p95"], "warning"),
                ("gt", baseline["p95"] * 2.0, "critical"),
            ]

        # ---------------- Error rates ----------------
        elif family == "error_rate":
            rules = [
                ("gt", 0.01, "warning"),
                ("gt", 0.05, "critical"),
            ]

        # ---------------- Events / Counters ----------------
        elif family == "events":
            rules = [
                ("gt", 1, "warning"),
                ("gt", 3, "critical"),
            ]

        # ---------------- Generic counts ----------------
        elif family == "count" and baseline:
            rules = [
                ("gt", baseline["p95"], "warning"),
                ("gt", baseline["max"], "critical"),
            ]

        for op, threshold, severity in rules:
            db.add(
                AlertRule(
                    signal_code=s.signal_code,
                    operator=op,
                    threshold=float(threshold),
                    min_duration_ticks=2 if severity == "warning" else 3,
                    severity=severity,
                    enabled=True,
                )
            )
            created += 1

    db.commit()
    return created




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\services\alert_rule_service.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\alert_rule_service.py
==================================================
# app/services/alert_rule_service.py
import statistics
from sqlalchemy.orm import Session
from sqlalchemy import text
from app.db.models.alerts import AlertRule
from app.db.models.signals import Signal


def _baseline(db: Session, signal: Signal, window: int = 50):
    rows = db.execute(
        text("""
            SELECT (payload ->> :column)::double precision AS value
            FROM timeseries_points
            WHERE component_code = :component
              AND payload ? :column
            ORDER BY tick DESC
            LIMIT :window
        """),
        {
            "column": signal.column_name,
            "component": signal.component_code,
            "window": window,
        },
    ).fetchall()

    values = [r.value for r in rows if r.value is not None]

    if len(values) < 5:
        return None, None

    return statistics.mean(values), statistics.stdev(values)


def generate_rules_for_all_signals(db: Session) -> int:
    existing = {
        r.signal_code for r in db.query(AlertRule.signal_code).all()
    }

    created = 0

    for s in db.query(Signal).all():
        if s.signal_code in existing:
            continue

        mean, std = _baseline(db, s)

        # ---------------- xi ----------------
        if s.signal_type == "xi":
            if mean is not None and std is not None:
                threshold = (
                    mean + 2 * std
                    if s.polarity == "higher_is_worse"
                    else mean - 2 * std
                )
            else:
                # fallback â€” safe generic
                threshold = 1.0

            operator = "gt" if s.polarity == "higher_is_worse" else "lt"

            rule = AlertRule(
                signal_code=s.signal_code,
                operator=operator,
                threshold=threshold,
                min_duration_ticks=2,
                severity="warning",
                enabled=True,
            )

        # ---------------- yi ----------------
        elif s.signal_type == "yi":
            rule = AlertRule(
                signal_code=s.signal_code,
                operator="lt",
                threshold=70.0,
                min_duration_ticks=3,
                severity="warning",
                enabled=True,
            )

        # ---------------- zi ----------------
        elif s.signal_type == "zi":
            rule = AlertRule(
                signal_code=s.signal_code,
                operator="gt",
                threshold=0.7,
                min_duration_ticks=5,
                severity="critical",
                enabled=True,
            )

        else:
            # ABSOLUTE SAFETY NET
            rule = AlertRule(
                signal_code=s.signal_code,
                operator="ne",
                threshold=-1,
                min_duration_ticks=999999,
                severity="info",
                enabled=False,
            )

        db.add(rule)
        created += 1

    db.commit()
    return created




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\services\alert_service copy.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\alert_service copy.py
==================================================
# app/services/alert_service.py
from __future__ import annotations
from typing import Optional, Dict, Any, List, Tuple

from sqlalchemy.orm import Session
from sqlalchemy import text

from app.db.models.alerts import AlertRule, AlertEvent
from app.db.models.signals import Signal

OPERATORS = {
    "gt":  lambda v, t: v > t,
    "gte": lambda v, t: v >= t,
    "lt":  lambda v, t: v < t,
    "lte": lambda v, t: v <= t,
    "eq":  lambda v, t: v == t,
    "ne":  lambda v, t: v != t,
}


def _close_all_open_baseline(db: Session, rule_id: int):
    db.query(AlertEvent).filter(
        AlertEvent.rule_id == rule_id,
        AlertEvent.status == "OPEN",
    ).update({"status": "CLOSED"})


def _delete_simulated_for_rule(db: Session, rule_id: int):
    db.query(AlertEvent).filter(
        AlertEvent.rule_id == rule_id,
        AlertEvent.status == "SIMULATED",
    ).delete()


def evaluate_alerts(
    db: Session,
    lookback_ticks: int = 200,
    simulation_mode: bool = False,
) -> Dict[str, Any]:

    rules = db.query(AlertRule).filter(AlertRule.enabled == True).all()
    signals = {s.signal_code: s for s in db.query(Signal).all()}

    evaluated = created = closed = updated = 0
    origin = "SIMULATED" if simulation_mode else "REAL"

    for rule in rules:
        signal = signals.get(rule.signal_code)
        if not signal:
            continue

        op = OPERATORS.get(rule.operator)
        if not op:
            continue

        # Fetch existing OPEN alert (if any)
        open_alert = (
            db.query(AlertEvent)
            .filter(
                AlertEvent.rule_id == rule.id,
                AlertEvent.component_code == signal.component_code,
                AlertEvent.status == "OPEN",
                AlertEvent.origin == origin,
            )
            .one_or_none()
        )

        sql = """
            SELECT tick,
                   (payload ->> :column)::double precision AS value
            FROM timeseries_points
            WHERE component_code = :component
              AND payload ? :column
            ORDER BY tick DESC
            LIMIT :limit
        """

        rows = db.execute(
            text(sql),
            {
                "component": signal.component_code,
                "column": signal.column_name,
                "limit": lookback_ticks,
            },
        ).fetchall()

        if not rows:
            continue

        rows = list(reversed(rows))

        streak = 0
        start_tick = None
        peak = None
        violated_now = False

        for tick, value in rows:
            if value is None:
                streak = 0
                start_tick = None
                peak = None
                continue

            if op(value, rule.threshold):
                streak += 1
                peak = value if peak is None else max(peak, value)
                start_tick = start_tick or tick

                if streak >= rule.min_duration_ticks:
                    violated_now = True
                    break
            else:
                streak = 0
                start_tick = None
                peak = None

        # ---------- STATE TRANSITIONS ----------

        if violated_now:
            if open_alert:
                open_alert.tick_end = tick
                open_alert.peak_value = max(open_alert.peak_value, peak)
                updated += 1
            else:
                db.add(
                    AlertEvent(
                        rule_id=rule.id,
                        component_code=signal.component_code,
                        signal_code=signal.signal_code,
                        tick_start=start_tick,
                        tick_end=tick,
                        peak_value=peak,
                        severity=rule.severity,
                        status="OPEN",
                        origin=origin,
                    )
                )
                created += 1
        else:
            if open_alert:
                open_alert.status = "CLOSED"
                closed += 1

        evaluated += 1

    db.commit()

    return {
        "evaluated_rules": evaluated,
        "created_events": created,
        "updated_events": updated,
        "closed_events": closed,
        "origin": origin,
    }




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\services\alert_service.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\alert_service.py
==================================================
# app/services/alert_service.py
from __future__ import annotations
from typing import Dict, Any, List

from sqlalchemy.orm import Session
from sqlalchemy import text

from app.db.models.alerts import AlertRule, AlertEvent
from app.db.models.signals import Signal
from app.services.alert_notification_serice import notify_admin_for_real_alerts


OPERATORS = {
    "gt":  lambda v, t: v > t,
    "gte": lambda v, t: v >= t,
    "lt":  lambda v, t: v < t,
    "lte": lambda v, t: v <= t,
    "eq":  lambda v, t: v == t,
    "ne":  lambda v, t: v != t,
}


def _close_all_open_baseline(db: Session, rule_id: int):
    db.query(AlertEvent).filter(
        AlertEvent.rule_id == rule_id,
        AlertEvent.status == "OPEN",
    ).update({"status": "CLOSED"})


def _delete_simulated_for_rule(db: Session, rule_id: int):
    db.query(AlertEvent).filter(
        AlertEvent.rule_id == rule_id,
        AlertEvent.status == "SIMULATED",
    ).delete()


def evaluate_alerts(
    db: Session,
    lookback_ticks: int = 200,
    simulation_mode: bool = False,
) -> Dict[str, Any]:

    rules = db.query(AlertRule).filter(AlertRule.enabled == True).all()
    signals = {s.signal_code: s for s in db.query(Signal).all()}

    evaluated = created = closed = updated = 0
    origin = "SIMULATED" if simulation_mode else "REAL"

    # ðŸ”” Track newly created REAL alerts
    new_real_alerts: List[AlertEvent] = []

    for rule in rules:
        signal = signals.get(rule.signal_code)
        if not signal:
            continue

        op = OPERATORS.get(rule.operator)
        if not op:
            continue

        # Fetch existing OPEN alert (if any)
        open_alert = (
        db.query(AlertEvent)
         .filter(
            AlertEvent.rule_id == rule.id,
            AlertEvent.component_code == signal.component_code,
             AlertEvent.status == "OPEN",
            AlertEvent.origin == origin,
                )
        .order_by(AlertEvent.id.desc())
        .first()
        )


        sql = """
            SELECT tick,
                   (payload ->> :column)::double precision AS value
            FROM timeseries_points
            WHERE component_code = :component
              AND payload ? :column
            ORDER BY tick DESC
            LIMIT :limit
        """

        rows = db.execute(
            text(sql),
            {
                "component": signal.component_code,
                "column": signal.column_name,
                "limit": lookback_ticks,
            },
        ).fetchall()

        if not rows:
            continue

        rows = list(reversed(rows))

        streak = 0
        start_tick = None
        peak = None
        violated_now = False

        for tick, value in rows:
            if value is None:
                streak = 0
                start_tick = None
                peak = None
                continue

            if op(value, rule.threshold):
                streak += 1
                peak = value if peak is None else max(peak, value)
                start_tick = start_tick or tick

                if streak >= rule.min_duration_ticks:
                    violated_now = True
                    break
            else:
                streak = 0
                start_tick = None
                peak = None

        # ---------- STATE TRANSITIONS ----------

        if violated_now:
            if open_alert:
                open_alert.tick_end = tick
                open_alert.peak_value = max(open_alert.peak_value, peak)
                updated += 1
            else:
                alert = AlertEvent(
                    rule_id=rule.id,
                    component_code=signal.component_code,
                    signal_code=signal.signal_code,
                    tick_start=start_tick,
                    tick_end=tick,
                    peak_value=peak,
                    severity=rule.severity,
                    status="OPEN",
                    origin=origin,
                )

                db.add(alert)
                created += 1

                # ðŸ”” Collect REAL alerts only
                if origin == "REAL":
                    new_real_alerts.append(alert)
        else:
            if open_alert:
                open_alert.status = "CLOSED"
                closed += 1

        evaluated += 1

    db.commit()

    # ðŸ”” Send ONE email for REAL alerts
    if origin == "REAL" and new_real_alerts:
        notify_admin_for_real_alerts(db, new_real_alerts)

    return {
        "evaluated_rules": evaluated,
        "created_events": created,
        "updated_events": updated,
        "closed_events": closed,
        "origin": origin,
    }




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\services\analytics_service.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\analytics_service.py
==================================================
# app/services/analytics_service.py
import statistics
from typing import Dict, Any, List, Optional, Tuple

from sqlalchemy.orm import Session
from sqlalchemy import Float, func, text , case

from app.db.models.signals import Signal
from app.db.models.timeseries import TimeSeriesPoint
from app.db.models.alerts import AlertRule, AlertEvent
from typing import Dict, Any, List
import statistics
import math

from sqlalchemy import Float
from collections import defaultdict
import statistics
from sqlalchemy import text








# ---------- INTERNAL HELPER ----------
def _extract_series(db: Session, component_code: str, column_name: str, limit: int = 30) -> List[float]:
    rows = (
        db.query(
            TimeSeriesPoint.tick,
            TimeSeriesPoint.payload[column_name].astext.cast(Float)
        )
        .filter(TimeSeriesPoint.component_code == component_code)
        .order_by(TimeSeriesPoint.tick.desc())
        .limit(limit)
        .all()
    )
    return [r[1] for r in reversed(rows) if r[1] is not None]


# ---------- VOLATILITY ----------
def compute_volatility(db: Session, signal_code: str, window: int):
    signal = (
        db.query(Signal)
        .filter(Signal.signal_code == signal_code)
        .one_or_none()
    )
    if not signal:
        raise ValueError("Signal not found")

    series = _extract_series(db, signal.component_code, signal.column_name, window)

    # ðŸ”¥ FIX: extract only values
    values = [v for _, v in series]

    if len(values) < 2:
        return 0.0

    return statistics.stdev(values)



# ---------- DEGRADATION ----------
def detect_degradation(db: Session, role: str, window: int = 20):
    signals = db.query(Signal).all()
    results = []

    for s in signals:
        if s.visible_to_roles and role not in s.visible_to_roles and "admin" not in s.visible_to_roles:
            continue

        values = _extract_series(db, s.component_code, s.column_name, window)
        if len(values) < 2:
            continue

        slope = (values[-1] - values[0]) / max(window, 1)

        if s.polarity == "higher_is_worse" and slope > 0:
            results.append({"signal_code": s.signal_code, "slope": slope, "polarity": s.polarity})

        if s.polarity == "lower_is_worse" and slope < 0:
            results.append({"signal_code": s.signal_code, "slope": slope, "polarity": s.polarity})

    return results


# ---------- COMPONENT HEALTH ----------
def component_health(db: Session, component_code: str):
    signals = (
        db.query(Signal)
        .filter(
            Signal.component_code == component_code,
            Signal.signal_type == "yi",
        )
        .all()
    )

    values = []

    for s in signals:
        series = _extract_series(
            db,
            component_code,
            s.column_name,
            limit=1
        )
        if series:
            value = series[0]
            if isinstance(value, tuple):
                value = value[0]

            if value is not None:
                values.append(float(value))

    if not values:
        return 100.0

    return max(0.0, 100.0 - (sum(values) / len(values)))



# ---------- GLOBAL HEALTH ----------
def global_health(db: Session):
    """
    Compute global health dynamically from OPEN alerts.
    No system_health table required.
    """

    rows = (
        db.query(
            AlertEvent.severity,
            func.count(AlertEvent.id)
        )
        .filter(AlertEvent.status == "OPEN")
        .group_by(AlertEvent.severity)
        .all()
    )

    counts = {sev: cnt for sev, cnt in rows}

    critical = counts.get("critical", 0)
    warning = counts.get("warning", 0)

    total = critical + warning

    if total == 0:
        return {
            "collapse_risk": 0.0,
            "status": "STABLE",
        }

    # Simple, explainable risk model
    collapse_risk = min(1.0, (critical * 2 + warning) / max(total * 2, 1))

    status = (
        "CRITICAL" if collapse_risk > 0.7
        else "DEGRADED" if collapse_risk > 0.3
        else "STABLE"
    )

    return {
        "collapse_risk": round(collapse_risk, 3),
        "status": status,
    }

# =========================================================
# NEW GLOBAL ANALYTICS
# =========================================================

def system_stats(db: Session) -> Dict[str, Any]:
    # ingestion stats
    total_rows = db.query(func.count(TimeSeriesPoint.id)).scalar() or 0

    tick_min, tick_max = db.query(
        func.min(TimeSeriesPoint.tick),
        func.max(TimeSeriesPoint.tick),
    ).one()

    components_count = db.query(func.count(func.distinct(TimeSeriesPoint.component_code))).scalar() or 0

    latest_ticks = db.query(
        TimeSeriesPoint.component_code,
        func.max(TimeSeriesPoint.tick)
    ).group_by(TimeSeriesPoint.component_code).all()

    latest_tick_by_component = {c: int(t) for c, t in latest_ticks if t is not None}

    # signals inventory
    total_signals = db.query(func.count(Signal.signal_code)).scalar() or 0

    by_type_rows = db.query(Signal.signal_type, func.count(Signal.signal_code)).group_by(Signal.signal_type).all()
    by_type = {t or "unknown": int(cnt) for t, cnt in by_type_rows}

    by_family_rows = db.query(Signal.family, func.count(Signal.signal_code)).group_by(Signal.family).all()
    by_family = {f or "unknown": int(cnt) for f, cnt in by_family_rows}

    # role visibility distribution
    # visible_to_roles is an ARRAY, easiest is to iterate (signals count is small ~1k)
    role_counts: Dict[str, int] = {}
    for s in db.query(Signal.visible_to_roles).all():
        roles = s[0] or []
        for r in roles:
            role_counts[r] = role_counts.get(r, 0) + 1

    # rules coverage
    total_rules = db.query(func.count(AlertRule.id)).scalar() or 0
    signals_with_rule = db.query(func.count(func.distinct(AlertRule.signal_code))).scalar() or 0
    coverage_ratio = float(signals_with_rule / total_signals) if total_signals else 0.0

    # events stats
    total_events = db.query(func.count(AlertEvent.id)).scalar() or 0

    by_sev_rows = db.query(AlertEvent.severity, func.count(AlertEvent.id)).group_by(AlertEvent.severity).all()
    by_severity = {s or "unknown": int(cnt) for s, cnt in by_sev_rows}

    by_status_rows = db.query(AlertEvent.status, func.count(AlertEvent.id)).group_by(AlertEvent.status).all()
    by_status = {s or "unknown": int(cnt) for s, cnt in by_status_rows}

    return {
        "ingestion": {
            "total_rows": int(total_rows),
            "components": int(components_count),
            "tick_range": {"min_tick": tick_min, "max_tick": tick_max},
            "latest_tick_by_component": latest_tick_by_component,
        },
        "signals": {
            "total_signals": int(total_signals),
            "by_type": by_type,
            "by_family": by_family,
            "by_role_visibility": role_counts,
        },
        "rules": {
            "total_rules": int(total_rules),
            "signals_with_rule": int(signals_with_rule),
            "rule_coverage_ratio": coverage_ratio,
        },
        "events": {
            "total_events": int(total_events),
            "by_severity": by_severity,
            "by_status": by_status,
        }
    }


def alerts_stats(
    db: Session,
    from_tick: Optional[int] = None,
    to_tick: Optional[int] = None,
    limit: int = 10,
) -> Dict[str, Any]:
    q = db.query(AlertEvent)

    if from_tick is not None:
        q = q.filter(AlertEvent.tick_end >= from_tick)
    if to_tick is not None:
        q = q.filter(AlertEvent.tick_start <= to_tick)

    total_events = q.count()

    # severity / status breakdown
    by_sev = dict(
        q.with_entities(AlertEvent.severity, func.count(AlertEvent.id))
        .group_by(AlertEvent.severity)
        .all()
    )
    by_sev = {k or "unknown": int(v) for k, v in by_sev.items()}

    by_status = dict(
        q.with_entities(AlertEvent.status, func.count(AlertEvent.id))
        .group_by(AlertEvent.status)
        .all()
    )
    by_status = {k or "unknown": int(v) for k, v in by_status.items()}

    # top components and signals
    top_components = (
        q.with_entities(AlertEvent.component_code, func.count(AlertEvent.id).label("cnt"))
        .group_by(AlertEvent.component_code)
        .order_by(text("cnt DESC"))
        .limit(limit)
        .all()
    )

    top_signals = (
        q.with_entities(AlertEvent.signal_code, func.count(AlertEvent.id).label("cnt"))
        .group_by(AlertEvent.signal_code)
        .order_by(text("cnt DESC"))
        .limit(limit)
        .all()
    )

    # longest open alerts
    open_q = q.filter(AlertEvent.status == "OPEN")

    # duration_ticks = tick_end - tick_start (tick_end can be None during creation, but in your code it's set)
    longest_open = (
        open_q.with_entities(
            AlertEvent.id,
            AlertEvent.component_code,
            AlertEvent.signal_code,
            AlertEvent.severity,
            AlertEvent.tick_start,
            AlertEvent.tick_end,
            (AlertEvent.tick_end - AlertEvent.tick_start).label("duration_ticks"),
        )
        .order_by(text("duration_ticks DESC"))
        .limit(limit)
        .all()
    )

    return {
        "window": {"from_tick": from_tick, "to_tick": to_tick},
        "totals": {"total_events": int(total_events)},
        "by_severity": by_sev,
        "by_status": by_status,
        "top_components": [{"key": c or "unknown", "count": int(cnt)} for c, cnt in top_components],
        "top_signals": [{"key": s or "unknown", "count": int(cnt)} for s, cnt in top_signals],
        "longest_open": [
            {
                "alert_event_id": int(r[0]),
                "component_code": r[1],
                "signal_code": r[2],
                "severity": r[3],
                "tick_start": r[4],
                "tick_end": r[5],
                "duration_ticks": int(r[6]) if r[6] is not None else None,
            }
            for r in longest_open
        ],
    }


def component_rankings(db: Session, limit: int = 10) -> Dict[str, Any]:
    components = db.query(Signal.component_code).distinct().all()
    components = [c[0] for c in components if c and c[0]]

    ranked = []

    for comp in components:
        health = float(component_health(db, comp))

        open_events = (
            db.query(func.count(AlertEvent.id))
            .filter(AlertEvent.component_code == comp, AlertEvent.status == "OPEN")
            .scalar()
            or 0
        )

        critical_open = (
            db.query(func.count(AlertEvent.id))
            .filter(
                AlertEvent.component_code == comp,
                AlertEvent.status == "OPEN",
                AlertEvent.severity == "critical",
            )
            .scalar()
            or 0
        )

        warning_open = (
            db.query(func.count(AlertEvent.id))
            .filter(
                AlertEvent.component_code == comp,
                AlertEvent.status == "OPEN",
                AlertEvent.severity == "warning",
            )
            .scalar()
            or 0
        )

        # Composite risk score (simple but meaningful):
        # - critical weighs heavily
        # - warning weighs moderately
        # - low health increases risk
        risk_score = (critical_open * 5.0) + (warning_open * 1.5) + max(0.0, (100.0 - health) / 10.0)

        ranked.append({
            "component_code": comp,
            "health_score": health,
            "open_alerts": int(open_events),
            "critical_open_alerts": int(critical_open),
            "warning_open_alerts": int(warning_open),
            "risk_score": float(risk_score),
        })

    ranked.sort(key=lambda x: x["risk_score"], reverse=True)
    return {"ranked": ranked[:limit]}


def signal_coverage(db: Session, window_ticks: int = 200, limit: int = 20) -> Dict[str, Any]:
    # find max tick globally
    max_tick = db.query(func.max(TimeSeriesPoint.tick)).scalar()
    if max_tick is None:
        return {"window_ticks": window_ticks, "worst": []}

    from_tick = int(max_tick) - int(window_ticks) + 1

    # total points per component in window
    component_points = dict(
        db.query(
            TimeSeriesPoint.component_code,
            func.count(TimeSeriesPoint.id)
        )
        .filter(TimeSeriesPoint.tick >= from_tick, TimeSeriesPoint.tick <= int(max_tick))
        .group_by(TimeSeriesPoint.component_code)
        .all()
    )
    component_points = {c: int(cnt) for c, cnt in component_points.items()}

    # for each signal, count points where payload contains column
    # We do a SQL per signal (924 signals -> still ok for a button click, but could be heavy).
    # To keep it efficient, we compute coverage and then return only worst 'limit'.
    worst_list: List[Dict[str, Any]] = []

    signals = db.query(Signal).all()
    for s in signals:
        total = component_points.get(s.component_code, 0)
        if total == 0:
            continue

        sql = """
            SELECT COUNT(*) AS present_count
            FROM timeseries_points
            WHERE component_code = :component
              AND tick >= :from_tick
              AND tick <= :to_tick
              AND payload ? :column
        """
        present_count = db.execute(
            text(sql),
            {
                "component": s.component_code,
                "from_tick": from_tick,
                "to_tick": int(max_tick),
                "column": s.column_name,
            }
        ).scalar() or 0

        ratio = float(present_count / total) if total else 0.0

        worst_list.append({
            "signal_code": s.signal_code,
            "component_code": s.component_code,
            "column_name": s.column_name,
            "window_ticks": int(window_ticks),
            "total_component_points_in_window": int(total),
            "points_with_metric_present": int(present_count),
            "coverage_ratio": float(ratio),
        })

    worst_list.sort(key=lambda x: x["coverage_ratio"])
    return {"window_ticks": int(window_ticks), "worst": worst_list[:limit]}


def active_hotspots(db: Session, limit: int = 15):

    rows = (
        db.query(
            AlertEvent.signal_code,
            AlertEvent.component_code,
            func.count(AlertEvent.id).label("open_events"),

            func.sum(
                case(
                    (AlertEvent.severity == "critical", 1),
                    else_=0
                )
            ).label("critical_open"),

            func.sum(
                case(
                    (AlertEvent.severity == "warning", 1),
                    else_=0
                )
            ).label("warning_open"),

            func.max(AlertEvent.tick_end).label("last_tick"),
            func.max(AlertEvent.tick_end - AlertEvent.tick_start).label("max_duration"),
        )
        .filter(AlertEvent.status == "OPEN")
        .group_by(AlertEvent.signal_code, AlertEvent.component_code)
        .order_by(text("open_events DESC"))
        .limit(limit)
        .all()
    )

    return {
        "hotspots": [
            {
                "signal_code": r.signal_code,
                "component_code": r.component_code,
                "open_events": int(r.open_events or 0),
                "critical_open": int(r.critical_open or 0),
                "warning_open": int(r.warning_open or 0),
                "last_tick_seen": int(r.last_tick or 0),
                "max_duration_ticks": int(r.max_duration or 0),
            }
            for r in rows
        ]
    }

def component_time_analysis(
    db: Session,
    component_code: str,
    max_ticks: int = 500,
) -> Dict[str, Any]:
    """
    Adaptive time-interval analysis for a component.
    Automatically segments time based on behavior changes.
    """

    # 1ï¸âƒ£ Collect ticks
    ticks = (
        db.query(TimeSeriesPoint.tick)
        .filter(TimeSeriesPoint.component_code == component_code)
        .order_by(TimeSeriesPoint.tick)
        .limit(max_ticks)
        .all()
    )
    ticks = [t[0] for t in ticks]

    if not ticks:
        return {"component_code": component_code, "intervals": []}

    # 2ï¸âƒ£ Build per-tick stress score
    stress_by_tick = {}

    for t in ticks:
        # open alerts
        open_alerts = (
            db.query(func.count(AlertEvent.id))
            .filter(
                AlertEvent.component_code == component_code,
                AlertEvent.status == "OPEN",
                AlertEvent.tick_start <= t,
                AlertEvent.tick_end >= t,
            )
            .scalar()
            or 0
        )

        critical_alerts = (
            db.query(func.count(AlertEvent.id))
            .filter(
                AlertEvent.component_code == component_code,
                AlertEvent.status == "OPEN",
                AlertEvent.severity == "critical",
                AlertEvent.tick_start <= t,
                AlertEvent.tick_end >= t,
            )
            .scalar()
            or 0
        )

        # component health
        health = component_health(db, component_code)

        # stress score (simple but meaningful)
        stress = (
            critical_alerts * 10.0
            + open_alerts * 2.0
            + (100.0 - health) * 0.3
        )

        stress_by_tick[t] = {
            "stress": stress,
            "open_alerts": open_alerts,
            "critical_alerts": critical_alerts,
            "health": health,
        }

    # 3ï¸âƒ£ Adaptive interval splitting
    intervals = []
    current = {
        "start_tick": ticks[0],
        "end_tick": ticks[0],
        "samples": [],
    }

    last_stress = stress_by_tick[ticks[0]]["stress"]

    for t in ticks:
        s = stress_by_tick[t]["stress"]

        # split condition
        if abs(s - last_stress) > 15:
            intervals.append(current)
            current = {
                "start_tick": t,
                "end_tick": t,
                "samples": [],
            }

        current["end_tick"] = t
        current["samples"].append(stress_by_tick[t])
        last_stress = s

    intervals.append(current)

    # 4ï¸âƒ£ Score & classify intervals
    analyzed = []

    for i in intervals:
        samples = i["samples"]
        avg_stress = sum(x["stress"] for x in samples) / len(samples)
        max_critical = max(x["critical_alerts"] for x in samples)
        avg_health = sum(x["health"] for x in samples) / len(samples)

        if max_critical > 0 or avg_stress > 60:
            status = "BAD"
        elif avg_stress > 25:
            status = "DEGRADED"
        else:
            status = "GOOD"

        analyzed.append({
            "start_tick": i["start_tick"],
            "end_tick": i["end_tick"],
            "duration_ticks": i["end_tick"] - i["start_tick"] + 1,
            "avg_health": round(avg_health, 2),
            "avg_stress": round(avg_stress, 2),
            "max_critical_alerts": max_critical,
            "status": status,
        })

    return {
        "component_code": component_code,
        "intervals": analyzed,
    }






# -------------------------------------------------
# Helpers
# -------------------------------------------------

def _extract_series(db, component_code, column_name, limit=1440):
    rows = (
        db.query(
            TimeSeriesPoint.tick,
            TimeSeriesPoint.payload[column_name].astext.cast(Float),
        )
        .filter(TimeSeriesPoint.component_code == component_code)
        .order_by(TimeSeriesPoint.tick.desc())
        .limit(limit)
        .all()
    )
    rows = [(int(t), float(v)) for t, v in reversed(rows) if v is not None]
    return rows


def _linear_forecast(xs: List[int], ys: List[float]):
    """
    Simple least-squares linear regression.
    Returns slope and intercept.
    """
    n = len(xs)
    if n < 2:
        return 0.0, ys[-1] if ys else 0.0

    x_mean = sum(xs) / n
    y_mean = sum(ys) / n

    num = sum((x - x_mean) * (y - y_mean) for x, y in zip(xs, ys))
    den = sum((x - x_mean) ** 2 for x in xs)

    slope = num / den if den != 0 else 0.0
    intercept = y_mean - slope * x_mean
    return slope, intercept


# -------------------------------------------------
# SIGNAL FORECAST
# -------------------------------------------------

def forecast_signal(
    db: Session,
    signal_code: str,
    horizon_ticks: int = 30,
    history_ticks: int = 1440,
) -> Dict[str, Any]:
    """
    Forecast next N ticks for a signal.
    """

    signal = (
        db.query(Signal)
        .filter(Signal.signal_code == signal_code)
        .one_or_none()
    )
    if not signal:
        raise ValueError("Signal not found")

    series = _extract_series(
        db,
        signal.component_code,
        signal.column_name,
        history_ticks,
    )

    if len(series) < 10:
        return {
            "signal_code": signal_code,
            "status": "INSUFFICIENT_DATA",
        }

    ticks = [t for t, _ in series]
    values = [v for _, v in series]

    slope, intercept = _linear_forecast(ticks, values)
    volatility = statistics.stdev(values) if len(values) >= 2 else 0.0

    last_tick = ticks[-1]
    last_value = values[-1]

    predictions = []
    for i in range(1, horizon_ticks + 1):
        future_tick = last_tick + i
        mean = slope * future_tick + intercept
        predictions.append({
            "tick": future_tick,
            "expected": mean,
            "min": mean - 2 * volatility,
            "max": mean + 2 * volatility,
        })

    # rule-aware risk estimation
    rule = (
        db.query(AlertRule)
        .filter(AlertRule.signal_code == signal_code)
        .filter(AlertRule.enabled == True)
        .first()
    )

    risk_ahead = None
    breach_tick = None

    if rule:
        for p in predictions:
            v = p["expected"]
            if rule.operator == "gt" and v > rule.threshold:
                risk_ahead = "LIKELY"
                breach_tick = p["tick"]
                break
            if rule.operator == "lt" and v < rule.threshold:
                risk_ahead = "LIKELY"
                breach_tick = p["tick"]
                break

        if risk_ahead is None:
            risk_ahead = "UNLIKELY"

    return {
        "signal_code": signal_code,
        "component_code": signal.component_code,
        "signal_type": signal.signal_type,
        "polarity": signal.polarity,
        "history_ticks_used": len(series),
        "horizon_ticks": horizon_ticks,
        "last_tick": last_tick,
        "last_value": last_value,
        "trend": {
            "slope_per_tick": slope,
            "direction": "UP" if slope > 0 else "DOWN" if slope < 0 else "FLAT",
        },
        "volatility": volatility,
        "forecast": predictions,
        "risk_ahead": {
            "status": risk_ahead,
            "breach_tick": breach_tick,
            "rule_threshold": rule.threshold if rule else None,
        },
    }


# -------------------------------------------------
# COMPONENT FORECAST
# -------------------------------------------------

def forecast_component(
    db: Session,
    component_code: str,
    horizon_ticks: int = 30,
) -> Dict[str, Any]:
    """
    Forecast component health & risks.
    """

    signals = (
        db.query(Signal)
        .filter(Signal.component_code == component_code)
        .all()
    )

    forecasts = []
    risky_signals = []

    for s in signals:
        try:
            f = forecast_signal(
                db,
                s.signal_code,
                horizon_ticks=horizon_ticks,
            )
        except Exception:
            continue

        if f.get("risk_ahead", {}).get("status") == "LIKELY":
            risky_signals.append({
                "signal_code": s.signal_code,
                "breach_tick": f["risk_ahead"]["breach_tick"],
            })

        forecasts.append(f)

    status = "STABLE"
    if len(risky_signals) > 0:
        status = "DEGRADED"
    if len(risky_signals) > 3:
        status = "CRITICAL"

    return {
        "component_code": component_code,
        "horizon_ticks": horizon_ticks,
        "predicted_status": status,
        "risky_signals_count": len(risky_signals),
        "risky_signals": risky_signals,
    }





def component_regimes(
    db: Session,
    component_code: str,
    window: int = 1440,
    bucket_size: int = 60,
):
    """
    Splits time into buckets and classifies each bucket into a regime.
    """

    max_tick = (
        db.query(func.max(TimeSeriesPoint.tick))
        .filter(TimeSeriesPoint.component_code == component_code)
        .scalar()
    )

    if max_tick is None:
        return {"component_code": component_code, "regimes": []}

    start_tick = max(0, max_tick - window)
    regimes = []

    for bucket_start in range(start_tick, max_tick, bucket_size):
        bucket_end = bucket_start + bucket_size - 1

        # ---- alerts in bucket
        alert_count = (
            db.query(func.count(AlertEvent.id))
            .filter(
                AlertEvent.component_code == component_code,
                AlertEvent.tick_start <= bucket_end,
                AlertEvent.tick_end >= bucket_start,
            )
            .scalar()
            or 0
        )

        # ---- collect numeric values
        values = []
        rows = (
            db.query(TimeSeriesPoint.payload)
            .filter(
                TimeSeriesPoint.component_code == component_code,
                TimeSeriesPoint.tick >= bucket_start,
                TimeSeriesPoint.tick <= bucket_end,
            )
            .limit(500)
            .all()
        )

        for (payload,) in rows:
            if isinstance(payload, dict):
                for v in payload.values():
                    if isinstance(v, (int, float)):
                        values.append(float(v))

        volatility = statistics.stdev(values) if len(values) >= 2 else 0.0

        # ---- regime classification
        if alert_count == 0 and volatility < 2:
            regime = "STABLE"
        elif alert_count < 5 and volatility < 5:
            regime = "DEGRADED"
        elif alert_count >= 5 or volatility >= 5:
            regime = "UNSTABLE"
        else:
            regime = "UNKNOWN"

        regimes.append({
            "from_tick": bucket_start,
            "to_tick": bucket_end,
            "regime": regime,
            "alert_count": int(alert_count),
            "avg_volatility": round(float(volatility), 3),
        })

    return {
        "component_code": component_code,
        "window_ticks": window,
        "bucket_size": bucket_size,
        "regimes": regimes,
    }


def signal_influence(
    db: Session,
    signal_code: str,
    window: int = 500,
    lag_window: int = 20,
):
    """
    Finds signals that tend to lead or follow a given signal.
    """

    base_events = (
        db.query(AlertEvent)
        .filter(AlertEvent.signal_code == signal_code)
        .order_by(AlertEvent.tick_start)
        .all()
    )

    if not base_events:
        return {"signal_code": signal_code, "leads": [], "follows": []}

    lead_counts = defaultdict(list)
    follow_counts = defaultdict(list)

    for e in base_events:
        t0 = e.tick_start

        neighbors = (
            db.query(AlertEvent)
            .filter(
                AlertEvent.tick_start >= t0 - lag_window,
                AlertEvent.tick_start <= t0 + lag_window,
                AlertEvent.signal_code != signal_code,
            )
            .all()
        )

        for n in neighbors:
            delta = n.tick_start - t0
            if delta < 0:
                lead_counts[n.signal_code].append(abs(delta))
            elif delta > 0:
                follow_counts[n.signal_code].append(delta)

    def summarize(d):
        out = []
        for k, vals in d.items():
            if len(vals) >= 3:
                out.append({
                    "signal_code": k,
                    "avg_ticks": round(sum(vals) / len(vals), 2),
                    "occurrences": len(vals),
                })
        return sorted(out, key=lambda x: x["occurrences"], reverse=True)

    return {
        "signal_code": signal_code,
        "analysis_window": window,
        "leads": summarize(lead_counts),
        "follows": summarize(follow_counts),
    }


def signal_envelope(
    db: Session,
    signal_code: str,
    window: int = 300,
    bucket: int = 10,
):
    signal = (
        db.query(Signal)
        .filter(Signal.signal_code == signal_code)
        .one_or_none()
    )
    if not signal:
        return {"error": f"Signal '{signal_code}' not found"}

    max_tick = db.query(func.max(TimeSeriesPoint.tick)).scalar()
    if max_tick is None:
        return {"error": "No timeseries data"}

    start_tick = max_tick - window

    rows = (
        db.query(
            TimeSeriesPoint.tick,
            TimeSeriesPoint.payload[signal.column_name].astext.cast(Float),
        )
        .filter(
            TimeSeriesPoint.component_code == signal.component_code,
            TimeSeriesPoint.tick >= start_tick,
        )
        .order_by(TimeSeriesPoint.tick)
        .all()
    )

    series = []

    for i in range(0, len(rows), bucket):
        chunk = rows[i : i + bucket]
        values = [v for _, v in chunk if v is not None]

        if len(values) < 3:
            continue

        values_sorted = sorted(values)

        series.append({
            "from_tick": chunk[0][0],
            "to_tick": chunk[-1][0],
            "p10": statistics.quantiles(values_sorted, n=10)[0],
            "p50": statistics.median(values_sorted),
            "p90": statistics.quantiles(values_sorted, n=10)[8],
            "mean": statistics.mean(values_sorted),
            "out_of_band": (
                statistics.mean(values_sorted) < statistics.quantiles(values_sorted, n=10)[0]
                or statistics.mean(values_sorted) > statistics.quantiles(values_sorted, n=10)[8]
            ),
        })

    return {
        "signal_code": signal_code,
        "component_code": signal.component_code,
        "window": window,
        "bucket": bucket,
        "series": series,
    }


def component_stress_curve(db: Session, component_code: str, window: int = 600, bucket: int = 20):
    max_tick = db.query(func.max(TimeSeriesPoint.tick)).scalar()
    start = max_tick - window
    series = []

    for t in range(start, max_tick, bucket):
        alerts = (
            db.query(AlertEvent.severity, func.count(AlertEvent.id))
            .filter(
                AlertEvent.component_code == component_code,
                AlertEvent.tick_start <= t + bucket,
                AlertEvent.tick_end >= t
            )
            .group_by(AlertEvent.severity)
            .all()
        )

        counts = {s: c for s, c in alerts}
        stress = (
            counts.get("critical", 0) * 30 +
            counts.get("warning", 0) * 10
        )
        stress = min(100, stress)

        series.append({
            "from_tick": t,
            "to_tick": t + bucket - 1,
            "stress_score": stress,
            "alerts": counts
        })

    return {
        "component_code": component_code,
        "window": window,
        "bucket": bucket,
        "series": series
    }

{
  "signal_code": "C2.consumer_lag",
  "pivot_tick": 1000,
  "before": {
    "mean": 240,
    "p95": 380
  },
  "after": {
    "mean": 160,
    "p95": 210
  },
  "delta": {
    "mean_change": -80,
    "p95_change": -170,
    "improvement": True
  }
}

def signal_change_impact(
    db: Session,
    signal_code: str,
    pivot_tick: int,
    window: int = 200,
):
    signal = (
        db.query(Signal)
        .filter(Signal.signal_code == signal_code)
        .one_or_none()
    )
    if not signal:
        return {"error": f"Signal '{signal_code}' not found"}

    rows = (
        db.query(
            TimeSeriesPoint.tick,
            TimeSeriesPoint.payload[signal.column_name].astext.cast(Float),
        )
        .filter(TimeSeriesPoint.component_code == signal.component_code)
        .all()
    )

    before = [v for t, v in rows if v is not None and pivot_tick - window <= t < pivot_tick]
    after = [v for t, v in rows if v is not None and pivot_tick <= t <= pivot_tick + window]

    if len(before) < 3 or len(after) < 3:
        return {"error": "Not enough data around pivot"}

    before_sorted = sorted(before)
    after_sorted = sorted(after)

    return {
        "signal_code": signal_code,
        "pivot_tick": pivot_tick,
        "before": {
            "mean": statistics.mean(before_sorted),
            "p95": statistics.quantiles(before_sorted, n=20)[18],
        },
        "after": {
            "mean": statistics.mean(after_sorted),
            "p95": statistics.quantiles(after_sorted, n=20)[18],
        },
        "delta": {
            "mean_change": statistics.mean(after_sorted) - statistics.mean(before_sorted),
            "p95_change": (
                statistics.quantiles(after_sorted, n=20)[18]
                - statistics.quantiles(before_sorted, n=20)[18]
            ),
            "improvement": statistics.mean(after_sorted) < statistics.mean(before_sorted),
        },
    }




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\services\anomaly_analysis_service copy.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\anomaly_analysis_service copy.py
==================================================
from sqlalchemy.orm import Session
from sqlalchemy import func, text
from typing import Dict, Any, List

from app.db.models.anomalies import InjectedAnomaly
from app.db.models.alerts import AlertEvent
from app.services.analytics_service import component_health


PIPELINE_ORDER = {
    "C2": 0,  # Kafka
    "C3": 1,  # Stream proc
    "C6": 2,  # Storage / processing
    "C8": 3,  # API
    "C1": 0,  # Batch ingest
}


def analyze_anomaly(db: Session) -> Dict[str, Any]:
    """
    Deep behavioral analysis of the currently injected anomaly.
    """

    anomalies = db.query(InjectedAnomaly).all()
    if not anomalies:
        return {"active": False}

    anomaly_type = anomalies[0].anomaly_type
    from_tick = min(a.tick for a in anomalies)
    to_tick = max(a.tick for a in anomalies)

    components = sorted(
        {a.component_code for a in anomalies},
        key=lambda c: PIPELINE_ORDER.get(c, 99),
    )

    signals = sorted({a.signal_code for a in anomalies})

    # --------------------------------------------------
    # 1. Narrative
    # --------------------------------------------------
    narrative = {
        "cpu_saturation": "CPU saturation caused sustained utilization pressure.",
        "error_spike": "Error rates increased sharply, indicating failure conditions.",
        "latency_regression": "Request latency increased beyond normal operating bounds.",
        "event_storm": "Excessive internal events stressed system stability.",
        "backlog_growth": "Queue backlog grew upstream and propagated downstream.",
    }.get(anomaly_type, "Anomalous behavior detected across the system.")

    # --------------------------------------------------
    # 2. Alert timeline
    # --------------------------------------------------
    alert_timeline = db.query(
        func.min(AlertEvent.tick_start),
        func.max(AlertEvent.tick_end),
        func.count(AlertEvent.id),
    ).filter(
        AlertEvent.origin == "SIMULATED",
        AlertEvent.status == "OPEN",
    ).one()

    # --------------------------------------------------
    # 3. Component stress analysis
    # --------------------------------------------------
    component_analysis = []

    for c in components:
        alerts = (
            db.query(AlertEvent.severity, func.count(AlertEvent.id))
            .filter(
                AlertEvent.component_code == c,
                AlertEvent.origin == "SIMULATED",
                AlertEvent.status == "OPEN",
            )
            .group_by(AlertEvent.severity)
            .all()
        )

        severity_map = {s: int(cnt) for s, cnt in alerts}

        try:
            health = float(component_health(db, c))
        except Exception:
            health = None

        component_analysis.append({
            "component_code": c,
            "pipeline_position": PIPELINE_ORDER.get(c, 99),
            "health_score": health,
            "alerts": severity_map,
            "total_alerts": sum(severity_map.values()),
        })

    # --------------------------------------------------
    # 4. Signal sensitivity (who reacted first & strongest)
    # --------------------------------------------------
    sensitivity_rows = db.execute(
        text("""
            SELECT
                signal_code,
                MIN(tick) AS first_impact,
                COUNT(*) AS modified_points
            FROM injected_anomalies
            GROUP BY signal_code
            ORDER BY first_impact ASC
        """)
    ).fetchall()

    signal_sensitivity = [
        {
            "signal_code": r.signal_code,
            "first_impact_tick": int(r.first_impact),
            "points_modified": int(r.modified_points),
        }
        for r in sensitivity_rows
    ]

    # --------------------------------------------------
    # 5. Degradation pattern classification
    # --------------------------------------------------
    pattern = "localized"

    if len(components) > 2:
        upstream = PIPELINE_ORDER.get(components[0], 0)
        downstream = PIPELINE_ORDER.get(components[-1], 0)
        if downstream > upstream:
            pattern = "cascading"

    if any(c["total_alerts"] > 10 for c in component_analysis):
        pattern = "amplified_downstream"

    # --------------------------------------------------
    # 6. Stability assessment
    # --------------------------------------------------
    stability = "stable"

    if alert_timeline[2] and alert_timeline[2] > 50:
        stability = "unstable"

    # --------------------------------------------------
    # 7. Observations (derived facts)
    # --------------------------------------------------
    observations: List[str] = []

    if signal_sensitivity:
        observations.append(
            f"{signal_sensitivity[0]['signal_code']} acted as an early indicator."
        )

    if pattern == "cascading":
        observations.append("Pressure propagated across multiple pipeline stages.")

    if stability == "unstable":
        observations.append("Alert pressure escalated rapidly.")

    # --------------------------------------------------
    # Final response
    # --------------------------------------------------
    return {
        "active": True,
        "anomaly_type": anomaly_type,
        "narrative": narrative,
        "window": {
            "from_tick": from_tick,
            "to_tick": to_tick,
            "duration_ticks": to_tick - from_tick + 1,
        },
        "components": component_analysis,
        "signal_sensitivity": signal_sensitivity,
        "degradation_pattern": pattern,
        "stability": stability,
        "observations": observations,
    }




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\services\anomaly_analysis_service.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\anomaly_analysis_service.py
==================================================

# app/services/anomaly_analysis_service.py
from __future__ import annotations

from dataclasses import dataclass
from typing import Dict, Any, List, Tuple, Optional
from collections import defaultdict

from sqlalchemy.orm import Session
from sqlalchemy import text, func

from app.db.models.anomalies import InjectedAnomaly
from app.db.models.alerts import AlertEvent
from app.db.models.signals import Signal
from app.observability.metric_families import detect_family
from app.services.analytics_service import component_health, global_health


# --- Optional friendly names for UI narrative (you can edit freely) ---
COMPONENT_LABELS = {
    "C1": "Batch Ingest",
    "C2": "Kafka / Stream Ingest",
    "C3": "Stream Processor",
    "C6": "Storage / Processing Layer",
    "C8": "API / Serving Layer",
}

PIPELINE_DEF = {
    "stream_lane": ["C2", "C3", "C6", "C8"],
    "rail": ["C1", "C6"],
}

ANOMALY_DOC = {
    "cpu_saturation": {
        "title": "CPU Saturation",
        "expected": [
            "utilization increases and stays elevated",
            "latency may increase if compute is constrained",
            "errors may increase if overload happens",
        ],
    },
    "error_spike": {
        "title": "Error Spike",
        "expected": [
            "error_rate increases sharply",
            "downstream may see throughput drop",
            "retries may cause latency increase",
        ],
    },
    "latency_regression": {
        "title": "Latency Regression",
        "expected": [
            "latency metrics drift upward",
            "queue/backlog may grow if system falls behind",
        ],
    },
    "event_storm": {
        "title": "Event Storm",
        "expected": [
            "event counters increase (restarts, timeouts, failovers)",
            "secondary increases in latency/errors may appear",
        ],
    },
    "backlog_growth": {
        "title": "Backlog Growth",
        "expected": [
            "backlog/queue depth increases",
            "latency increases due to waiting time",
            "downstream pressure may rise (cascading effect)",
        ],
    },
}


def _component_label(code: str) -> str:
    return COMPONENT_LABELS.get(code, code)


def _infer_pipeline(components: List[str]) -> Optional[str]:
    comp_set = set(components)
    for p, chain in PIPELINE_DEF.items():
        if comp_set.issubset(set(chain)):
            return p
    return None


def _safe_float(x) -> Optional[float]:
    try:
        if x is None:
            return None
        return float(x)
    except Exception:
        return None


def anomaly_full_analysis(db: Session) -> Dict[str, Any]:
    """
    Monitoring-grade anomaly analysis.
    Uses ONLY existing tables and deterministic logic.

    Outputs are UI-ready:
      - timeline objects
      - per-component tables
      - per-signal deviation stats
      - observations and narrative
    """

    anomalies: List[InjectedAnomaly] = db.query(InjectedAnomaly).all()
    if not anomalies:
        return {"active": False}

    # ------------------------------
    # Core anomaly window + scope
    # ------------------------------
    anomaly_type = anomalies[0].anomaly_type
    from_tick = int(min(a.tick for a in anomalies))
    to_tick = int(max(a.tick for a in anomalies))
    duration = int(to_tick - from_tick + 1)

    affected_components = sorted({a.component_code for a in anomalies})
    affected_signals = sorted({a.signal_code for a in anomalies})

    pipeline = _infer_pipeline(affected_components)

    doc = ANOMALY_DOC.get(anomaly_type, {"title": anomaly_type, "expected": []})

    # ------------------------------
    # Pull Signal metadata (column names, families)
    # ------------------------------
    signal_rows: List[Signal] = (
        db.query(Signal)
        .filter(Signal.signal_code.in_(affected_signals))
        .all()
    )
    sig_meta = {
        s.signal_code: {
            "component_code": s.component_code,
            "column_name": s.column_name,
            "family": detect_family(s.column_name),
            "unit": getattr(s, "unit", None),
            "description": getattr(s, "description", None),
        }
        for s in signal_rows
    }

    # ------------------------------
    # Compute deviation stats:
    # original_value (stored) vs current value in timeseries_points
    #
    # We'll fetch current values for all affected (component, tick, column)
    # and compute:
    #   delta_abs, delta_pct
    # plus aggregations per signal and per component.
    # ------------------------------
    # Build lookup: (component, tick) -> payload
    payload_rows = db.execute(
        text("""
            SELECT component_code, tick, payload
            FROM timeseries_points
            WHERE tick BETWEEN :from_tick AND :to_tick
              AND component_code = ANY(:components)
        """),
        {"from_tick": from_tick, "to_tick": to_tick, "components": affected_components},
    ).fetchall()

    payload_by_ct: Dict[Tuple[str, int], Dict[str, Any]] = {}
    for r in payload_rows:
        payload_by_ct[(r.component_code, int(r.tick))] = dict(r.payload)

    # Aggregate containers
    per_signal_stats = defaultdict(lambda: {
        "signal_code": None,
        "component_code": None,
        "family": None,
        "column_name": None,
        "points": 0,
        "mean_original": None,
        "mean_current": None,
        "mean_delta_abs": None,
        "mean_delta_pct": None,
        "min_delta_pct": None,
        "max_delta_pct": None,
        "peak_current": None,
    })

    per_component_stats = defaultdict(lambda: {
        "component_code": None,
        "component_label": None,
        "points_modified": 0,
        "signals_modified": set(),
        "families_touched": set(),
        "mean_delta_pct": None,
        "peak_delta_pct": None,
    })

    # For mean computations
    signal_sum_orig = defaultdict(float)
    signal_sum_cur = defaultdict(float)
    signal_sum_delta_abs = defaultdict(float)
    signal_sum_delta_pct = defaultdict(float)
    signal_min_delta_pct = defaultdict(lambda: None)
    signal_max_delta_pct = defaultdict(lambda: None)
    signal_peak_cur = defaultdict(lambda: None)
    signal_n = defaultdict(int)

    component_sum_delta_pct = defaultdict(float)
    component_peak_delta_pct = defaultdict(lambda: None)
    component_n = defaultdict(int)

    for a in anomalies:
        s = a.signal_code
        meta = sig_meta.get(s)
        if not meta:
            # fallback: try parse column from signal_code
            col = s.split(".", 1)[1] if "." in s else None
            meta = {
                "component_code": a.component_code,
                "column_name": col,
                "family": detect_family(col or ""),
                "unit": None,
                "description": None,
            }

        col = meta["column_name"]
        if not col:
            continue

        key = (a.component_code, int(a.tick))
        payload = payload_by_ct.get(key, {})
        current_val = _safe_float(payload.get(col))
        original_val = _safe_float(a.original_value)

        if original_val is None or current_val is None:
            continue

        delta_abs = current_val - original_val
        delta_pct = (delta_abs / original_val) * 100.0 if original_val != 0 else None

        if delta_pct is None:
            continue

        signal_n[s] += 1
        signal_sum_orig[s] += original_val
        signal_sum_cur[s] += current_val
        signal_sum_delta_abs[s] += delta_abs
        signal_sum_delta_pct[s] += delta_pct

        # min/max delta pct
        if signal_min_delta_pct[s] is None or delta_pct < signal_min_delta_pct[s]:
            signal_min_delta_pct[s] = delta_pct
        if signal_max_delta_pct[s] is None or delta_pct > signal_max_delta_pct[s]:
            signal_max_delta_pct[s] = delta_pct

        # peak current
        if signal_peak_cur[s] is None or current_val > signal_peak_cur[s]:
            signal_peak_cur[s] = current_val

        # per component
        c = a.component_code
        component_n[c] += 1
        component_sum_delta_pct[c] += delta_pct
        if component_peak_delta_pct[c] is None or delta_pct > component_peak_delta_pct[c]:
            component_peak_delta_pct[c] = delta_pct

        per_component_stats[c]["component_code"] = c
        per_component_stats[c]["component_label"] = _component_label(c)
        per_component_stats[c]["points_modified"] += 1
        per_component_stats[c]["signals_modified"].add(s)
        per_component_stats[c]["families_touched"].add(meta["family"])

    # finalize per signal
    for s in affected_signals:
        if signal_n[s] == 0:
            continue

        meta = sig_meta.get(s, {})
        per_signal_stats[s].update({
            "signal_code": s,
            "component_code": meta.get("component_code"),
            "family": meta.get("family"),
            "column_name": meta.get("column_name"),
            "unit": meta.get("unit"),
            "description": meta.get("description"),
            "points": signal_n[s],
            "mean_original": signal_sum_orig[s] / signal_n[s],
            "mean_current": signal_sum_cur[s] / signal_n[s],
            "mean_delta_abs": signal_sum_delta_abs[s] / signal_n[s],
            "mean_delta_pct": signal_sum_delta_pct[s] / signal_n[s],
            "min_delta_pct": signal_min_delta_pct[s],
            "max_delta_pct": signal_max_delta_pct[s],
            "peak_current": signal_peak_cur[s],
        })

    # finalize per component
    component_table = []
    for c, v in per_component_stats.items():
        n = component_n[c]
        if n == 0:
            continue
        component_table.append({
            "component_code": c,
            "component_label": v["component_label"],
            "points_modified": v["points_modified"],
            "signals_modified": sorted(list(v["signals_modified"])),
            "families_touched": sorted(list(v["families_touched"])),
            "mean_delta_pct": component_sum_delta_pct[c] / n,
            "peak_delta_pct": component_peak_delta_pct[c],
        })

    component_table.sort(key=lambda x: (-x["points_modified"], x["component_code"]))

    signal_table = list(per_signal_stats.values())
    signal_table = [x for x in signal_table if x["signal_code"] is not None]
    signal_table.sort(key=lambda x: (-x["mean_delta_pct"], x["signal_code"]))

    # ------------------------------
    # Alert analysis (SIMULATED only)
    # ------------------------------
    open_alerts = (
        db.query(AlertEvent)
        .filter(AlertEvent.origin == "SIMULATED", AlertEvent.status == "OPEN")
        .all()
    )

    alerts_by_sev = defaultdict(int)
    alerts_by_component = defaultdict(int)
    earliest_alert_tick = None
    latest_alert_tick = None

    for ev in open_alerts:
        alerts_by_sev[ev.severity] += 1
        alerts_by_component[ev.component_code] += 1

        if ev.tick_start is not None:
            earliest_alert_tick = ev.tick_start if earliest_alert_tick is None else min(earliest_alert_tick, ev.tick_start)
        if ev.tick_end is not None:
            latest_alert_tick = ev.tick_end if latest_alert_tick is None else max(latest_alert_tick, ev.tick_end)

    total_alerts = sum(alerts_by_sev.values())

    # timeline buckets (UI chart ready)
    # bucket size depends on duration
    bucket = 1
    if duration > 200:
        bucket = 10
    elif duration > 80:
        bucket = 5
    elif duration > 30:
        bucket = 2

    # count alerts overlapping each bucket window
    # lightweight: using in-memory events
    timeline = []
    if duration > 0:
        t = from_tick
        while t <= to_tick:
            t_end = min(to_tick, t + bucket - 1)
            count = 0
            crit = 0
            warn = 0
            for ev in open_alerts:
                # overlapping window check
                if ev.tick_start is None or ev.tick_end is None:
                    continue
                if ev.tick_start <= t_end and ev.tick_end >= t:
                    count += 1
                    if ev.severity == "critical":
                        crit += 1
                    else:
                        warn += 1
            timeline.append({
                "from_tick": t,
                "to_tick": t_end,
                "open_alerts": count,
                "critical": crit,
                "warning": warn,
            })
            t += bucket

    # ------------------------------
    # Health ranking for impacted components
    # ------------------------------
    impacted_components = sorted(alerts_by_component.keys(), key=lambda c: alerts_by_component[c], reverse=True)
    health_table = []
    for c in impacted_components:
        try:
            health = float(component_health(db, c))
        except Exception:
            health = None
        health_table.append({
            "component_code": c,
            "component_label": _component_label(c),
            "open_alerts": int(alerts_by_component[c]),
            "health_score": health,
        })
    health_table.sort(key=lambda x: (x["health_score"] if x["health_score"] is not None else 999))

    # ------------------------------
    # Propagation inference (simple & explainable)
    # We infer cascading if:
    #  - >1 component has alerts OR
    #  - deviation observed across >1 pipeline stage
    # ------------------------------
    pipeline_chain = PIPELINE_DEF.get(pipeline or "", affected_components)
    chain_positions = {c: i for i, c in enumerate(pipeline_chain)}

    stages_impacted = sorted([chain_positions.get(c, 99) for c in alerts_by_component.keys()])
    cascading = len(set(stages_impacted)) >= 2

    # ------------------------------
    # Observations (monitoring-grade, factual)
    # ------------------------------
    observations: List[Dict[str, str]] = []

    # Early indicator: the signal with earliest anomaly tick and largest mean delta
    if signal_table:
        top_by_delta = signal_table[0]
        observations.append({
            "type": "early_indicator",
            "message": f"{top_by_delta['signal_code']} showed the strongest deviation (mean {top_by_delta['mean_delta_pct']:.1f}%)."
        })

    if earliest_alert_tick is not None:
        observations.append({
            "type": "alert_onset",
            "message": f"First simulated alert opened at tick {int(earliest_alert_tick)} (anomaly window {from_tick} â†’ {to_tick})."
        })

    if total_alerts > 0:
        critical_cnt = alerts_by_sev.get("critical", 0)
        warn_cnt = alerts_by_sev.get("warning", 0)
        observations.append({
            "type": "severity_mix",
            "message": f"Open simulated alerts: {total_alerts} total (critical={critical_cnt}, warning={warn_cnt})."
        })

    if cascading:
        observations.append({
            "type": "propagation",
            "message": "Behavior matches cascading impact: multiple pipeline stages show alerts/deviation."
        })
    else:
        observations.append({
            "type": "localization",
            "message": "Behavior appears localized: impact concentrated in a single stage/component."
        })

    # Component concentration
    if health_table:
        worst = health_table[0]
        observations.append({
            "type": "most_impacted_component",
            "message": f"Most impacted component is {worst['component_label']} ({worst['component_code']}) with health={worst['health_score']}."
        })

    # Deviation shape observation
    if component_table:
        peak = max(component_table, key=lambda x: x["peak_delta_pct"] if x["peak_delta_pct"] is not None else -1)
        observations.append({
            "type": "peak_deviation",
            "message": f"Peak deviation observed in {peak['component_label']} ({peak['component_code']}): {peak['peak_delta_pct']:.1f}%."
        })

    # Stability: look at timeline trend
    stability = "stable"
    if len(timeline) >= 3:
        first = timeline[0]["open_alerts"]
        mid = timeline[len(timeline)//2]["open_alerts"]
        last = timeline[-1]["open_alerts"]

        if last > first * 2 and last > mid:
            stability = "escalating"
        elif last < first and last < mid:
            stability = "recovering"
        elif max(first, mid, last) > 50:
            stability = "high_pressure"

        observations.append({
            "type": "stability",
            "message": f"Alert pressure pattern classified as '{stability}'."
        })

    # ------------------------------
    # Final payload (UI-ready)
    # ------------------------------
    return {
        "active": True,
        "anomaly": {
            "type": anomaly_type,
            "title": doc["title"],
            "expected_behavior": doc["expected"],
            "pipeline": pipeline,
            "window": {
                "from_tick": from_tick,
                "to_tick": to_tick,
                "duration_ticks": duration,
            },
            "scope": {
                "affected_components": [
                    {"code": c, "label": _component_label(c)} for c in sorted(affected_components, key=lambda x: chain_positions.get(x, 99))
                ],
                "affected_signals": affected_signals,
            },
        },

        # high-level system reading
        "system_state": {
            "global_health": global_health(db),
            "cascading_behavior": cascading,
            "stability": stability,
        },

        # charts / tables for UI
        "alerts": {
            "open_total": int(total_alerts),
            "by_severity": dict(alerts_by_sev),
            "by_component": [
                {
                    "component_code": c,
                    "component_label": _component_label(c),
                    "open_alerts": int(cnt),
                    "pipeline_position": chain_positions.get(c, 99),
                }
                for c, cnt in sorted(alerts_by_component.items(), key=lambda x: -x[1])
            ],
            "timeline": timeline,
            "ticks": {
                "first_open_tick": int(earliest_alert_tick) if earliest_alert_tick is not None else None,
                "latest_open_tick": int(latest_alert_tick) if latest_alert_tick is not None else None,
            },
        },

        "deviation": {
            "per_component": component_table,
            "per_signal": signal_table,
        },

        "health": {
            "components_ranked": health_table,
        },

        "observations": observations,
    }




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\services\anomaly_impact_service.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\anomaly_impact_service.py
==================================================
# app/services/anomaly_impact_service.py
from sqlalchemy.orm import Session
from sqlalchemy import func, text
from typing import Dict, Any

from app.db.models.alerts import AlertEvent
from app.db.models.anomalies import InjectedAnomaly
from app.services.analytics_service import component_health, global_health


def anomaly_impact_summary(db: Session) -> Dict[str, Any]:
    """
    Deep impact analysis of the currently active anomaly.
    Read-only, rollback-safe.
    """

    # -------------------------------------------------
    # 0. Is there an active anomaly?
    # -------------------------------------------------
    anomaly_rows = db.query(InjectedAnomaly).all()
    if not anomaly_rows:
        return {
            "active": False,
            "global_health": global_health(db),
        }

    # -------------------------------------------------
    # 1. Anomaly context
    # -------------------------------------------------
    anomaly_type = anomaly_rows[0].anomaly_type
    from_tick = min(a.tick for a in anomaly_rows)
    to_tick = max(a.tick for a in anomaly_rows)

    affected_components = sorted({a.component_code for a in anomaly_rows})
    affected_signals = sorted({a.signal_code for a in anomaly_rows})

    anomaly_context = {
        "type": anomaly_type,
        "from_tick": from_tick,
        "to_tick": to_tick,
        "duration_ticks": to_tick - from_tick + 1,
        "affected_components": affected_components,
        "affected_signals": len(affected_signals),
        "points_modified": len(anomaly_rows),
    }

    # -------------------------------------------------
    # 2. Alert impact (SIMULATED only)
    # -------------------------------------------------
    alert_rows = (
        db.query(
            AlertEvent.component_code,
            AlertEvent.severity,
            func.count(AlertEvent.id),
        )
        .filter(
            AlertEvent.status == "OPEN",
            AlertEvent.origin == "SIMULATED",
        )
        .group_by(AlertEvent.component_code, AlertEvent.severity)
        .all()
    )

    alerts_by_severity: Dict[str, int] = {}
    alerts_by_component: Dict[str, int] = {}
    component_severity: Dict[str, Dict[str, int]] = {}

    for component, severity, cnt in alert_rows:
        alerts_by_severity[severity] = alerts_by_severity.get(severity, 0) + cnt
        alerts_by_component[component] = alerts_by_component.get(component, 0) + cnt
        component_severity.setdefault(component, {})[severity] = cnt

    alert_impact = {
        "total": sum(alerts_by_severity.values()),
        "by_severity": alerts_by_severity,
        "by_component": alerts_by_component,
    }

    # -------------------------------------------------
    # 3. Component degradation
    # -------------------------------------------------
    component_impacts = []

    for component in affected_components:
        try:
            health = component_health(db, component)
        except Exception:
            continue

        component_impacts.append({
            "component_code": component,
            "health_score": float(health),
            "open_alerts": alerts_by_component.get(component, 0),
            "severity_pressure": component_severity.get(component, {}),
        })

    component_impacts.sort(key=lambda x: x["health_score"])

    # -------------------------------------------------
    # 4. Metric deviation analysis
    # -------------------------------------------------
    deviation_rows = db.execute(
        text("""
            SELECT
                ia.signal_code,
                AVG(
                    ABS(
                        ((ts.payload ->> split_part(ia.signal_code, '.', 2))::double precision
                         - (ia.original_value)::double precision)
                        / NULLIF((ia.original_value)::double precision, 0)
                    ) * 100
                ) AS avg_delta_pct,
                MAX(
                    ABS(
                        ((ts.payload ->> split_part(ia.signal_code, '.', 2))::double precision
                         - (ia.original_value)::double precision)
                        / NULLIF((ia.original_value)::double precision, 0)
                    ) * 100
                ) AS max_delta_pct
            FROM injected_anomalies ia
            JOIN timeseries_points ts
              ON ts.component_code = ia.component_code
             AND ts.tick = ia.tick
            GROUP BY ia.signal_code
        """)
    ).fetchall()

    metric_deviation = [
        {
            "signal_code": r.signal_code,
            "avg_delta_pct": float(r.avg_delta_pct or 0.0),
            "max_delta_pct": float(r.max_delta_pct or 0.0),
        }
        for r in deviation_rows
    ]

    metric_deviation.sort(key=lambda x: x["max_delta_pct"], reverse=True)

    # -------------------------------------------------
    # 5. Final response
    # -------------------------------------------------
    return {
        "active": True,
        "anomaly": anomaly_context,
        "alerts": alert_impact,
        "components": component_impacts,
        "metric_deviation": metric_deviation,
        "global_health": global_health(db),
    }




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\services\anomaly_injection_service.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\anomaly_injection_service.py
==================================================
# app/services/anomaly_injection_service.py
from __future__ import annotations

import json
import random
from typing import Dict, Any, List

from sqlalchemy.orm import Session
from sqlalchemy import text

from app.db.models.signals import Signal
from app.db.models.anomalies import InjectedAnomaly
from app.observability.metric_families import detect_family


PIPELINES = {
    "stream_lane": ["C2", "C3", "C6", "C8"],
    "rail": ["C1", "C6"],
}

ANOMALY_DEFINITIONS = {
    "cpu_saturation": {"families": ["utilization"], "base_factor": 1.4},
    "error_spike": {"families": ["error_rate"], "base_factor": 5.0},
    "latency_regression": {"families": ["latency"], "base_factor": 2.5},
    "event_storm": {"families": ["events"], "base_factor": 3.0},
    "backlog_growth": {
        "families": ["backlog", "latency"],
        "base_factor": 3.0,
        "propagates": True,
    },
}


def _guard_single_anomaly(db: Session):
    active = db.query(InjectedAnomaly.id).first()
    if active:
        raise RuntimeError("An anomaly is already active. Rollback first.")


def _apply_shift(value: float, factor: float) -> float:
    jitter = 1.0 + random.uniform(-0.02, 0.02)
    return float(value * factor * jitter)


def inject_anomaly(
    db: Session,
    pipeline: str,
    anomaly_type: str,
    from_tick: int,
    to_tick: int,
    strength: float = 1.0,
) -> int:

    _guard_single_anomaly(db)

    if pipeline not in PIPELINES:
        raise ValueError(f"Unknown pipeline '{pipeline}'")

    if anomaly_type not in ANOMALY_DEFINITIONS:
        raise ValueError(f"Unknown anomaly '{anomaly_type}'")

    definition = ANOMALY_DEFINITIONS[anomaly_type]
    families = definition["families"]
    base_factor = definition["base_factor"]
    propagates = definition.get("propagates", False)

    components = PIPELINES[pipeline]

    signals = db.query(Signal).filter(
        Signal.component_code.in_(components)
    ).all()

    affected = 0
    anomaly_rows: List[InjectedAnomaly] = []

    for idx, component in enumerate(components):
        decay = 1.0 / (1 + idx) if propagates else 1.0
        factor = 1.0 + (base_factor * strength * decay)

        rows = db.execute(
            text("""
                SELECT id, tick, payload
                FROM timeseries_points
                WHERE component_code = :component
                  AND tick BETWEEN :from_tick AND :to_tick
                ORDER BY tick
            """),
            {
                "component": component,
                "from_tick": from_tick,
                "to_tick": to_tick,
            },
        ).fetchall()

        if not rows:
            continue

        component_signals = [s for s in signals if s.component_code == component]

        for row in rows:
            payload = dict(row.payload)
            changed = False

            for s in component_signals:
                family = detect_family(s.column_name)
                if family not in families:
                    continue

                old_val = payload.get(s.column_name)
                if not isinstance(old_val, (int, float)):
                    continue

                new_val = _apply_shift(old_val, factor)
                payload[s.column_name] = new_val

                anomaly_rows.append(
                    InjectedAnomaly(
                        signal_code=s.signal_code,
                        component_code=component,
                        tick=row.tick,
                        original_value=old_val,
                        anomaly_type=anomaly_type,
                    )
                )

                affected += 1
                changed = True

            if changed:
                db.execute(
                    text("""
                        UPDATE timeseries_points
                        SET payload = CAST(:payload AS jsonb)
                        WHERE id = :id
                    """),
                    {"payload": json.dumps(payload), "id": row.id},
                )

    db.add_all(anomaly_rows)
    db.commit()
    return affected




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\services\anomaly_insight_service.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\anomaly_insight_service.py
==================================================
# app/services/anomaly_insight_service.py
from sqlalchemy.orm import Session
from sqlalchemy import func
from typing import Dict, Any

from app.db.models.anomalies import InjectedAnomaly


def active_anomalies(db: Session) -> Dict[str, Any]:
    rows = (
        db.query(
            InjectedAnomaly.anomaly_type,
            InjectedAnomaly.component_code,
            func.min(InjectedAnomaly.tick).label("from_tick"),
            func.max(InjectedAnomaly.tick).label("to_tick"),
            func.count(InjectedAnomaly.id).label("points"),
        )
        .group_by(
            InjectedAnomaly.anomaly_type,
            InjectedAnomaly.component_code,
        )
        .all()
    )

    components = set()
    total_points = 0
    items = []

    for r in rows:
        components.add(r.component_code)
        total_points += r.points

        items.append({
            "anomaly_type": r.anomaly_type,
            "component_code": r.component_code,
            "from_tick": int(r.from_tick),
            "to_tick": int(r.to_tick),
            "points_modified": int(r.points),
        })

    return {
        "active": len(items) > 0,
        "total_points_modified": int(total_points),
        "affected_components": sorted(list(components)),
        "anomalies": items,
    }




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\services\anomaly_rollback_service.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\anomaly_rollback_service.py
==================================================
import json
from typing import Dict, Any, Tuple, List

from sqlalchemy.orm import Session
from sqlalchemy import text

from app.db.models.anomalies import InjectedAnomaly
from app.db.models.alerts import AlertEvent


def rollback_anomalies(db: Session) -> int:
    anomalies = db.query(InjectedAnomaly).all()
    if not anomalies:
        return 0

    grouped: Dict[Tuple[str, int], List[InjectedAnomaly]] = {}

    for a in anomalies:
        grouped.setdefault((a.component_code, a.tick), []).append(a)

    restored = 0

    for (component, tick), items in grouped.items():
        row = db.execute(
            text("""
                SELECT id, payload
                FROM timeseries_points
                WHERE component_code = :component AND tick = :tick
            """),
            {"component": component, "tick": tick},
        ).fetchone()

        if not row:
            continue

        payload: Dict[str, Any] = dict(row.payload)

        for a in items:
            metric = a.signal_code.split(".", 1)[1]
            payload[metric] = a.original_value
            restored += 1

        db.execute(
            text("""
                UPDATE timeseries_points
                SET payload = CAST(:payload AS jsonb)
                WHERE id = :id
            """),
            {"payload": json.dumps(payload), "id": row.id},
        )

    # ðŸ”¥ Delete ONLY simulated alerts
    db.query(AlertEvent).filter(
        AlertEvent.origin == "SIMULATED"
    ).delete(synchronize_session=False)

    # ðŸ”¥ Remove anomaly records
    db.query(InjectedAnomaly).delete()

    db.commit()
    return restored




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\services\auth_service.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\auth_service.py
==================================================
# app/services/auth_service.py
from sqlalchemy.orm import Session
from app.db.models.users import User, Role
from app.core.security import hash_password, verify_password, create_access_token
from fastapi import HTTPException
from app.services.email_service import send_email
from app.core.security import create_email_verification_token
from app.core.config import settings



def signup(db: Session, username: str, password: str):
    if db.query(User).filter_by(username=username).first():
        raise HTTPException(status_code=400, detail="Username exists")

    user = User(
        username=username,
        password_hash=hash_password(password),
        is_active=False,  # ðŸ”’ NOT ACTIVE YET
    )
    db.add(user)
    db.commit()
    db.refresh(user)

    token = create_email_verification_token({
        "sub": str(user.id),
        "username": user.username,
    })

    verify_url = (
        f"{settings.APP_PUBLIC_BASE_URL}"
        f"/api/auth/verify-email?token={token}"
    )

    send_email(
        to_email=user.username,  # username = email
        subject="Verify your PlatformOPS account",
        text=f"Verify your account: {verify_url}",
        html=f"""
        <h2>Welcome to PlatformOPS</h2>
        <p>Please verify your account:</p>
        <a href="{verify_url}">Verify Email</a>
        """,
    )

    return user


def login(db: Session, username: str, password: str):
    user = db.query(User).filter_by(username=username).first()
    if not user or not verify_password(password, user.password_hash):
        raise HTTPException(status_code=401, detail="Invalid credentials")

    if not user.is_active:
        raise HTTPException(
            status_code=403,
            detail="Account not verified. Check your email.",
        )

    roles = [r.id for r in user.roles]
    is_admin = "admin" in roles

    token = create_access_token({
        "sub": str(user.id),
        "username": user.username,
        "roles": roles,
        "is_admin": is_admin,
    })

    return token

















############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\services\components_service.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\components_service.py
==================================================
from sqlalchemy.orm import Session
from sqlalchemy import func
from app.db.models.signals import Signal
from app.db.models.alerts import AlertRule
from app.db.models.timeseries import TimeSeriesPoint
from app.db.models.anomalies import InjectedAnomaly
from app.services.analytics_service import component_health, forecast_signal
from app.services.propagation_service import compute_propagation
from app.services.analytics_service import signal_change_impact  # Reuse for deltas
import statistics

def get_related_signals(db: Session, component_code: str, limit: int, min_correlation: float):
    # Get primary signals for component
    primary_signals = [s.signal_code for s in db.query(Signal).filter(Signal.component_code == component_code).all()]
    
    if not primary_signals:
        return {"error": "No signals for component"}
    
    related = []
    for primary in primary_signals:
        # Compute propagation for each primary (aggregate unique)
        for other_signal in db.query(Signal.signal_code).filter(Signal.signal_code != primary).limit(20).all():  # Limit scan
            prop = compute_propagation(db, primary, other_signal[0])
            if prop["correlation"] >= min_correlation:
                related.append({
                    "signal_code": other_signal[0],
                    "component_code": db.query(Signal.component_code).filter(Signal.signal_code == other_signal[0]).scalar(),
                    "lag_ticks": prop["lag_ticks"],
                    "correlation": prop["correlation"],
                    "confidence": prop["confidence_score"],
                    "direction": "upstream" if prop["lag_ticks"] > 0 else "downstream"
                })
    
    # Sort and limit unique
    unique_related = {r["signal_code"]: r for r in related}
    sorted_related = sorted(unique_related.values(), key=lambda x: x["correlation"], reverse=True)[:limit]
    
    return {
        "component_code": component_code,
        "primary_signals": primary_signals,
        "related": sorted_related
    }

def get_health_breakdown(db: Session, component_code: str):
    signals = db.query(Signal).filter(Signal.component_code == component_code).all()
    if not signals:
        return {"error": "No signals for component"}
    
    overall = component_health(db, component_code)
    
    by_family = {}
    for s in signals:
        fam = s.family or 'unknown'
        if fam not in by_family:
            by_family[fam] = {"scores": [], "worst_signals": []}
        # Assume signal health from volatility or baseline; here mock with rule thresholds
        signal_health = 100 - (s.current_value - s.threshold) / s.threshold * 100 if s.threshold else 100  # Placeholder
        by_family[fam]["scores"].append(signal_health)
        if signal_health < 70:
            by_family[fam]["worst_signals"].append(s.signal_code)
    
    for fam, data in by_family.items():
        data["score"] = statistics.mean(data["scores"]) if data["scores"] else 0
        del data["scores"]
    
    critical_families = [fam for fam, data in by_family.items() if data["score"] < 50]
    
    return {
        "component_code": component_code,
        "overall_health": overall,
        "by_family": by_family,
        "critical_families": critical_families
    }

def get_family_snapshot(db: Session, component_code: str, family: str, window: int):
    signals = db.query(Signal).filter(Signal.component_code == component_code, Signal.family == family).all()
    if not signals:
        return {"error": "No signals in family"}
    
    # Aggregate values across signals in family (last window ticks)
    max_tick = db.query(func.max(TimeSeriesPoint.tick)).scalar()
    start_tick = max_tick - window
    
    values = []
    mini_series = []
    for s in signals:
        rows = db.query(
            TimeSeriesPoint.tick,
            TimeSeriesPoint.payload[s.column_name].astext.cast(float).label('value')
        ).filter(
            TimeSeriesPoint.component_code == component_code,
            TimeSeriesPoint.tick.between(start_tick, max_tick)
        ).order_by(TimeSeriesPoint.tick).all()
        
        sig_values = [r.value for r in rows if r.value is not None]
        values.extend(sig_values)
        
        # Downsample to ~10 points for mini
        if len(rows) > 10:
            step = len(rows) // 10
            mini = [{'tick': rows[i].tick, 'avg': statistics.mean([r.value for r in rows[i:i+step] if r.value is not None])} for i in range(0, len(rows), step)]
        else:
            mini = [{'tick': r.tick, 'avg': r.value} for r in rows if r.value is not None]
        mini_series.append({s.signal_code: mini})
    
    if not values:
        return {"error": "No data in window"}
    
    avg = statistics.mean(values)
    p95 = statistics.quantiles(values, n=20)[18]
    trend = 'up' if avg > statistics.mean(values[:len(values)//2]) else 'down' if avg < statistics.mean(values[:len(values)//2]) else 'flat'
    
    return {
        "family": family,
        "signal_count": len(signals),
        "avg_value": avg,
        "p95_value": p95,
        "trend": trend,
        "health_contribution": 100 - (p95 / avg * 10) if avg else 0,  # Placeholder
        "mini_series": mini_series,
        "threshold_breaches_last_hour": db.query(AlertEvent).filter(AlertEvent.component_code == component_code, AlertEvent.family == family, AlertEvent.tick_start > max_tick - 60).count()
    }

def get_anomaly_contribution(db: Session, component_code: str):
    active_anomaly = db.query(InjectedAnomaly).filter(InjectedAnomaly.rollback_tick.is_(None)).first()
    if not active_anomaly:
        return {"error": "No active anomaly"}
    
    pivot_tick = active_anomaly.from_tick  # Use anomaly start as pivot
    
    signals = db.query(Signal).filter(Signal.component_code == component_code).all()
    affected = []
    total_impact = 0
    
    for s in signals:
        impact = signal_change_impact(db, s.signal_code, pivot_tick)
        if "delta" in impact and impact["delta"]["mean_change"] != 0:
            delta_percent = (impact["delta"]["mean_change"] / impact["before"]["mean"]) * 100 if impact["before"]["mean"] else 0
            affected.append({
                "signal_code": s.signal_code,
                "delta_percent": delta_percent,
                "before_p95": impact["before"]["p95"],
                "after_p95": impact["after"]["p95"]
            })
            total_impact += abs(delta_percent)
    
    affected.sort(key=lambda x: abs(x["delta_percent"]), reverse=True)
    
    return {
        "component_code": component_code,
        "affected_signals": affected,
        "total_impact_score": total_impact / len(signals) if signals else 0
    }

def get_forecast_summary(db: Session, component_code: str, horizon_ticks: int):
    signals = db.query(Signal).filter(Signal.component_code == component_code, Signal.signal_type.in_(["yi", "zi"])).all()  # Focus on KPIs/KQIs
    if not signals:
        return {"error": "No health signals"}
    
    predicted_health = 0
    risky = []
    
    for s in signals:
        forecast = forecast_signal(db, s.signal_code, horizon_ticks)
        predicted_value = forecast["predicted_mean"]  # Assume forecast returns predicted_mean
        threshold = db.query(AlertRule.threshold).filter(AlertRule.signal_code == s.signal_code).scalar() or float('inf')
        breach_in_ticks = next((i for i, v in enumerate(forecast["series"]) if v["value"] > threshold), horizon_ticks) if s.polarity == "higher_is_worse" else horizon_ticks
        
        if breach_in_ticks < horizon_ticks:
            risky.append({
                "signal_code": s.signal_code,
                "breach_in_ticks": breach_in_ticks,
                "predicted_value": predicted_value
            })
        
        predicted_health += predicted_value / len(signals)
    
    risk_level = "HIGH" if len(risky) > len(signals) * 0.3 else "MEDIUM" if len(risky) > 0 else "LOW"
    
    return {
        "component_code": component_code,
        "horizon_ticks": horizon_ticks,
        "predicted_health": predicted_health,
        "risk_level": risk_level,
        "risky_signals": sorted(risky, key=lambda x: x["breach_in_ticks"])
    }



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\services\email_service.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\email_service.py
==================================================
# app/services/email_service.py
import smtplib
from email.mime.text import MIMEText
from email.mime.multipart import MIMEMultipart

from app.core.config import settings


def send_email(
    to_email: str,
    subject: str,
    text: str,
    html: str | None = None,
):
    msg = MIMEMultipart("alternative")
    msg["From"] = settings.SMTP_FROM_EMAIL
    msg["To"] = to_email
    msg["Subject"] = subject

    msg.attach(MIMEText(text, "plain"))

    if html:
        msg.attach(MIMEText(html, "html"))

    with smtplib.SMTP(settings.SMTP_HOST, settings.SMTP_PORT) as server:
        server.sendmail(
            settings.SMTP_FROM_EMAIL,
            [to_email],
            msg.as_string(),
        )




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\services\incident_notification_service.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\incident_notification_service.py
==================================================
# app/services/incident_notification_service.py
from typing import Dict, List
from collections import defaultdict

from app.db.models.alerts import AlertEvent
from app.db.models.incidents import Incident
from app.services.email_service import send_email


def send_incident_summary_email(
    incidents: List[Incident],
    alerts_by_incident: Dict[int, List[AlertEvent]],
    to_email: str,
):
    subject = f"[INCIDENT REPORT] {len(incidents)} new critical incident(s) detected"

    lines = [
        "ðŸš¨ PlatformOPS Incident Report",
        "",
        f"New incidents detected: {len(incidents)}",
        "",
        "=" * 60,
    ]

    for inc in incidents:
        lines.extend([
            "",
            f"ðŸ“Œ Incident #{inc.id}",
            f"Component      : {inc.component_code}",
            f"Severity       : {inc.severity}",
            f"Start tick     : {inc.start_tick}",
            f"Summary        : {inc.summary}",
            "",
            "ðŸ”Ž Observations:",
            "- Sustained metric violations detected",
            "- Alert density exceeded safe thresholds",
            "",
            "âš ï¸ Contributing alerts:",
        ])

        alerts = alerts_by_incident.get(inc.id, [])
        for a in alerts:
            duration = (
                a.tick_end - a.tick_start
                if a.tick_end is not None
                else "ongoing"
            )
            lines.append(
                f"  â€¢ {a.signal_code} | "
                f"severity={a.severity} | "
                f"duration={duration} | "
                f"peak={a.peak_value}"
            )

        lines.append("-" * 60)

    lines.extend([
        "",
        "ðŸ§  Operational insight:",
        "These incidents indicate real service degradation.",
        "Recommended actions:",
        "- Inspect upstream dependencies",
        "- Check recent deployments",
        "- Monitor recovery metrics",
        "",
        "This email was generated automatically by PlatformOPS.",
    ])

    send_email(
        to_email=to_email,
        subject=subject,
        text="\n".join(lines),
    )




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\services\incident_service.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\incident_service.py
==================================================
# app/services/incident_service.py
from sqlalchemy.orm import Session
from collections import defaultdict

from app.db.models.alerts import AlertEvent
from app.db.models.incidents import Incident, IncidentAlert
from app.core.config import settings
from app.services.incident_notification_service import send_incident_summary_email


CRITICAL_THRESHOLD = 2
SUSTAINED_TICKS = 10


def evaluate_incidents(db: Session) -> dict:
    created = 0
    resolved = 0

    new_incidents: list[Incident] = []
    alerts_by_incident: dict[int, list[AlertEvent]] = defaultdict(list)

    alerts = (
        db.query(AlertEvent)
        .filter(
            AlertEvent.status == "OPEN",
            AlertEvent.origin == "REAL",
            AlertEvent.severity == "critical",
        )
        .all()
    )

    alerts_by_component = defaultdict(list)
    for a in alerts:
        alerts_by_component[a.component_code].append(a)

    for component, component_alerts in alerts_by_component.items():

        open_incident = (
            db.query(Incident)
            .filter(
                Incident.component_code == component,
                Incident.status == "OPEN",
                Incident.origin == "REAL",
            )
            .one_or_none()
        )

        density_trigger = len(component_alerts) >= CRITICAL_THRESHOLD
        sustained_trigger = any(
            (a.tick_end - a.tick_start) >= SUSTAINED_TICKS
            for a in component_alerts
            if a.tick_end is not None
        )

        if density_trigger or sustained_trigger:
            if not open_incident:
                incident = Incident(
                    component_code=component,
                    start_tick=min(a.tick_start for a in component_alerts),
                    severity="critical",
                    status="OPEN",
                    origin="REAL",
                    summary=f"Critical degradation detected on component {component}",
                )
                db.add(incident)
                db.flush()

                for a in component_alerts:
                    db.add(
                        IncidentAlert(
                            incident_id=incident.id,
                            alert_event_id=a.id,
                        )
                    )
                    alerts_by_incident[incident.id].append(a)

                new_incidents.append(incident)
                created += 1

        else:
            if open_incident:
                open_incident.status = "RESOLVED"
                open_incident.end_tick = max(
                    a.tick_end for a in component_alerts if a.tick_end is not None
                )
                resolved += 1

    db.commit()

    # ðŸ”¥ ONE EMAIL FOR ALL INCIDENTS
    if new_incidents:
        send_incident_summary_email(
            incidents=new_incidents,
            alerts_by_incident=alerts_by_incident,
            to_email=settings.SMTP_FROM_EMAIL,
        )

    return {
        "created_incidents": created,
        "resolved_incidents": resolved,
    }




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\services\patterns_service.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\patterns_service.py
==================================================
# app/services/patterns_service.py
import statistics
from sqlalchemy.orm import Session
from sqlalchemy import text
from app.db.models.signals import Signal


def detect_spikes(db: Session, window: int = 50, zscore: float = 3.0):
    results = []

    signals = db.query(Signal).all()

    for s in signals:
        sql = """
        SELECT tick, (payload ->> :column)::double precision AS value
        FROM timeseries_points
        WHERE component_code = :component
          AND payload ? :column
        ORDER BY tick DESC
        LIMIT :window
        """

        rows = db.execute(
            text(sql),
            {
                "component": s.component_code,
                "column": s.column_name,
                "window": window
            }
        ).fetchall()

        values = [r.value for r in rows if r.value is not None]

        if len(values) < 10:
            continue

        mean = statistics.mean(values)
        std = statistics.stdev(values)

        for r in rows:
            if r.value is None:
                continue

            if abs(r.value - mean) > zscore * std:
                results.append({
                    "signal_code": s.signal_code,
                    "component_code": s.component_code,
                    "tick": r.tick,
                    "value": r.value,
                    "type": "SPIKE"
                })
                break

    return results


def detect_recovery(db: Session, window: int = 30):
    results = []

    signals = db.query(Signal).filter(Signal.signal_type == "yi").all()

    for s in signals:
        sql = """
        SELECT tick, (payload ->> :column)::double precision AS value
        FROM timeseries_points
        WHERE component_code = :component
          AND payload ? :column
        ORDER BY tick DESC
        LIMIT :window
        """

        rows = db.execute(
            text(sql),
            {
                "component": s.component_code,
                "column": s.column_name,
                "window": window
            }
        ).fetchall()

        values = [r.value for r in rows if r.value is not None]

        if len(values) < 5:
            continue

        if values[-1] > values[0]:
            results.append({
                "signal_code": s.signal_code,
                "component_code": s.component_code,
                "from": values[0],
                "to": values[-1],
                "type": "RECOVERY"
            })

    return results




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\services\propagation_engine.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\propagation_engine.py
==================================================



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\services\propagation_service.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\propagation_service.py
==================================================
# app/services/propagation_service.py
import numpy as np
from sqlalchemy.orm import Session
from app.services.timeseries_service import get_timeseries


def compute_propagation(
    db: Session,
    source_signal: str,
    target_signal: str,
    window: int = 30,
):
    src = get_timeseries(db, source_signal, None, None)
    tgt = get_timeseries(db, target_signal, None, None)

    if len(src) < window or len(tgt) < window:
        raise ValueError("Insufficient data for propagation analysis")

    # Align by tick
    src_values = np.array([p["value"] for p in src], dtype=float)
    tgt_values = np.array([p["value"] for p in tgt], dtype=float)

    # Remove NaNs
    mask = ~np.isnan(src_values) & ~np.isnan(tgt_values)
    src_values = src_values[mask]
    tgt_values = tgt_values[mask]

    # Normalize
    src_z = (src_values - src_values.mean()) / src_values.std()
    tgt_z = (tgt_values - tgt_values.mean()) / tgt_values.std()

    best_corr = 0.0
    best_lag = 0

    for lag in range(-window, window + 1):
        if lag < 0:
            corr = np.corrcoef(src_z[:lag], tgt_z[-lag:])[0, 1]
        elif lag > 0:
            corr = np.corrcoef(src_z[lag:], tgt_z[:-lag])[0, 1]
        else:
            corr = np.corrcoef(src_z, tgt_z)[0, 1]

        if abs(corr) > abs(best_corr):
            best_corr = corr
            best_lag = lag

    confidence = abs(best_corr) * (len(src_z) / len(src))

    classification = (
        "strong_positive_propagation"
        if best_corr > 0.7
        else "weak_or_no_propagation"
    )

    return {
        "source_signal": source_signal,
        "target_signal": target_signal,
        "window": window,
        "correlation": round(float(best_corr), 3),
        "lag_ticks": best_lag,
        "confidence": round(float(confidence), 3),
        "classification": classification,
    }




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\services\signal_bootstrap_service.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\signal_bootstrap_service.py
==================================================
# app/services/signal_bootstrap_service.py
from sqlalchemy.orm import Session
from sqlalchemy import text
from app.db.models.signals import Signal


def bootstrap_signals_from_payload(db: Session):
    """
    Create missing signals directly from payload schema.
    Payload is the source of truth.
    """
    sample = db.execute(
        text("SELECT payload, component_code FROM timeseries_points LIMIT 1")
    ).fetchone()

    if not sample:
        return 0

    payload, component = sample
    existing = {
        s.signal_code for s in db.query(Signal).all()
    }

    created = 0

    for key in payload.keys():
        signal_code = f"{component}.{key}"
        if signal_code in existing:
            continue

        db.add(
            Signal(
                signal_code=signal_code,
                component_code=component,
                column_name=key,
            )
        )
        created += 1

    db.commit()
    return created




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\services\signal_generation_service.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\signal_generation_service.py
==================================================
# app/services/signal_generation_service.py
from sqlalchemy.orm import Session
from sqlalchemy import text
from app.db.models.signals import Signal

def infer_signal_type(column_name: str) -> str:
    if column_name.startswith("y"):
        return "yi"
    if column_name.startswith("z"):
        return "zi"
    return "xi"


def infer_roles(signal_type: str):
    if signal_type == "xi":
        return ["ops"]
    if signal_type == "yi":
        return ["architect", "exec"]
    return ["exec"]


def infer_unit(column_name: str) -> str:
    mapping = {
        "_ms": "ms",
        "_sec": "sec",
        "_percent": "percent",
        "_ratio": "ratio",
        "_bytes": "bytes",
        "_kb": "kb",
        "_mb": "mb",
        "_count": "count",
        "_rate": "rate",
        "_probability": "probability",
    }
    for suffix, unit in mapping.items():
        if column_name.endswith(suffix):
            return unit
    return "value"


def humanize(text_value: str) -> str:
    return text_value.replace("_", " ").capitalize()


def generate_signals(db: Session):
    """
    Discover all metrics from timeseries_points.payload
    and insert missing signals.
    """

    # Get one payload per component (enough to discover all keys)
    rows = db.execute(text("""
        SELECT DISTINCT ON (component_code)
               component_code,
               payload
        FROM timeseries_points
        ORDER BY component_code, tick
    """)).mappings().all()

    created = 0

    for row in rows:
        component = row["component_code"]
        payload = row["payload"]

        for column_name in payload.keys():
            signal_code = f"{component}.{column_name}"

            exists = db.query(Signal).filter(
                Signal.signal_code == signal_code
            ).first()

            if exists:
                continue

            signal_type = infer_signal_type(column_name)

            signal = Signal(
                signal_code=signal_code,
                component_code=component,
                column_name=column_name,
                signal_type=signal_type,
                unit=infer_unit(column_name),
                polarity="higher_is_worse",
                description=humanize(column_name),
                visible_to_roles=infer_roles(signal_type),
                family=f"AUTO_{component}",
            )

            db.add(signal)
            created += 1

    db.commit()
    return created




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\services\signal_service.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\signal_service.py
==================================================
# app/services/signal_service.py
from sqlalchemy.orm import Session
from app.db.models.signals import Signal

def list_signals(db: Session, role: str):
    return (
        db.query(Signal)
        .filter(Signal.visible_to_roles.any(role))
        .order_by(Signal.component_code, Signal.signal_code)
        .all()
    )




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\services\timeseries_service.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\timeseries_service.py
==================================================
# app/services/timeseries_service.py
import statistics
from sqlalchemy.orm import Session
from sqlalchemy import Float, text
from app.db.models.signals import Signal
from sqlalchemy.orm import Session
from app.db.models.timeseries import TimeSeriesPoint
import math


def get_timeseries(
    db: Session,
    signal_code: str,
    from_tick: int | None,
    to_tick: int | None,
):
    # 1ï¸âƒ£ Load signal metadata
    signal = (
        db.query(Signal)
        .filter(Signal.signal_code == signal_code)
        .one_or_none()
    )

    if not signal:
        raise ValueError(f"Unknown signal_code: {signal_code}")

    component_code = signal.component_code
    column_name = signal.column_name

    # 2ï¸âƒ£ Build SQL dynamically (JSONB extraction)
    sql = f"""
        SELECT
            tick,
            timestamp,
            (payload ->> :column_name)::double precision AS value
        FROM timeseries_points
        WHERE component_code = :component_code
          AND payload ? :column_name
    """

    params = {
        "component_code": component_code,
        "column_name": column_name,
    }

    if from_tick is not None:
        sql += " AND tick >= :from_tick"
        params["from_tick"] = from_tick

    if to_tick is not None:
        sql += " AND tick <= :to_tick"
        params["to_tick"] = to_tick

    sql += " ORDER BY tick"

    rows = db.execute(text(sql), params).fetchall()

    # 3ï¸âƒ£ Format for frontend charts
    return [
        {
            "tick": r.tick,
            "timestamp": r.timestamp,
            "value": r.value,
        }
        for r in rows
    ]

def _extract_series(db, component_code, column_name, limit=30):
    rows = (
        db.query(
            TimeSeriesPoint.tick,
            TimeSeriesPoint.payload[column_name].astext.cast(Float)
        )
        .filter(TimeSeriesPoint.component_code == component_code)
        .order_by(TimeSeriesPoint.tick.desc())
        .limit(limit)
        .all()
    )

    return [r[1] for r in reversed(rows) if r[1] is not None]


# ---------- VOLATILITY ----------
def compute_volatility(db: Session, signal_code: str, window: int = 30):
    signal = db.query(Signal).filter(Signal.signal_code == signal_code).first()
    if not signal:
        return 0.0

    values = _extract_series(db, signal.component_code, signal.column_name, window)

    if len(values) < 2:
        return 0.0

    return statistics.stdev(values)


# ---------- DEGRADATION ----------
def detect_degradation(db: Session, role: str, window: int = 20):
    signals = db.query(Signal).all()
    results = []

    for s in signals:
        if role not in s.visible_to_roles and "admin" not in s.visible_to_roles:
            continue

        values = _extract_series(db, s.component_code, s.column_name, window)
        if len(values) < 2:
            continue

        slope = (values[-1] - values[0]) / window

        if s.polarity == "higher_is_worse" and slope > 0:
            results.append({"signal": s.signal_code, "slope": slope})

        if s.polarity == "lower_is_worse" and slope < 0:
            results.append({"signal": s.signal_code, "slope": slope})

    return results


# ---------- COMPONENT HEALTH ----------
def component_health(db: Session, component_code: str):
    signals = (
        db.query(Signal)
        .filter(Signal.component_code == component_code, Signal.signal_type == "yi")
        .all()
    )

    scores = []

    for s in signals:
        values = _extract_series(db, component_code, s.column_name, limit=1)
        if values:
            scores.append(values[0])

    if not scores:
        return 100.0

    return max(0.0, 100.0 - sum(scores) / len(scores))


# ---------- GLOBAL HEALTH ----------
def global_health(db: Session):
    signal = db.query(Signal).filter(Signal.signal_code == "GLOBAL.z9_collapse_risk").first()
    values = _extract_series(db, "GLOBAL", signal.column_name, limit=1)

    risk = values[0] if values else 0.0

    return {
        "collapse_risk": risk,
        "status": "CRITICAL" if risk > 0.7 else "DEGRADED" if risk > 0.4 else "STABLE"
    }


def multi_signal(db, signal_codes):
    result = {}

    for code in signal_codes:
        try:
            result[code] = get_timeseries(
                db=db,
                signal_code=code.strip(),
                from_tick=None,
                to_tick=None,
            )
        except Exception as e:
            result[code] = {
                "error": str(e)
            }

    return result #
def aggregate_signal(db, signal_code: str, window: int = 10, agg_type: str = "avg"):
    points = get_timeseries(db, signal_code, None, None)

    if not points:
        return []

    result = []

    for i in range(0, len(points), window):
        chunk = points[i:i + window]
        if not chunk:
            continue

        values = [p["value"] for p in chunk]

        if agg_type == "avg":
            agg_value = sum(values) / len(values)
        elif agg_type == "min":
            agg_value = min(values)
        elif agg_type == "max":
            agg_value = max(values)
        elif agg_type == "sum":
            agg_value = sum(values)
        else:
            raise ValueError(f"Unknown aggregation type: {agg_type}")

        result.append({
            "tick": chunk[0]["tick"],
            "timestamp": chunk[0]["timestamp"],
            "value": agg_value
        })

    return result


def derivative_signal(db, signal_code: str):
    signal_code = signal_code.strip()

    points = get_timeseries(db, signal_code, None, None)

    if len(points) < 2:
        return []

    derivatives = []

    prev = points[0]
    for curr in points[1:]:
        derivatives.append({
            "tick": curr["tick"],
            "timestamp": curr["timestamp"],
            "value": curr["value"] - prev["value"]
        })
        prev = curr

    return derivatives


def normalize_signal(db, signal_code: str):
    signal_code = signal_code.strip()

    points = get_timeseries(db, signal_code, None, None)

    if not points:
        return []

    values = [p["value"] for p in points]
    min_v = min(values)
    max_v = max(values)

    # avoid division by zero
    if max_v == min_v:
        return [
            {
                "tick": p["tick"],
                "timestamp": p["timestamp"],
                "value": 0.0
            }
            for p in points
        ]

    normalized = []
    for p in points:
        normalized.append({
            "tick": p["tick"],
            "timestamp": p["timestamp"],
            "value": (p["value"] - min_v) / (max_v - min_v)
        })

    return normalized




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\services\user_service.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\user_service.py
==================================================
# app/services/user_service.py
from sqlalchemy.orm import Session
from app.db.models.users import User, Role
from fastapi import HTTPException


def assign_roles(db: Session, user_id: str, roles: list[str]):
    user = db.query(User).filter(User.id == user_id).first()
    if not user:
        raise HTTPException(status_code=404, detail="User not found")

    user.roles.clear()

    for role_id in roles:
        role = db.query(Role).filter(Role.id == role_id).first()
        if not role:
            raise HTTPException(status_code=400, detail=f"Invalid role {role_id}")
        user.roles.append(role)

    db.commit()
    return user




############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\services\__pycache__\alerts_evaluator.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\__pycache__\alerts_evaluator.cpython-314.pyc
==================================================
+
    ypXiv  ã                   óf   € ^ RI Ht ^ RIHt ^ RIHtHt ^ RIHt RR RR R	R
 RR /t	RR R llt
R# )é    )ÚSession)Útext)Ú	AlertRuleÚ
AlertEvent)ÚSignalÚgtc                 ó
   € W8„  # ©N© ©ÚvÚts   &&ÚRC:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\alerts_evaluator.pyÚ<lambda>r   	   ó   € ˜šó    Úgtec                 ó
   € W8¬  # r
   r   r   s   &&r   r   r   
   ó   € ˜šr   Últc                 ó
   € W8  # r
   r   r   s   &&r   r   r      r   r   Últec                 ó
   € W8*  # r
   r   r   s   &&r   r   r      r   r   c                ó0   € V ^8„  d   QhR\         R\        /# )é   ÚdbÚ
max_window)r   Úint)Úformats   "r   Ú__annotate__r       s   € ÷ ]ñ ]œð ]¬Sñ ]r   c                ó0  € V P                  \        4      P                  \        P                  R8H  4      P	                  4       p^ p^ pV EF³  pV^,          pV P                  \
        4      P                  \
        P                  VP                  8H  4      P                  4       pV'       g   Kd  \        P                  VP                  4      pV'       g   K  RpV P                  \        V4      RVP                  RVP                  RV/4      P                  4       p	V	'       g   KÜ  \!        \#        V	4      4      p	^ p
RpRpV	 F·  w  rÞVf	   ^ p
RpRpK  V! WåP$                  4      '       d"   V
^,          p
Vf   TM
\'        WÎ4      pVf   TpM^ p
RpRpW¥P(                  8¼  g   Kb  V P+                  \-        VP.                  VP                  VP                  VVVVP0                  RR7      4       V^,          p EK±  	  EK¶  	  V P3                  4        R	VR
V/# )zR
Deterministic rolling-window alert evaluator.
ONE event per rule per evaluation.
Ta   
            SELECT
                tick,
                (payload ->> :column)::double precision AS value
            FROM timeseries_points
            WHERE component_code = :component
              AND payload ? :column
            ORDER BY tick DESC
            LIMIT :limit
        Ú	componentÚcolumnÚlimitNÚOPEN)Úrule_idÚcomponent_codeÚsignal_codeÚ
tick_startÚtick_endÚ
peak_valueÚseverityÚstatusÚevaluated_rulesÚcreated_events)Úqueryr   ÚfilterÚenabledÚallr   r(   Úone_or_noneÚ	OPERATORSÚgetÚoperatorÚexecuter   r'   Úcolumn_nameÚfetchallÚlistÚreversedÚ	thresholdÚmaxÚmin_duration_ticksÚaddr   Úidr,   Úcommit)r   r   ÚrulesÚ	evaluatedÚcreatedÚruleÚsignalÚ
comparatorÚsqlÚrowsÚstreakÚ
start_tickÚpeakÚtickÚvalues   &&             r   Úevaluate_alertsrP      sõ  € ð H‰H”YÓ×&Ñ&¤y×'8Ñ'8¸DÑ'@ÓA×EÑEÓG€Eà€IØ€GäˆØQˆ	ð H‰H”VÓß‰V”F×&Ñ&¨$×*:Ñ*:Ñ:Ó;ß‰[‹]ð 	÷
 Ùä—]‘] 4§=¡=Ó1ˆ
ßÙð	ˆð z‰zÜ‹Ià˜V×2Ñ2Ø˜&×,Ñ,Ø˜ðó
÷ ‰(‹*ð 	÷ Ùä”H˜T“NÓ#ˆàˆØˆ
Øˆã‰KˆDØŠ}ØØ!
ØÙá˜%§¡×0Ò0Ø˜!•Ø $¢‘u´#°dÓ2BØÒ%Ø!%JøàØ!
Øà×0Ñ0Ö0Ø—‘ÜØ $§¡Ø'-×'<Ñ'<Ø$(×$4Ñ$4Ø#-Ø!%Ø#'Ø!%§¡Ø%ô	ôð ˜1•Ûô?  ñY ðZ ‡II„Kð 	˜9Ø˜'ðð r   N)éÈ   )Úsqlalchemy.ormr   Ú
sqlalchemyr   Úapp.db.models.alertsr   r   Úapp.db.models.signalsr   r5   rP   r   r   r   Ú<module>rV      s>   ðå "Ý ç 6Ý (ð 	ÑØ	ÑØÑØ	Ñð	€	÷]ñ ]r   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\services\__pycache__\alerts_insight_service.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\__pycache__\alerts_insight_service.cpython-314.pyc
==================================================
+
    Ò½Ii—  ã                   óB   € ^ RI Ht ^ RIHt ^ RIHt R R ltR R ltR# )	é    ©ÚSession)Úfunc)Ú
AlertEventc                ó$   € V ^8„  d   QhR\         /# )é   Údbr   )Úformats   "ÚXC:\Users\h50048240\3D Objects\platformOPS\backend\app\services\alerts_insight_service.pyÚ__annotate__r      s   € ÷ 
9ñ 
9”gñ 
9ó    c                 ó  € V P                  \        P                  \        P                  ! \        P
                  4      4      P                  \        P                  4      P                  4       pV UUu/ uF  w  r#W#bK	  	  upp# u uppi ©N)Úqueryr   Úseverityr   ÚcountÚidÚgroup_byÚall)r	   Úrowsr   r   s   &   r   Úalert_summaryr      sc   € à
‰Ü×ÑÜJŠJ”z—}‘}Ó%ó	
÷ 
‰”*×%Ñ%Ó	&ß	‰‹ð 	ñ 48Ô8±4¡ ˆHŠO±4Ò8Ð8ùÓ8s   Á3Bc                ó0   € V ^8„  d   QhR\         R\        /# )r   r	   Úcomponent_code)r   Ústr)r
   s   "r   r   r      s   € ÷ ñ œGð ´Sñ r   c                 óÞ   € V P                  \        4      P                  \        P                  V8H  4      P	                  \        P
                  P                  4       4      P                  4       # r   )r   r   Úfilterr   Úorder_byr   Údescr   )r	   r   s   &&r   Úalerts_by_componentr      sF   € à
‰”Óß	‰”
×)Ñ)¨^Ñ;Ó	<ß	‰”*—-‘-×$Ñ$Ó&Ó	'ß	‰‹ð	r   N)Úsqlalchemy.ormr   Ú
sqlalchemyr   Úapp.db.models.alertsr   r   r   © r   r   Ú<module>r$      s   ðå "Ý Ý +õ
9÷r   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\services\__pycache__\alert_autogen_service.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\__pycache__\alert_autogen_service.cpython-314.pyc
==================================================
+
    ß‹Giª	  ã                   óZ   € ^ RI t ^ RIHt ^ RIHt ^ RIHt ^ RIHt R
R R llt	R R	 lt
R# )é    N©ÚSession)Útext)ÚSignal)Ú	AlertRulec                ó<   € V ^8„  d   QhR\         R\        R\        /# )é   ÚdbÚsignalÚwindow)r   r   Úint)Úformats   "ÚWC:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\alert_autogen_service.pyÚ__annotate__r      s!   € ÷ =ñ =”'ð =¤6ð =´3ñ =ó    c           	      óf  € R pV P                  \        V4      RVP                  RVP                  RV/4      P	                  4       pV Uu. uF  qUP
                  f   K  VP
                  NK   	  pp\        V4      ^8  d   R# \        P                  ! V4      \        P                  ! V4      3# u upi )zë
        SELECT
            (payload ->> :column)::double precision AS value
        FROM timeseries_points
        WHERE component_code = :component
          AND payload ? :column
        ORDER BY tick DESC
        LIMIT :window
    ÚcolumnÚ	componentr   )NN)
Úexecuter   Úcolumn_nameÚcomponent_codeÚfetchallÚvalueÚlenÚ
statisticsÚmeanÚstdev)r
   r   r   ÚsqlÚrowsÚrÚvaluess   &&&    r   Ú	_baseliner"      s¡   € ð€Cð :‰:ÜˆS‹	àf×(Ñ(Ø˜×.Ñ.Øfð	
ó÷ hƒjð 	ñ  $Ó;™t˜!§w¡wŒgˆagŒg™t€FÐ;ä
ˆ6ƒ{Q„ØÐä?Š?˜6Ó"¤J×$4Ò$4°VÓ$<Ð<Ð<ùò <s   Á
B.ÁB.c                ó$   € V ^8„  d   QhR\         /# )r	   r
   r   )r   s   "r   r   r   $   s   € ÷ 7ñ 7¤ñ 7r   c           	      ó   € ^ pV P                  \        4      P                  4       pV EFQ  pV P                  \        4      P	                  \        P
                  VP
                  8H  4      P                  4       pV'       d   K[  \        W4      w  rVVP                  R8X  dd   Ve`   VP                  R8X  d   V^V,          ,           MV^V,          ,
          p\        VP
                  VP                  R8X  d   RMRV^RR7      pM[VP                  R8X  d   \        VP
                  RR^R	R7      pM/VP                  R
8X  d   \        VP
                  RR^RR7      pMEK7  V P                  V4       V^,          pEKT  	  V P                  4        V# )r   ÚxiÚhigher_is_worseÚ>Ú<ÚMEDIUM)Úsignal_codeÚoperatorÚ	thresholdÚmin_duration_ticksÚseverityÚyig     €Q@ÚHIGHÚzigffffffæ?ÚCRITICAL)Úqueryr   Úallr   Úfilterr*   Úfirstr"   Úsignal_typeÚpolarityÚaddÚcommit)	r
   ÚcreatedÚsignalsÚsÚexistsr   Ústdr,   Úrules	   &        r   Úautogenerate_alert_rulesrA   $   sT  € Ø€Gàh‰h”vÓ×"Ñ"Ó$€Gäˆð H‰H”YÓß‰V”I×)Ñ)¨Q¯]©]Ñ:Ó;ß‰U‹Wð 	÷
 Ùä˜bÓ$‰	ˆð =‰=˜DÔ  TÒ%5Ø*+¯*©*Ð8IÔ*I˜˜q 3wžÈtÐVWÐZ]ÕV]Í~ˆIÜØŸM™MØ !§
¡
Ð.?Ô ?™ÀSØ#Ø#$Ø!ô‰Dð ]‰]˜dÔ"ÜØŸM™MØØØ#$Øô‰Dð ]‰]˜dÔ"ÜØŸM™MØØØ#$Ø#ô‰Dò à
‰ˆtŒØ1‹ñ_ ðb ‡II„KØ€Nr   )é2   )r   Úsqlalchemy.ormr   Ú
sqlalchemyr   Úapp.db.models.signalsr   Úapp.db.models.alertsr   r"   rA   © r   r   Ú<module>rH      s   ðÛ Ý "Ý Ý (Ý *÷=÷87r   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\services\__pycache__\alert_notification_serice.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\__pycache__\alert_notification_serice.cpython-314.pyc
==================================================
+
    Ñ·\i{  ã                   óN   € ^ RI Ht ^ RIHt ^ RIHt ^ RIHt ^ RIH	t	 R R lt
R# )	é    )ÚList)ÚSession)Ú
AlertEvent)Úsettings)Ú
send_emailc                óF   € V ^8„  d   QhR\         R\        \        ,          /# )é   ÚdbÚalerts)r   r   r   )Úformats   "Ú[C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\alert_notification_serice.pyÚ__annotate__r   	   s!   € ÷ (ñ (Üð(ä”Õñ(ó    c                óì  € V'       g   R# / pV F.  pVP                  VP                  . 4      P                  V4       K0  	  . pVP                  R4       VP                  R4       VP                  R\        V4       24       VP                  R4       VP	                  4        F   w  rVVP                  RVP                  4        R\        V4       R24       V FU  pVP                  RVP                   R	VP                   R
VP                   RVP                   RVP                   2
4       KW  	  VP                  R4       K¢  	  RP                  V4      p\        \        P                  RVR7       R# )z7
Send ONE summary email for newly created REAL alerts.
Nu)   ðŸš¨ PlatformOPS â€“ REAL Alerts DetectedÚ zTotal new alerts: z
Severity: z (Ú)z- Component: z | Signal: z
 | Ticks: u    â†’ z	 | Peak: Ú
u"   ðŸš¨ PlatformOPS â€“ Alert Summary)Úto_emailÚsubjectÚtext)Ú
setdefaultÚseverityÚappendÚlenÚitemsÚupperÚcomponent_codeÚsignal_codeÚ
tick_startÚtick_endÚ
peak_valueÚjoinr   r   ÚSMTP_FROM_EMAIL)	r
   r   ÚgroupedÚalertÚlinesr   r   ÚaÚbodys	   &&       r   Únotify_admin_for_real_alertsr)   	   sI  € ÷ Ùð ,.€GÛˆØ×Ñ˜5Ÿ>™>¨2Ó.×5Ñ5°eÖ<ñ ð €EØ	‡LLÐ<Ô=Ø	‡LLÔØ	‡LLÐ%¤c¨&£k ]Ð3Ô4Ø	‡LLÔà"Ÿ=™=ž?‰ˆØ‰z (§.¡.Ó"2Ð!3°2´c¸%³j°\ÀÐCÔDÛˆAØL‰LØ × 0Ñ 0Ð1ð 2ØŸ=™=˜/ð *ØŸ,™,˜ u¨Q¯Z©Z¨Lð 9ØŸ™˜ð(öñ ð 	‰RÖñ +ð 9‰9UÓ€DäÜ×)Ñ)Ø4Ø÷r   N)Útypingr   Úsqlalchemy.ormr   Úapp.db.models.alertsr   Úapp.core.configr   Úapp.services.email_servicer   r)   © r   r   Ú<module>r0      s   ðÝ Ý "å +Ý $Ý 1÷(r   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\services\__pycache__\alert_rule_generator.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\__pycache__\alert_rule_generator.cpython-314.pyc
==================================================
+
    ¦dXi¢  ã                   óN   € ^ RI Ht ^ RIHt ^ RIHt ^ RIHt ^ RIH	t	 R R lt
R# )	é    )ÚSession)Ú	AlertRule)ÚSignal)Úmetric_baseline)Údetect_familyc                ó0   € V ^8„  d   QhR\         R\        /# )é   ÚdbÚreturn)r   Úint)Úformats   "ÚVC:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\alert_rule_generator.pyÚ__annotate__r   	   s   € ÷ Sñ S¤wð S´3ñ Só    c                ó   € V P                  \        P                  4      P                  4        Uu0 uF  qP                  kK  	  pp^ pV P                  \        4      P                  4       pV EFw  pVP                  V9   d   K  \        VP                  4      p\        WP                  VP                  4      p. pVR8X  d   RR.pMÌVR8X  d0   V'       d(   RVR,          R,          R3RVR,          R,          R3.pM–VR	8X  d"   V'       d   RVR
,          R3RVR,          R3.pMnVR8X  d)   V'       d!   RVR
,          R3RVR
,          R,          R3.pM?VR8X  d   RR.pM3VR8X  d   RR.pM'VR8X  d!   V'       d   RVR
,          R3RVR,          R3.pV FK  w  ršpT P                  \        VP                  T	\        V
4      VR8X  d   ^M^VRR7      4       V^,          pKM  	  EKz  	  V P                  4        V# u upi )zY
Deterministic, family-based alert rule generation.
NO std, NO dynamic math instability.
ÚutilizationÚgtÚwarningÚcriticalÚ
throughputÚmeang      ø?g      @ÚbacklogÚp95ÚmaxÚlatencyg       @Ú
error_rateÚeventsÚcountT)Úsignal_codeÚoperatorÚ	thresholdÚmin_duration_ticksÚseverityÚenabled)r   g      è?r   )r   gÍÌÌÌÌÌì?r   )r   g{®Gáz„?r   )r   gš™™™™™©?r   )r   é   r   )r   é   r   )Úqueryr   r   Úallr   r   Úcolumn_namer   Úcomponent_codeÚaddÚfloatÚcommit)r
   ÚrÚexistingÚcreatedÚsignalsÚsÚfamilyÚbaselineÚrulesÚopr!   r#   s   &           r   Úgenerate_rules_for_all_metricsr7   	   s  € ð (*§x¡x´	×0EÑ0EÓ'F×'JÑ'JÔ'LÓMÑ'L !—”Ñ'L€HÐMØ€Gàh‰h”vÓ×"Ñ"Ó$€GäˆØ=‰=˜HÔ$Ùä˜qŸ}™}Ó-ˆÜ" 2×'7Ñ'7¸¿¹ÓGˆàˆð ]Ô"à'Ø(ð‰Eð |Ô#¯àx Õ'¨#Õ-¨yÐ9Øx Õ'¨#Õ-¨zÐ:ð‰Eð yÔ §Xàx •¨	Ð2Øx •¨
Ð3ð‰Eð yÔ §Xàx •¨	Ð2Øx •¨Õ,¨jÐ9ð‰Eð |Ô#à'Ø(ð‰Eð xÔà$Ø%ð‰Eð wÔ§8àx •¨	Ð2Øx •¨
Ð3ðˆEó
 (-Ñ#ˆB˜8ØF‰FÜØ !§¡ØÜ# IÓ.Ø,4¸	Ô,A¡qÀqØ%Ø ôô	ð qLŠGô (-ñu ðN ‡II„KØ€Nùò[ Ns   °G;N)Úsqlalchemy.ormr   Úapp.db.models.alertsr   Úapp.db.models.signalsr   Úapp.observability.baseliner   Ú!app.observability.metric_familiesr   r7   © r   r   Ú<module>r>      s   ðÝ "å *Ý (Ý 6Ý ;÷Sr   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\services\__pycache__\alert_rule_service.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\__pycache__\alert_rule_service.cpython-314.pyc
==================================================
+
    ÄñViý  ã                   óZ   € ^ RI t ^ RIHt ^ RIHt ^ RIHt ^ RIHt R
R R llt	R R	 lt
R# )é    N)ÚSession)Útext)Ú	AlertRule)ÚSignalc                ó<   € V ^8„  d   QhR\         R\        R\        /# )é   ÚdbÚsignalÚwindow)r   r   Úint)Úformats   "ÚTC:\Users\h50048240\3D Objects\platformOPS\backend\app\services\alert_rule_service.pyÚ__annotate__r      s!   € ÷ =ñ =”'ð =¤6ð =´3ñ =ó    c           	      ób  € V P                  \        R 4      RVP                  RVP                  RV/4      P	                  4       pV Uu. uF  qDP
                  f   K  VP
                  NK   	  pp\        V4      ^8  d   R# \        P                  ! V4      \        P                  ! V4      3# u upi )zû
            SELECT (payload ->> :column)::double precision AS value
            FROM timeseries_points
            WHERE component_code = :component
              AND payload ? :column
            ORDER BY tick DESC
            LIMIT :window
        ÚcolumnÚ	componentr   )NN)
Úexecuter   Úcolumn_nameÚcomponent_codeÚfetchallÚvalueÚlenÚ
statisticsÚmeanÚstdev)r	   r
   r   ÚrowsÚrÚvaluess   &&&   r   Ú	_baseliner       s    € Ø:‰:Üð ó 	ð f×(Ñ(Ø˜×.Ñ.Øfð	
ó÷ hƒjð 	ñ   $Ó;™t˜!§w¡wŒgˆagŒg™t€FÐ;ä
ˆ6ƒ{Q„ØÐä?Š?˜6Ó"¤J×$4Ò$4°VÓ$<Ð<Ð<ùò <s   ÁB,ÁB,c                ó0   € V ^8„  d   QhR\         R\        /# )r   r	   Úreturn)r   r   )r   s   "r   r   r   !   s   € ÷ Iñ I¤wð I´3ñ Ir   c           
      óp  € V P                  \        P                  4      P                  4        Uu0 uF  qP                  kK  	  pp^ pV P                  \        4      P                  4        EF1  pVP                  V9   d   K  \        W4      w  rVVP                  R8X  dn   Ve7   Ve3   VP                  R8X  d   V^V,          ,           MV^V,          ,
          pMRpVP                  R8X  d   RMRp\        VP                  VV^RRR7      p	MuVP                  R	8X  d   \        VP                  RR
^RRR7      p	MHVP                  R8X  d   \        VP                  RR^RRR7      p	M\        VP                  RRRRRR7      p	V P                  V	4       V^,          pEK4  	  V P                  4        V# u upi )r   ÚxiÚhigher_is_worseg      ð?ÚgtÚltÚwarningT)Úsignal_codeÚoperatorÚ	thresholdÚmin_duration_ticksÚseverityÚenabledÚyig     €Q@Úzigffffffæ?ÚcriticalÚnei?B ÚinfoFéÿÿÿÿ)
Úqueryr   r)   Úallr   r    Úsignal_typeÚpolarityÚaddÚcommit)
r	   r   ÚexistingÚcreatedÚsr   Ústdr+   r*   Úrules
   &         r   Úgenerate_rules_for_all_signalsr@   !   s¡  € à!Ÿx™x¬	×(=Ñ(=Ó>×BÑBÔDóÙD˜!ŒÑDð ð ð €GàX‰X”fÓ×!Ñ!×#ˆØ=‰=˜HÔ$Ùä˜bÓ$‰	ˆð =‰=˜DÔ ØÒ C¢Oð —z‘zÐ%6Ô6ð ˜1˜s7–Nà  C¥ñ ð  	à Ÿz™zÐ->Ô>‘tÀDˆHäØŸM™MØ!Ø#Ø#$Ø"Øô‰Dð ]‰]˜dÔ"ÜØŸM™MØØØ#$Ø"Øô‰Dð ]‰]˜dÔ"ÜØŸM™MØØØ#$Ø#Øô‰Dô ØŸM™MØØØ#)ØØôˆDð 	‰ˆtŒØ1‹ñ $ðB ‡II„KØ€NùòQs   °F3)é2   )r   Úsqlalchemy.ormr   Ú
sqlalchemyr   Úapp.db.models.alertsr   Úapp.db.models.signalsr   r    r@   © r   r   Ú<module>rG      s   ðÛ Ý "Ý Ý *Ý (÷=÷2Ir   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\services\__pycache__\alert_service.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\__pycache__\alert_service.cpython-314.pyc
==================================================
+
    Hƒeiì  ã                  ó¶   € ^ RI Ht ^ RIHtHtHt ^ RIHt ^ RIH	t	 ^ RI
HtHt ^ RIHt ^ RIHt RR	 R
R RR RR RR RR /tR R ltR R ltRR R lltR# )é    )Úannotations)ÚDictÚAnyÚList)ÚSession)Útext)Ú	AlertRuleÚ
AlertEvent)ÚSignal)Únotify_admin_for_real_alertsÚgtc                ó
   € W8„  # ©N© ©ÚvÚts   &&ÚOC:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\alert_service.pyÚ<lambda>r      ó   € ˜šó    Úgtec                ó
   € W8¬  # r   r   r   s   &&r   r   r      ó   € ˜šr   Últc                ó
   € W8  # r   r   r   s   &&r   r   r      r   r   Últec                ó
   € W8*  # r   r   r   s   &&r   r   r      r   r   Úeqc                ó
   € W8H  # r   r   r   s   &&r   r   r      r   r   Únec                ó
   € W8g  # r   r   r   s   &&r   r   r      r   r   c               ó    € V ^8„  d   QhRRRR/# ©é   Údbr   Úrule_idÚintr   )Úformats   "r   Ú__annotate__r*      s   € ÷ #ñ # ð #°3ñ #r   c                ó¶   € V P                  \        4      P                  \        P                  V8H  \        P                  R 8H  4      P                  RR/4       R# )ÚOPENÚstatusÚCLOSEDN)Úqueryr
   Úfilterr'   r-   Úupdate©r&   r'   s   &&r   Ú_close_all_open_baseliner3      sF   € Ø‡HHŒZÓ×ÑÜ×Ñ˜gÑ%Ü×Ñ˜VÑ#ó÷ fˆh˜Ð!Ö"r   c               ó    € V ^8„  d   QhRRRR/# r$   r   )r)   s   "r   r*   r*      s   € ÷ ñ  7ð °Sñ r   c                ó°   € V P                  \        4      P                  \        P                  V8H  \        P                  R 8H  4      P                  4        R# )Ú	SIMULATEDN)r/   r
   r0   r'   r-   Údeleter2   s   &&r   Ú_delete_simulated_for_ruler8      s>   € Ø‡HHŒZÓ×ÑÜ×Ñ˜gÑ%Ü×Ñ˜[Ñ(ó÷ f†hr   c               ó(   € V ^8„  d   QhRRRRRRRR/# )	r%   r&   r   Úlookback_ticksr(   Úsimulation_modeÚboolÚreturnzDict[str, Any]r   )r)   s   "r   r*   r*   %   s6   € ÷ Dñ DØðDàðDð ðDð ñ	Dr   c                ó  € V P                  \        4      P                  \        P                  R 8H  4      P	                  4       pV P                  \
        4      P	                  4        Uu/ uF  qDP                  VbK  	  pp^ ;p;p;r‰V'       d   RMRp
. pV EF·  pVP                  VP                  4      pV'       g   K)  \        P                  VP                  4      pV'       g   KR  V P                  \        4      P                  \        P                  VP                  8H  \        P                  VP                  8H  \        P                  R8H  \        P                  V
8H  4      P!                  \        P                  P#                  4       4      P%                  4       pRpV P'                  \)        V4      RVP                  RVP*                  RV/4      P-                  4       pV'       g   EKZ  \/        \1        V4      4      p^ pRpRpR	pV Fo  w  ppVf	   ^ pRpRpK  V! VVP2                  4      '       d?   V^,          pVf   TM\5        VV4      pT;'       g    TpVVP6                  8¼  d   R p MKi  ^ pRpRpKq  	  V'       d¤   V'       d-   XVn        \5        VP:                  V4      Vn        V	^,          p	M‡\        VP                  VP                  VP                  VXVVP<                  RV
R
7	      pV P?                  V4       V^,          pV
R8X  d   VPA                  V4       MV'       d   RVn        V^,          pV^,          pEKº  	  V PC                  4        V
R8X  d   V'       d   \E        W4       RVRVRV	RVRV
/# u upi )Tr6   ÚREALr,   a  
            SELECT tick,
                   (payload ->> :column)::double precision AS value
            FROM timeseries_points
            WHERE component_code = :component
              AND payload ? :column
            ORDER BY tick DESC
            LIMIT :limit
        Ú	componentÚcolumnÚlimitNF)	r'   Úcomponent_codeÚsignal_codeÚ
tick_startÚtick_endÚ
peak_valueÚseverityr-   Úoriginr.   Úevaluated_rulesÚcreated_eventsÚupdated_eventsÚclosed_eventsrI   )#r/   r	   r0   ÚenabledÚallr   rD   ÚgetÚ	OPERATORSÚoperatorr
   r'   ÚidrC   r-   rI   Úorder_byÚdescÚfirstÚexecuter   Úcolumn_nameÚfetchallÚlistÚreversedÚ	thresholdÚmaxÚmin_duration_ticksrF   rG   rH   ÚaddÚappendÚcommitr   )r&   r:   r;   ÚrulesÚsÚsignalsÚ	evaluatedÚcreatedÚclosedÚupdatedrI   Únew_real_alertsÚruleÚsignalÚopÚ
open_alertÚsqlÚrowsÚstreakÚ
start_tickÚpeakÚviolated_nowÚtickÚvalueÚalerts   &&&                      r   Úevaluate_alertsrw   %   s;  € ð H‰H”YÓ×&Ñ&¤y×'8Ñ'8¸DÑ'@ÓA×EÑEÓG€EØ)+¯©´&Ó)9×)=Ñ)=Ô)?Ó@Ñ)? A}‰}˜aÒÑ)?€GÐ@à-.Ð.€IÐ.Ð.˜&ß+‰[°€Fð )+€OäˆØ—‘˜T×-Ñ-Ó.ˆßÙä]‰]˜4Ÿ=™=Ó)ˆßÙð 	‰”Óß
‰&Ü×Ñ $§'¡'Ñ)Ü×%Ñ%¨×)>Ñ)>Ñ>Ü×Ñ &Ñ(Ü×Ñ Ñ'ó	÷ 
‰”*—-‘-×$Ñ$Ó&Ó	'ß	‰‹ð 	ðˆð z‰zÜ‹Ià˜V×2Ñ2Ø˜&×,Ñ,Ø˜ðó
÷ ‰(‹*ð 	÷ Úä”H˜T“NÓ#ˆàˆØˆ
ØˆØˆã‰KˆD%ØŠ}ØØ!
ØÙá%˜Ÿ™×(Ò(Ø˜!•Ø $¢‘u´#°d¸EÓ2BØ'×/Ð/¨4
à˜T×4Ñ4Ô4Ø#'LÙñ 5ð Ø!
Ø’ñ%  ÷, ßØ&*
Ô#Ü(+¨J×,AÑ,AÀ4Ó(H
Ô%Ø˜1•‘ä"Ø ŸG™GØ#)×#8Ñ#8Ø &× 2Ñ 2Ø)Ø!Ø#Ø!Ÿ]™]Ø!Ø!ô
ð —‘u”Ø˜1•ð ˜VÔ#Ø#×*Ñ*¨5Ô1øçØ$,
Ô!Ø˜!•àQ‹	ñO ðR ‡II„Kð ÔŸOÜ$ RÔ9ð 	˜9Ø˜'Ø˜'Ø˜Ø&ðð ùòo As   Á)N	N)éÈ   F)Ú
__future__r   Útypingr   r   r   Úsqlalchemy.ormr   Ú
sqlalchemyr   Úapp.db.models.alertsr	   r
   Úapp.db.models.signalsr   Ú&app.services.alert_notification_sericer   rQ   r3   r8   rw   r   r   r   Ú<module>r€      s`   ðå "ß "Ñ "å "Ý ç 6Ý (Ý Oð 	ÑØ	ÑØÑØ	ÑØÑØÑð€	õ#õ÷Dñ Dr   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\services\__pycache__\analytics_service.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\__pycache__\analytics_service.cpython-314.pyc
==================================================
+
    ù²eiŠ†  ã                   ó   € ^ RI t ^ RIHtHtHtHtHt ^ RIHt ^ RI	H
t
HtHtHt ^ RIHt ^ RIHt ^ RIHtHt ^ RIHtHtHt ^ RI t ^ RIt^ R	I	H
t
 ^ R
IHt ^ RI t ^ RI	Ht RAR R lltR R ltRBR R lltR R ltR R ltR R ltRCR R lltRDR R lltRER R llt RFR R llt!RGR  R! llt"RHR" ltR# R$ lt#RIR% R& llt$RAR' R( llt%RJR) R* llt&RKR+ R, llt'RLR- R. llt(RMR/ R0 llt)R1R2R3R4R5R6^ðR7R8/R9R6^ R7^Ò/R:R;RNR<ROR=R>// RPR? R@ llt*R# )Qé    N)ÚDictÚAnyÚListÚOptionalÚTuple©ÚSession)ÚFloatÚfuncÚtextÚcase)ÚSignal)ÚTimeSeriesPoint)Ú	AlertRuleÚ
AlertEvent)r   r   r   )r
   )Údefaultdict)r   c                ój   € V ^8„  d   QhR\         R\        R\        R\        R\        \        ,          /# )é   ÚdbÚcomponent_codeÚcolumn_nameÚlimitÚreturn)r	   ÚstrÚintr   Úfloat)Úformats   "ÚSC:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\analytics_service.pyÚ__annotate__r      s6   € ÷ >ñ >œð >´ð >Ä3ð >Ìsð >Ô\`ÔafÕ\gñ >ó    c                 óÜ  € V P                  \        P                  \        P                  V,          P                  P                  \        4      4      P                  \        P                  V8H  4      P                  \        P                  P                  4       4      P                  V4      P                  4       p\        V4       Uu. uF  qU^,          f   K  V^,          NK  	  up# u upi )é   )Úqueryr   ÚtickÚpayloadÚastextÚcastr
   Úfilterr   Úorder_byÚdescr   ÚallÚreversed)r   r   r   r   ÚrowsÚrs   &&&&  r   Ú_extract_seriesr/      s¥   € à
‰Ü× Ñ Ü×#Ñ# KÕ0×7Ñ7×<Ñ<¼UÓCó	
÷ 
‰”×.Ñ.°.Ñ@Ó	Aß	‰”/×&Ñ&×+Ñ+Ó-Ó	.ß	‰ˆu‹ß	‰‹ð 	ô # 4œ.Ó=™.Q¨a­DŒDˆAˆaDˆD™.Ñ=Ð=ùÒ=s   ÃC)ÃC)c                ó<   € V ^8„  d   QhR\         R\        R\        /# )r   r   Úsignal_codeÚwindow©r	   r   r   )r   s   "r   r   r   +   s!   € ÷ $ñ $œ7ð $´ð $¼cñ $r    c                 óv  € V P                  \        4      P                  \        P                  V8H  4      P	                  4       pV'       g   \        R 4      h\        WP                  VP                  V4      pV UUu. uF  w  rVVNK	  	  ppp\        V4      ^8  d   R# \        P                  ! V4      # u uppi )úSignal not foundç        )r#   r   r(   r1   Úone_or_noneÚ
ValueErrorr/   r   r   ÚlenÚ
statisticsÚstdev)r   r1   r2   ÚsignalÚseriesÚ_ÚvÚvaluess   &&&     r   Úcompute_volatilityrA   +   s–   € à
‰”Óß	‰”×"Ñ" kÑ1Ó	2ß	‰‹ð ÷
 ÜÐ+Ó,Ð,ä˜R×!6Ñ!6¸×8JÑ8JÈFÓS€Fñ #Ô#™F‘DA‹a™F€FÑ#ä
ˆ6ƒ{Q„Ùä×Ò˜FÓ#Ð#ùó $s   Á=B5c                ó<   € V ^8„  d   QhR\         R\        R\        /# )r   r   Úroler2   r3   )r   s   "r   r   r   A   s!   € ÷ ñ œ7ð ¬#ð ´sñ r    c           	      óš  € V P                  \        4      P                  4       p. pV EF  pVP                  '       d$   WP                  9  d   R VP                  9  d   K9  \	        WP
                  VP                  V4      p\        V4      ^8  d   Kl  VR,          V^ ,          ,
          \        V^4      ,          pVP                  R8X  d3   V^ 8”  d,   VP                  RVP                  RVRVP                  /4       VP                  R8X  g   Kê  V^ 8  g   Kó  VP                  RVP                  RVRVP                  /4       EK!  	  V# )ÚadminÚhigher_is_worser1   ÚslopeÚpolarityÚlower_is_worseéÿÿÿÿ)r#   r   r+   Úvisible_to_rolesr/   r   r   r9   ÚmaxrH   Úappendr1   )r   rC   r2   ÚsignalsÚresultsÚsr@   rG   s   &&&     r   Údetect_degradationrQ   A   s  € Øh‰h”vÓ×"Ñ"Ó$€GØ€GäˆØ××Ð $×.@Ñ.@Ô"@ÀWÐTU×TfÑTfÔEfÙä  ×%5Ñ%5°q·}±}ÀfÓMˆÜˆv‹;˜Œ?Ùà˜•˜f QiÕ'¬3¨v°q«>Õ9ˆà:‰:Ð*Ô*¨u°q¬yØN‰N˜M¨1¯=©=¸'À5È*ÐVW×V`ÑV`ÐaÔbà:‰:Ð)Ö)¨e°a®iØN‰N˜M¨1¯=©=¸'À5È*ÐVW×V`ÑV`Ða×bñ ð  €Nr    c                ó0   € V ^8„  d   QhR\         R\        /# )r   r   r   )r	   r   )r   s   "r   r   r   Y   s   € ÷ 9ñ 9œð 9´#ñ 9r    c                 ó  € V P                  \        4      P                  \        P                  V8H  \        P                  R 8H  4      P                  4       p. pV Fn  p\        V VVP                  ^R7      pV'       g   K&  V^ ,          p\        V\        4      '       d
   V^ ,          pVf   KT  VP                  \        V4      4       Kp  	  V'       g   R# \        RR\        V4      \        V4      ,          ,
          4      # )Úyi)r   ç      Y@r6   )r#   r   r(   r   Úsignal_typer+   r/   r   Ú
isinstanceÚtuplerM   r   rL   Úsumr9   )r   r   rN   r@   rP   r=   Úvalues   &&     r   Úcomponent_healthr[   Y   sÐ   € à
‰”Óß	‰Ü×!Ñ! ^Ñ3Ü×Ñ $Ñ&ó

÷ 
‰‹ð ð €FãˆÜ ØØØM‰MØô	
ˆ÷ ‰6Ø˜1•IˆEÜ˜%¤×'Ò'Ø˜aàÔ Ø—‘œe E›lÖ+ñ ÷ ÙäˆsEœS ›[¬3¨v«;Õ6Õ7Ó8Ð8r    c                ó$   € V ^8„  d   QhR\         /# )r   r   r   )r   s   "r   r   r   |   s   € ÷ )ñ )”gñ )r    c                óp  € V P                  \        P                  \        P                  ! \        P
                  4      4      P                  \        P                  R8H  4      P                  \        P                  4      P                  4       pV UUu/ uF  w  r#W#bK	  	  pppVP                  R^ 4      pVP                  R^ 4      pWV,           pV^ 8X  d   RRRR/# \        RV^,          V,           \        V^,          ^4      ,          4      pVR	8”  d   R
M
VR8”  d   RMRp	R\        V^4      RV	/# u uppi )zV
Compute global health dynamically from OPEN alerts.
No system_health table required.
ÚOPENÚcriticalÚwarningÚcollapse_riskr6   ÚstatusÚSTABLEg      ð?gffffffæ?ÚCRITICALç333333Ó?ÚDEGRADED)r#   r   Úseverityr   ÚcountÚidr(   rb   Úgroup_byr+   ÚgetÚminrL   Úround)
r   r-   ÚsevÚcntÚcountsr_   r`   Útotalra   rb   s
   &         r   Úglobal_healthrr   |   s   € ð 	‰Ü×ÑÜJŠJ”z—}‘}Ó%ó	
÷ 
‰”
×!Ñ! VÑ+Ó	,ß	‰”*×%Ñ%Ó	&ß	‰‹ð 	ñ (,Ô,¡t™8˜3ˆcŠh¡t€FÑ,àz‰z˜* aÓ(€HØj‰j˜ AÓ&€GàÕ€Eà„zà˜SØhð
ð 	
ô ˜˜h¨l¨WÕ4¼¸EÀA½IÀqÓ8IÕIÓJ€Mð $ cÔ)‰
Ø(¨3Ô.‰ZØð ð 	œ˜}¨aÓ0Ø&ðð ùó- -s   ÂD2c                óR   € V ^8„  d   QhR\         R\        \        \        3,          /# )r   r   r   )r	   r   r   r   )r   s   "r   r   r   «   s&   € ÷ Hñ H”Wð H¤¤c¬3 h¥ñ Hr    c                 óŠ  € V P                  \        P                  ! \        P                  4      4      P                  4       ;'       g    ^ pV P                  \        P                  ! \        P                  4      \        P                  ! \        P                  4      4      P                  4       w  r#V P                  \        P                  ! \        P                  ! \        P                  4      4      4      P                  4       ;'       g    ^ pV P                  \        P                  \        P                  ! \        P                  4      4      P                  \        P                  4      P                  4       pV UUu/ uF  w  rgVf   K  V\        V4      bK  	  pppV P                  \        P                  ! \        P                   4      4      P                  4       ;'       g    ^ p	V P                  \        P"                  \        P                  ! \        P                   4      4      P                  \        P"                  4      P                  4       p
V
 UUu/ uF  w  r{T;'       g    R\        V4      bK  	  pppV P                  \        P$                  \        P                  ! \        P                   4      4      P                  \        P$                  4      P                  4       pV UUu/ uF  w  rëT;'       g    R\        V4      bK  	  ppp/ pV P                  \        P&                  4      P                  4        F;  pV^ ,          ;'       g    . pV F  pVP)                  V^ 4      ^,           VV&   K!  	  K=  	  V P                  \        P                  ! \*        P                  4      4      P                  4       ;'       g    ^ pV P                  \        P                  ! \        P                  ! \*        P                   4      4      4      P                  4       ;'       g    ^ pV	'       d   \-        VV	,          4      MRpV P                  \        P                  ! \.        P                  4      4      P                  4       ;'       g    ^ pV P                  \.        P0                  \        P                  ! \.        P                  4      4      P                  \.        P0                  4      P                  4       pV UUu/ uF  w  ppT;'       g    R\        V4      bK  	  pppV P                  \.        P2                  \        P                  ! \.        P                  4      4      P                  \.        P2                  4      P                  4       pV UUu/ uF  w  ppT;'       g    R\        V4      bK  	  pppRR\        V4      R\        V4      RRVRV/R	V/R
R\        V	4      RVRVRV/RR\        V4      R\        V4      RV/RR\        V4      RVRV//# u uppi u uppi u uppi u uppi u uppi )r   Úunknownr6   Ú	ingestionÚ
total_rowsÚ
componentsÚ
tick_rangeÚmin_tickÚmax_tickÚlatest_tick_by_componentrN   Útotal_signalsÚby_typeÚ	by_familyÚby_role_visibilityÚrulesÚtotal_rulesÚsignals_with_ruleÚrule_coverage_ratioÚeventsÚtotal_eventsÚby_severityÚ	by_status)r#   r   rh   r   ri   Úscalarrl   r$   rL   ÚoneÚdistinctr   rj   r+   r   r   r1   rV   ÚfamilyrK   rk   r   r   r   rg   rb   )r   rw   Útick_minÚtick_maxÚcomponents_countÚlatest_ticksÚcÚtr|   r}   Úby_type_rowsro   r~   Úby_family_rowsÚfr   Úrole_countsrP   Úrolesr.   r‚   rƒ   Úcoverage_ratior†   Úby_sev_rowsr‡   Úby_status_rowsrˆ   s   &                           r   Úsystem_statsr›   «   sœ  € à—‘œ$Ÿ*š*¤_×%7Ñ%7Ó8Ó9×@Ñ@ÓB×GÐGÀa€JàŸ™ÜŠ”×%Ñ%Ó&ÜŠ”×%Ñ%Ó&ó÷ 
cƒeñ €Hð
 —x‘x¤§
¢
¬4¯=ª=¼×9WÑ9WÓ+XÓ YÓZ×aÑaÓc×hÐhÐghÐà—8‘8Ü×&Ñ&ÜŠ”×%Ñ%Ó&ó÷ hŒ×-Ñ-Ó.¯s©s«uð ñ
 7CÔT±l©d¨aÀa¤	 ¤3 q£6¢	±lÐÑTð —H‘HœTŸZšZ¬×(:Ñ(:Ó;Ó<×CÑCÓE×JÐJÈ€Mà—8‘8œF×.Ñ.´·
²
¼6×;MÑ;MÓ0NÓO×XÑXÔY_×YkÑYkÓl×pÑpÓr€LÙ6BÔC±l©F¨Aˆq~ˆ~Iœs 3›xÒ'±l€GÑCà—X‘XœfŸm™m¬T¯ZªZ¼×8JÑ8JÓ-KÓL×UÑUÔV\×VcÑVcÓd×hÑhÓj€NÙ8FÔG¹©f¨a—i¤ S£Ò)¹€IÑGð #%€KØX‰X”f×-Ñ-Ó.×2Ñ2Ö4ˆØ!•—

˜ˆÛˆAØ(Ÿ_™_¨Q°Ó2°QÕ6ˆK˜‹Nó ñ 5ð —(‘(œ4Ÿ:š:¤i§l¡lÓ3Ó4×;Ñ;Ó=×BÐBÀ€KØŸ™¤§¢¬D¯MªM¼)×:OÑ:OÓ,PÓ!QÓR×YÑYÓ[×`Ð`Ð_`ÐßAN”UÐ,¨}Õ<Ô=ÐTW€Nð —8‘8œDŸJšJ¤z§}¡}Ó5Ó6×=Ñ=Ó?×DÐDÀ1€Là—(‘(œ:×.Ñ.´·
²
¼:¿=¹=Ó0IÓJ×SÑSÔT^×TgÑTgÓh×lÑlÓn€KÙ:EÔF¹+±°°31—>>˜	¤3 s£8Ò+¹+€KÑFà—X‘Xœj×/Ñ/´·²¼J¿M¹MÓ1JÓK×TÑTÔU_×UfÑUfÓg×kÑkÓm€NÙ8FÔG¹©f¨a°—i¤ S£Ò)¹€IÑGð 	Øœ#˜j›/Øœ#Ð.Ó/Ø˜: x°¸XÐFØ&Ð(@ð	
ð 	ØœS Ó/ØwØ˜Ø  +ð	
ð 	Øœ3˜{Ó+Ø¤Ð%6Ó!7Ø! >ð
ð
 	ØœC Ó-Ø˜;Ø˜ð
ð%ð ùóC  Uùó Dùó Hùó& Gùó Hs<   ÆX'ÆX'É X-É0X-Ë6X3ÌX3ÔX9ÔX9Ö"X?Ö3X?c                ó¢   € V ^8„  d   QhR\         R\        \        ,          R\        \        ,          R\        R\        \        \
        3,          /# )r   r   Ú	from_tickÚto_tickr   r   )r	   r   r   r   r   r   )r   s   "r   r   r   ö   sQ   € ÷ Uñ UÜðUäœ}ðUô ”c]ðUô ð	Uô
 
Œ#Œsˆ(…^ñUr    c           !      ó
  € V P                  \        4      pVe#   VP                  \        P                  V8¬  4      pVe#   VP                  \        P                  V8*  4      pVP                  4       p\        VP                  \        P                  \        P
                  ! \        P                  4      4      P                  \        P                  4      P                  4       4      pVP                  4        UUu/ uF  w  rxT;'       g    R\        V4      bK  	  ppp\        VP                  \        P                  \        P
                  ! \        P                  4      4      P                  \        P                  4      P                  4       4      p	V	P                  4        UUu/ uF  w  rxT;'       g    R\        V4      bK  	  p	ppVP                  \        P                   \        P
                  ! \        P                  4      P#                  R4      4      P                  \        P                   4      P%                  \'        R4      4      P)                  V4      P                  4       p
VP                  \        P*                  \        P
                  ! \        P                  4      P#                  R4      4      P                  \        P*                  4      P%                  \'        R4      4      P)                  V4      P                  4       pVP                  \        P                  R8H  4      pVP                  \        P                  \        P                   \        P*                  \        P                  \        P                  \        P                  \        P                  \        P                  ,
          P#                  R4      4      P%                  \'        R4      4      P)                  V4      P                  4       pRRVR	V/R
R\        V4      /RTRT	RV
 UUu. uF  w  rïRT;'       g    RR\        V4      /NK   	  uppRV UUu. uF  w  ppRT;'       g    RR\        V4      /NK!  	  uppRV Uu. uFc  pR\        V^ ,          4      RV^,          RV^,          RV^,          RV^,          RV^,          RV^,          e   \        V^,          4      MR /NKe  	  up/# u uppi u uppi u uppi u uppi u upi )Nru   ro   zcnt DESCr^   Úduration_tickszduration_ticks DESCr2   r   rž   Útotalsr†   r‡   rˆ   Útop_componentsÚkeyrh   Útop_signalsÚlongest_openÚalert_event_idr   r1   rg   Ú
tick_startÚtick_end)r#   r   r(   r¨   r§   rh   ÚdictÚwith_entitiesrg   r   ri   rj   r+   Úitemsr   rb   r   Úlabelr)   r   r   r1   )r   r   rž   r   Úqr†   Úby_sevÚkr?   rˆ   r¢   r¤   Úopen_qr¥   r‘   ro   rP   r.   s   &&&&              r   Úalerts_statsr±   ö   sË  € ð 	‰”Ó€AàÒØH‰H”Z×(Ñ(¨IÑ5Ó6ˆØÒØH‰H”Z×*Ñ*¨gÑ5Ó6ˆà—7‘7“9€Lô Ø	‰œ
×+Ñ+¬T¯ZªZ¼
¿¹Ó-FÓGß	‰”*×%Ñ%Ó	&ß	‰‹ó€Fð
 28·±´Ô@±©¨ˆanˆn9œc !›fÒ$±€FÑ@äØ	‰œ
×)Ñ)¬4¯:ª:´j·m±mÓ+DÓEß	‰”*×#Ñ#Ó	$ß	‰‹ó€Ið
 5>·O±OÔ4EÔFÑ4E©D¨A—i¤ Q£Ò'Ñ4E€IÑFð 	
‰œ
×1Ñ1´4·:²:¼j¿m¹mÓ3L×3RÑ3RÐSXÓ3YÓZß	‰”*×+Ñ+Ó	,ß	‰”$zÓ"Ó	#ß	‰ˆu‹ß	‰‹ð ð 	
‰œ
×.Ñ.´·
²
¼:¿=¹=Ó0I×0OÑ0OÐPUÓ0VÓWß	‰”*×(Ñ(Ó	)ß	‰”$zÓ"Ó	#ß	‰ˆu‹ß	‰‹ð ð X‰X”j×'Ñ'¨6Ñ1Ó2€Fð 	×ÑÜM‰MÜ×%Ñ%Ü×"Ñ"Ü×ÑÜ×!Ñ!Ü×ÑÜ× Ñ ¤:×#8Ñ#8Õ8×?Ñ?Ð@PÓQó	
÷ 
‰”$Ð,Ó-Ó	.ß	‰ˆu‹ß	‰‹ð ð  	; 	¨9°gÐ>Ø>¤3 |Ó#4Ð5ØvØYØÑTbÔcÑTbÉ&È!˜E 1§> >¨	°7¼CÀ»HÓEÑTbÒcØÑQ\Ô]ÑQ\ÁvÀqÈ#˜ §  Y°¼¸S»ÓBÑQ\Ò]Øñ "ó
ñ "ð !¤# a¨¥d£)Ø  ! A¥$Ø˜q tØ˜A˜aDØ˜a dØ˜A˜aDØ ¨q°­tÒ/?¤# a¨¥d¤)ÀTóñ "ñ
ðð ùó[ Aùó GùóV dùÛ]ùò
s7   Ã;S*ÄS*Æ(S0Æ8S0Ð#S6Ð4S6ÑS<Ñ"S<Ñ=A)Tc                ó^   € V ^8„  d   QhR\         R\        R\        \        \        3,          /# )r   r   r   r   ©r	   r   r   r   r   )r   s   "r   r   r   N  s)   € ÷ 6&ñ 6&œ7ð 6&¬3ð 6&¼¼SÄ#¸X½ñ 6&r    c                 ó‚  € V P                  \        P                  4      P                  4       P	                  4       pV Uu. uF&  q3'       g   K  V^ ,          '       g   K  V^ ,          NK(  	  pp. pV EF*  p\        \        W4      4      pV P                  \        P                  ! \        P                  4      4      P                  \        P                  V8H  \        P                  R8H  4      P                  4       ;'       g    ^ pV P                  \        P                  ! \        P                  4      4      P                  \        P                  V8H  \        P                  R8H  \        P                  R8H  4      P                  4       ;'       g    ^ pV P                  \        P                  ! \        P                  4      4      P                  \        P                  V8H  \        P                  R8H  \        P                  R8H  4      P                  4       ;'       g    ^ p	VR,          V	R,          ,           \        RRV,
          R,          4      ,           p
VP!                  R	VR
VR\#        V4      R\#        V4      R\#        V	4      R\        V
4      /4       EK-  	  VP%                  R RR7       RVRV /# u upi )r   r^   r_   r`   g      @g      ø?r6   rU   ç      $@r   Úhealth_scoreÚopen_alertsÚcritical_open_alertsÚwarning_open_alertsÚ
risk_scorec                 ó   € V R ,          # )rº   © ©Úxs   &r   Ú<lambda>Ú$component_rankings.<locals>.<lambda>ƒ  s   € ˜a žor    T©r£   ÚreverseÚrankedN)r#   r   r   r‹   r+   r   r[   r   rh   r   ri   r(   rb   r‰   rg   rL   rM   r   Úsort)r   r   rx   r‘   rÃ   ÚcompÚhealthÚopen_eventsÚcritical_openÚwarning_openrº   s   &&         r   Úcomponent_rankingsrÊ   N  s;  € Ø—‘œ&×/Ñ/Ó0×9Ñ9Ó;×?Ñ?ÓA€JÙ *Ó9¡
˜1«a”$°A°a·D±D”$!A—$$¡
€JÐ9à€FäˆÜÔ'¨Ó1Ó2ˆð H‰H”T—Z’Z¤
§¡Ó.Ó/ß‰V”J×-Ñ-°Ñ5´z×7HÑ7HÈFÑ7RÓSß‰V‹X÷ð ð ð	 	ð H‰H”T—Z’Z¤
§¡Ó.Ó/ß‰VÜ×)Ñ)¨TÑ1Ü×!Ñ! VÑ+Ü×#Ñ# zÑ1ó÷
 ‰V‹X÷ð ð ð 	ð H‰H”T—Z’Z¤
§¡Ó.Ó/ß‰VÜ×)Ñ)¨TÑ1Ü×!Ñ! VÑ+Ü×#Ñ# yÑ0ó÷
 ‰V‹X÷ð ð ð 	ð $ cÕ)¨l¸SÕ.@ÕAÄCÈÈeÐV\ÍnÐ`dÕMdÓDeÕeˆ
à‰Ø˜dØ˜FØœ3˜{Ó+Ø"¤C¨Ó$6Ø!¤3 |Ó#4Øœ% 
Ó+ð
÷ 	ñM ð^ ‡KKÑ-°t€KÔ<Øf˜V˜enÐ%Ð%ùòi :s   Á 	J<ÁJ<ÁJ<c          
      ój   € V ^8„  d   QhR\         R\        R\        R\        \        \        3,          /# )r   r   Úwindow_ticksr   r   r³   )r   s   "r   r   r   ‡  s9   € ÷ >Lñ >Lœð >L¬sð >LÄð >LÌdÔSVÔX[ÐS[Ínñ >Lr    c                 óB  € V P                  \        P                  ! \        P                  4      4      P                  4       pVf   RVR. /# \        V4      \        V4      ,
          ^,           p\        V P                  \        P                  \        P                  ! \        P                  4      4      P                  \        P                  V8¬  \        P                  \        V4      8*  4      P                  \        P                  4      P                  4       4      pVP                  4        UUu/ uF  w  rgV\        V4      bK  	  ppp. pV P                  \        4      P                  4       p	V	 Fÿ  p
VP!                  V
P                  ^ 4      pV^ 8X  d   K(  RpV P#                  \%        V4      RV
P                  RVR\        V4      RV
P&                  /4      P                  4       ;'       g    ^ pV'       d   \)        WÛ,          4      MRpVP+                  R	V
P,                  R
V
P                  RV
P&                  R\        V4      R\        V4      R\        V4      R\)        V4      /4       EK  	  VP/                  R R7       R\        V4      RVR V /# u uppi )NrÌ   Úworstzó
            SELECT COUNT(*) AS present_count
            FROM timeseries_points
            WHERE component_code = :component
              AND tick >= :from_tick
              AND tick <= :to_tick
              AND payload ? :column
        Ú	componentr   rž   Úcolumnr6   r1   r   r   Ú total_component_points_in_windowÚpoints_with_metric_presentr˜   c                 ó   € V R ,          # )r˜   r¼   r½   s   &r   r¿   Ú!signal_coverage.<locals>.<lambda>Ä  s
   €  !Ð$4Ö"5r    )r£   )r#   r   rL   r   r$   r‰   r   r©   r   rh   ri   r(   rj   r+   r«   r   rk   Úexecuter   r   r   rM   r1   rÄ   )r   rÌ   r   r{   r   Úcomponent_pointsr‘   ro   Ú
worst_listrN   rP   rq   ÚsqlÚpresent_countÚratios   &&&            r   Úsignal_coveragerÛ   ‡  s<  € àx‰xœŸš¤×!5Ñ!5Ó6Ó7×>Ñ>Ó@€HØÒØ ¨g°rÐ:Ð:äH“¤ LÓ 1Õ1°AÕ5€Iô Ø
‰Ü×*Ñ*ÜJŠJ”×)Ñ)Ó*ó	
÷ 
‰”×$Ñ$¨	Ñ1´?×3GÑ3GÌ3ÈxË=Ñ3XÓ	Yß	‰”/×0Ñ0Ó	1ß	‰‹óÐð 3C×2HÑ2HÔ2JÔKÑ2J©¨˜œ3˜s›8šÑ2JÐÑKð
 (*€Jàh‰h”vÓ×"Ñ"Ó$€GÛˆØ ×$Ñ$ Q×%5Ñ%5°qÓ9ˆØAŒ:Ùðˆð Ÿ
™
Ü‹Ià˜Q×-Ñ-Ø˜YØœ3˜x›=Ø˜!Ÿ-™-ð	ó
÷ ‰&‹(÷ð ð ð 	÷ 16”mÕ+Ô,¸3ˆà×ÑØ˜1Ÿ=™=Ø˜a×.Ñ.Ø˜1Ÿ=™=ØœC Ó-Ø.´°E³
Ø(¬#¨mÓ*<Øœe E›lð
÷ 	ñ3 ðF ‡OOÑ5€OÔ6ØœC Ó-¨w¸
À6ÀEÐ8JÐKÐKùóY Ls   Ä2Jc                ó0   € V ^8„  d   QhR\         R\        /# )r   r   r   )r	   r   )r   s   "r   r   r   È  s   € ÷ -ñ -œð -¬ñ -r    c                 óV  € V P                  \        P                  \        P                  \        P
                  ! \        P                  4      P                  R 4      \        P                  ! \        \        P                  R8H  ^3^ R7      4      P                  R4      \        P                  ! \        \        P                  R8H  ^3^ R7      4      P                  R4      \        P                  ! \        P                  4      P                  R4      \        P                  ! \        P                  \        P                  ,
          4      P                  R4      4      P                  \        P                  R8H  4      P!                  \        P                  \        P                  4      P#                  \%        R	4      4      P'                  V4      P)                  4       pR
V Uu. uF¸  pRVP                  RVP                  R \+        VP,                  ;'       g    ^ 4      R\+        VP.                  ;'       g    ^ 4      R\+        VP0                  ;'       g    ^ 4      R\+        VP2                  ;'       g    ^ 4      R\+        VP4                  ;'       g    ^ 4      /NKº  	  up/# u upi )rÇ   r_   )Úelse_rÈ   r`   rÉ   Ú	last_tickÚmax_durationr^   zopen_events DESCÚhotspotsr1   r   Úlast_tick_seenÚmax_duration_ticks)r#   r   r1   r   r   rh   ri   r¬   rY   r   rg   rL   r¨   r§   r(   rb   rj   r)   r   r   r+   r   rÇ   rÈ   rÉ   rß   rà   )r   r   r-   r.   s   &&  r   Úactive_hotspotsrä   È  sû  € ð 	‰Ü×"Ñ"Ü×%Ñ%ÜJŠJ”z—}‘}Ó%×+Ñ+¨MÓ:äHŠHÜÜ×(Ñ(¨JÑ6¸Ð:Øôó÷
 ‰eOÓ$äHŠHÜÜ×(Ñ(¨IÑ5°qÐ9Øôó÷
 ‰eNÓ#äHŠH”Z×(Ñ(Ó)×/Ñ/°Ó<ÜHŠH”Z×(Ñ(¬:×+@Ñ+@Õ@ÓA×GÑGÈÓWó)	
÷, 
‰”
×!Ñ! VÑ+Ó	,ß	‰”*×(Ñ(¬*×*CÑ*CÓ	Dß	‰”$Ð)Ó*Ó	+ß	‰ˆu‹ß	‰‹ð7 	ð> 	ñ ó
ñ ð ˜qŸ}™}Ø  !×"2Ñ"2Øœs 1§=¡=×#5Ð#5°AÓ6Ø¤ Q§_¡_×%9Ð%9¸Ó!:Ø¤ A§N¡N×$7Ð$7°aÓ 8Ø ¤# a§k¡k×&6Ð&6°QÓ"7Ø$¤c¨!¯.©.×*=Ð*=¸AÓ&>óñ ñ
ðð ùò
s$   Ç$5J&ÈJ&È9J&ÉJ&É7J&ÊJ&c          
      ój   € V ^8„  d   QhR\         R\        R\        R\        \        \        3,          /# )r   r   r   Ú	max_ticksr   ©r	   r   r   r   r   )r   s   "r   r   r   ÷  s>   € ÷ ñ Üðäðô ðô 
Œ#Œsˆ(…^ñ	r    c                ó¸  € V P                  \        P                  4      P                  \        P                  V8H  4      P                  \        P                  4      P                  V4      P                  4       pV Uu. uF  qD^ ,          NK  	  ppV'       g   RVR. /# / pV EF›  pV P                  \        P                  ! \        P                  4      4      P                  \        P                  V8H  \        P                  R8H  \        P                  V8*  \        P                  V8¬  4      P                  4       ;'       g    ^ pV P                  \        P                  ! \        P                  4      4      P                  \        P                  V8H  \        P                  R8H  \        P                   R8H  \        P                  V8*  \        P                  V8¬  4      P                  4       ;'       g    ^ p\#        W4      pVR,          VR,          ,           RV,
          R,          ,           p	R	V	R
VRVRV/WT&   EKž  	  . p
RV^ ,          RV^ ,          R. /pWS^ ,          ,          R	,          pV Fe  pWT,          R	,          p\%        WÜ,
          4      ^8”  d   V
P'                  V4       RVRVR. /pWKR&   VR,          P'                  WT,          4       TpKg  	  V
P'                  V4       . pV
 FÜ  pVR,          p\)        R V 4       4      \+        V4      ,          p\-        R V 4       4      p\)        R V 4       4      \+        V4      ,          pV^ 8”  g   V^<8”  d   RpMV^8”  d   RpMRpVP'                  RVR,          RVR,          RVR,          VR,          ,
          ^,           R\/        V^4      R\/        V^4      RVRV/4       KÞ  	  RVRV/# u upi )zi
Adaptive time-interval analysis for a component.
Automatically segments time based on behavior changes.
r   Ú	intervalsr^   r_   rµ   g       @rU   re   Ústressr·   Úcritical_alertsrÆ   Ú
start_tickÚend_tickÚsamplesc              3   ó2   "  € T F  qR ,          x € K  	  R# 5i)rê   Nr¼   ©Ú.0r¾   s   & r   Ú	<genexpr>Ú*component_time_analysis.<locals>.<genexpr>^  ó   é € Ð6©g¨˜8Ÿš«gùó   ‚c              3   ó2   "  € T F  qR ,          x € K  	  R# 5i)rë   Nr¼   rð   s   & r   rò   ró   _  s   é € ÐA¹°AÐ.×/Ò/»ùrõ   c              3   ó2   "  € T F  qR ,          x € K  	  R# 5i)rÆ   Nr¼   rð   s   & r   rò   ró   `  rô   rõ   ÚBADrf   ÚGOODr    Ú
avg_healthÚ
avg_stressÚmax_critical_alertsrb   )r#   r   r$   r(   r   r)   r   r+   r   rh   r   ri   rb   r§   r¨   r‰   rg   r[   ÚabsrM   rY   r9   rL   rm   )r   r   ræ   Úticksr’   Ústress_by_tickr·   rë   rÆ   rê   ré   ÚcurrentÚlast_stressrP   ÚanalyzedÚirî   rû   Úmax_criticalrú   rb   s   &&&                  r   Úcomponent_time_analysisr  ÷  sœ  € ð 	‰”×%Ñ%Ó&ß	‰”×.Ñ.°.Ñ@Ó	Aß	‰”/×&Ñ&Ó	'ß	‰ˆyÓ	ß	‰‹ð 
ñ !Ó!™5aˆqTˆT™5€EÐ!çØ  .°+¸rÐBÐBð €Näˆð H‰H”T—Z’Z¤
§¡Ó.Ó/ß‰VÜ×)Ñ)¨^Ñ;Ü×!Ñ! VÑ+Ü×%Ñ%¨Ñ*Ü×#Ñ# qÑ(ó	÷ ‰V‹X÷ð ð ð 	ð H‰H”T—Z’Z¤
§¡Ó.Ó/ß‰VÜ×)Ñ)¨^Ñ;Ü×!Ñ! VÑ+Ü×#Ñ# zÑ1Ü×%Ñ%¨Ñ*Ü×#Ñ# qÑ(ó÷ ‰V‹X÷	ð 	ð ð 	ô " "Ó5ˆð ˜dÕ"Ø˜CÕõ àv~ Õ$õ%ð 	ð fØ˜;Ø˜Øfð	
ˆÔñK ðZ €Iàe˜A•hØE˜!•HØ2ð€Gð ! q¥Õ*¨8Õ4€KãˆØÕ˜hÕ'ˆô ˆqÓ "Ô$Ø×Ñ˜WÔ%à˜aØ˜AØ˜2ðˆGð  
ÑØ	Õ×!Ñ! .Õ"3Ô4ØŠñ ð  ×ÑWÔð €HãˆØI•,ˆÜÑ6©gÓ6Ó6¼¸W»ÕEˆ
ÜÑA¹ÓAÓAˆÜÑ6©gÓ6Ó6¼¸W»ÕEˆ
à˜!Ô˜z¨BœØ‰FØ˜"Œ_Ø‰FàˆFà‰Ø˜!˜L/Ø˜˜*Ø˜a 
m¨a°­oÕ=ÀÕAØœ% 
¨AÓ.Øœ% 
¨AÓ.Ø! <Øfð
ö 	ñ ð0 	˜.ØXðð ùòU "s   Á>Oc                 óö  € V P                  \        P                  \        P                  V,          P                  P                  \        4      4      P                  \        P                  V8H  4      P                  \        P                  P                  4       4      P                  V4      P                  4       p\        V4       UUu. uF!  w  rVVf   K  \        V4      \        V4      3NK#  	  pppV# u uppi ©N)r#   r   r$   r%   r&   r'   r
   r(   r   r)   r*   r   r+   r,   r   r   )r   r   r   r   r-   r’   r?   s   &&&&   r   r/   r/     s´   € à
‰Ü× Ñ Ü×#Ñ# KÕ0×7Ñ7×<Ñ<¼UÓCó	
÷ 
‰”×.Ñ.°.Ñ@Ó	Aß	‰”/×&Ñ&×+Ñ+Ó-Ó	.ß	‰ˆu‹ß	‰‹ð 	ô ,4°D¬>ÔK©>¡4 1¸QÔŒS‹V”U˜1“XÓ©>€DÑKØ€Kùó Ls   Ã	C5ÃC5c                ó\   € V ^8„  d   QhR\         \        ,          R\         \        ,          /# )r   ÚxsÚys)r   r   r   )r   s   "r   r   r     s"   € ÷ ñ œœcð ¬¬U­ñ r    c                óN  aa€ \        V 4      pV^8  d   RV'       d   VR,          3# R3# \        V 4      V,          o\        V4      V,          o\        VV3R l\        W4       4       4      p\        V3R lV  4       4      pV^ 8w  d	   W4,          MRpSVS,          ,
          pWV3# )zF
Simple least-squares linear regression.
Returns slope and intercept.
r6   c              3   óV   <"  € T F  w  rVS,
          VS,
          ,          x € K   	  R # 5ir  r¼   )rñ   r¾   ÚyÚx_meanÚy_means   &  €€r   rò   Ú#_linear_forecast.<locals>.<genexpr>œ  s#   øé € ÐB±k©d¨aˆq6z˜a &j×)Ò)³kùs   ƒ&)c              3   óB   <"  € T F  qS,
          ^,          x € K  	  R# 5i)r   Nr¼   )rñ   r¾   r  s   & €r   rò   r    s   øé € Ð,© A6z˜a×Ò«ùs   ƒrJ   )r9   rY   Úzip)	r	  r
  ÚnÚnumÚdenrG   Ú	interceptr  r  s	   &&     @@r   Ú_linear_forecastr    s’   ù€ ô
 	ˆB‹€AØˆ1„uØŸbBr•FÐ)Ð) cÐ)Ð)ä‹Wq[€FÜ‹Wq[€Fä
ÕB´c¸"´kÓBÓ
B€CÜ
Ô,©Ó,Ó
,€Cà œˆCŽI s€EØ˜ Õ'€IØÐÐr    c                óv   € V ^8„  d   QhR\         R\        R\        R\        R\        \        \        3,          /# )r   r   r1   Úhorizon_ticksÚhistory_ticksr   rç   )r   s   "r   r   r   ¨  sI   € ÷ añ aÜðaäðaô ðaô ð	aô
 
Œ#Œsˆ(…^ñar    c                ó   € V P                  \        4      P                  \        P                  V8H  4      P	                  4       pV'       g   \        R4      h\        V VP                  VP                  V4      p\        V4      ^
8  d   RVRR/# V UUu. uF  w  rgVNK	  	  pppV UU	u. uF  w  ryV	NK	  	  p
pp	\        WŠ4      w  r¼\        V
4      ^8¼  d   \        P                  ! V
4      MRpVR",          pV
R",          p. p\        ^V^,           4       FQ  pVV,           pVV,          V,           pVP                  RVRVRV^V,          ,
          R	V^V,          ,           /4       KS  	  V P                  \        4      P                  \        P                  V8H  4      P                  \        P                   R
8H  4      P#                  4       pRpRpV'       dy   V Fl  pVR,          p	VP$                  R8X  d   V	VP&                  8”  d   RpVR,          p M5VP$                  R8X  g   KN  V	VP&                  8  g   Ka  RpVR,          p M	  Vf   RpRTRVP                  RVP(                  RVP*                  R\        V4      RTRTRTRRTRV^ 8”  d   RM
V^ 8  d   RMR/RTRTRRTR TR!V'       d   VP&                  //# R//# u uppi u up	pi )#z%
Forecast next N ticks for a signal.
r5   r1   rb   ÚINSUFFICIENT_DATAr6   r$   Úexpectedrl   rL   TNÚgtÚLIKELYÚltÚUNLIKELYr   rV   rH   Úhistory_ticks_usedr  rß   Ú
last_valueÚtrendÚslope_per_tickÚ	directionÚUPÚDOWNÚFLATÚ
volatilityÚforecastÚ
risk_aheadÚbreach_tickÚrule_thresholdrJ   )r#   r   r(   r1   r7   r8   r/   r   r   r9   r  r:   r;   ÚrangerM   r   ÚenabledÚfirstÚoperatorÚ	thresholdrV   rH   )r   r1   r  r  r<   r=   r’   r>   rþ   r?   r@   rG   r  r*  rß   r#  Úpredictionsr  Úfuture_tickÚmeanÚruler,  r-  Úps   &&&&                    r   Úforecast_signalr9  ¨  sÐ  € ð 	‰”Óß	‰”×"Ñ" kÑ1Ó	2ß	‰‹ð ÷
 ÜÐ+Ó,Ð,äØ
Ø×ÑØ×ÑØó	€Fô ˆ6ƒ{RÔà˜;ØÐ)ð
ð 	
ñ
 "Ô"™6‘41‹Q™6€EÑ"Ù"Ô#™F‘DA‹a™F€FÑ#ä'¨Ó6Ñ€EÜ-0°«[¸AÔ-=”×!Ò! &Ô)À3€Jàb•	€IØ˜•€Jà€KÜ1m aÕ'Ö(ˆØ !•mˆØ{Õ" YÕ.ˆØ×ÑØKØ˜Ø4˜!˜j.Õ(Ø4˜!˜j.Õ(ð	
ö 	ñ )ð 	‰”Óß	‰”	×%Ñ%¨Ñ4Ó	5ß	‰”	×!Ñ! TÑ)Ó	*ß	‰‹ð	 	ð €JØ€KçÛˆAØ*•ˆAØ}‰} Ô$¨¨T¯^©^Ô);Ø%
Ø iÙØ}‰} Ö$¨¨T¯^©^Ö);Ø%
Ø iÙñ ð ÒØ#ˆJð 	{Ø˜&×/Ñ/Øv×)Ñ)ØF—O‘OØœc &›kØ˜ØYØjØØ˜eØ ¨¤™¸%À!¼)±Èð
ð 	jØKØØjØ˜;Ø·˜dŸn™nð
ðð ð$ ;?ð
ðð ùó] #ùÛ#s   ÂKÂ)K
c          
      ój   € V ^8„  d   QhR\         R\        R\        R\        \        \        3,          /# )r   r   r   r  r   rç   )r   s   "r   r   r     s8   € ÷ 0ñ 0Üð0äð0ô ð0ô 
Œ#Œsˆ(…^ñ	0r    c           
     ó6  € V P                  \        4      P                  \        P                  V8H  4      P	                  4       p. p. pV F€  p \        V VP                  VR7      pTP                  R/ 4      P                  R4      R8X  d.   TP                  RTP                  RTR,          R,          /4       TP                  T4       K‚  	  Rp\        V4      ^ 8”  d   Rp\        V4      ^8”  d   R	pR
VRVRVR\        V4      RV/#   \         d     KÍ  i ; i)z$
Forecast component health & risks.
)r  r,  rb   r  r1   r-  rc   rf   rd   r   r  Úpredicted_statusÚrisky_signals_countÚrisky_signals)r#   r   r(   r   r+   r9  r1   Ú	Exceptionrk   rM   r9   )	r   r   r  rN   Ú	forecastsr>  rP   r•   rb   s	   &&&      r   Úforecast_componentrA    s&  € ð 	‰”Óß	‰”×%Ñ%¨Ñ7Ó	8ß	‰‹ð ð €IØ€Mãˆð	ÜØØ—‘Ø+ôˆAð 5‰5˜rÓ"×&Ñ& xÓ0°HÔ<Ø× Ñ Ø˜qŸ}™}Ø˜q ¨}Õ=ð"ô ð
 	×Ñ˜Öñ! ð$ €FÜ
ˆ=Ó˜AÔØˆÜ
ˆ=Ó˜AÔØˆð 	˜.Ø˜Ø˜FØœs =Ó1Ø˜ðð øô# ô 	Úð	ús   ÁD	Ä	DÄDc                óH   € V ^8„  d   QhR\         R\        R\        R\        /# )r   r   r   r2   Úbucket_sizer3   )r   s   "r   r   r   F  s6   € ÷ Qñ QÜðQäðQô ðQô ñ	Qr    c                óŠ  € V P                  \        P                  ! \        P                  4      4      P                  \        P                  V8H  4      P                  4       pVf   RVR. /# \        ^ WB,
          4      p. p\        WTV4       EF*  pWs,           ^,
          pV P                  \        P                  ! \        P                  4      4      P                  \        P                  V8H  \        P                  V8*  \        P                  V8¬  4      P                  4       ;'       g    ^ p	. p
V P                  \        P                  4      P                  \        P                  V8H  \        P                  V8¬  \        P                  V8*  4      P                  R4      P!                  4       pV Fl  w  p\#        V\$        4      '       g   K  VP'                  4        F;  p\#        V\(        \*        34      '       g   K!  V
P-                  \+        V4      4       K=  	  Kn  	  \/        V
4      ^8¼  d   \0        P2                  ! V
4      MRpV	^ 8X  d   V^8  d   RpM$V	^8  d   V^8  d   RpMV	^8¼  g   V^8¼  d   RpMRpVP-                  R	VR
VRVR\)        V	4      R\5        \+        V4      ^4      /4       EK-  	  RVRVRVRV/# )zD
Splits time into buckets and classifies each bucket into a regime.
r   Úregimeséô  r6   rc   rf   ÚUNSTABLEÚUNKNOWNr   rž   ÚregimeÚalert_countÚavg_volatilityrÌ   rC  )r#   r   rL   r   r$   r(   r   r‰   r/  rh   r   ri   r§   r¨   r%   r   r+   rW   r©   r@   r   r   rM   r9   r:   r;   rm   )r   r   r2   rC  r{   rì   rE  Úbucket_startÚ
bucket_endrJ  r@   r-   r%   r?   r*  rI  s   &&&&            r   Úcomponent_regimesrN  F  sb  € ð 	‰”—’œ/×.Ñ.Ó/Ó0ß	‰”×.Ñ.°.Ñ@Ó	Aß	‰‹ð ð ÒØ  .°)¸RÐ@Ð@äQ˜Õ)Ó*€JØ€Gä˜j°K×@ˆØ!Õ/°!Õ3ˆ
ð H‰H”T—Z’Z¤
§¡Ó.Ó/ß‰VÜ×)Ñ)¨^Ñ;Ü×%Ñ%¨Ñ3Ü×#Ñ# |Ñ3ó÷
 ‰V‹X÷ð ð ð 	ð ˆàH‰H”_×,Ñ,Ó-ß‰VÜ×.Ñ.°.Ñ@Ü×$Ñ$¨Ñ4Ü×$Ñ$¨
Ñ2ó÷
 ‰U3‹Zß‰S‹Uð 	ó ‰JˆWÜ˜'¤4×(Ô(Ø Ÿ™Ö)AÜ! !¤c¬5 \×2Ô2ØŸ™¤e¨A£hÖ/ó *ñ ô 25°V³ÀÔ1A”Z×%Ò% fÔ-Àsˆ
ð ˜!Ô 
¨Q¤Ø‰FØ˜1Œ_ ¨a¤Ø‰FØ˜AÔ ¨q¤Ø‰FàˆFà‰Ø˜ØzØfØœ3˜{Ó+Øœe¤E¨*Ó$5°qÓ9ð
÷ 	ñ] Aðn 	˜.Ø˜Ø{Ø7ð	ð r    c                óH   € V ^8„  d   QhR\         R\        R\        R\        /# )r   r   r1   r2   Ú
lag_windowr3   )r   s   "r   r   r   š  s0   € ÷ ;ñ ;Üð;äð;ô ð;ô ñ	;r    c           
     óR  € V P                  \        4      P                  \        P                  V8H  4      P	                  \        P
                  4      P                  4       pV'       g	   RVR. R. /# \        \        4      p\        \        4      pV Fû  pVP
                  pV P                  \        4      P                  \        P
                  Wƒ,
          8¬  \        P
                  Wƒ,           8*  \        P                  V8g  4      P                  4       p	V	 Fs  p
V
P
                  V,
          pV^ 8  d-   WZP                  ,          P                  \        V4      4       KI  V^ 8”  g   KR  WjP                  ,          P                  V4       Ku  	  Ký  	  R pRVRVRV! V4      RV! V4      /# )z;
Finds signals that tend to lead or follow a given signal.
r1   ÚleadsÚfollowsc                 ó   € . pV P                  4        FZ  w  r#\        V4      ^8¼  g   K  VP                  RVR\        \	        V4      \        V4      ,          ^4      R\        V4      /4       K\  	  \        VR RR7      # )é   r1   Ú	avg_ticksÚoccurrencesc                 ó   € V R ,          # )rW  r¼   r½   s   &r   r¿   Ú5signal_influence.<locals>.summarize.<locals>.<lambda>Î  s	   € ¨¨=Ö)9r    TrÁ   )r«   r9   rM   rm   rY   Úsorted)ÚdÚoutr¯   Úvalss   &   r   Ú	summarizeÚ#signal_influence.<locals>.summarizeÅ  sn   € ØˆØ—w‘w–y‰GˆAÜ4‹y˜AŽ~Ø—
‘
Ø! 1Ø¤¤s¨4£y´3°t³9Õ'<¸aÓ!@Ø!¤3 t£9ðö ñ !ô cÑ9À4ÔHÐHr    Úanalysis_window)r#   r   r(   r1   r)   r§   r+   r   ÚlistrM   rý   )r   r1   r2   rP  Úbase_eventsÚlead_countsÚfollow_countsÚeÚt0Ú	neighborsr  Údeltar^  s   &&&&         r   Úsignal_influenceri  š  sZ  € ð 	‰”Óß	‰”
×&Ñ&¨+Ñ5Ó	6ß	‰”*×'Ñ'Ó	(ß	‰‹ð	 ÷ Ø˜{¨G°R¸ÀBÐGÐGäœdÓ#€KÜ¤Ó%€MãˆØ\‰\ˆð H‰H”ZÓ ß‰VÜ×%Ñ%¨­Ñ8Ü×%Ñ%¨­Ñ8Ü×&Ñ&¨+Ñ5ó÷
 ‰S‹Uð 	ó ˆAØ—L‘L 2Õ%ˆEØqŒyØŸM™MÕ*×1Ñ1´#°e³*Ö=Ø˜–ØŸm™mÕ,×3Ñ3°EÖ:ó ñ ò(	Ið 	{Ø˜6Ø‘˜;Ó'Ø‘9˜]Ó+ð	ð r    c                óH   € V ^8„  d   QhR\         R\        R\        R\        /# )r   r   r1   r2   Úbucketr3   )r   s   "r   r   r   Ø  s0   € ÷ ?ñ ?Üð?äð?ô ð?ô ñ	?r    c                 óì  € V P                  \        4      P                  \        P                  V8H  4      P	                  4       pV'       g	   R RV R2/# V P                  \
        P                  ! \        P                  4      4      P                  4       pVf   R R/# WR,
          pV P                  \        P                  \        P                  VP                  ,          P                  P                  \        4      4      P                  \        P                  VP                  8H  \        P                  V8¬  4      P!                  \        P                  4      P#                  4       p. p\%        ^ \'        V4      V4       EFU  p	WyW“,            p
V
 UUu. uF  w  r¼Vf   K  VNK  	  ppp\'        V4      ^8  d   K;  \)        V4      pTP+                  RV
^ ,          ^ ,          RV
R,          ^ ,          R\,        P.                  ! V^
R7      ^ ,          R\,        P0                  ! V4      R	\,        P.                  ! V^
R7      ^,          R
\,        P2                  ! V4      R\,        P2                  ! V4      \,        P.                  ! V^
R7      ^ ,          8  ;'       g7    \,        P2                  ! V4      \,        P.                  ! V^
R7      ^,          8„  /4       EKX  	  RVRVP                  RVRVRV/# u uppi )ÚerrorúSignal 'ú' not foundzNo timeseries datar   rž   Úp10©r  Úp50Úp90r6  Úout_of_bandr1   r   r2   rk  r=   rJ   )r#   r   r(   r1   r7   r   rL   r   r$   r‰   r%   r   r&   r'   r
   r   r)   r+   r/  r9   rZ  rM   r:   Ú	quantilesÚmedianr6  )r   r1   r2   rk  r<   r{   rì   r-   r=   r  Úchunkr>   r?   r@   Úvalues_sorteds   &&&&           r   Úsignal_envelopery  Ø  sm  € ð 	‰”Óß	‰”×"Ñ" kÑ1Ó	2ß	‰‹ð ÷
 Ø˜8 K =°Ð<Ð=Ð=àx‰xœŸš¤×!5Ñ!5Ó6Ó7×>Ñ>Ó@€HØÒØÐ-Ð.Ð.àÕ"€Jð 	‰Ü× Ñ Ü×#Ñ# F×$6Ñ$6Õ7×>Ñ>×CÑCÄEÓJó	
÷ 
‰Ü×*Ñ*¨f×.CÑ.CÑCÜ× Ñ  JÑ.ó

÷ 
‰”/×&Ñ&Ó	'ß	‰‹ð 	ð €Fä1”c˜$“i ×(ˆØ˜Ð$ˆÙ %Ô7¡™˜¨—!!¡ˆÑ7äˆv‹;˜Œ?Ùä˜v›ˆà‰Ø˜˜q !Øu˜R•y •|Ø”:×'Ò'¨¸Ô<¸QÕ?Ø”:×$Ò$ ]Ó3Ø”:×'Ò'¨¸Ô<¸QÕ?Ø”J—O’O MÓ2ØÜ—’ Ó.´×1EÒ1EÀmÐWYÔ1ZÐ[\Õ1]Ñ]÷ að aÜ—?’? =Ó1´J×4HÒ4HÈÐZ\Ô4]Ð^_Õ4`Ñ`ð
÷ 	ñ )ð. 	{Ø˜&×/Ñ/Ø&Ø&Ø&ðð ùó) 8s   ÆK0Æ K0c                óH   € V ^8„  d   QhR\         R\        R\        R\        /# )r   r   r   r2   rk  r3   )r   s   "r   r   r     s)   € ÷ $ñ $œwð $¼ð $ÄSð $ÔX[ñ $r    c                 óL  € V P                  \        P                  ! \        P                  4      4      P                  4       pWB,
          p. p\        WTV4       EF9  pV P                  \        P                  \        P                  ! \        P                  4      4      P                  \        P                  V8H  \        P                  Ws,           8*  \        P                  V8¬  4      P                  \        P                  4      P!                  4       pV U	U
u/ uF  w  ršWšbK	  	  pp	p
VP#                  R ^ 4      ^,          VP#                  R^ 4      ^
,          ,           p\%        ^dV4      pVP'                  RVRWs,           ^,
          RVRV/4       EK<  	  RVRVRVR	V/# u up
p	i )
r_   r`   r   rž   Ústress_scoreÚalertsr   r2   rk  r=   )r#   r   rL   r   r$   r‰   r/  r   rg   rh   ri   r(   r   r§   r¨   rj   r+   rk   rl   rM   )r   r   r2   rk  r{   Ústartr=   r’   r}  rP   r‘   rp   rê   s   &&&&         r   Úcomponent_stress_curver    sc  € Øx‰xœŸš¤×!5Ñ!5Ó6Ó7×>Ñ>Ó@€HØÕ€EØ€Fä5 F×+ˆàH‰H”Z×(Ñ(¬$¯*ª*´Z·]±]Ó*CÓDß‰VÜ×)Ñ)¨^Ñ;Ü×%Ñ%¨­Ñ3Ü×#Ñ# qÑ(ó÷
 ‰X”j×)Ñ)Ó*ß‰S‹Uð 	ñ $*Ô*¡6™4˜1!’$¡6ˆÑ*àJ‰Jz 1Ó%¨Õ*ØJ‰Jy !Ó$ rÕ)õ*ð 	ô S˜&Ó!ˆà‰Ø˜Øq•z A•~Ø˜FØfð	
÷ 	ñ' ,ð6 	˜.Ø&Ø&Ø&ð	ð ùó +s   ÄF r1   zC2.consumer_lagÚ
pivot_tickiè  Úbeforer6  Úp95i|  Úafterrh  Úmean_changeÚ
p95_changeÚimprovementTc                óH   € V ^8„  d   QhR\         R\        R\        R\        /# )r   r   r1   r€  r2   r3   )r   s   "r   r   r   R  s0   € ÷ 3ñ 3Üð3äð3ô ð3ô ñ	3r    c                 ó`  € V P                  \        4      P                  \        P                  V8H  4      P	                  4       pV'       g	   R RV R2/# V P                  \
        P                  \
        P                  VP                  ,          P                  P                  \        4      4      P                  \
        P                  VP                  8H  4      P                  4       pV UUu. uF(  w  rgVf   K  W#,
          Tu;8:  d
   V8  g   K"  M K&  VNK*  	  pppV UUu. uF'  w  rgVf   K  Y&u;8:  d   W#,           8:  g   K!  M K%  VNK)  	  p	pp\        V4      ^8  g   \        V	4      ^8  d   R R/# \        V4      p
\        V	4      pRVRVRR\         P"                  ! V
4      R\         P$                  ! V
^R	7      ^,          /R
R\         P"                  ! V4      R\         P$                  ! V^R	7      ^,          /RR\         P"                  ! V4      \         P"                  ! V
4      ,
          R\         P$                  ! V^R	7      ^,          \         P$                  ! V
^R	7      ^,          ,
          R\         P"                  ! V4      \         P"                  ! V
4      8  //# u uppi u uppi )rm  rn  ro  zNot enough data around pivotr1   r€  r  r6  r‚  rq  rƒ  rh  r„  r…  r†  )r#   r   r(   r1   r7   r   r$   r%   r   r&   r'   r
   r   r+   r9   rZ  r:   r6  ru  )r   r1   r€  r2   r<   r-   r’   r?   r  rƒ  Úbefore_sortedÚafter_sorteds   &&&&        r   Úsignal_change_impactr‹  R  s1  € ð 	‰”Óß	‰”×"Ñ" kÑ1Ó	2ß	‰‹ð ÷
 Ø˜8 K =°Ð<Ð=Ð=ð 	‰Ü× Ñ Ü×#Ñ# F×$6Ñ$6Õ7×>Ñ>×CÑCÄEÓJó	
÷ 
‰”×.Ñ.°&×2GÑ2GÑGÓ	Hß	‰‹ð 	ñ !Ô\™D‘DA AŒa°jÕ6IÈQÖ6[ÐQ[Ñ6[ŒaÑ6[a™D€FÑ\ÙÔ\™4‘41 1ŒQ°ZÖ5[È
ÕH[Ñ5[ŒQÑ5[Q™4€EÑ\ä
ˆ6ƒ{Q„œ#˜e›* qœ.ØÐ7Ð8Ð8ä˜6“N€MÜ˜%“=€Lð 	{ØjØØ”J—O’O MÓ2Ø”:×'Ò'¨¸Ô<¸RÕ@ð
ð 	Ø”J—O’O LÓ1Ø”:×'Ò'¨¸Ô;¸BÕ?ð
ð 	Øœ:Ÿ?š?¨<Ó8¼:¿?º?È=Ó;YÕYØÜ×$Ò$ \°RÔ8¸Õ<Ü×&Ò& }¸Ô;¸BÕ?õ@ð œ:Ÿ?š?¨<Ó8¼:¿?º?È=Ó;YÑYð
ðð ùó ]ùÛ\s0   Ã-J$Ã:J$ÄJ$ÄJ$Ä#J*Ä0J*ÅJ*Å
J*)é   )é   )NNé
   )rŽ  )éÈ   r  )é   )rF  )é   )rŒ  r‘  )r‘  é<   )rF  r  )i,  rŽ  )iX  r  i°ÿÿÿiVÿÿÿ)r  )+r:   Útypingr   r   r   r   r   Úsqlalchemy.ormr	   Ú
sqlalchemyr
   r   r   r   Úapp.db.models.signalsr   Úapp.db.models.timeseriesr   Úapp.db.models.alertsr   r   ÚmathÚcollectionsr   r/   rA   rQ   r[   rr   r›   r±   rÊ   rÛ   rä   r  r  r9  rA  rN  ri  ry  r  r‹  r¼   r    r   Ú<module>r›     s  ðã ß 3Õ 3å "ß /Ó /å (Ý 4ß 6ß "Ñ "Û Û å Ý #Û Ý ÷>õ$÷,õ09õF)õ^H÷VU÷p6&÷r>L÷B-÷^ôTõ÷0a÷P0÷lQ÷h;÷|?÷D$ðN Ð"ØØ
Ø
ˆCØ	ˆ3ðð 
Ø
ˆCØ	ˆ3ðð 
Ø3Ø$Ø4ðñ÷$3ñ 3r    



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\services\__pycache__\anomaly_analysis_service.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\__pycache__\anomaly_analysis_service.cpython-314.pyc
==================================================
+
    ùÂYiÐJ  ã                  óR  € ^ RI Ht ^ RIHt ^ RIHtHtHtHtH	t	 ^ RI
Ht ^ RIHt ^ RIHtHt ^ RIHt ^ RIHt ^ R	IHt ^ R
IHt ^ RIHtHt RRRRRRRRRR/tR. R1ORRR./tRRRR. R2O/RRRR. R3O/RRRRR R!./R"RR#RR$R%./R&RR'R. R4O//tR( R) ltR* R+ lt R, R- lt!R. R/ lt"R0# )5é    )Úannotations)Ú	dataclass)ÚDictÚAnyÚListÚTupleÚOptional)Údefaultdict)ÚSession)ÚtextÚfunc)ÚInjectedAnomaly)Ú
AlertEvent)ÚSignal)Údetect_family)Úcomponent_healthÚglobal_healthÚC1zBatch IngestÚC2zKafka / Stream IngestÚC3zStream ProcessorÚC6zStorage / Processing LayerÚC8zAPI / Serving LayerÚstream_laneÚrailÚcpu_saturationÚtitlezCPU SaturationÚexpectedÚerror_spikezError SpikeÚlatency_regressionzLatency Regressionzlatency metrics drift upwardz-queue/backlog may grow if system falls behindÚevent_stormzEvent Stormz7event counters increase (restarts, timeouts, failovers)z0secondary increases in latency/errors may appearÚbacklog_growthzBacklog Growthc               ó    € V ^8„  d   QhRRRR/# )é   ÚcodeÚstrÚreturn© )Úformats   "ÚZC:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\anomaly_analysis_service.pyÚ__annotate__r*   K   s   € ÷ ,ñ ,˜3ð , 3ñ ,ó    c                ó,   € \         P                  W 4      # ©N)ÚCOMPONENT_LABELSÚget)r$   s   &r)   Ú_component_labelr0   K   s   € Ü×Ñ Ó+Ð+r+   c               ó    € V ^8„  d   QhRRRR/# )r#   Ú
componentsz	List[str]r&   zOptional[str]r'   )r(   s   "r)   r*   r*   O   s   € ÷ ñ  	ð ¨mñ r+   c                óž   € \        V 4      p\        P                  4        F)  w  r#VP                  \        V4      4      '       g   K'  Vu # 	  R # r-   )ÚsetÚPIPELINE_DEFÚitemsÚissubset)r2   Úcomp_setÚpÚchains   &   r)   Ú_infer_pipeliner;   O   s?   € Ü:‹€HÜ ×&Ñ&Ö(‰ˆØ×ÑœS ›Z×(Ô(ØŠHñ )ñ r+   c               ó   € V ^8„  d   QhRR/# )r#   r&   zOptional[float]r'   )r(   s   "r)   r*   r*   W   s   € ÷ ñ oñ r+   c                óJ   €  V f   R # \        V 4      #   \         d     R # i ; ir-   )ÚfloatÚ	Exception©Úxs   &r)   Ú_safe_floatrB   W   s*   € ðØŠ9ÙÜQ‹xˆøÜô Úðús   ‚ ˆ
 “"¡"c               ó    € V ^8„  d   QhRRRR/# )r#   Údbr   r&   zDict[str, Any]r'   )r(   s   "r)   r*   r*   `   s   € ÷ ñ ˜gð ¨.ñ r+   c                 óº  aKaL€ V P                  \        4      P                  4       pV'       g   RR/# V^ ,          P                  p\	        \        R V 4       4      4      p\	        \        R V 4       4      4      p\	        WC,
          ^,           4      p\        V Uu0 uF  qfP                  kK  	  up4      p\        V Uu0 uF  qfP                  kK  	  up4      p\        V4      p	\        P                  VRVR. /4      p
V P                  \        4      P                  \        P                  P                  V4      4      P                  4       pV Uu/ uFW  pVP                  RVP                  RVP                   R	\#        VP                   4      R
\%        VR
R4      R\%        VRR4      /bKY  	  ppV P'                  \)        R4      RVRVRV/4      P+                  4       p/ pV F:  p\-        VP.                  4      VVP                  \	        VP0                  4      3&   K<  	  \3        R 4      p\3        R 4      p\3        \4        4      p\3        \4        4      p\3        \4        4      p\3        \4        4      p\3        R 4      p\3        R 4      p\3        R 4      p\3        \        4      p\3        \4        4      p\3        R 4      p\3        \        4      pV EFµ  pVP                  pVP                  V4      pV'       gL   RV9   d   VP7                  R^4      ^,          MRpRVP                  RTR	\#        T;'       g    R4      R
RRR/pVR,          pV'       g   K‡  VP                  \	        VP0                  4      3p VP                  V / 4      p!\9        V!P                  V4      4      p"\9        VP:                  4      p#V#e   V"f   Kó  V"V#,
          p$V#^ 8w  d   V$V#,          R,          MRp%V%f   EK  VV;;,          ^,          uu&   VV;;,          V#,          uu&   VV;;,          V",          uu&   VV;;,          V$,          uu&   VV;;,          V%,          uu&   VV,          e   V%VV,          8  d   V%VV&   VV,          e   V%VV,          8”  d   V%VV&   VV,          e   V"VV,          8”  d   V"VV&   VP                  p&VV&;;,          ^,          uu&   VV&;;,          V%,          uu&   VV&,          e   V%VV&,          8”  d   V%VV&&   V&VV&,          R&   \=        V&4      VV&,          R&   VV&,          R;;,          ^,          uu&   VV&,          R,          P?                  V4       VV&,          R,          P?                  VR	,          4       EK¸  	  V EF  pVV,          ^ 8X  d   K  VP                  V/ 4      pVV,          PA                  RVRVP                  R4      R	VP                  R	4      RVP                  R4      R
VP                  R
4      RVP                  R4      RVV,          R VV,          VV,          ,          R!VV,          VV,          ,          R"VV,          VV,          ,          R#VV,          VV,          ,          R$VV,          R%VV,          R&VV,          /4       EK  	  . p'VPC                  4        FŒ  w  p&p(VV&,          p)V)^ 8X  d   K  V'PE                  RV&RV(R,          RV(R,          R\        \G        V(R,          4      4      R\        \G        V(R,          4      4      R#VV&,          V),          R'VV&,          /4       KŽ  	  V'PI                  R( R)7       \G        VPK                  4       4      p*V* U+u. uF  p+V+R,          f   K  V+NK  	  p*p+V*PI                  R* R)7       V P                  \L        4      P                  \L        PN                  R+8H  \L        PP                  R,8H  4      P                  4       p,\3        \        4      p-\3        \        4      oKRp.Rp/V, F«  p0V-V0PR                  ;;,          ^,          uu&   SKV0P                  ;;,          ^,          uu&   V0PT                  e'   V.f   V0PT                  M\        V.V0PT                  4      p.V0PV                  f   K…  V/f   V0PV                  M\        V/V0PV                  4      p/K­  	  \Y        V-PK                  4       4      p1^p2V^È8”  d   ^
p2MV^P8”  d   ^p2M	V^8”  d   ^p2. p3V^ 8”  dË   Tp4V4V8:  dÂ   \        VV4V2,           ^,
          4      p5^ p6^ p7^ p8V, Fu  p0V0PT                  e   V0PV                  f   K!  V0PT                  V58:  g   K4  V0PV                  V48¼  g   KG  V6^,          p6V0PR                  R-8X  d   V7^,          p7Kl  V8^,          p8Kw  	  V3PE                  RV4RV5R.V6R-V7R/V8/4       V4V2,          p4KÈ  \        SKP[                  4       VK3R0 lR1R27      p9. p:V9 FK  p& \5        \]        V V&4      4      p;V:PE                  RV&R\=        V&4      R.\	        SKV&,          4      R3V;/4       KM  	  V:PI                  R4 R)7       \`        P                  T	;'       g    RV4      p<\c        V<4       U=U&u/ uF	  w  p=p&V&V=bK  	  up&p=oL\        SKP[                  4        U&u. uF  p&SLP                  V&^c4      NK  	  up&4      p>\e        \g        V>4      4      ^8¬  p?. p@V*'       d4   V*^ ,          pAX@PE                  R5R6R7VAR,           R8VAR#,          R9 R:2/4       V.e)   X@PE                  R5R;R7R<\	        V.4       R=V R>V R?2/4       V1^ 8”  dD   V-P                  R-^ 4      pBV-P                  R/^ 4      pCX@PE                  R5R@R7RAV1 RBVB RCVC R?2/4       V?'       d   X@PE                  R5RDR7RE/4       MX@PE                  R5RFR7RG/4       V:'       d>   V:^ ,          pDX@PE                  R5RHR7RIVDR,           RJVDR,           RKVDR3,           R2/4       V''       dD   \        V'RL R)7      pEX@PE                  R5RMR7RNVER,           RJVER,           ROVER',          R9 RP2/4       RQpF\e        V34      ^8¼  d—   V3^ ,          R.,          pGV3\e        V34      ^,          ,          R.,          pHV3Rv,          R.,          pIVIVG^,          8”  d   XIXH8”  d   RRpFM%XIXG8  d   XIXH8  d   RSpFM\        XGXHXI4      ^28”  d   RTpFX@PE                  R5RUR7RVXF RW2/4       RR1RXR5TRV
R,          RYV
R,          RZT	R[RVRVR\V/R]R^\        VVL3R_ lR)7       U&u. uF  p&R`V&Ra\=        V&4      /NK  	  up&RbV//RcRd\i        V 4      ReV?RUXF/RfRg\	        V14      Rh\-        V-4      Ri\        SKPC                  4       Rj R)7       U&UJu. uF2  w  p&pJRV&R\=        V&4      R.\	        VJ4      RkSLP                  V&^c4      /NK4  	  upJp&RlT3RmRnV.e   \	        V.4      MRRoV/e   \	        V/4      MR//RpRqV'RrV*/RsRtV:/RuX@/# u upi u upi u upi u up+i   \^         d    Rp; EL(i ; iu up&p=i u up&i u up&i u upJp&i )wzÚ
Monitoring-grade anomaly analysis.
Uses ONLY existing tables and deterministic logic.

Outputs are UI-ready:
  - timeline objects
  - per-component tables
  - per-signal deviation stats
  - observations and narrative
ÚactiveFc              3  ó8   "  € T F  qP                   x € K  	  R # 5ir-   ©Útick©Ú.0Úas   & r)   Ú	<genexpr>Ú(anomaly_full_analysis.<locals>.<genexpr>t   s   é € Ð2©	 1Ÿž«	ùó   ‚c              3  ó8   "  € T F  qP                   x € K  	  R # 5ir-   rH   rJ   s   & r)   rM   rN   u   s   é € Ð0¡i —f–f£iùrO   r   r   Úcomponent_codeÚcolumn_nameÚfamilyÚunitNÚdescriptionzÈ
            SELECT component_code, tick, payload
            FROM timeseries_points
            WHERE tick BETWEEN :from_tick AND :to_tick
              AND component_code = ANY(:components)
        Ú	from_tickÚto_tickr2   c                 ó6   € R RRRRRRRR^ RRRRRRR	RR
RRRRR/# )Úsignal_codeNrQ   rS   rR   ÚpointsÚmean_originalÚmean_currentÚmean_delta_absÚmean_delta_pctÚmin_delta_pctÚmax_delta_pctÚpeak_currentr'   r'   r+   r)   Ú<lambda>Ú'anomaly_full_analysis.<locals>.<lambda>«   sC   € ØtØ˜$Ø$ØtØ!Ø˜Ø˜Ø˜$Ø˜$Ø˜Ø˜Ø˜ñ,r+   c                 óB   € R RRRR^ R\        4       R\        4       RRRR/# )rQ   NÚcomponent_labelÚpoints_modifiedÚsignals_modifiedÚfamilies_touchedr^   Úpeak_delta_pct)r4   r'   r+   r)   rb   rc   º   s.   € Ø˜$Ø˜4Ø˜1ØœC›EØœC›EØ˜$Ø˜$ñ/r+   c                 ó   € R # r-   r'   r'   r+   r)   rb   rc   É   ó   € ©tr+   c                 ó   € R # r-   r'   r'   r+   r)   rb   rc   Ê   rk   r+   c                 ó   € R # r-   r'   r'   r+   r)   rb   rc   Ë   s   € ©$r+   c                 ó   € R # r-   r'   r'   r+   r)   rb   rc   Ï   s   € ±4r+   Ú.Ú g      Y@re   rf   rg   rh   rY   rZ   r[   r\   r]   r^   r_   r`   ra   ri   c                ó(   € V R ,          ) V R,          3# )rf   rQ   r'   r@   s   &r)   rb   rc   6  s   € ¨Ð+<Õ)=Ð(=¸qÐAQÕ?RÑ'Sr+   )Úkeyc                ó(   € V R ,          ) V R,          3# )r^   rY   r'   r@   s   &r)   rb   rc   :  s   €  aÐ(8Õ&9Ð%9¸1¸]Õ;KÑ$Lr+   Ú	SIMULATEDÚOPENÚcriticalÚopen_alertsÚwarningc                ó   <€ SV ,          # r-   r'   )ÚcÚalerts_by_components   &€r)   rb   rc     s   ø€ ÐK^Ð_`ÖKar+   T)rr   ÚreverseÚhealth_scorec                ó.   € V R ,          e
   V R ,          # R# )r}   iç  r'   r@   s   &r)   rb   rc   Œ  s   € ¸!¸NÕ:KÒ:W Q ~Õ%6Ð%`Ð]`Ð%`r+   ÚtypeÚearly_indicatorÚmessagez& showed the strongest deviation (mean z.1fz%).Úalert_onsetz%First simulated alert opened at tick z (anomaly window u    â†’ z).Úseverity_mixzOpen simulated alerts: z total (critical=z
, warning=ÚpropagationzRBehavior matches cascading impact: multiple pipeline stages show alerts/deviation.ÚlocalizationzLBehavior appears localized: impact concentrated in a single stage/component.Úmost_impacted_componentzMost impacted component is z (z) with health=c                ó.   € V R ,          e
   V R ,          # R# )ri   éÿÿÿÿr'   r@   s   &r)   rb   rc   Ê  s   € ÈÐK[ÕI\ÒIh°!Ð4DÕ2EÐ2pÐnpÐ2pr+   Úpeak_deviationzPeak deviation observed in z): z%.ÚstableÚ
escalatingÚ
recoveringÚhigh_pressureÚ	stabilityz&Alert pressure pattern classified as 'z'.ÚanomalyÚexpected_behaviorÚpipelineÚwindowÚduration_ticksÚscopeÚaffected_componentsc                ó(   <€ SP                  V ^c4      # )éc   )r/   )rA   Úchain_positionss   &€r)   rb   rc   ô  s-   ø€ ð  rA÷  rEñ  rEð  FGð  IKô  rLr+   r$   ÚlabelÚaffected_signalsÚsystem_stater   Úcascading_behaviorÚalertsÚ
open_totalÚby_severityÚby_componentc                ó   € V ^,          ) # )é   r'   r@   s   &r)   rb   rc     s   € ÐQRÐSTÕQUÑPUr+   Úpipeline_positionÚtimelineÚticksÚfirst_open_tickÚlatest_open_tickÚ	deviationÚper_componentÚ
per_signalÚhealthÚcomponents_rankedÚobservationsrˆ   )5Úqueryr   ÚallÚanomaly_typeÚintÚminÚmaxÚsortedrQ   rY   r;   ÚANOMALY_DOCr/   r   ÚfilterÚin_rR   r   ÚgetattrÚexecuter   ÚfetchallÚdictÚpayloadrI   r
   r>   ÚsplitrB   Úoriginal_valuer0   ÚaddÚupdater6   ÚappendÚlistÚsortÚvaluesr   ÚoriginÚstatusÚseverityÚ
tick_startÚtick_endÚsumÚkeysr   r?   r5   Ú	enumerateÚlenr4   r   )MrD   Ú	anomaliesr°   rV   rW   ÚdurationrL   r•   rš   r‘   ÚdocÚsignal_rowsÚsÚsig_metaÚpayload_rowsÚpayload_by_ctÚrÚper_signal_statsÚper_component_statsÚsignal_sum_origÚsignal_sum_curÚsignal_sum_delta_absÚsignal_sum_delta_pctÚsignal_min_delta_pctÚsignal_max_delta_pctÚsignal_peak_curÚsignal_nÚcomponent_sum_delta_pctÚcomponent_peak_delta_pctÚcomponent_nÚmetaÚcolrr   r¼   Úcurrent_valÚoriginal_valÚ	delta_absÚ	delta_pctrz   Úcomponent_tableÚvÚnÚsignal_tablerA   rw   Úalerts_by_sevÚearliest_alert_tickÚlatest_alert_tickÚevÚtotal_alertsÚbucketr¤   ÚtÚt_endÚcountÚcritÚwarnÚimpacted_componentsÚhealth_tabler«   Úpipeline_chainÚiÚstages_impactedÚ	cascadingr­   Útop_by_deltaÚcritical_cntÚwarn_cntÚworstÚpeakrŽ   ÚfirstÚmidÚlastÚcntr{   r˜   sM   &                                                                          @@r)   Úanomaly_full_analysisr  `   sú  ù€ ð (*§x¡x´Ó'@×'DÑ'DÓ'F€IßØ˜%Ð Ð ð
 ˜Q•<×,Ñ,€LÜ”CÑ2©	Ó2Ó2Ó3€IÜ”#Ñ0¡iÓ0Ó0Ó1€GÜ7Õ&¨Õ*Ó+€Hä ¹IÓ!F¹I°q×"2Ô"2¹IÑ!FÓGÐÜ±iÓ@±i°Ÿ}œ}±iÑ@ÓAÐäÐ2Ó3€Hä
/‰/˜,¨°,À
ÈBÐ(OÓ
P€Cð 	‰”Óß	‰”×"Ñ"×&Ñ&Ð'7Ó8Ó	9ß	‰‹ð ñ ó	ñ ˆAð 	
‰Ø˜a×.Ñ.Ø˜1Ÿ=™=Ø”m A§M¡MÓ2Ø”G˜A˜v tÓ,Øœ7 1 m°TÓ:ð
ò 	
ñ ð ð 	ð* —:‘:Üð ó 	ð 
i ¨G°\ÐCVÐWó÷ hƒjð ð <>€MÛˆÜ9=¸a¿i¹i»ˆq×'Ñ'¬¨Q¯V©V«Ð5Ó6ñ ô #ñ $ó Ðô &ñ 'ó Ðô "¤%Ó(€OÜ ¤Ó'€NÜ&¤uÓ-ÐÜ&¤uÓ-ÐÜ&¡|Ó4ÐÜ&¡|Ó4ÐÜ!¡,Ó/€OÜœ3Ó€Hä)¬%Ó0ÐÜ*©<Ó8ÐÜœcÓ"€KäˆØM‰MˆØ|‰|˜A‹ˆßà(+¨q¬!—'‘'˜#˜q“/ !Ö$°dˆCà  !×"2Ñ"2Ø˜sØœ-¨¯	¨	¨rÓ2Ø˜Ø˜tðˆDð =Õ!ˆßÙà×Ñ¤ Q§V¡V£Ð-ˆØ×#Ñ# C¨Ó,ˆÜ! '§+¡+¨cÓ"2Ó3ˆÜ" 1×#3Ñ#3Ó4ˆàÒ ;Ò#6Ùà ,Õ.ˆ	Ø:FÈ!Ô:KY Õ-°Ö6ÐQUˆ	àÒÚàqÕ‹Ø˜×˜lÕ*ÓØq×˜[Õ(ÓØ˜Q× 9Õ,ÓØ˜Q× 9Õ,Óð   Õ"Ò*¨iÐ:NÈqÕ:QÔ.QØ&/Ð  Ñ#Ø Õ"Ò*¨iÐ:NÈqÕ:QÔ.QØ&/Ð  Ñ#ð ˜1ÕÒ%¨°ÀqÕ7IÔ)IØ!,ˆO˜AÑð ×ÑˆØA˜!Õ‹Ø ×" iÕ/Ó"Ø# AÕ&Ò.°)Ð>VÐWXÕ>YÔ2YØ*3Ð$ QÑ'à34Ð˜AÕÐ/Ñ0Ü4DÀQÓ4GÐ˜AÕÐ0Ñ1Ø˜AÕÐ0×1°QÕ6Ó1Ø˜AÕÐ1Õ2×6Ñ6°qÔ9Ø˜AÕÐ1Õ2×6Ñ6°t¸Hµ~×Fñw ô| ˆØA;˜!ÔÙà|‰|˜A˜rÓ"ˆØ˜Õ×"Ñ"Ø˜1Ø˜dŸh™hÐ'7Ó8Ød—h‘h˜xÓ(Ø˜4Ÿ8™8 MÓ2ØD—H‘H˜VÓ$Ø˜4Ÿ8™8 MÓ2Øh˜q•kØ˜_¨QÕ/°(¸1µ+Õ=Ø˜N¨1Õ-°¸µÕ;ØÐ2°1Õ5¸À½ÕCØÐ2°1Õ5¸À½ÕCØÐ1°!Õ4ØÐ1°!Õ4Ø˜O¨AÕ.ð$
÷ 	ñ ð. €OØ#×)Ñ)Ö+‰ˆˆ1Ø˜NˆØŒ6ÙØ×ÑØ˜aØ˜qÐ!2Õ3Ø˜qÐ!2Õ3Ø¤¤t¨AÐ.@Õ,AÓ'BÓ CØ¤¤t¨AÐ.@Õ,AÓ'BÓ CØÐ5°aÕ8¸1Õ<ØÐ6°qÕ9ð 
ö 	ñ	 ,ð ×ÑÑSÐÔTäÐ(×/Ñ/Ó1Ó2€LÙ+ÓL™|˜!¨q°Õ/?—AA™|€LÐLØ×ÑÑLÐÔMð 	‰”Óß	‰”
×!Ñ! [Ñ0´*×2CÑ2CÀvÑ2MÓ	Nß	‰‹ð ô  ¤Ó$€MÜ%¤cÓ*ÐØÐØÐãˆØb—k‘k×" aÕ'Ó"Ø˜B×-Ñ-×.°!Õ3Ó.à=‰=Ò$Ø3FÒ3N "§-¢-ÔTWÐXkÐmo×mzÑmzÓT{ÐØ;‰;Ô"Ø/@Ò/H §¢ÌcÐRcÐeg×epÑepÓNqÒñ ô }×+Ñ+Ó-Ó.€Lð €FØ#„~Ø‰Ø	BŒØ‰Ø	BŒØˆð €HØ!„|ØˆØ7ŒlÜ˜  V¥¨a¥Ó0ˆEØˆEØˆDØˆDÛ!à—=‘=Ò(¨B¯K©KÒ,?ÙØ—=‘= EÖ)¨b¯k©k¸QÖ.>Ø˜Q•JEØ—{‘{ jÔ0Ø 	šà 	šñ "ð O‰OØ˜QØ˜5Ø˜uØ˜DØ˜4ðô ð KŠAô
 !Ð!4×!9Ñ!9Ó!;ÔAaÐkoÔpÐØ€LÛ ˆð	ÜÔ+¨B°Ó2Ó3ˆFð 	×ÑØ˜aØÔ/°Ó2Øœ3Ð2°1Õ5Ó6Ø˜Fð	
ö 	ñ !ð ×ÑÑaÐÔbô "×%Ñ% h§n n°"Ð6IÓJ€NÜ(1°.Ô(AÔBÑ(A¡  1q˜!’tÑ(AÒB€OäÐBU×BZÑBZÔB\Ó]ÑB\¸Q˜o×1Ñ1°!°RÖ8ÑB\Ñ]Ó^€OÜ”C˜Ó(Ó)¨QÑ.€Ið
 *,€L÷ Ø# A•ˆØ×ÑØÐ%Ø˜, }Õ5Ð6Ð6\Ð]iÐjzÕ]{Ð|ð  ]Að  ADð  Eð
ô 	ð
 Ò&Ø×ÑØMØÐ>¼sÐCVÓ?WÐ>XÐXiÐjsÐitÐtyð  {Bð  zCð  CEð  Fð
ô 	ð
 aÔØ$×(Ñ(¨°QÓ7ˆØ ×$Ñ$ Y°Ó2ˆØ×ÑØNØÐ0°°Ð>OÐP\È~Ð]gÐhpÐgqÐqsÐtð
ô 	÷
 Ø×ÑØMØÐkð
õ 	ð
 	×ÑØNØÐeð
ô 	÷ Ø˜Q•ˆØ×ÑØÐ-ØÐ4°UÐ;LÕ5MÐ4NÈbÐQVÐWgÕQhÐPiÐiwÐx}ð  Mõ  yNð  xOð  OPð  Qð
ô 	÷ Ü?Ñ(pÔqˆØ×ÑØÐ$ØÐ4°TÐ:KÕ5LÐ4MÈRÐPTÐUeÕPfÐOgÐgjÐkoð  qAõ  lBð  CFð  kGð  GIð  Jð
ô 	ð €IÜ
ˆ8ƒ}˜ÔØ˜•˜MÕ*ˆØ”s˜8“} aÕ'Õ(¨Õ7ˆØ˜|˜MÕ*ˆà%˜!•)Ô  s¤
Ø$‰IØEŒ\˜d SœjØ$‰IÜ˜˜TÓ" RÔ'Ø'ˆIà×ÑØKØÐ?À	¸{È"ÐMð
ô 	ð 	$ØØLØS˜•\Ø  Z¥Ø˜ØØ˜YØ˜7Ø  (ðð
 Ø%ÜGMÐNaô  hLõ  HMó(ñ HMÀ!V˜Q Ô)9¸!Ó)<Ó=ñ  HMñ(ð #Ð$4ð	ð
ð& 	Øœ]¨2Ó.Ø  )Ø˜ð
ð 	Øœ#˜lÓ+Øœ4 Ó.Øô %Ð%8×%>Ñ%>Ó%@ÁoÕVôñ W‘FAsð % aØ%Ô'7¸Ó':Ø!¤3 s£8Ø'¨×)<Ñ)<¸QÀÓ)Có	ñ Wòð ˜ØØ!Ð?RÒ?^¤3Ð':Ô#;ÐdhØ"Ð>OÒ>[¤CÐ(9Ô$:Ðaeðð
ð& 	Ø˜_Ø˜,ð
ð
 	Ø ð
ð 	˜ðq9ð 9ùò] "GùÚ@ùò	ùòd MøôV ô 	Ø‹Fð	üó" Cùâ]ùòx(ùó$sI   ÂxÃ x$ÅAx)Ý>x.Þx.èx3êyê<yõ	y"ö/8yø3yùyN)r   r   r   r   )z(utilization increases and stays elevatedz.latency may increase if compute is constrainedz'errors may increase if overload happens)zerror_rate increases sharplyz"downstream may see throughput dropz"retries may cause latency increase)zbacklog/queue depth increasesz%latency increases due to waiting timez/downstream pressure may rise (cascading effect))#Ú
__future__r   Údataclassesr   Útypingr   r   r   r   r	   Úcollectionsr
   Úsqlalchemy.ormr   Ú
sqlalchemyr   r   Úapp.db.models.anomaliesr   Úapp.db.models.alertsr   Úapp.db.models.signalsr   Ú!app.observability.metric_familiesr   Úapp.services.analytics_servicer   r   r.   r5   rµ   r0   r;   rB   r  r'   r+   r)   Ú<module>r     s	  ðõ #å !ß 3Õ 3Ý #å "ß !å 3Ý +Ý (Ý ;ß Jð
 	ˆ.ØÐ
!ØÐ
ØÐ
&ØÐ
ðÐ ð Ò+Ø
ˆT4ˆLð€ð ØÐ!Øò 
ðð ØØò 
ðð ØÐ%ØØ*Ø;ð
ðð ØØØEØ>ð
ðð ØÐ!Øò 
ðð?'€õT,õõ÷r+   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\services\__pycache__\anomaly_impact_service.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\__pycache__\anomaly_impact_service.cpython-314.pyc
==================================================
+
    ¸YiÞ  ã                   óf   € ^ RI Ht ^ RIHtHt ^ RIHtHt ^ RIH	t	 ^ RI
Ht ^ RIHtHt R R ltR	# )
é    )ÚSession)ÚfuncÚtext)ÚDictÚAny)Ú
AlertEvent)ÚInjectedAnomaly)Úcomponent_healthÚglobal_healthc                óR   € V ^8„  d   QhR\         R\        \        \        3,          /# )é   ÚdbÚreturn)r   r   Ústrr   )Úformats   "ÚXC:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\anomaly_impact_service.pyÚ__annotate__r      s&   € ÷ Jñ Jœwð J¬4´´S°­>ñ Jó    c                óº  € V P                  \        4      P                  4       pV'       g   RRR\        V 4      /# V^ ,          P                  p\        R V 4       4      p\        R V 4       4      p\        V Uu0 uF  qUP                  kK  	  up4      p\        V Uu0 uF  qUP                  kK  	  up4      pRVRVRVR	WC,
          ^,           R
VR\        V4      R\        V4      /pV P                  \        P                  \        P                  \        P                  ! \        P                  4      4      P!                  \        P"                  R8H  \        P$                  R8H  4      P'                  \        P                  \        P                  4      P                  4       p	/ p
/ p/ pV	 FP  w  rÞpV
P)                  V^ 4      V,           W®&   VP)                  V^ 4      V,           W½&   WüP+                  V/ 4      V&   KR  	  R\-        V
P/                  4       4      RV
RV/p. pV FQ  p \1        W4      pTP5                  RTR\7        T4      RTP)                  T^ 4      RTP)                  T/ 4      /4       KS  	  VP9                  R R7       V P;                  \=        R4      4      P?                  4       pV Uu. uFO  pRVP                  R\7        VP@                  ;'       g    R4      R\7        VPB                  ;'       g    R4      /NKQ  	  ppVP9                  R RR7       RRR VR!VR"VR#VR\        V 4      /# u upi u upi   \2         d     EK/  i ; iu upi )$zQ
Deep impact analysis of the currently active anomaly.
Read-only, rollback-safe.
ÚactiveFr   c              3   ó8   "  € T F  qP                   x € K  	  R # 5i©N©Útick©Ú.0Úas   & r   Ú	<genexpr>Ú)anomaly_impact_summary.<locals>.<genexpr>   s   é € Ð1¡L˜q—F–F£Lùó   ‚c              3   ó8   "  € T F  qP                   x € K  	  R # 5ir   r   r   s   & r   r   r       s   é € Ð/¡,˜Q—&–&£,ùr    ÚtypeÚ	from_tickÚto_tickÚduration_ticksÚaffected_componentsÚaffected_signalsÚpoints_modifiedÚOPENÚ	SIMULATEDÚtotalÚby_severityÚby_componentÚcomponent_codeÚhealth_scoreÚopen_alertsÚseverity_pressurec                 ó   € V R ,          # )r/   © ©Úxs   &r   Ú<lambda>Ú(anomaly_impact_summary.<locals>.<lambda>a   s	   € ¨¨>Ö):r   )Úkeyaº  
            SELECT
                ia.signal_code,
                AVG(
                    ABS(
                        ((ts.payload ->> split_part(ia.signal_code, '.', 2))::double precision
                         - (ia.original_value)::double precision)
                        / NULLIF((ia.original_value)::double precision, 0)
                    ) * 100
                ) AS avg_delta_pct,
                MAX(
                    ABS(
                        ((ts.payload ->> split_part(ia.signal_code, '.', 2))::double precision
                         - (ia.original_value)::double precision)
                        / NULLIF((ia.original_value)::double precision, 0)
                    ) * 100
                ) AS max_delta_pct
            FROM injected_anomalies ia
            JOIN timeseries_points ts
              ON ts.component_code = ia.component_code
             AND ts.tick = ia.tick
            GROUP BY ia.signal_code
        Úsignal_codeÚavg_delta_pctg        Úmax_delta_pctc                 ó   € V R ,          # )r;   r3   r4   s   &r   r6   r7   ‰   s	   € ¨¨/Ö(:r   T)r8   ÚreverseÚanomalyÚalertsÚ
componentsÚmetric_deviation)"Úqueryr	   Úallr   Úanomaly_typeÚminÚmaxÚsortedr.   r9   Úlenr   Úseverityr   ÚcountÚidÚfilterÚstatusÚoriginÚgroup_byÚgetÚ
setdefaultÚsumÚvaluesr
   Ú	ExceptionÚappendÚfloatÚsortÚexecuter   Úfetchallr:   r;   )r   Úanomaly_rowsrD   r#   r$   r   r&   r'   Úanomaly_contextÚ
alert_rowsÚalerts_by_severityÚalerts_by_componentÚcomponent_severityÚ	componentrI   ÚcntÚalert_impactÚcomponent_impactsÚhealthÚdeviation_rowsÚrrA   s   &                     r   Úanomaly_impact_summaryrg      sh  € ð —8‘8œOÓ,×0Ñ0Ó2€LßàeØœ]¨2Ó.ð
ð 	
ð   •?×/Ñ/€LÜÑ1¡LÓ1Ó1€IÜÑ/¡,Ó/Ó/€Gä ¹LÓ!I¹L°q×"2Ô"2¹LÑ!IÓJÐÜ±lÓC±l°Ÿ}œ}±lÑCÓDÐð 	ØYØ7Ø˜'Õ-°Õ1ØÐ2ØœCÐ 0Ó1Øœ3˜|Ó,ð€Oð 	‰Ü×%Ñ%Ü×ÑÜJŠJ”z—}‘}Ó%ó	
÷
 
‰Ü×Ñ Ñ'Ü×Ñ Ñ,ó

÷ 
‰”*×+Ñ+¬Z×-@Ñ-@Ó	Aß	‰‹ð ð *,ÐØ*,ÐØ46Ðã$.Ñ ˆ	˜SØ'9×'=Ñ'=¸hÈÓ'JÈSÕ'PÐÑ$Ø)<×)@Ñ)@ÀÈAÓ)NÐQTÕ)TÐÑ&ØAD×%Ñ% i°Ó4°XÓ>ñ %/ð 	”Ð'×.Ñ.Ó0Ó1ØÐ)ØÐ+ð€Lð Ðã(ˆ	ð	Ü% bÓ4ˆFð 	× Ñ Ø˜iØœE &›MØÐ.×2Ñ2°9¸aÓ@ØÐ!3×!7Ñ!7¸	À2Ó!Fð	"
ö 	ñ )ð ×ÑÑ:ÐÔ;ð
 —Z‘ZÜð ó 	ó÷0 hƒjð1 ñ@  óñ  ˆAð	 ˜1Ÿ=™=ØœU 1§?¡?×#9Ð#9°cÓ:ØœU 1§?¡?×#9Ð#9°cÓ:ó	
ñ
  ð ð ð ×ÑÑ:ÀDÐÔIð 	$Ø?Ø,ØÐ'ØÐ,Øœ rÓ*ðð ùòY "JùÚCøôh ô 	Ûð	üòRs0   Á;L;ÂM È)MÊ9)MË#MÌMÍMÍMN)Úsqlalchemy.ormr   Ú
sqlalchemyr   r   Útypingr   r   Úapp.db.models.alertsr   Úapp.db.models.anomaliesr	   Úapp.services.analytics_servicer
   r   rg   r3   r   r   Ú<module>rn      s   ðå "ß !ß å +Ý 3ß J÷Jr   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\services\__pycache__\anomaly_injection_service.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\__pycache__\anomaly_injection_service.cpython-314.pyc
==================================================
+
    Ò›aip  ã                  óþ   € ^ RI Ht ^ RIt^ RIt^ RIHtHtHt ^ RIH	t	 ^ RI
Ht ^ RIHt ^ RIHt ^ RIHt R	. R%ORRR
./tRRR.RR/RRR.RR/RRR.RR/RRR.RR/RRRR.RRRR//tR R  ltR! R" ltR&R# R$ lltR# )'é    )ÚannotationsN)ÚDictÚAnyÚList)ÚSession)Útext)ÚSignal)ÚInjectedAnomaly)Údetect_familyÚstream_laneÚC6ÚrailÚC1Úcpu_saturationÚfamiliesÚutilizationÚbase_factorgffffffö?Úerror_spikeÚ
error_rateg      @Úlatency_regressionÚlatencyg      @Úevent_stormÚeventsg      @Úbacklog_growthÚbacklogÚ
propagatesTc               ó   € V ^8„  d   QhRR/# )é   Údbr   © )Úformats   "Ú[C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\anomaly_injection_service.pyÚ__annotate__r#   "   s   € ÷ Lñ L˜gñ Ló    c                ó†   € V P                  \        P                  4      P                  4       pV'       d   \	        R 4      hR# )z-An anomaly is already active. Rollback first.N)Úqueryr
   ÚidÚfirstÚRuntimeError)r   Úactives   & r"   Ú_guard_single_anomalyr+   "   s3   € ØX‰X”o×(Ñ(Ó)×/Ñ/Ó1€FßÜÐJÓKÐKñ r$   c               ó$   € V ^8„  d   QhRRRRRR/# )r   ÚvalueÚfloatÚfactorÚreturnr    )r!   s   "r"   r#   r#   (   s!   € ÷ *ñ *˜ð * uð *°ñ *r$   c                ón   € R \         P                  ! RR4      ,           p\        W,          V,          4      # )ç      ð?g{®Gáz”?g{®Gáz”¿)ÚrandomÚuniformr.   )r-   r/   Újitters   && r"   Ú_apply_shiftr6   (   s)   € Ø”6—>’> %¨Ó.Õ.€FÜ• &Õ(Ó)Ð)r$   c               ó4   € V ^8„  d   QhRRRRRRRRRRR	R
RR/# )r   r   r   ÚpipelineÚstrÚanomaly_typeÚ	from_tickÚintÚto_tickÚstrengthr.   r0   r    )r!   s   "r"   r#   r#   -   sW   € ÷ `ñ `Øð`àð`ð ð`ð ð	`ð
 ð`ð ð`ð 	ñ`r$   c                ó|  € \        V 4       V\        9  d   \        R V R24      hV\        9  d   \        RV R24      h\        V,          pVR,          pVR,          pVP	                  RR4      p	\        V,          p
V P                  \        4      P                  \        P                  P                  V
4      4      P                  4       p^ p. p\        V
4       EFµ  w  rïV	'       d   R^V,           ,          MRpRW…,          V,          ,           pV P                  \        R4      R	VR
VRV/4      P                  4       pV'       g   Ko  V Uu. uF  pVP                  V8X  g   K  VNK  	  ppV EF  p\        VP                   4      pRpV F³  p\#        VP$                  4      pVV9  d   K!  VP	                  VP$                  4      p\'        V\(        \*        34      '       g   KZ  \-        VV4      pVVVP$                  &   VP/                  \1        VP2                  VVP4                  VVR7      4       V^,          pRpKµ  	  V'       g   KÞ  V P                  \        R4      R\6        P8                  ! V4      RVP:                  /4       EK  	  EK¸  	  V P=                  V4       V P?                  4        V# u upi )zUnknown pipeline 'Ú'zUnknown anomaly 'r   r   r   Fr2   zè
                SELECT id, tick, payload
                FROM timeseries_points
                WHERE component_code = :component
                  AND tick BETWEEN :from_tick AND :to_tick
                ORDER BY tick
            Ú	componentr;   r=   )Úsignal_codeÚcomponent_codeÚtickÚoriginal_valuer:   Tz«
                        UPDATE timeseries_points
                        SET payload = CAST(:payload AS jsonb)
                        WHERE id = :id
                    Úpayloadr'   ) r+   Ú	PIPELINESÚ
ValueErrorÚANOMALY_DEFINITIONSÚgetr&   r	   ÚfilterrC   Úin_ÚallÚ	enumerateÚexecuter   ÚfetchallÚdictrF   r   Úcolumn_nameÚ
isinstancer<   r.   r6   Úappendr
   rB   rD   ÚjsonÚdumpsr'   Úadd_allÚcommit)r   r8   r:   r;   r=   r>   Ú
definitionr   r   r   Ú
componentsÚsignalsÚaffectedÚanomaly_rowsÚidxrA   Údecayr/   ÚrowsÚsÚcomponent_signalsÚrowrF   ÚchangedÚfamilyÚold_valÚnew_vals   &&&&&&                     r"   Úinject_anomalyrh   -   s{  € ô ˜"Ôà”yÔ ÜÐ-¨h¨Z°qÐ9Ó:Ð:àÔ.Ô.ÜÐ,¨\¨N¸!Ð<Ó=Ð=ä$ \Õ2€JØ˜*Õ%€HØ˜]Õ+€KØ—‘ ¨eÓ4€Jä˜8Õ$€Jàh‰h”vÓ×%Ñ%Ü×Ñ×!Ñ! *Ó-óç	cƒeð ð €HØ*,€Lä# J×/‰ˆß#-q˜3•w–°3ˆØ˜Õ.°Õ6Õ7ˆàz‰zÜð ó ð ˜YØ˜YØ˜7ðó
÷ ‰(‹*ð 	÷ Ùá(/ÓQ© 1°1×3CÑ3CÀyÑ3PŸQ˜Q©ÐÐQäˆCÜ˜3Ÿ;™;Ó'ˆGØˆGã&Ü& q§}¡}Ó5Ø Ô)Ùà!Ÿ+™+ a§m¡mÓ4Ü! '¬C´¨<×8Ò8Ùä& w°Ó7Ø)0˜Ÿ™Ñ&à×#Ñ#Ü#Ø$%§M¡MØ'0Ø ŸX™XØ'.Ø%1ôôð ˜A•Ø’ñ/ '÷2 ‰wØ—
‘
Üð ó ð
 ¤§
¢
¨7Ó 3°T¸3¿6¹6ÐB÷ô= ñ1 0ð~ ‡JJˆ|ÔØ‡II„KØ€OùòW Rs   ÅJ9Å'J9)ÚC2ÚC3r   ÚC8)r2   )Ú
__future__r   rU   r3   Útypingr   r   r   Úsqlalchemy.ormr   Ú
sqlalchemyr   Úapp.db.models.signalsr	   Úapp.db.models.anomaliesr
   Ú!app.observability.metric_familiesr   rG   rI   r+   r6   rh   r    r$   r"   Ú<module>rs      s¸   ðå "ã Û ß "Ñ "å "Ý å (Ý 3Ý ;ð Ò+Ø
ˆT4ˆLð€	ð z M ?°MÀ3ÐGØJ  °¸sÐCØ˜:¨	 {°MÀ3ÐGØJ  
¨M¸3Ð?ØØY 	Ð*ØsØdðð
Ð õLõ*÷
`ñ `r$   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\services\__pycache__\anomaly_insight_service.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\__pycache__\anomaly_insight_service.cpython-314.pyc
==================================================
+
    yAWi7  ã                   óF   € ^ RI Ht ^ RIHt ^ RIHtHt ^ RIHt R R lt	R# )é    )ÚSession)Úfunc)ÚDictÚAny)ÚInjectedAnomalyc                óR   € V ^8„  d   QhR\         R\        \        \        3,          /# )é   ÚdbÚreturn)r   r   Ústrr   )Úformats   "ÚYC:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\anomaly_insight_service.pyÚ__annotate__r   	   s"   € ÷ %ñ %œð %¤T¬#¬s¨(¥^ñ %ó    c                 ó¸  € V P                  \        P                  \        P                  \        P
                  ! \        P                  4      P                  R 4      \        P                  ! \        P                  4      P                  R4      \        P                  ! \        P                  4      P                  R4      4      P                  \        P                  \        P                  4      P                  4       p\        4       p^ p. pV F˜  pVP                  VP                  4       W5P                  ,          pVP!                  RVP                  RVP                  R \#        VP$                  4      R\#        VP&                  4      R\#        VP                  4      /4       Kš  	  R\)        V4      ^ 8„  R\#        V4      R\+        \-        V4      4      R	V/# )
Ú	from_tickÚto_tickÚpointsÚanomaly_typeÚcomponent_codeÚpoints_modifiedÚactiveÚtotal_points_modifiedÚaffected_componentsÚ	anomalies)Úqueryr   r   r   r   ÚminÚtickÚlabelÚmaxÚcountÚidÚgroup_byÚallÚsetÚaddr   ÚappendÚintr   r   ÚlenÚsortedÚlist)r
   ÚrowsÚ
componentsÚtotal_pointsÚitemsÚrs   &     r   Úactive_anomaliesr1   	   sb  € à
‰Ü×(Ñ(Ü×*Ñ*ÜHŠH”_×)Ñ)Ó*×0Ñ0°Ó=ÜHŠH”_×)Ñ)Ó*×0Ñ0°Ó;ÜJŠJ”×)Ñ)Ó*×0Ñ0°Ó:ó	
÷ 
‰Ü×(Ñ(Ü×*Ñ*ó

÷ 
‰‹ð 	ô “€JØ€LØ€EãˆØ‰q×'Ñ'Ô(ØŸ™Õ ˆà‰Ø˜AŸN™NØ˜a×.Ñ.Øœ˜QŸ[™[Ó)Ø”s˜1Ÿ9™9“~Øœs 1§8¡8›}ð
ö 	ñ	 ð 	”#e“*˜q‘.Ø¤ \Ó!2Øœv¤d¨:Ó&6Ó7ØUð	ð r   N)
Úsqlalchemy.ormr   Ú
sqlalchemyr   Útypingr   r   Úapp.db.models.anomaliesr   r1   © r   r   Ú<module>r7      s   ðå "Ý ß å 3÷%r   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\services\__pycache__\anomaly_rollback_service.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\__pycache__\anomaly_rollback_service.cpython-314.pyc
==================================================
+
    ë©Yi•  ã                   ób   € ^ RI t ^ RIHtHtHtHt ^ RIHt ^ RIH	t	 ^ RI
Ht ^ RIHt R R ltR# )	é    N)ÚDictÚAnyÚTupleÚList)ÚSession)Útext)ÚInjectedAnomaly)Ú
AlertEventc                ó0   € V ^8„  d   QhR\         R\        /# )é   ÚdbÚreturn)r   Úint)Úformats   "ÚZC:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\anomaly_rollback_service.pyÚ__annotate__r      s   € ÷ 2ñ 2œ7ð 2¤sñ 2ó    c                 ó¨  € V P                  \        4      P                  4       pV'       g   ^ # / pV F:  pVP                  VP                  VP
                  3. 4      P                  V4       K<  	  ^ pVP                  4        FÔ  w  w  rVpV P                  \        R4      RVRV/4      P                  4       pV'       g   K?  \        VP                  4      p	V F=  pVP                  P                  R^4      ^,          p
VP                  Wš&   V^,          pK?  	  V P                  \        R4      R\         P"                  ! V	4      RVP$                  /4       KÖ  	  V P                  \&        4      P)                  \&        P*                  R8H  4      P-                  R	R
7       V P                  \        4      P-                  4        V P/                  4        V# )r   zš
                SELECT id, payload
                FROM timeseries_points
                WHERE component_code = :component AND tick = :tick
            Ú	componentÚtickÚ.z‹
                UPDATE timeseries_points
                SET payload = CAST(:payload AS jsonb)
                WHERE id = :id
            ÚpayloadÚidÚ	SIMULATEDF)Úsynchronize_session)Úqueryr	   ÚallÚ
setdefaultÚcomponent_coder   ÚappendÚitemsÚexecuter   ÚfetchoneÚdictr   Úsignal_codeÚsplitÚoriginal_valueÚjsonÚdumpsr   r
   ÚfilterÚoriginÚdeleteÚcommit)r   Ú	anomaliesÚgroupedÚaÚrestoredr   r   r!   Úrowr   Úmetrics   &          r   Úrollback_anomaliesr4      s‹  € Ø—‘œÓ)×-Ñ-Ó/€IßÙà<>€GãˆØ×Ñ˜A×,Ñ,¨a¯f©fÐ5°rÓ:×AÑAÀ!ÖDñ ð €Hà$+§M¡M¦OÑ Ñˆ˜5Øj‰jÜð ó ð
 ˜) V¨TÐ2ó
÷ ‰(‹*ð 	÷ Ùä"& s§{¡{Ó"3ˆãˆAØ—]‘]×(Ñ(¨¨aÓ0°Õ3ˆFØ×.Ñ.ˆG‰OØ˜MŠHñ ð
 	
‰
Üð ó ð
 œŸ
š
 7Ó+¨T°3·6±6Ð:ö	
ñ) %4ð< ‡HHŒZÓ×ÑÜ×Ñ˜[Ñ(óçf €fÔ'ð ‡HHŒ_Ó×$Ñ$Ô&à‡II„KØ€Or   )r(   Útypingr   r   r   r   Úsqlalchemy.ormr   Ú
sqlalchemyr   Úapp.db.models.anomaliesr	   Úapp.db.models.alertsr
   r4   © r   r   Ú<module>r;      s   ðÛ ß )Ó )å "Ý å 3Ý +÷2r   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\services\__pycache__\auth_service.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\__pycache__\auth_service.cpython-314.pyc
==================================================
+
    g=\iI  ã                   ó~   € ^ RI Ht ^ RIHtHt ^ RIHtHtHt ^ RI	H
t
 ^ RIHt ^ RIHt ^ RIHt R R	 ltR
 R ltR# )é    )ÚSession)ÚUserÚRole)Úhash_passwordÚverify_passwordÚcreate_access_token)ÚHTTPException)Ú
send_email)Úcreate_email_verification_token)Úsettingsc                ó<   € V ^8„  d   QhR\         R\        R\        /# ©é   ÚdbÚusernameÚpassword©r   Ústr)Úformats   "ÚNC:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\auth_service.pyÚ__annotate__r      s!   € ÷ "ñ "Œwð "¤#ð "´ñ "ó    c                 óæ  € V P                  \        4      P                  VR 7      P                  4       '       d   \	        RRR7      h\        V\        V4      RR7      pV P                  V4       V P                  4        V P                  V4       \        R\        VP                  4      RVP                  /4      p\        P                   RV 2p\        VP                  R	R
V 2RV R2R7       V# )©r   i  zUsername exists©Ústatus_codeÚdetailF)r   Úpassword_hashÚ	is_activeÚsubr   z/api/auth/verify-email?token=zVerify your PlatformOPS accountzVerify your account: ze
        <h2>Welcome to PlatformOPS</h2>
        <p>Please verify your account:</p>
        <a href="z">Verify Email</a>
        )Úto_emailÚsubjectÚtextÚhtml)Úqueryr   Ú	filter_byÚfirstr	   r   ÚaddÚcommitÚrefreshr   r   Úidr   r   ÚAPP_PUBLIC_BASE_URLr
   )r   r   r   ÚuserÚtokenÚ
verify_urls   &&&   r   Úsignupr0      sî   € Ø	‡xx”ƒ~×Ñ¨ÐÓ2×8Ñ8×:Ò:Ü¨Ð4EÔFÐFäØÜ# HÓ-Øô€Dð
 ‡FFˆ4„LØ‡II„KØ‡JJˆtÔä+ØŒs4—7‘7‹|ØD—M‘Mð-ó €Eô ×'Ñ'Ð
(Ø
'¨ wð	0ð ô
 Ø—‘Ø1Ø$ Z LÐ1ðð ð 	ðõ		ð €Kr   c                ó<   € V ^8„  d   QhR\         R\        R\        /# r   r   )r   s   "r   r   r   1   s!   € ÷ ñ Œgð ¤ð ´ñ r   c           
      óÆ  € V P                  \        4      P                  VR 7      P                  4       pV'       d   \	        W#P
                  4      '       g   \        RRR7      hVP                  '       g   \        RRR7      hVP                   Uu. uF  qDP                  NK  	  ppRV9   p\        R\        VP                  4      RVP                  R	VR
V/4      pV# u upi )r   i‘  zInvalid credentialsr   i“  z'Account not verified. Check your email.Úadminr    r   ÚrolesÚis_admin)r%   r   r&   r'   r   r   r	   r   r4   r+   r   r   r   )r   r   r   r-   Úrr4   r5   r.   s   &&&     r   Úloginr7   1   sÄ   € Ø8‰8”D‹>×#Ñ#¨XÐ#Ó6×<Ñ<Ó>€Dß” x×1CÑ1C×DÒDÜ¨Ð4IÔJÐJà>>ˆ>ÜØØ<ô
ð 	
ð
  Ÿ:š:Ó&™:aTŒT™:€EÐ&Ø˜%Ñ€HäØŒs4—7‘7‹|ØD—M‘MØØHð	!ó €Eð €Lùò 's   ÂCN)Úsqlalchemy.ormr   Úapp.db.models.usersr   r   Úapp.core.securityr   r   r   Úfastapir	   Úapp.services.email_servicer
   r   Úapp.core.configr   r0   r7   © r   r   Ú<module>r?      s(   ðå "ß *ß QÑ QÝ !Ý 1Ý =Ý $õ"÷Jr   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\services\__pycache__\components_service.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\__pycache__\components_service.cpython-314.pyc
==================================================
+
    I£eiÛ   ã                   óº   € ^ RI Ht ^ RIHt ^ RIHt ^ RIHt ^ RIH	t	 ^ RI
Ht ^ RIHtHt ^ RIHt ^ R	IHt ^ R
ItR R ltR R ltR R ltR R ltR R ltR
# )é    )ÚSession)Úfunc)ÚSignal)Ú	AlertRule)ÚTimeSeriesPoint)ÚInjectedAnomaly)Úcomponent_healthÚforecast_signal)Úcompute_propagation)Úsignal_change_impactNc                óH   € V ^8„  d   QhR\         R\        R\        R\        /# )é   ÚdbÚcomponent_codeÚlimitÚmin_correlation)r   ÚstrÚintÚfloat)Úformats   "ÚTC:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\components_service.pyÚ__annotate__r      s)   € ÷ ñ œGð ´Sð Äð ÔW\ñ ó    c                 óÀ  € V P                  \        4      P                  \        P                  V8H  4      P	                  4        Uu. uF  qDP
                  NK  	  ppV'       g   R R/# . pV EF%  pV P                  \        P
                  4      P                  \        P
                  V8g  4      P                  ^4      P	                  4        FÁ  p\        WV^ ,          4      p	V	R,          V8¼  g   K&  TP                  RV^ ,          RV P                  \        P                  4      P                  \        P
                  V^ ,          8H  4      P                  4       RV	R,          RV	R,          RV	R,          RV	R,          ^ 8”  d   R	MR
/4       KÃ  	  EK(  	  V U
u/ uF  qªR,          V
bK  	  pp
\        VP                  4       R RR7      RV pRVRVRV/# u upi u up
i )ÚerrorúNo signals for componentÚcorrelationÚsignal_coder   Ú	lag_ticksÚ
confidenceÚconfidence_scoreÚ	directionÚupstreamÚ
downstreamc                 ó   € V R ,          # )r   © ©Úxs   &r   Ú<lambda>Ú%get_related_signals.<locals>.<lambda>$   s	   € À1À]ÖCSr   T©ÚkeyÚreverseNÚprimary_signalsÚrelated)Úqueryr   Úfilterr   Úallr   r   r   ÚappendÚscalarÚsortedÚvalues)r   r   r   r   Úsr.   r/   ÚprimaryÚother_signalÚpropÚrÚunique_relatedÚsorted_relateds   &&&&         r   Úget_related_signalsr>      s°  € à.0¯h©h´vÓ.>×.EÑ.EÄf×F[ÑF[Ð_mÑFmÓ.n×.rÑ.rÔ.tÓuÑ.t¨—}”}Ñ.t€OÐuçØÐ3Ð4Ð4à€GÜ"ˆàŸH™H¤V×%7Ñ%7Ó8×?Ñ?Ä×@RÑ@RÐV]Ñ@]Ó^×dÑdÐegÓh×lÑlÖnˆLÜ& r°LÀµOÓDˆDØMÕ" oÖ5Ø—‘Ø! <°¥?Ø$ b§h¡h¬v×/DÑ/DÓ&E×&LÑ&LÌV×M_ÑM_ÐcoÐpqÕcrÑMrÓ&s×&zÑ&zÓ&|Ø  kÕ!2Ø! 4¨Õ#6Ø  $Ð'9Õ":Ø¨t°KÕ/@À1Ô/D¡È,ð ö ô oñ #ñ 4;Ó;±7¨a˜Õ&¨Ò)±7€NÐ;Ü˜N×1Ñ1Ó3Ñ9SÐ]aÔbÐciÐdiÐj€Nð 	˜.Ø˜?Ø>ðð ùò1 vùò* <s   ÁGÆGc                ó0   € V ^8„  d   QhR\         R\        /# ©r   r   r   ©r   r   )r   s   "r   r   r   ,   s   € ÷ ñ œWð ´cñ r   c                 ór  € V P                  \        4      P                  \        P                  V8H  4      P	                  4       pV'       g   R R/# \        W4      p/ pV FÆ  pVP                  ;'       g    RpWd9  d	   R. R. /WF&   VP                  '       d=   ^dVP                  VP                  ,
          VP                  ,          ^d,          ,
          M^dpWF,          R,          P                  V4       V^F8  g   Kž  WF,          R,          P                  VP                  4       KÈ  	  VP                  4        F9  w  rhVR,          '       d   \        P                  ! VR,          4      M^ VR&   VR K;  	  VP                  4        UUu. uF  w  rhVR,          ^28  g   K  VNK  	  p	ppRVRVRVR	V	/# u uppi )
r   r   ÚunknownÚscoresÚworst_signalsÚscorer   Úoverall_healthÚ	by_familyÚcritical_families)r0   r   r1   r   r2   r	   ÚfamilyÚ	thresholdÚcurrent_valuer3   r   ÚitemsÚ
statisticsÚmean)
r   r   ÚsignalsÚoverallrH   r7   ÚfamÚsignal_healthÚdatarI   s
   &&        r   Úget_health_breakdownrU   ,   sz  € Øh‰h”vÓ×%Ñ%¤f×&;Ñ&;¸~Ñ&MÓN×RÑRÓT€GßØÐ3Ð4Ð4ä˜rÓ2€Gà€IÛˆØh‰h×#Ð#˜)ˆØÔØ&¨¨O¸RÐ@ˆI‰NàUV×U`×U`ÐU`˜˜qŸ™°·±Õ<ÀÇÁÕKÈcÕQÖQÐfiˆØxÕ ×'Ñ'¨Ô6Ø˜2ÖØN˜?Õ+×2Ñ2°1·=±=ÖAñ ð —_‘_Ö&‰	ˆØ;?À¿>¼>œ
Ÿš¨¨X­Ô7ÈqˆˆW‰ØŠNñ 'ð /8¯o©oÔ.?ÔVÑ.?¡ À4ÈÅ=ÐSUÑCUŸ˜Ñ.?ÐÑVð 	˜.Ø˜'ØYØÐ.ð	ð ùó Ws   Æ	F3Æ F3c                óH   € V ^8„  d   QhR\         R\        R\        R\        /# )r   r   r   rJ   Úwindow©r   r   r   )r   s   "r   r   r   K   s(   € ÷ /ñ /œGð /´Sð /Ä#ð /Ìsñ /r   c                 ó>  € V P                  \        4      P                  \        P                  V8H  \        P                  V8H  4      P                  4       pV'       g   R R/# V P                  \        P                  ! \        P                  4      4      P                  4       pWS,
          p. p. pV EF  p	V P                  \        P                  \        P                  V	P                  ,          P                  P                  \        4      P!                  R4      4      P                  \        P                  V8H  \        P                  P#                  We4      4      P%                  \        P                  4      P                  4       p
V
 Uu. uF  q»P&                  f   K  VP&                  NK   	  ppVP)                  V4       \+        V
4      ^
8”  d”   \+        V
4      ^
,          p\-        ^ \+        V
4      V4       UUu. uF^  pRW®,          P                  R\.        P0                  ! W®Wí,             Uu. uF  q»P&                  f   K  VP&                  NK   	  up4      /NK`  	  pppM8V
 Uu. uF,  q»P&                  f   K  RVP                  RVP&                  /NK.  	  ppVP3                  V	P4                  V/4       EK  	  V'       g   R R/# \.        P0                  ! V4      p\.        P6                  ! V^R7      ^,          pV\.        P0                  ! VR\+        V4      ^,           4      8”  d   RM1V\.        P0                  ! VR\+        V4      ^,           4      8  d   R	MR
pRTR\+        V4      RTRTRTRV'       d   ^dVV,          ^
,          ,
          M^ RVRV P                  \8        4      P                  \8        P                  V8H  \8        P                  V8H  \8        P:                  V^<,
          8„  4      P=                  4       /# u upi u upi u uppi u upi )r   zNo signals in familyÚvalueNÚtickÚavgzNo data in window)ÚnÚupÚdownÚflatrJ   Úsignal_countÚ	avg_valueÚ	p95_valueÚtrendÚhealth_contributionÚmini_seriesÚthreshold_breaches_last_hour)r0   r   r1   r   rJ   r2   r   Úmaxr   r[   r4   ÚpayloadÚcolumn_nameÚastextÚcastr   ÚlabelÚbetweenÚorder_byrZ   ÚextendÚlenÚrangerN   rO   r3   r   Ú	quantilesÚ
AlertEventÚ
tick_startÚcount)r   r   rJ   rW   rP   Úmax_tickÚ
start_tickr6   rf   r7   Úrowsr;   Ú
sig_valuesÚstepÚiÚminir\   Úp95rd   s   &&&&               r   Úget_family_snapshotr   K   s¶  € Øh‰h”vÓ×%Ñ%¤f×&;Ñ&;¸~Ñ&MÌvÏ}É}Ð`fÑOfÓg×kÑkÓm€GßØÐ/Ð0Ð0ð x‰xœŸš¤×!5Ñ!5Ó6Ó7×>Ñ>Ó@€HØÕ"€Jà€FØ€KÜˆØx‰xÜ× Ñ Ü×#Ñ# A§M¡MÕ2×9Ñ9×>Ñ>¼uÓE×KÑKÈGÓTó
÷ ‰&Ü×*Ñ*¨nÑ<Ü× Ñ ×(Ñ(¨Ó>ó
÷ ‰(”?×'Ñ'Ó
(¯©«ð 	ñ (,ÓC¡t !¯w©w”ga—g”g¡tˆ
ÐCØ‰jÔ!ô ˆt‹9rŒ>Üt“9 •?ˆDô GLð  MNô  PSð  TXó  PYð  [_ô  G`ô  añ  G`ð  BCV˜TWŸ\™\¨5´*·/²/ÐTXÐ[\Õ[aÑTbÓBzÑTbÈq×fmÑfmÄ7À1Ç7Ä7ÑTbÑBzÓ2{Ó|ñ  G`ˆDñ  aˆDá>BÓZ¹d¸ÇgÁgÔ4V˜QŸV™V U¨A¯G©GÓ4¹dˆDÐZØ×Ñ˜AŸM™M¨4Ð0×1ñ% ÷( ØÐ,Ð-Ð-ä
/Š/˜&Ó
!€CÜ
×
Ò
˜v¨Ô
,¨RÕ
0€CØœ*Ÿ/š/¨&°´#°f³+¸qµ.Ð*AÓBÔB‰DÐRUÔXb×XgÒXgÐhnÐo~ÔpsÐtzÓp{Ð}~Õp~Ðhó  YAô  SAÉð  GM€Eð 	&Øœ˜G›ØSØSØØ¿˜s c¨C¥i°"¥nÖ5À!Ø{Ø&¨¯©´Ó(<×(CÑ(CÄJ×D]ÑD]ÐaoÑDoÔq{÷  rCñ  rCð  GMñ  rMô  OY÷  Odñ  Odð  goð  rtõ  gtñ  Otó  )u÷  ){ñ  ){ó  )}ð	ð 	ùò% Dùò C{ùó  aùâZs6   ÆP
Æ!P
Ç?4PÈ3PÉPÉPÉ+PÉ?PÐPc                ó0   € V ^8„  d   QhR\         R\        /# r@   rA   )r   s   "r   r   r   |   s   € ÷ ñ ¤ð ¼#ñ r   c                 ót  € V P                  \        4      P                  \        P                  P	                  R 4      4      P                  4       pV'       g   RR/# VP                  pV P                  \        4      P                  \        P                  V8H  4      P                  4       p. p^ pV FÎ  p\        WP                  V4      pRV9   g   K"  VR,          R,          ^ 8w  g   K9  VR,          R,          '       d-   VR,          R,          VR,          R,          ,          ^d,          M^ p	VP                  RVP                  RV	R	VR,          R
,          RVR,          R
,          /4       V\        V	4      ,          pKÐ  	  VP                  R RR7       RTRTRV'       d   V\        V4      ,          /# ^ /# )Nr   zNo active anomalyÚdeltaÚmean_changeÚbeforerO   r   Údelta_percentÚ
before_p95r~   Ú	after_p95Úafterc                 ó&   € \        V R ,          4      # )r…   )Úabsr'   s   &r   r)   Ú*get_anomaly_contribution.<locals>.<lambda>“   s   € ¤ A oÕ$6Ô 7r   Tr+   r   Úaffected_signalsÚtotal_impact_score)r0   r   r1   Úrollback_tickÚis_ÚfirstÚ	from_tickr   r   r2   r   r   r3   rŠ   Úsortrq   )
r   r   Úactive_anomalyÚ
pivot_tickrP   ÚaffectedÚtotal_impactr7   Úimpactr…   s
   &&        r   Úget_anomaly_contributionr˜   |   s‹  € Ø—X‘XœoÓ.×5Ñ5´o×6SÑ6S×6WÑ6WÐX\Ó6]Ó^×dÑdÓf€NßØÐ,Ð-Ð-à×)Ñ)€Jàh‰h”vÓ×%Ñ%¤f×&;Ñ&;¸~Ñ&MÓN×RÑRÓT€GØ€HØ€LãˆÜ% b¯-©-¸ÓDˆØfÖ ¨¥°Õ!?À1Ö!DØagÐhpÕaqÐrx×ayÔay˜V G_¨]Õ;¸fÀXÕ>NÈvÕ>VÕVÐZ]Ö]ð  @AˆMØO‰OØ˜qŸ}™}Ø Ø˜f XÕ.¨uÕ5Ø˜V G_¨UÕ3ð	ô ð œC Ó.Õ.ŠLñ ð ‡MMÑ7À€MÔFð 	˜.Ø˜HØ¿W˜l¬S°«\Õ9ðð ð KLðð r   c                ó<   € V ^8„  d   QhR\         R\        R\        /# )r   r   r   Úhorizon_ticksrX   )r   s   "r   r   r   ›   s!   € ÷ ñ œWð ´cð Ì#ñ r   c                 óž  a€ V P                  \        4      P                  \        P                  V8H  \        P                  P                  R R.4      4      P                  4       pV'       g   RR/# ^ p. pV EF  p\        WP                  V4      pVR,          pV P                  \        P                  4      P                  \        P                  VP                  8H  4      P                  4       ;'       g    \        R4      oVP                  R8X  d'   \        V3R l\        VR,          4       4       V4      MTp	W’8  d"   VP!                  R	VP                  R
V	RV/4       WH\#        V4      ,          ,          pEK  	  \#        V4      \#        V4      R,          8”  d   RM\#        V4      ^ 8”  d   RMRp
RVRVRVRV
R\%        VR R7      /# )ÚyiÚzir   zNo health signalsÚpredicted_meanÚinfÚhigher_is_worsec              3   óL   <"  € T F  w  rVR ,          S8”  g   K  Vx € K  	  R# 5i)rZ   Nr&   )Ú.0r|   ÚvrK   s   &  €r   Ú	<genexpr>Ú'get_forecast_summary.<locals>.<genexpr>§   s$   øé € ÐfÑ.K¡d aÈqÐQXÍzÐ\eÑOe§¢Ó.Kùs   ƒ$š
$Úseriesr   Úbreach_in_ticksÚpredicted_valueg333333Ó?ÚHIGHÚMEDIUMÚLOWr   rš   Úpredicted_healthÚ
risk_levelÚrisky_signalsc                 ó   € V R ,          # )r§   r&   r'   s   &r   r)   Ú&get_forecast_summary.<locals>.<lambda>¹   s
   € °QÐ7HÖ5Ir   )r,   )r0   r   r1   r   Úsignal_typeÚin_r2   r
   r   r   rK   r4   r   ÚpolarityÚnextÚ	enumerater3   rq   r5   )r   r   rš   rP   r¬   Úriskyr7   Úforecastr¨   r§   r­   rK   s   &&&        @r   Úget_forecast_summaryr¸   ›   s¬  ø€ Øh‰h”vÓ×%Ñ%¤f×&;Ñ&;¸~Ñ&MÌv×OaÑOa×OeÑOeÐgkÐmqÐfrÓOsÓt×xÑxÓz€GßØÐ,Ð-Ð-àÐØ€EäˆÜ" 2§}¡}°mÓDˆØ"Ð#3Õ4ˆØ—H‘HœY×0Ñ0Ó1×8Ñ8¼×9NÑ9NÐRS×R_ÑR_Ñ9_Ó`×gÑgÓi×yÐyÔmrÐsxÓmyˆ	Øz{÷  {Eñ  {Eð  IZô  {Zœ$Ôf¬i¸ÀÕ8JÔ.KÓfÐhuÔvð  `mˆàÔ*ØL‰LØ˜qŸ}™}Ø! ?Ø! ?ðô ð 	¬c°'«lÕ:Õ:Óñ ô ˜u›:¬¨G«°sÕ(:Ô:‘ÌCÐPUËJÐYZÌNÁÐ`e€Jð 	˜.Ø˜ØÐ,ØjØœ Ñ+IÔJðð r   )Úsqlalchemy.ormr   Ú
sqlalchemyr   Úapp.db.models.signalsr   Úapp.db.models.alertsr   Úapp.db.models.timeseriesr   Úapp.db.models.anomaliesr   Úapp.services.analytics_servicer	   r
   Ú app.services.propagation_servicer   r   rN   r>   rU   r   r˜   r¸   r&   r   r   Ú<module>rÁ      s>   ðÝ "Ý Ý (Ý *Ý 4Ý 3ß LÝ @Ý ?Û õõ@õ>/õb÷>r   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\services\__pycache__\email_service.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\__pycache__\email_service.cpython-314.pyc
==================================================
+
    Ò›aiß  ã                   óB   € ^ RI t ^ RIHt ^ RIHt ^ RIHt RR R lltR# )é    N)ÚMIMEText)ÚMIMEMultipart)Úsettingsc          	      óV   € V ^8„  d   QhR\         R\         R\         R\         R,          /# )é   Úto_emailÚsubjectÚtextÚhtmlN)Ústr)Úformats   "ÚOC:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\email_service.pyÚ__annotate__r   	   s4   € ÷ 
ñ 
Üð
äð
ô ð
ô *ñ	
ó    c                 óÞ  € \        R 4      p\        P                  VR&   WR&   WR&   VP                  \	        VR4      4       V'       d   VP                  \	        VR4      4       \
        P                  ! \        P                  \        P                  4      ;_uu_ 4       pVP                  \        P                  V .VP                  4       4       RRR4       R#   + '       g   i     R# ; i)ÚalternativeÚFromÚToÚSubjectÚplainr   N)r   r   ÚSMTP_FROM_EMAILÚattachr   ÚsmtplibÚSMTPÚ	SMTP_HOSTÚ	SMTP_PORTÚsendmailÚ	as_string)r   r	   r
   r   ÚmsgÚservers   &&&&  r   Ú
send_emailr!   	   s¥   € ô ˜Ó
&€CÜ×*Ñ*€CˆKØˆIØˆ	Nà‡JJŒx˜˜gÓ&Ô'çØ
‰
”8˜D &Ó)Ô*ä	Š”h×(Ñ(¬(×*<Ñ*<×	=Ô	=ÀØ‰Ü×$Ñ$ØˆJØM‰M‹Oô	
÷ 
>×	=×	=Ò	=ús   Â 1CÃC,	)N)r   Úemail.mime.textr   Úemail.mime.multipartr   Úapp.core.configr   r!   © r   r   Ú<module>r&      s   ðã Ý $Ý .å $÷
ñ 
r   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\services\__pycache__\incident_notification_service.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\__pycache__\incident_notification_service.cpython-314.pyc
==================================================
+
    Ò›ai“  ã                   óR   € ^ RI HtHt ^ RIHt ^ RIHt ^ RIHt ^ RI	H
t
 R R ltR# )	é    )ÚDictÚList)Údefaultdict)Ú
AlertEvent)ÚIncident)Ú
send_emailc                óŠ   € V ^8„  d   QhR\         \        ,          R\        \        \         \        ,          3,          R\
        /# )é   Ú	incidentsÚalerts_by_incidentÚto_email)r   r   r   Úintr   Ústr)Úformats   "Ú_C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\incident_notification_service.pyÚ__annotate__r   
   s9   € ÷ ?ñ ?Ü”H~ð?äœS¤$¤zÕ"2Ð2Õ3ð?ô ñ?ó    c                 ó¸  € R \        V 4       R2pRRR\        V 4       2RR.pV  EF   pVP                  RRVP                   2RVP                   2RVP                   2RVP
                   2R	VP                   2RR
RRRR.4       VP                  VP                  . 4      pV Fk  pVP                  e   VP                  VP                  ,
          MRpVP                  RVP                   RVP                   RV RVP                   24       Km  	  VP                  R4       EK  	  VP                  . RO4       \        VVRP                  V4      R7       R# )z[INCIDENT REPORT] z" new critical incident(s) detectedu    ðŸš¨ PlatformOPS Incident ReportÚ zNew incidents detected: u   ðŸ“Œ Incident #zComponent      : zSeverity       : zStart tick     : zSummary        : u   ðŸ”Ž Observations:z&- Sustained metric violations detectedz(- Alert density exceeded safe thresholdsu   âš ï¸ Contributing alerts:NÚongoingu     â€¢ z | severity=z | duration=z | peak=Ú
)r   ÚsubjectÚtextz<============================================================z<------------------------------------------------------------)	r   u   ðŸ§  Operational insight:z2These incidents indicate real service degradation.zRecommended actions:z- Inspect upstream dependenciesz- Check recent deploymentsz- Monitor recovery metricsr   z6This email was generated automatically by PlatformOPS.)ÚlenÚextendÚidÚcomponent_codeÚseverityÚ
start_tickÚsummaryÚgetÚtick_endÚ
tick_startÚappendÚsignal_codeÚ
peak_valuer   Újoin)	r   r   r   r   ÚlinesÚincÚalertsÚaÚdurations	   &&&      r   Úsend_incident_summary_emailr-   
   s‚  € ð
 #¤3 y£>Ð"2Ð2TÐU€Gð 	+Ø
Ø
"¤3 y£>Ð"2Ð3Ø
Øð€Eô ˆØ‰ØØ˜cŸf™f˜XÐ&Ø × 2Ñ 2Ð3Ð4Ø §¡˜~Ð.Ø §¡Ð/Ð0Ø §¡˜}Ð-ØØ Ø4Ø6ØØ)ð
ô 	ð $×'Ñ'¨¯©°Ó3ˆÛˆAð —:‘:Ò)ð —
‘
˜QŸ\™\Ö)àð ð
 L‰LØ˜Ÿ™˜ð (ØŸJ™J˜<ð (Ø$˜:ð &ØŸ™~ð'öñ ð 	‰X×ñ= ð@ 
‡LLò 
ô 
ô ØØØY‰YuÓ÷r   N)Útypingr   r   Úcollectionsr   Úapp.db.models.alertsr   Úapp.db.models.incidentsr   Úapp.services.email_servicer   r-   © r   r   Ú<module>r4      s   ðç Ý #å +Ý ,Ý 1÷?r   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\services\__pycache__\incident_service.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\__pycache__\incident_service.cpython-314.pyc
==================================================
+
    Ò›aiP  ã                   óf   € ^ RI Ht ^ RIHt ^ RIHt ^ RIHtHt ^ RI	H
t
 ^ RIHt ^t^
tR R ltR	# )
é    )ÚSession)Údefaultdict)Ú
AlertEvent)ÚIncidentÚIncidentAlert)Úsettings)Úsend_incident_summary_emailc                ó0   € V ^8„  d   QhR\         R\        /# )é   ÚdbÚreturn)r   Údict)Úformats   "ÚRC:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\incident_service.pyÚ__annotate__r      s   € ÷ Vñ Vœ7ð V¤tñ Vó    c           
      ó‚  € ^ p^ p. p\        \        4      pV P                  \        4      P	                  \        P
                  R8H  \        P                  R8H  \        P                  R8H  4      P                  4       p\        \        4      pV F$  pWgP                  ,          P                  V4       K&  	  VP                  4        EF¼  w  r‰V P                  \        4      P	                  \        P                  V8H  \        P
                  R8H  \        P                  R8H  4      P                  4       p
\        V	4      \        8¬  p\         ;QJ d    R V	 4       F  '       g   K   RM	  RM! R V	 4       4      pV'       g	   V'       dÈ   V
'       g½   \        V\#        R V	 4       4      RRRRV 2R	7      pV P%                  V4       V P'                  4        V	 FT  pV P%                  \)        VP*                  VP*                  R
7      4       WMP*                  ,          P                  V4       KV  	  VP                  V4       V^,          pEK‡  EKŠ  V
'       g   EK•  RV
n        \-        R V	 4       4      V
n        V^,          pEK¿  	  V P1                  4        V'       d   \3        VV\4        P6                  R7       RVRV/# )r   ÚOPENÚREALÚcriticalc              3   óŠ   "  € T F9  pVP                   f   K  VP                   VP                  ,
          \        8¬  x € K;  	  R # 5i©N)Útick_endÚ
tick_startÚSUSTAINED_TICKS©Ú.0Úas   & r   Ú	<genexpr>Ú%evaluate_incidents.<locals>.<genexpr>1   s2   é € ð  
á%Øz‰zô ;ˆQZ‰Z˜!Ÿ,™,Õ&¬?Ö:Û%ùs
   ‚A—,ATFc              3   ó8   "  € T F  qP                   x € K  	  R # 5ir   )r   r   s   & r   r   r    ;   s   é € Ð"JÑ9I°A§<¦<Ó9Iùs   ‚z+Critical degradation detected on component )Úcomponent_codeÚ
start_tickÚseverityÚstatusÚoriginÚsummary)Úincident_idÚalert_event_idÚRESOLVEDc              3   óX   "  € T F   qP                   f   K  VP                   x € K"  	  R # 5ir   )r   r   s   & r   r   r    S   s   é € ð -Ù(8 1¿J¹J”JA—J–JÓ(8ùs   ‚*–*)Ú	incidentsÚalerts_by_incidentÚto_emailÚcreated_incidentsÚresolved_incidents)r   ÚlistÚqueryr   Úfilterr%   r&   r$   Úallr"   ÚappendÚitemsr   Úone_or_noneÚlenÚCRITICAL_THRESHOLDÚanyÚminÚaddÚflushr   ÚidÚmaxÚend_tickÚcommitr	   r   ÚSMTP_FROM_EMAIL)r   ÚcreatedÚresolvedÚnew_incidentsr-   ÚalertsÚalerts_by_componentr   Ú	componentÚcomponent_alertsÚopen_incidentÚdensity_triggerÚsustained_triggerÚincidents   &             r   Úevaluate_incidentsrN      sd  € Ø€GØ€Hà$&€MÜ6AÄ$Ó6GÐð 	‰”Óß	‰Ü×Ñ Ñ'Ü×Ñ Ñ'Ü×Ñ :Ñ-ó

÷
 
‰‹ð ô &¤dÓ+ÐÛˆØ×,Ñ,Õ-×4Ñ4°QÖ7ñ ð (;×'@Ñ'@×'BÑ#ˆ	ð H‰H”XÓß‰VÜ×'Ñ'¨9Ñ4Ü—‘ 6Ñ)Ü—‘ 6Ñ)ó÷
 ‰[‹]ð 	ô Ð.Ó/Ô3EÑEˆß›Cñ  
á%ó 
ŸCŸCšCñ  
á%ó 
ó 
Ð÷ ×/ß Ü#Ø#,Ü"Ñ"JÑ9IÓ"JÓJØ'Ø!Ø!ØIÈ)ÈÐUôð —‘xÔ Ø—‘”
ã)AØ—F‘FÜ%Ø(0¯©Ø+,¯4©4ôôð '§{¡{Õ3×:Ñ:¸1Ö=ñ *ð ×$Ñ$ XÔ.Ø˜1•“ò- !÷2 Š}Ø'1Ô$Ü),ñ -Ù(8ó-ó *Ô&ð ˜A•“ñe (Cðh ‡II„K÷ Ü#Ø#Ø1Ü×-Ñ-õ	
ð 	˜WØ˜hðð r   N)Úsqlalchemy.ormr   Úcollectionsr   Úapp.db.models.alertsr   Úapp.db.models.incidentsr   r   Úapp.core.configr   Ú*app.services.incident_notification_servicer	   r9   r   rN   © r   r   Ú<module>rV      s*   ðå "Ý #å +ß ;Ý $Ý Rð Ð Ø€÷Vr   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\services\__pycache__\patterns_service.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\__pycache__\patterns_service.cpython-314.pyc
==================================================
+
    p½Ii
  ã                   óR   € ^ RI t ^ RIHt ^ RIHt ^ RIHt R	R R lltR
R R lltR# )é    N)ÚSession)Útext)ÚSignalc                ó<   € V ^8„  d   QhR\         R\        R\        /# )é   ÚdbÚwindowÚzscore)r   ÚintÚfloat)Úformats   "ÚRC:\Users\h50048240\3D Objects\platformOPS\backend\app\services\patterns_service.pyÚ__annotate__r      s!   € ÷ .ñ .”gð .¤sð .¼ñ .ó    c                 óØ  € . pV P                  \        4      P                  4       pV EF8  pR pV P                  \	        V4      RVP
                  RVP                  RV/4      P                  4       pV Uu. uF  qˆP                  f   K  VP                  NK   	  p	p\        V	4      ^
8  d   K…  \        P                  ! V	4      p
\        P                  ! V	4      pV F  pVP                  f   K  \        VP                  V
,
          4      W+,          8”  g   K<  VP                  RVP                  RVP
                  RVP                   RVP                  RR	/4        EK6  	  EK;  	  V# u upi )
úé
        SELECT tick, (payload ->> :column)::double precision AS value
        FROM timeseries_points
        WHERE component_code = :component
          AND payload ? :column
        ORDER BY tick DESC
        LIMIT :window
        Ú	componentÚcolumnr	   Úsignal_codeÚcomponent_codeÚtickÚvalueÚtypeÚSPIKE)Úqueryr   ÚallÚexecuter   r   Úcolumn_nameÚfetchallr   ÚlenÚ
statisticsÚmeanÚstdevÚabsÚappendr   r   )r   r	   r
   ÚresultsÚsignalsÚsÚsqlÚrowsÚrÚvaluesr"   Ústds   &&&         r   Údetect_spikesr.      s9  € Ø€Gàh‰h”vÓ×"Ñ"Ó$€Gäˆðˆð z‰zÜ‹Ià˜Q×-Ñ-Ø˜!Ÿ-™-Ø˜&ðó
÷ ‰(‹*ð 	ñ $(Ó?¡4˜a¯7©7”'!—'”'¡4ˆÐ?äˆv‹;˜ÔÙäŠ˜vÓ&ˆÜ×Ò˜vÓ&ˆãˆAØw‰wŠÙä1—7‘7˜T•>Ó" V¥\Ö1Ø—‘Ø! 1§=¡=Ø$ a×&6Ñ&6Ø˜AŸF™FØ˜QŸW™WØ˜Gð ô ó ô ñ7 ðR €Nùò- @s   Á5E'Â	E'c                ó0   € V ^8„  d   QhR\         R\        /# )r   r   r	   )r   r   )r   s   "r   r   r   9   s   € ÷ &ñ &œð &¬ñ &r   c                 óV  € . pV P                  \        4      P                  \        P                  R 8H  4      P	                  4       pV FØ  pRpV P                  \        V4      RVP                  RVP                  RV/4      P                  4       pV Uu. uF  qwP                  f   K  VP                  NK   	  pp\        V4      ^8  d   K„  VR,          V^ ,          8”  g   K›  VP                  RVP                  RVP                  RV^ ,          RVR,          R	R
/4       KÚ  	  V# u upi )Úyir   r   r   r	   r   r   ÚfromÚtor   ÚRECOVERYéÿÿÿÿ)r   r   ÚfilterÚsignal_typer   r   r   r   r   r   r   r    r%   r   )	r   r	   r&   r'   r(   r)   r*   r+   r,   s	   &&       r   Údetect_recoveryr8   9   s  € Ø€Gàh‰h”vÓ×%Ñ%¤f×&8Ñ&8¸DÑ&@ÓA×EÑEÓG€Gãˆðˆð z‰zÜ‹Ià˜Q×-Ñ-Ø˜!Ÿ-™-Ø˜&ðó
÷ ‰(‹*ð 	ñ $(Ó?¡4˜a¯7©7”'!—'”'¡4ˆÐ?äˆv‹;˜Œ?Ùà":˜˜q	Ö!ØN‰NØ˜qŸ}™}Ø  !×"2Ñ"2Ø˜˜q	Øf˜R•jØ˜
ðö ñ3 ðB €Nùò @s   ÂD&Â(D&)é2   g      @)é   )	r!   Úsqlalchemy.ormr   Ú
sqlalchemyr   Úapp.db.models.signalsr   r.   r8   © r   r   Ú<module>r?      s!   ðã Ý "Ý Ý (÷.÷b&ñ &r   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\services\__pycache__\propagation_service.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\__pycache__\propagation_service.cpython-314.pyc
==================================================
+
    ÄñViv  ã                   ó6   € ^ RI t^ RIHt ^ RIHt RR R lltR# )é    N)ÚSession)Úget_timeseriesc                óH   € V ^8„  d   QhR\         R\        R\        R\        /# )é   ÚdbÚsource_signalÚtarget_signalÚwindow)r   ÚstrÚint)Úformats   "ÚUC:\Users\h50048240\3D Objects\platformOPS\backend\app\services\propagation_service.pyÚ__annotate__r      s0   € ÷ 8ñ 8Üð8äð8ô ð8ô ñ	8ó    c                 óØ  € \        WR R 4      p\        WR R 4      p\        V4      V8  g   \        V4      V8  d   \        R4      h\        P                  ! V Uu. uF  qfR,          NK  	  up\
        R7      p\        P                  ! V Uu. uF  qfR,          NK  	  up\
        R7      p\        P                  ! V4      ( \        P                  ! V4      ( ,          p	Wy,          pW‰,          pWwP                  4       ,
          VP                  4       ,          p
WˆP                  4       ,
          VP                  4       ,          pRp^ p\        V) V^,           4       F—  pV^ 8  d&   \        P                  ! V
R V W¾) R  4      R,          pMIV^ 8”  d&   \        P                  ! W®R  VR V)  4      R,          pM\        P                  ! W«4      R,          p\        V4      \        V4      8”  g   K“  TpTpK™  	  \        V4      \        V
4      \        V4      ,          ,          pVR8”  d   RMRpRVR	VR
VR\        \        V4      ^4      RVR\        \        V4      ^4      RV/# u upi u upi )Nz*Insufficient data for propagation analysisÚvalue)Údtypeg        gffffffæ?Ústrong_positive_propagationÚweak_or_no_propagationr   r	   r
   ÚcorrelationÚ	lag_ticksÚ
confidenceÚclassification)r   é   )r   ÚlenÚ
ValueErrorÚnpÚarrayÚfloatÚisnanÚmeanÚstdÚrangeÚcorrcoefÚabsÚround)r   r   r	   r
   ÚsrcÚtgtÚpÚ
src_valuesÚ
tgt_valuesÚmaskÚsrc_zÚtgt_zÚ	best_corrÚbest_lagÚlagÚcorrr   r   s   &&&&              r   Úcompute_propagationr3      s  € ô ˜¨D°$Ó
7€CÜ
˜¨D°$Ó
7€Cä
ˆ3ƒx&ÔœC ›H vÔ-ÜÐEÓFÐFô —’©sÓ3©s¨!˜WŸ:˜:©sÑ3¼5ÔA€JÜ—’©sÓ3©s¨!˜WŸ:˜:©sÑ3¼5ÔA€Jô HŠHZÓ Ð ¤B§H¢H¨ZÓ$8Ð#8Õ8€DØÕ!€JØÕ!€Jð Ÿ/™/Ó+Õ+¨z¯~©~Ó/?Õ?€EØŸ/™/Ó+Õ+¨z¯~©~Ó/?Õ?€Eà€IØ€HäfW˜f qjÖ)ˆØŒ7Ü—;’;˜u T c˜{¨E°$°%¨LÓ9¸$Õ?‰DØ1ŒWÜ—;’;˜u T˜{¨E°%°C°4¨LÓ9¸$Õ?‰Dä—;’;˜uÓ,¨TÕ2ˆDäˆt‹9”s˜9“~Ö%ØˆIØŠHñ *ô Y“¤3 u£:´°C³Õ#8Õ9€Jð sŒ?ñ 	&à%ð ð 	˜Ø˜Ø&Ø”uœU 9Ó-¨qÓ1ØXØ”eœE *Ó-¨qÓ1Ø˜.ðð ùòG 4ùÚ3s   ÁI"ÂI')é   )Únumpyr   Úsqlalchemy.ormr   Úapp.services.timeseries_servicer   r3   © r   r   Ú<module>r9      s   ðã Ý "Ý :÷8ñ 8r   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\services\__pycache__\signal_generation_service.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\__pycache__\signal_generation_service.cpython-314.pyc
==================================================
+
    Ò›ai÷	  ã                   óf   € ^ RI Ht ^ RIHt ^ RIHt R R ltR R ltR R	 ltR
 R lt	R R lt
R# )é    ©ÚSession)Útext)ÚSignalc                ó0   € V ^8„  d   QhR\         R\         /# ©é   Úcolumn_nameÚreturn©Ústr)Úformats   "Ú[C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\signal_generation_service.pyÚ__annotate__r      s   € ÷ ñ ¤3ð ¬3ñ ó    c                 ój   € V P                  R 4      '       d   R# V P                  R4      '       d   R# R# )ÚyÚyiÚzÚziÚxi)Ú
startswith)r
   s   &r   Úinfer_signal_typer      s-   € Ø×Ñ˜c×"Ò"ÙØ×Ñ˜c×"Ò"ÙÙr   c                ó$   € V ^8„  d   QhR\         /# )r	   Úsignal_typer   )r   s   "r   r   r      s   € ÷ ñ œSñ r   c                 ó2   € V R 8X  d   R.# V R8X  d   RR.# R.# )r   Úopsr   Ú	architectÚexec© )r   s   &r   Úinfer_rolesr!      s+   € ØdÔØˆwˆØdÔØ˜VÐ$Ð$Øˆ8€Or   c                ó0   € V ^8„  d   QhR\         R\         /# r   r   )r   s   "r   r   r      s   € ÷ ñ œCð ¤Cñ r   c                 óš   € R RRRRRRRRR	R
RRRRRRRRR/
pVP                  4        F   w  r#V P                  V4      '       g   K  Vu # 	  R# )Ú_msÚmsÚ_secÚsecÚ_percentÚpercentÚ_ratioÚratioÚ_bytesÚbytesÚ_kbÚkbÚ_mbÚmbÚ_countÚcountÚ_rateÚrateÚ_probabilityÚprobabilityÚvalue)ÚitemsÚendswith)r
   ÚmappingÚsuffixÚunits   &   r   Ú
infer_unitr>      sj   € àˆtØØIØ'Ø'ØˆtØˆtØ'ØØ˜ð€Gð  Ÿ™ž‰ˆØ×Ñ ×'Ô'ØŠKñ (ñ r   c                ó0   € V ^8„  d   QhR\         R\         /# )r	   Ú
text_valuer   r   )r   s   "r   r   r   )   s   € ÷ 5ñ 5œð 5¤ñ 5r   c                 óB   € V P                  R R4      P                  4       # )Ú_Ú )ÚreplaceÚ
capitalize)r@   s   &r   ÚhumanizerF   )   s   € Ø×Ñ˜c 3Ó'×2Ñ2Ó4Ð4r   c                ó$   € V ^8„  d   QhR\         /# )r	   Údbr   )r   s   "r   r   r   -   s   € ÷ 1ñ 1œñ 1r   c                óP  € V P                  \        R4      4      P                  4       P                  4       p^ pV F×  pVR,          pVR,          pVP	                  4        F®  pV RV 2pV P                  \        4      P                  \        P                  V8H  4      P                  4       pV'       d   KW  \        V4      p	\        VVVV	\        V4      R\        V4      \        V	4      RV 2R7	      p
V P                  V
4       V^,          pK°  	  KÙ  	  V P                  4        V# )zQ
Discover all metrics from timeseries_points.payload
and insert missing signals.
z¬
        SELECT DISTINCT ON (component_code)
               component_code,
               payload
        FROM timeseries_points
        ORDER BY component_code, tick
    Úcomponent_codeÚpayloadÚ.Úhigher_is_worseÚAUTO_)	Úsignal_coderJ   r
   r   r=   ÚpolarityÚdescriptionÚvisible_to_rolesÚfamily)Úexecuter   ÚmappingsÚallÚkeysÚqueryr   ÚfilterrO   Úfirstr   r>   rF   r!   ÚaddÚcommit)rH   ÚrowsÚcreatedÚrowÚ	componentrK   r
   rO   Úexistsr   Úsignals   &          r   Úgenerate_signalsrc   -   s  € ð :‰:”dð ó 	ó 
÷ ‰(‹*—S‘S“Uð 	ð €GãˆØÐ(Õ)ˆ	Øi•.ˆà"Ÿ<™<ž>ˆKØ&˜K q¨¨Ð6ˆKà—X‘XœfÓ%×,Ñ,Ü×"Ñ" kÑ1óç‰e‹gð ÷ Ùä+¨KÓ8ˆKäØ'Ø(Ø'Ø'Ü Ó,Ø*Ü$ [Ó1Ü!,¨[Ó!9Ø˜y˜kÐ*ô
ˆFð F‰F6ŒNØqLŠGó3 *ñ	 ð> ‡II„KØ€Nr   N)Úsqlalchemy.ormr   Ú
sqlalchemyr   Úapp.db.models.signalsr   r   r!   r>   rF   rc   r    r   r   Ú<module>rg      s'   ðå "Ý Ý (õõõõ&5÷1r   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\services\__pycache__\signal_service.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\__pycache__\signal_service.cpython-314.pyc
==================================================
+
    …äViN  ã                   ó*   € ^ RI Ht ^ RIHt R R ltR# )é    )ÚSession)ÚSignalc                ó0   € V ^8„  d   QhR\         R\        /# )é   ÚdbÚrole)r   Ústr)Úformats   "ÚPC:\Users\h50048240\3D Objects\platformOPS\backend\app\services\signal_service.pyÚ__annotate__r      s   € ÷ ñ ”Wð ¤Cñ ó    c                 óø   € V P                  \        4      P                  \        P                  P	                  V4      4      P                  \        P                  \        P                  4      P                  4       # )N)	Úqueryr   ÚfilterÚvisible_to_rolesÚanyÚorder_byÚcomponent_codeÚsignal_codeÚall)r   r   s   &&r   Úlist_signalsr      sM   € à
‰”Óß	‰”×'Ñ'×+Ñ+¨DÓ1Ó	2ß	‰”&×'Ñ'¬×);Ñ);Ó	<ß	‰‹ð	r   N)Úsqlalchemy.ormr   Úapp.db.models.signalsr   r   © r   r   Ú<module>r      s   ðå "Ý (÷r   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\services\__pycache__\timeseries_service.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\__pycache__\timeseries_service.cpython-314.pyc
==================================================
+
    ˜eiý  ã                   óÒ   € ^ RI t ^ RIHt ^ RIHtHt ^ RIHt ^ RIHt ^ RIH	t	 ^ RI
t
R R ltRR ltRR	 R
 lltRR R lltR R ltR R ltR tRR R lltR R ltR R ltR# )é    N©ÚSession)ÚFloatÚtext)ÚSignal)ÚTimeSeriesPointc          	      ód   € V ^8„  d   QhR\         R\        R\        R,          R\        R,          /# )é   ÚdbÚsignal_codeÚ	from_tickNÚto_tick©r   ÚstrÚint)Úformats   "ÚTC:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\timeseries_service.pyÚ__annotate__r      s8   € ÷ 7ñ 7Üð7äð7ô Tzð7ô 4Zñ	7ó    c           	      ó  € V P                  \        4      P                  \        P                  V8H  4      P	                  4       pV'       g   \        R V 24      hVP                  pVP                  pRpRVRV/pVe   VR,          pW(R&   Ve   VR,          pW8R&   VR,          pV P                  \        V4      V4      P                  4       p	V	 U
u. uF)  p
R	V
P                  R
V
P                  RV
P                  /NK+  	  up
# u up
i )zUnknown signal_code: zò
        SELECT
            tick,
            timestamp,
            (payload ->> :column_name)::double precision AS value
        FROM timeseries_points
        WHERE component_code = :component_code
          AND payload ? :column_name
    Úcomponent_codeÚcolumn_namez AND tick >= :from_tickr   z AND tick <= :to_tickr   z ORDER BY tickÚtickÚ	timestampÚvalue)Úqueryr   Úfilterr   Úone_or_noneÚ
ValueErrorr   r   Úexecuter   Úfetchallr   r   r   )r   r   r   r   Úsignalr   r   ÚsqlÚparamsÚrowsÚrs   &&&&       r   Úget_timeseriesr'      s  € ð 	‰”Óß	‰”×"Ñ" kÑ1Ó	2ß	‰‹ð ÷ ÜÐ0°°Ð>Ó?Ð?à×*Ñ*€NØ×$Ñ$€Kð€Cð 	˜.Ø{ð€Fð
 ÒØÐ(Õ(ˆØ'ˆ{ÑàÒØÐ&Õ&ˆØ#ˆyÑàÐÕ€Cà:‰:”d˜3“i Ó(×1Ñ1Ó3€Dñ óñ ˆAð	 A—F‘FØ˜Ÿ™ØQ—W‘Wó	
ñ
 ñð ùò s   Ã/Dc                 óÜ  € V P                  \        P                  \        P                  V,          P                  P                  \        4      4      P                  \        P                  V8H  4      P                  \        P                  P                  4       4      P                  V4      P                  4       p\        V4       Uu. uF  qU^,          f   K  V^,          NK  	  up# u upi )é   )r   r   r   ÚpayloadÚastextÚcastr   r   r   Úorder_byÚdescÚlimitÚallÚreversed)r   r   r   r/   r%   r&   s   &&&&  r   Ú_extract_seriesr2   D   s¥   € à
‰Ü× Ñ Ü×#Ñ# KÕ0×7Ñ7×<Ñ<¼UÓCó	
÷ 
‰”×.Ñ.°.Ñ@Ó	Aß	‰”/×&Ñ&×+Ñ+Ó-Ó	.ß	‰ˆu‹ß	‰‹ð 	ô # 4œ.Ó=™.Q¨a­DŒDˆAˆaDˆD™.Ñ=Ð=ùÒ=s   ÃC)ÃC)c                ó<   € V ^8„  d   QhR\         R\        R\        /# )r
   r   r   Úwindowr   )r   s   "r   r   r   T   s!   € ÷ 
$ñ 
$œ7ð 
$´ð 
$¼cñ 
$r   c                 ó.  € V P                  \        4      P                  \        P                  V8H  4      P	                  4       pV'       g   R # \        WP                  VP                  V4      p\        V4      ^8  d   R # \        P                  ! V4      # )ç        )r   r   r   r   Úfirstr2   r   r   ÚlenÚ
statisticsÚstdev)r   r   r4   r"   Úvaluess   &&&  r   Úcompute_volatilityr<   T   sn   € ØX‰X”fÓ×$Ñ$¤V×%7Ñ%7¸;Ñ%FÓG×MÑMÓO€FßÙä˜R×!6Ñ!6¸×8JÑ8JÈFÓS€Fä
ˆ6ƒ{Q„Ùä×Ò˜FÓ#Ð#r   c                ó<   € V ^8„  d   QhR\         R\        R\        /# )r
   r   Úroler4   r   )r   s   "r   r   r   b   s!   € ÷ ñ œ7ð ¬#ð ´sñ r   c                 ó.  € V P                  \        4      P                  4       p. pV Fé  pWP                  9  d   R VP                  9  d   K&  \	        WP
                  VP                  V4      p\        V4      ^8  d   KY  VR,          V^ ,          ,
          V,          pVP                  R8X  d'   V^ 8”  d    VP                  RVP                  RV/4       VP                  R8X  g   KÁ  V^ 8  g   KÊ  VP                  RVP                  RV/4       Kë  	  V# )ÚadminÚhigher_is_worser"   ÚslopeÚlower_is_worseéÿÿÿÿ)r   r   r0   Úvisible_to_rolesr2   r   r   r8   ÚpolarityÚappendr   )r   r>   r4   ÚsignalsÚresultsÚsr;   rB   s   &&&     r   Údetect_degradationrK   b   sà   € Øh‰h”vÓ×"Ñ"Ó$€GØ€GãˆØ×)Ñ)Ô)¨g¸Q×=OÑ=OÔ.OÙä  ×%5Ñ%5°q·}±}ÀfÓMˆÜˆv‹;˜Œ?Ùà˜•˜f QiÕ'¨6Õ1ˆà:‰:Ð*Ô*¨u°q¬yØN‰N˜H a§m¡m°W¸eÐDÔEà:‰:Ð)Ö)¨e°a®iØN‰N˜H a§m¡m°W¸eÐDÖEñ ð  €Nr   c                ó0   € V ^8„  d   QhR\         R\        /# )r
   r   r   )r   r   )r   s   "r   r   r   z   s   € ÷ 7ñ 7œð 7´#ñ 7r   c                 ó¢  € V P                  \        4      P                  \        P                  V8H  \        P                  R 8H  4      P                  4       p. pV F=  p\        WVP                  ^R7      pV'       g   K%  VP                  V^ ,          4       K?  	  V'       g   R# \        RR\        V4      \        V4      ,          ,
          4      # )Úyi©r/   g      Y@r6   )r   r   r   r   Úsignal_typer0   r2   r   rG   ÚmaxÚsumr8   )r   r   rH   ÚscoresrJ   r;   s   &&    r   Úcomponent_healthrT   z   s›   € à
‰”Óß	‰”×%Ñ%¨Ñ7¼×9KÑ9KÈtÑ9SÓ	Tß	‰‹ð ð €FãˆÜ  °Q·]±]È!ÔLˆß‰6ØM‰M˜& )Ö$ñ ÷
 ÙäˆsEœC ›K¬#¨f«+Õ5Õ5Ó6Ð6r   c                ó$   € V ^8„  d   QhR\         /# )r
   r   r   )r   s   "r   r   r      s   € ÷ 	ñ 	”gñ 	r   c                 ó  € V P                  \        4      P                  \        P                  R 8H  4      P	                  4       p\        V RVP                  ^R7      pV'       d
   V^ ,          MRpRTRVR8”  d   R/# VR8”  d   R	/# R
/# )zGLOBAL.z9_collapse_riskÚGLOBALrO   r6   Úcollapse_riskÚstatusgffffffæ?ÚCRITICALgš™™™™™Ù?ÚDEGRADEDÚSTABLE)r   r   r   r   r7   r2   r   )r   r"   r;   Úrisks   &   r   Úglobal_healthr^      s   € ØX‰X”fÓ×$Ñ$¤V×%7Ñ%7Ð;TÑ%TÓU×[Ñ[Ó]€FÜ˜R ¨6×+=Ñ+=ÀQÔG€Fçˆ6!Ž9 C€Dð 	˜Ø  s¤
*ðð à>BÀS¼j°
ðð àNVðð r   c                 ó¬   € / pV F#  p \        V VP                  4       R R R7      W#&   K%  	  V#   \         d   pR\        T4      /Y#&    R p?KI  R p?ii ; i)N)r   r   r   r   Úerror)r'   ÚstripÚ	Exceptionr   )r   Úsignal_codesÚresultÚcodeÚes   &&   r   Úmulti_signalrg   ›   s_   € Ø€Fãˆð
	Ü)ØØ ŸJ™J›LØØô	ˆF‹Lñ ð €Møô ô 	àœ˜Q›ðˆFLûð	ús   ‰.®A¹AÁAc                ó<   € V ^8„  d   QhR\         R\        R\         /# )r
   r   r4   Úagg_type)r   r   )r   s   "r   r   r   ¬   s!   € ÷  ñ  ¤cð  ´3ð  Äsñ  r   c           	      ó  € \        WR R 4      pV'       g   . # . p\        ^ \        V4      V4       FË  pWFWb,            pV'       g   K  V Uu. uF  qˆR,          NK  	  p	pVR8X  d   \        V	4      \        V	4      ,          p
MGVR8X  d   \	        V	4      p
M4VR8X  d   \        V	4      p
M!VR8X  d   \        V	4      p
M\        RV 24      hVP                  RV^ ,          R,          RV^ ,          R,          RV
/4       KÍ  	  V# u upi )	Nr   ÚavgÚminrQ   rR   zUnknown aggregation type: r   r   )r'   Úranger8   rR   rl   rQ   r   rG   )r   r   r4   ri   Úpointsrd   ÚiÚchunkÚpr;   Ú	agg_values   &&&&       r   Úaggregate_signalrs   ¬   sü   € Ü˜B¨T°4Ó8€FçØˆ	à€Fä1”c˜&“k 6Ö*ˆØ˜Ð$ˆßÙá&+Ó,¡e G—**¡eˆÐ,àuÔÜ˜F›¤c¨&£kÕ1‰IØ˜ÔÜ˜F›‰IØ˜ÔÜ˜F›‰IØ˜ÔÜ˜F›‰IäÐ9¸(¸ÐDÓEÐEà‰ØE˜!•H˜VÕ$Ø˜˜q +Õ.ØYð
ö 	ñ% +ð0 €Mùò' -s   ÁDc                ó$   € V ^8„  d   QhR\         /# ©r
   r   ©r   )r   s   "r   r   r   Ï   s   € ÷ ñ ¤sñ r   c                 ó  € VP                  4       p\        WR R 4      p\        V4      ^8  d   . # . pV^ ,          pVR,           F?  pVP                  RVR,          RVR,          RVR,          VR,          ,
          /4       TpKA  	  V# )N:r)   NNr   r   r   )ra   r'   r8   rG   )r   r   rn   ÚderivativesÚprevÚcurrs   &&    r   Úderivative_signalr{   Ï   s“   € Ø×#Ñ#Ó%€Kä˜B¨T°4Ó8€Fä
ˆ6ƒ{Q„Øˆ	à€Kà!9€DØr—

ˆØ×ÑØD˜•LØ˜˜kÕ*ØT˜'•] T¨'¥]Õ2ð
ô 	ð
 Šñ ð Ðr   c                ó$   € V ^8„  d   QhR\         /# ru   rv   )r   s   "r   r   r   å   s   € ÷ ñ ¤cñ r   c                 ó°  € VP                  4       p\        WR R 4      pV'       g   . # V Uu. uF  q3R,          NK  	  pp\        V4      p\        V4      pWe8X  d'   V Uu. uF  pRVR,          RVR,          RR/NK  	  up# . pV FC  pVP	                  RVR,          RVR,          RVR,          V,
          We,
          ,          /4       KE  	  V# u upi u upi )Nr   r   r   r6   )ra   r'   rl   rQ   rG   )r   r   rn   rq   r;   Úmin_vÚmax_vÚ
normalizeds   &&      r   Únormalize_signalr   å   só   € Ø×#Ñ#Ó%€Kä˜B¨T°4Ó8€FçØˆ	á"(Ó)¡&˜Qjˆj¡&€FÐ)Ü‹K€EÜ‹K€Eð „~ñ ó
ñ ð	 ˜˜&	Ø˜Q˜{^Ø˜óñ
 ñ
ð 	
ð €JÛˆØ×ÑØAf•IØ˜˜;Øa˜•j 5Õ(¨U­]Õ;ð
ö 	ñ ð Ðùò/ *ùò
s   ¬CÁC)é   )é   )é
   rk   )r9   Úsqlalchemy.ormr   Ú
sqlalchemyr   r   Úapp.db.models.signalsr   Úapp.db.models.timeseriesr   Úmathr'   r2   r<   rK   rT   r^   rg   rs   r{   r   © r   r   Ú<module>r‹      sN   ðã Ý "ß "Ý (Ý "Ý 4Û õ7ôr>÷ 
$÷õ07õ*	ò÷" õF÷,r   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\services\__pycache__\user_service.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\__pycache__\user_service.cpython-314.pyc
==================================================
+
    JlGi–  ã                   ó:   € ^ RI Ht ^ RIHtHt ^ RIHt R R ltR# )é    )ÚSession)ÚUserÚRole)ÚHTTPExceptionc                óR   € V ^8„  d   QhR\         R\        R\        \        ,          /# )é   ÚdbÚuser_idÚroles)r   ÚstrÚlist)Úformats   "ÚNC:\Users\h50048240\3D Objects\PlatformOPS\backend\app\services\user_service.pyÚ__annotate__r      s%   € ÷ ñ ”Wð ¤sð ´4¼µ9ñ ó    c                 ó  € V P                  \        4      P                  \        P                  V8H  4      P	                  4       pV'       g   \        R RR7      hVP                  P                  4        V Fy  pV P                  \        4      P                  \        P                  V8H  4      P	                  4       pV'       g   \        RRV 2R7      hVP                  P                  V4       K{  	  V P                  4        V# )i”  zUser not found)Ústatus_codeÚdetaili  zInvalid role )Úqueryr   ÚfilterÚidÚfirstr   r   Úclearr   ÚappendÚcommit)r	   r
   r   ÚuserÚrole_idÚroles   &&&   r   Úassign_rolesr      sº   € Ø8‰8”D‹>× Ñ ¤§¡¨GÑ!3Ó4×:Ñ:Ó<€DßÜ¨Ð4DÔEÐEà‡JJ×ÑÔãˆØx‰xœ‹~×$Ñ$¤T§W¡W°Ñ%7Ó8×>Ñ>Ó@ˆßÜ¨C¸-ÈÀyÐ8QÔRÐRØ
‰
×Ñ˜$Öñ	 ð ‡II„KØ€Kr   N)Úsqlalchemy.ormr   Úapp.db.models.usersr   r   Úfastapir   r   © r   r   Ú<module>r$      s   ðå "ß *Ý !÷r   



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\utils\correlation.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\utils\correlation.py
==================================================



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\utils\stats.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\utils\stats.py
==================================================



############################################################
FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\backend_prompt_code\__pycache__\main.cpython-314.txt
############################################################

ORIGINAL FILE: C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\__pycache__\main.cpython-314.pyc
==================================================
+
    û²ei€  ã                   ó†  € ^ RI Ht ^ RIHt ^ RIHtHtHtHtH	t	H
t
 ^ RIHt ^ RIHtHtHt ^ RIHt ^ RIHt ^ RIHt ]! R	R
7      t]P)                  ]. RORR.R.R7       ]P+                  ]P,                  4       ]P+                  ]P,                  4       ]P+                  ]P,                  4       ]P+                  ]	P,                  4       ]P+                  ]
P,                  4       ]P+                  ]P,                  4       ]P+                  ]P,                  4       ]P+                  ]P,                  4       ]P+                  ]P,                  4       ]P+                  ]P,                  4       ]P+                  ]P,                  4       ]P+                  ]P,                  4       ]P+                  ]P,                  4       R# )é    )ÚFastAPI)Úsignals)ÚalertsÚ
componentsÚ
timeseriesÚpropagationÚauthÚusers)Ú	analytics)ÚsystemÚpatternsÚ	simulator)Ú	anomalies)ÚCORSMiddleware)Ú	incidentszPlatformOPS Observability API)ÚtitleTÚ*)Úallow_originsÚallow_credentialsÚallow_methodsÚallow_headersN)zhttp://localhost:5173zhttp://127.0.0.1:5173zhttp://localhost:3000)Úfastapir   Úapp.api.routersr   Úapp.apir   r   r   r   r	   r
   r   r   r   r   r   Úfastapi.middleware.corsr   r   ÚappÚadd_middlewareÚinclude_routerÚrouter© ó    Ú=C:\Users\h50048240\3D Objects\PlatformOPS\backend\app\main.pyÚ<module>r#      sP  ðå Ý #ß O× OÝ ß /Ñ /Ý Ý 2Ý ñ Ð3Ô4€Ø × Ñ ØÚ]ØØ%Ø%ð ô ð × Ñ :×$Ñ$Ô %Ø × Ñ 7—>‘>Ô "Ø × Ñ ;×%Ñ%Ô &Ø × Ñ 4—;‘;Ô Ø × Ñ 5—<‘<Ô  Ø × Ñ 9×#Ñ#Ô $Ø × Ñ 6—=‘=Ô !Ø × Ñ 6—=‘=Ô !Ø × Ñ 8—?‘?Ô #Ø × Ñ 9×#Ñ#Ô $Ø × Ñ 9×#Ñ#Ô $Ø × Ñ 9×#Ñ#Ô $Ø × Ñ :×$Ñ$Ö %r!   



